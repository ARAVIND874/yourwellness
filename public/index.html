<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>роЖро░рпЛроХрпНроХро┐роп роирогрпНрокройрпН - роЙроЩрпНроХро│рпН роЖро░рпЛроХрпНроХро┐роп ро╡ро┤ро┐роХро╛роЯрпНроЯро┐</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #E6F7FF; /* Light Blue */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1.5rem;
            color: #333333;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            box-sizing: border-box;
            transition: all 0.5s ease-in-out;
            overflow-y: auto; /* Allow scrolling for features */
        }

        body.main-content-active {
            min-height: auto;
            align-items: flex-start;
            padding-top: 2rem;
            padding-bottom: 2rem;
            overflow-y: auto;
        }

        .container {
            max-width: 640px;
            width: 100%;
            background-color: #ffffff;
            border-radius: 1.75rem;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08);
            padding: 2.5rem;
            text-align: center;
            position: relative;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .language-selector-wrapper {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
        }
        .input-wrapper {
            position: relative;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
        }
        .input-field {
            flex-grow: 1;
            padding: 1rem 1.25rem;
            padding-right: 3.5rem; /* Space for mic icon */
            border: 1px solid #D1D5DB;
            border-radius: 0.875rem;
            font-size: 1.05rem;
            box-sizing: border-box;
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .input-field:focus {
            border-color: #87CEEB;
            box-shadow: 0 0 0 3px rgba(135, 206, 235, 0.4);
        }
        .mic-button {
            position: absolute;
            right: 1rem;
            background: none;
            border: none;
            color: #0000FF;
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            transition: color 0.3s ease, background-color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        .mic-button:hover {
            color: #DC2626; /* Red */
            background-color: rgba(220, 38, 38, 0.1);
        }
        .mic-button.recording {
            color: #DC2626; /* Red */
            animation: pulse 1s infinite alternate;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.1); opacity: 0.7); }
        }

        .generate-button, .action-button, .open-tracker-button, .ai-voice-button {
            background-color: #6A0DAD; /* Dark Violet */
            color: #ffffff;
            padding: 1rem 2rem;
            border-radius: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease;
            box-shadow: 0 6px 15px rgba(106, 13, 173, 0.4);
            letter-spacing: 0.025em;
            margin-top: 1rem;
            border: none;
            display: inline-flex; /* Ensure flex behavior for centering icon/text */
            align-items: center;
            justify-content: center;
            gap: 0.5rem; /* Space between icon and text */
        }
        .generate-button:hover, .action-button:hover, .open-tracker-button:hover, .ai-voice-button:hover {
            background-color: #4B0A7B; /* Darker Violet */
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(106, 13, 173, 0.5);
        }
        .generate-button:active, .action-button:active, .open-tracker-button:active, .ai-voice-button:active {
            transform: translateY(0);
            box-shadow: 0 4px 10px rgba(106, 13, 173, 0.3);
        }
        .loading-indicator {
            display: none;
            margin-top: 2rem;
            font-size: 1.15rem;
            color: #6B7280;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #6A0DAD;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .tip-box, .result-box { /* Unified style for all output boxes */
            background-color: #FFFFAA; /* Light Yellow */
            border: 1px solid #CCCC88; /* Darker Yellow */
            border-radius: 1.25rem;
            padding: 2rem;
            margin-top: 2rem;
            text-align: left;
            color: #333333;
            line-height: 1.7;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
            font-size: 1.05rem;
            transition: all 0.5s ease-in-out;
            word-break: break-word; /* Ensure long words break */
        }
        .tip-box p, .result-box p {
            margin: 0;
        }
        .text-red-600 {
            color: #DC2626; /* Red */
        }
        /* Responsive adjustments */
        @media (max-width: 640px) {
            body {
                padding: 1rem;
            }
            .container {
                padding: 1.5rem;
                border-radius: 1.25rem;
            }
            .generate-button, .action-button, .open-tracker-button, .ai-voice-button {
                width: 100%;
                padding: 0.9rem 1.5rem;
            }
            .flex.flex-wrap.justify-center.gap-4 {
                flex-direction: column;
                gap: 0.75rem;
            }
            .language-selector-wrapper {
                top: 0.75rem;
                right: 0.75rem;
            }
            .input-wrapper {
                flex-direction: row;
                justify-content: center;
            }
            .mic-button {
                position: absolute;
                right: 0.5rem;
            }
        }
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #E6F7FF;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 1;
            transition: opacity 1s ease-out;
            overflow: hidden;
        }
        .splash-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }
        .splash-screen img {
            max-width: 25%;
            max-height: 25%;
            object-fit: contain;
        }

        /* Feature Button for Main Page */
        .features-toggle-button {
            font-size: 4rem; /* Even larger emoji size for the main toggle */
            cursor: pointer;
            padding: 1rem;
            border-radius: 1rem;
            transition: transform 0.3s ease, background-color 0.3s ease;
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            line-height: 1;
            margin-top: 2rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            background-color: #e0f2fe; /* Light blue background */
        }
        .features-toggle-button:hover {
            transform: scale(1.05);
            background-color: #bee3f8; /* Slightly darker blue hover */
        }
        .features-toggle-button span.label {
            font-size: 1rem;
            margin-top: 0.75rem;
            color: #333;
            font-weight: 600;
        }

        /* Feature Icons and Sections */
        .feature-icon-container {
            display: flex;
            justify-content: center;
            gap: 1.5rem; /* Space between icons */
            margin-top: 2rem;
            flex-wrap: wrap; /* Allow icons to wrap on smaller screens */
        }
        .feature-icon {
            font-size: 3rem; /* Larger emoji size */
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.75rem;
            transition: transform 0.2s ease, background-color 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            line-height: 1;
        }
        .feature-icon:hover {
            transform: translateY(-5px);
            background-color: rgba(135, 206, 235, 0.1); /* Light blue hover */
        }
        .feature-icon span.label {
            font-size: 0.8rem; /* Smaller text label */
            margin-top: 0.5rem;
            color: #555;
            font-weight: 500;
        }

        /* Feature sections (initially hidden, shown by JS) */
        .feature-section {
            display: none;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e5e7eb; /* Subtle separator */
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Specific feature section styles */
        .dropdown-menu {
            position: absolute;
            background-color: white;
            border: 1px solid #D1D5DB;
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            text-align: left;
            padding: 0.5rem 0;
            top: calc(100% + 5px); /* Position below input */
            left: 0;
        }
        .dropdown-menu div {
            padding: 0.75rem 1.25rem;
            cursor: pointer;
        }
        .dropdown-menu div:hover {
            background-color: #F3F4F6;
        }
        .dropdown-menu div.selected {
            background-color: #e0f2fe; /* light blue */
            font-weight: 500;
        }
        
        .tts-voice-selector {
            padding: 0.75rem;
            border: 1px solid #D1D5DB;
            border-radius: 0.875rem;
            font-size: 0.95rem;
            background-color: white;
            margin-left: 1rem;
            flex-grow: 1;
        }
        .body-map-container {
            position: relative;
            width: 100%;
            max-width: 300px; /* Adjust as needed */
            margin: 0 auto;
            border: 1px solid #ccc;
            border-radius: 10px;
            overflow: hidden;
        }
        .body-map-image {
            width: 100%;
            height: auto;
            display: block;
        }
        .pain-dot {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: red;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
            transform: translate(-50%, -50%); /* Center the dot on the click */
        }
        .pain-dot.selected {
            background-color: darkred;
            border: 2px solid yellow;
        }
        /* Hide all feature sections by default */
        .feature-section {
            display: none;
        }
        /* Show the main view or a specific section */
        #initialView, #allFeatureIconsContainer.active, .feature-section.active {
            display: block;
        }
        .back-button {
            background: none;
            border: none;
            color: #6A0DAD;
            font-weight: 600;
            cursor: pointer;
            padding: 0.5rem 0;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            font-size: 1rem;
            transition: color 0.3s ease;
        }
        .back-button:hover {
            color: #4B0A7B;
        }
    </style>
</head>
<body>
    <div id="splashScreen" class="splash-screen">
        <img src="https://placehold.co/150x150/E6F7FF/000000?text=Healthcare+Logo" alt="Healthcare related image">
    </div>

    <div class="container" id="mainContent" style="display: none;">
        <div class="language-selector-wrapper">
            <select id="languageSelect" aria-label="Select Language" class="p-2 border border-gray-300 rounded-md text-sm bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-300">
                <option value="ta">родрооро┐ро┤рпН</option>
                <option value="en">English</option>
            </select>
        </div>

        <div id="initialView">
            <h1 id="mainTitle" class="text-3xl font-bold text-gray-800 mb-4 lg:text-4xl"></h1>
            <p id="descriptionText" class="text-gray-600 mb-8 text-lg"></p>

            <h2 id="tipSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <div class="input-wrapper">
                <input type="text" id="goalInput" class="input-field" aria-label="роЙроЩрпНроХро│рпН роЖро░рпЛроХрпНроХро┐роп роЗро▓роХрпНроХрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН">
                <button id="micBtn" class="mic-button" title="роЙроЩрпНроХро│рпН роЗро▓роХрпНроХрпИрокрпН рокрпЗроЪрпБроЩрпНроХро│рпН" aria-label="роЙроЩрпНроХро│рпН роЖро░рпЛроХрпНроХро┐роп роЗро▓роХрпНроХрпИрокрпН рокродро┐ро╡рпБ роЪрпЖропрпНропро╡рпБроорпН">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" x2="12" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                    </svg>
                </button>
            </div>
            <div class="flex flex-wrap justify-center gap-4 mt-4">
                <button id="generateBtn" class="generate-button"></button>
                <button id="aiVoiceBtn" class="ai-voice-button" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg>
                </button>
                <select id="ttsVoiceSelect" class="tts-voice-selector" style="display: none;" aria-label="Select Voice"></select>
            </div>
            <div id="loading" class="loading-indicator" aria-live="polite">
                <div class="loading-spinner"></div>
                <p id="loadingText"></p>
            </div>
            <div id="tipOutput" class="tip-box" aria-live="polite"></div>

            <hr class="border-t border-gray-300 my-8">

            <h2 id="featuresTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <button id="toggleFeaturesBtn" class="features-toggle-button" title="роЕройрпИродрпНродрпБ роЕроорпНроЪроЩрпНроХро│рпИропрпБроорпН роХро╛рогрпНроХ">
                тЬи<span class="label" data-label-key="showFeaturesLabel"></span>
            </button>
        </div>

        <!-- This div will now contain both the list of icons and the individual feature sections -->
        <div id="featuresContainer" style="display: none;">
            <!-- This button takes you back to the initial view from the features section -->
            <button class="back-button" id="backToMainFromFeaturesContainer" style="display: none;">тЖР рокро┐ройрпНроЪрпЖро▓рпН</button>
            <h1 id="featuresPageTitle" class="text-3xl font-bold text-gray-800 mb-6 mt-4 lg:text-4xl"></h1>

            <!-- All feature icons container -->
            <div id="allFeatureIconsContainer" class="feature-icon-container">
                <div id="iconStepTracker" class="feature-icon" data-section="stepTrackerSection" title="рокроЯро┐ роЯро┐ро░ро╛роХрпНроХро░рпН">ЁЯСЯ<span class="label" data-label-key="stepTrackerLabel"></span></div>
                <div id="iconHeartRateTracker" class="feature-icon" data-section="heartRateTrackerSection" title="роЗродропродрпН родрпБроЯро┐рокрпНрокрпБ роЯро┐ро░ро╛роХрпНроХро░рпН">ЁЯТУ<span class="label" data-label-key="heartRateTrackerLabel"></span></div>
                <div id="iconWaterTracker" class="feature-icon" data-section="waterTrackerSection" title="родрогрпНрогрпАро░рпН роЯро┐ро░ро╛роХрпНроХро░рпН">ЁЯТз<span class="label" data-label-key="waterTrackerLabel"></span></div>
                <div id="iconJournal" class="feature-icon" data-section="journalSection" title="рооройроиро┐ро▓рпИ & роиройрпНро▒ро┐ропрпБрогро░рпНро╡рпБ роЬро░рпНройро▓рпН">ЁЯУЭ<span class="label" data-label-key="journalLabel"></span></div>
                <div id="iconLocalTips" class="feature-icon" data-section="localTipsSection" title="роЙро│рпНро│рпВро░рпН роЖро░рпЛроХрпНроХро┐роп роХрпБро▒ро┐рокрпНрокрпБроХро│рпН">ЁЯМ▒<span class="label" data-label-key="localTipsLabel"></span></div>
                <div id="iconMealPlan" class="feature-icon" data-section="mealPlanSection" title="роЙрогро╡рпБродрпН родро┐роЯрпНроЯрокрпН рокро░ро┐роирпНродрпБро░рпИроХро│рпН">ЁЯН╜я╕П<span class="label" data-label-key="mealPlanLabel"></span></div>
                <div id="iconMoodAnalysis" class="feature-icon" data-section="moodAnalysisSection" title="роЙрогро░рпНро╡рпБрокрпН рокродро┐ро╡рпЗроЯрпБ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ">ЁЯза<span class="label" data-label-key="moodAnalysisLabel"></span></div>
                <div id="iconExerciseYoga" class="feature-icon" data-section="exerciseYogaSection" title="роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐ & ропрпЛроХро╛">ЁЯд╕тАНтЩАя╕П<span class="label" data-label-key="exerciseYogaLabel"></span></div>
                <div id="iconDiseasePrevention" class="feature-icon" data-section="diseasePreventionSection" title="роирпЛропрпН родроЯрпБрокрпНрокрпБ">ЁЯЫбя╕П<span class="label" data-label-key="diseasePreventionLabel"></span></div>
                <div id="iconWellnessChallenge" class="feature-icon" data-section="wellnessChallengeSection" title="роЖро░рпЛроХрпНроХро┐роп роЪро╡ро╛ро▓рпНроХро│рпН">ЁЯПЕ<span class="label" data-label-key="wellnessChallengeLabel"></span></div>
                <div id="iconMedicationReminder" class="feature-icon" data-section="medicationReminderSection" title="рооро░рпБроирпНродрпБ роиро┐ройрпИро╡рпВроЯрпНроЯро▓рпН">тП░<span class="label" data-label-key="medicationReminderLabel"></span></div>
                <div id="iconBodyPainMapping" class="feature-icon" data-section="bodyPainMappingSection" title="роЙроЯро▓рпН ро╡ро▓ро┐ роорпЗрокрпНрокро┐роЩрпН">ЁЯУН<span class="label" data-label-key="bodyPainMappingLabel"></span></div>
                <div id="iconFirstAidEmergency" class="feature-icon" data-section="firstAidEmergencySection" title="роорпБродро▓рпБродро╡ро┐ & роЕро╡роЪро░ роЙродро╡ро┐">ЁЯЖШ<span class="label" data-label-key="firstAidEmergencyLabel"></span></div>
            </div>

            <!-- All feature sections are now children of featuresContainer -->
            <div id="stepTrackerSection" class="feature-section">
                <!-- Data target for back button now points to the icons container -->
                <button class="back-button" data-target="allFeatureIconsContainer">тЖР рокро┐ройрпНроЪрпЖро▓рпН</button>
                <h2 id="stepSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <div class="input-wrapper">
                    <label for="currentStepsDisplay" class="sr-only">родро▒рпНрокрпЛродрпИроп рокроЯро┐роХро│рпН</label>
                    <input type="text" id="currentStepsDisplay" class="input-field" value="0" readonly aria-atomic="true">
                </div>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="addOneStepBtn" class="action-button"></button>
                    <button id="toggleTrackingBtn" class="action-button"></button>
                    <button id="resetStepsBtn" class="action-button"></button>
                </div>
                <div id="stepResultOutput" class="result-box" aria-live="polite"></div>
            </div>

            <div id="heartRateTrackerSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">тЖР рокро┐ройрпНроЪрпЖро▓рпН</button>
                <h2 id="heartRateSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <div class="input-wrapper">
                    <label for="currentHeartRateDisplay" class="sr-only">родро▒рпНрокрпЛродрпИроп роЗродропродрпН родрпБроЯро┐рокрпНрокрпБ</label>
                    <input type="text" id="currentHeartRateDisplay" class="input-field" value="0" readonly aria-atomic="true">
                </div>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="simulateHeartRateBtn" class="action-button"></button>
                    <button id="resetHeartRateBtn" class="action-button"></button>
                </div>
                <div id="heartRateResultOutput" class="result-box" aria-live="polite"></div>
            </div>

            <div id="waterTrackerSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">тЖР рокро┐ройрпНроЪрпЖро▓рпН</button>
                <h2 id="waterSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <div class="input-wrapper">
                    <label for="waterIntakeDisplay" class="sr-only">родро▒рпНрокрпЛродрпИроп родрогрпНрогрпАро░рпН роЙроЯрпНроХрпКро│рпНро│ро▓рпН</label>
                    <input type="text" id="waterIntakeDisplay" class="input-field" value="0 ml" readonly aria-atomic="true">
                </div>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="addWaterBtn" class="action-button"></button>
                    <button id="resetWaterBtn" class="action-button"></button>
                </div>
                <div id="waterResultOutput" class="result-box" aria-live="polite"></div>
            </div>

            <div id="journalSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">тЖР рокро┐ройрпНроЪрпЖро▓рпН</button>
                <h2 id="journalSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="journalDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper flex-col items-stretch">
                    <label for="moodSelect" class="sr-only">роЙроЩрпНроХро│рпН рооройроиро┐ро▓рпИропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН</label>
                    <select id="moodSelect" class="input-field mb-4" aria-label="роЙроЩрпНроХро│рпН рооройроиро┐ро▓рпИропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН">
                        <option value="">роЙроЩрпНроХро│рпН рооройроиро┐ро▓рпИропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН</option>
                        <option value="happy">роороХро┐ро┤рпНроЪрпНроЪро┐ ЁЯШД</option>
                        <option value="neutral">роЪро╛родро╛ро░рогроорпН ЁЯШР</option>
                        <option value="sad">роЪрпЛроХроорпН ЁЯШФ</option>
                        <option value="stressed">роорой роЕро┤рпБродрпНродроорпН ЁЯШй</option>
                        <option value="energetic">роЖро▒рпНро▒ро▓рпН ЁЯТк</option>
                    </select>
                    <label for="gratitudeInput" class="sr-only">роирпАроЩрпНроХро│рпН роиройрпНро▒ро┐ропрпБро│рпНро│ роТро░рпБ ро╡ро┐ро╖ропродрпНродрпИ роОро┤рпБродрпБроЩрпНроХро│рпН</label>
                    <textarea id="gratitudeInput" class="input-field min-h-[100px]" placeholder="роирпАроЩрпНроХро│рпН роиройрпНро▒ро┐ропрпБро│рпНро│ роТро░рпБ ро╡ро┐ро╖ропродрпНродрпИ роОро┤рпБродрпБроЩрпНроХро│рпН..." aria-label="роирпАроЩрпНроХро│рпН роиройрпНро▒ро┐ропрпБро│рпНро│ роТро░рпБ ро╡ро┐ро╖ропродрпНродрпИ роОро┤рпБродрпБроЩрпНроХро│рпН"></textarea>
                </div>
                <button id="saveJournalEntryBtn" class="action-button mt-4"></button>
                <div id="journalEntriesOutput" class="result-box mt-4 text-left"></div>
            </div>

            <div id="localTipsSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">тЖР рокро┐ройрпНроЪрпЖро▓рпН</button>
                <h2 id="localTipsSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="localTipsDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper mb-4">
                    <input type="text" id="localTipCategory" class="input-field" aria-label="роЙродро╡ро┐роХрпНроХрпБро▒ро┐рокрпНрокрпБ ро╡роХрпИропрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН" placeholder="роО.роХро╛. роороЮрпНроЪро│рпН, роорпБро░рпБроЩрпНроХрпИ, родро┐ропро╛ройроорпН...">
                    <button id="localTipMicBtn" class="mic-button" title="роЙродро╡ро┐роХрпНроХрпБро▒ро┐рокрпНрокрпБ ро╡роХрпИропрпИ рокрпЗроЪро╡рпБроорпН" aria-label="роЙродро╡ро┐роХрпНроХрпБро▒ро┐рокрпНрокрпБ ро╡роХрпИропрпИрокрпН рокродро┐ро╡рпБ роЪрпЖропрпНропро╡рпБроорпН">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" x2="12" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>
                    </button>
                    <div id="localTipCategoryDropdown" class="dropdown-menu hidden mt-2 top-full left-0"></div>
                </div>
                <button id="getLocalTipBtn" class="generate-button"></button>
                <div id="localTipOutput" class="tip-box" aria-live="polite"></div>
                <button id="localTipAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg>
                </button>
            </div>

            <div id="mealPlanSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">тЖР рокро┐ройрпНроЪрпЖро▓рпН</button>
                <h2 id="mealPlanSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="mealPlanDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper flex-col items-stretch">
                    <label for="dietGoalInput" class="sr-only">роЙрогро╡рпБ роЗро▓роХрпНроХрпБ</label>
                    <div class="input-wrapper mb-4"> <!-- Nested input-wrapper for mic -->
                        <input type="text" id="dietGoalInput" class="input-field" placeholder="роО.роХро╛. роОроЯрпИ роХрпБро▒рпИрокрпНрокрпБ, родроЪрпИ ро╡ро│ро░рпНроЪрпНроЪро┐..." aria-label="роЙрогро╡рпБ роЗро▓роХрпНроХрпБ">
                        <button id="dietGoalMicBtn" class="mic-button" title="роЙрогро╡рпБ роЗро▓роХрпНроХрпИрокрпН рокрпЗроЪро╡рпБроорпН" aria-label="роЙрогро╡рпБ роЗро▓роХрпНроХрпИрокрпН рокродро┐ро╡рпБ роЪрпЖропрпНропро╡рпБроорпН">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                <line x1="12" y1="19" x2="12" y2="23"></line>
                                <line x1="8" y1="23" x2="16" y2="23"></line>
                            </svg>
                        </button>
                    </div>

                    <label for="dietPreferenceSelect" class="sr-only">роЙрогро╡рпБ ро╡ро┐ро░рпБрокрпНрокроорпН</label>
                    <select id="dietPreferenceSelect" class="input-field mb-4" aria-label="роЙрогро╡рпБ ро╡ро┐ро░рпБрокрпНрокроорпН">
                        <option value="">роЙрогро╡рпБ ро╡ро┐ро░рпБрокрпНрокродрпНродрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН</option>
                        <option value="vegetarian">роЪрпИро╡роорпН</option>
                        <option value="non-vegetarian">роЕроЪрпИро╡роорпН</option>
                        <option value="vegan">роорпБро┤рпБ роЪрпИро╡роорпН</option>
                    </select>

                    <label for="allergiesInput" class="sr-only">роТро╡рпНро╡ро╛роорпИроХро│рпН (роЗро░рпБрокрпНрокро┐ройрпН)</label>
                    <div class="input-wrapper mb-4"> <!-- Nested input-wrapper for mic -->
                        <input type="text" id="allergiesInput" class="input-field" placeholder="роО.роХро╛. роиро┐ро▓роХрпНроХроЯро▓рпИ, рокро╛ро▓рпН..." aria-label="роТро╡рпНро╡ро╛роорпИроХро│рпН">
                        <button id="allergiesMicBtn" class="mic-button" title="роТро╡рпНро╡ро╛роорпИроХро│рпИрокрпН рокрпЗроЪро╡рпБроорпН" aria-label="роТро╡рпНро╡ро╛роорпИроХро│рпИрокрпН рокродро┐ро╡рпБ роЪрпЖропрпНропро╡рпБроорпН">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                <line x1="12" y1="19" x2="12" y2="23"></line>
                                <line x1="8" y1="23" x2="16" y2="23"></line>
                            </svg>
                        </button>
                    </div>
                </div>
                <button id="generateMealPlanBtn" class="action-button mt-4"></button>
                <div id="mealPlanOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
                <button id="mealPlanAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg>
                </button>
            </div>

            <div id="moodAnalysisSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">тЖР рокро┐ройрпНроЪрпЖро▓рпН</button>
                <h2 id="moodAnalysisSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="moodAnalysisDescription" class="text-gray-600 mb-4 text-lg"></p>
                <button id="analyzeMoodJournalBtn" class="action-button mt-4"></button>
                <div id="moodAnalysisOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
            </div>

            <div id="exerciseYogaSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">тЖР рокро┐ройрпНроЪрпЖро▓рпН</button>
                <h2 id="exerciseYogaSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="exerciseYogaDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper flex-col items-stretch">
                    <label for="fitnessLevelSelect" class="sr-only">роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐ роиро┐ро▓рпИ</label>
                    <select id="fitnessLevelSelect" class="input-field mb-4" aria-label="роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐ роиро┐ро▓рпИ">
                        <option value="">роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐ роиро┐ро▓рпИропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН</option>
                        <option value="beginner">роЖро░роорпНрокроиро┐ро▓рпИ</option>
                        <option value="intermediate">роЗроЯрпИроиро┐ро▓рпИ</option>
                        <option value="advanced">роорпЗроорпНрокроЯрпНроЯродрпБ</option>
                    </select>
                    <label for="exerciseTypeSelect" class="sr-only">роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐ ро╡роХрпИ</label>
                    <select id="exerciseTypeSelect" class="input-field mb-4" aria-label="роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐ ро╡роХрпИ">
                        <option value="">роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐ ро╡роХрпИропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН</option>
                        <option value="strength">ро╡ро▓ро┐роорпИ рокропро┐ро▒рпНроЪро┐</option>
                        <option value="cardio">роХро╛ро░рпНроЯро┐ропрпЛ</option>
                        <option value="yoga">ропрпЛроХро╛</option>
                        <option value="flexibility">роирпЖроХро┐ро┤рпНро╡рпБродрпНродройрпНроорпИ</option>
                    </select>
                </div>
                <button id="generateExercisePlanBtn" class="action-button mt-4"></button>
                <div id="exercisePlanOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
                <button id="exerciseYogaAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg>
                </button>
            </div>

            <div id="diseasePreventionSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">тЖР рокро┐ройрпНроЪрпЖро▓рпН</button>
                <h2 id="diseasePreventionSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="diseasePreventionDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper mb-4">
                    <input type="text" id="diseaseInput" class="input-field" aria-label="роирпЛропрпН роЕро▓рпНро▓родрпБ роиро┐ро▓рпИ" placeholder="роО.роХро╛. роирпАро░ро┐ро┤ро┐ро╡рпБ, роЙропро░рпН роЗро░родрпНрод роЕро┤рпБродрпНродроорпН...">
                    <button id="diseaseMicBtn" class="mic-button" title="роирпЛропрпИрокрпН рокрпЗроЪро╡рпБроорпН" aria-label="роирпЛропрпИрокрпН рокродро┐ро╡рпБ роЪрпЖропрпНропро╡рпБроорпН">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" x2="12" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>
                    </button>
                </div>
                <button id="getPreventionTipsBtn" class="action-button mt-4"></button>
                <div id="preventionTipsOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
                <button id="diseasePreventionAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg>
                </button>
            </div>

            <div id="wellnessChallengeSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">тЖР рокро┐ройрпНроЪрпЖро▓рпН</button>
                <h2 id="wellnessChallengeSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="wellnessChallengeDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper mb-4">
                    <input type="text" id="challengeTopicInput" class="input-field" aria-label="роЪро╡ро╛ро▓рпН родро▓рпИрокрпНрокрпБ" placeholder="роО.роХро╛. 30 роиро╛ро│рпН роироЯрпИрокропро┐ро▒рпНроЪро┐, роЪро░рпНроХрпНроХро░рпИ роЗро▓рпНро▓ро╛род роЪро╡ро╛ро▓рпН...">
                    <button id="challengeTopicMicBtn" class="mic-button" title="роЪро╡ро╛ро▓рпН родро▓рпИрокрпНрокрпИрокрпН рокрпЗроЪро╡рпБроорпН" aria-label="роЪро╡ро╛ро▓рпН родро▓рпИрокрпНрокрпИрокрпН рокродро┐ро╡рпБ роЪрпЖропрпНропро╡рпБроорпН">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" x2="12" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>
                    </button>
                </div>
                <button id="generateChallengeBtn" class="action-button mt-4"></button>
                <div id="challengeOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
                <button id="wellnessChallengeAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg>
                </button>
            </div>

            <div id="medicationReminderSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">тЖР рокро┐ройрпНроЪрпЖро▓рпН</button>
                <h2 id="medicationReminderSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="medicationReminderDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper flex-col items-stretch">
                    <label for="medicationNameInput" class="sr-only">рооро░рпБроирпНродро┐ройрпН рокрпЖропро░рпН</label>
                    <input type="text" id="medicationNameInput" class="input-field mb-4" placeholder="рооро░рпБроирпНродро┐ройрпН рокрпЖропро░рпН" aria-label="рооро░рпБроирпНродро┐ройрпН рокрпЖропро░рпН">
                    <label for="medicationTimeInput" class="sr-only">роирпЗро░роорпН (роО.роХро╛. 08:00, 20:00)</label>
                    <input type="time" id="medicationTimeInput" class="input-field mb-4" aria-label="роирпЗро░роорпН (роО.роХро╛. 08:00, 20:00)">
                </div>
                <button id="addMedicationReminderBtn" class="action-button mt-4"></button>
                <div id="medicationRemindersOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
            </div>

            <div id="bodyPainMappingSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">тЖР рокро┐ройрпНроЪрпЖро▓рпН</button>
                <h2 id="bodyPainMappingSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="bodyPainMappingDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="body-map-container">
                    <img src="https://placehold.co/300x500/E6F7FF/000000?text=Human+Body+Map" alt="Human Body Map" class="body-map-image" id="bodyMapImage">
                    <!-- Pain dots will be added here dynamically -->
                </div>
                <button id="clearPainDotsBtn" class="action-button mt-4"></button>
                <button id="analyzePainBtn" class="action-button mt-4"></button>
                <div id="painAnalysisOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
            </div>

            <div id="firstAidEmergencySection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">тЖР рокро┐ройрпНроЪрпЖро▓рпН</button>
                <h2 id="firstAidEmergencySectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="firstAidEmergencyDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper mb-4">
                    <input type="text" id="emergencyTopicInput" class="input-field" aria-label="роЕро╡роЪро░ родро▓рпИрокрпНрокрпБ" placeholder="роО.роХро╛. родрпАроХрпНроХро╛ропроорпН, роорпВроЪрпНроЪрпБродрпНродро┐рогро▒ро▓рпН...">
                    <button id="emergencyTopicMicBtn" class="mic-button" title="роЕро╡роЪро░ родро▓рпИрокрпНрокрпИрокрпН рокрпЗроЪро╡рпБроорпН" aria-label="роЕро╡роЪро░ родро▓рпИрокрпНрокрпИрокрпН рокродро┐ро╡рпБ роЪрпЖропрпНропро╡рпБроорпН">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" x2="12" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>
                    </button>
                </div>
                <button id="getEmergencyGuideBtn" class="action-button mt-4"></button>
                <div id="emergencyGuideOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
                <button id="firstAidEmergencyAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        // Firebase imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, collection, query, onSnapshot, addDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global Firebase variables
        let app;
        let db;
        let auth;
        let userId;

        // Initialize Firebase
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        if (Object.keys(firebaseConfig).length > 0) {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            // Sign in anonymously or with custom token
            onAuthStateChanged(auth, async (user) => {
                if (!user) {
                    try {
                        if (typeof __initial_auth_token !== 'undefined') {
                            await signInWithCustomToken(auth, __initial_auth_token);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (error) {
                        console.error("Firebase authentication failed:", error);
                    }
                }
                userId = auth.currentUser?.uid || crypto.randomUUID(); // Use authenticated UID or a random one
                console.log("Firebase User ID:", userId);
                // Now that auth is ready, you can start listening to Firestore data
                setupFirestoreListeners();
            });
        } else {
            console.warn("Firebase config not found. Running without Firestore persistence.");
            userId = crypto.randomUUID(); // Generate a random ID if Firebase is not configured
            // If Firestore is not initialized, ensure related functions handle it gracefully
        }

        // Language specific text content
        const translations = {
            ta: {
                mainTitle: "роЖро░рпЛроХрпНроХро┐роп роирогрпНрокройрпН - роЙроЩрпНроХро│рпН роЖро░рпЛроХрпНроХро┐роп ро╡ро┤ро┐роХро╛роЯрпНроЯро┐",
                descriptionText: "роЙроЩрпНроХро│рпН роЖро░рпЛроХрпНроХро┐роп роЗро▓роХрпНроХрпБроХро│рпИ роЕроЯрпИропро╡рпБроорпН, роиро▓рпНро╡ро╛ро┤рпНро╡рпИ роорпЗроорпНрокроЯрпБродрпНродро╡рпБроорпН родройро┐рокрпНрокропройро╛роХрпНроХрокрпНрокроЯрпНроЯ роХрпБро▒ро┐рокрпНрокрпБроХро│рпН рооро▒рпНро▒рпБроорпН роЕроорпНроЪроЩрпНроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.",
                tipSectionTitle: "роЙроЩрпНроХро│рпН роЖро░рпЛроХрпНроХро┐роп роЗро▓роХрпНроХрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН",
                generateBtn: "роХрпБро▒ро┐рокрпНрокрпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН",
                loadingText: "роЙроЩрпНроХро│рпБроХрпНроХрпБ роТро░рпБ роЖро░рпЛроХрпНроХро┐ропрооро╛рой роХрпБро▒ро┐рокрпНрокрпИ роЙро░рпБро╡ро╛роХрпНроХрпБроХро┐ро▒рпЗройрпН...",
                tipOutputPlaceholder: "роЗроЩрпНроХрпЗ роТро░рпБ роЖро░рпЛроХрпНроХро┐ропрооро╛рой роХрпБро▒ро┐рокрпНрокрпБ родрпЛройрпНро▒рпБроорпН...",
                showFeaturesLabel: "роЕройрпИродрпНродрпБ роЕроорпНроЪроЩрпНроХро│рпИропрпБроорпН роХро╛рогрпНроХ",
                featuresPageTitle: "роЖро░рпЛроХрпНроХро┐роп роирогрпНрокройрпН роЕроорпНроЪроЩрпНроХро│рпН",
                stepTrackerLabel: "рокроЯро┐ роЯро┐ро░ро╛роХрпНроХро░рпН",
                heartRateTrackerLabel: "роЗродропродрпН родрпБроЯро┐рокрпНрокрпБ роЯро┐ро░ро╛роХрпНроХро░рпН",
                waterTrackerLabel: "родрогрпНрогрпАро░рпН роЯро┐ро░ро╛роХрпНроХро░рпН",
                journalLabel: "рооройроиро┐ро▓рпИ & роиройрпНро▒ро┐ропрпБрогро░рпНро╡рпБ роЬро░рпНройро▓рпН",
                localTipsLabel: "роЙро│рпНро│рпВро░рпН роЖро░рпЛроХрпНроХро┐роп роХрпБро▒ро┐рокрпНрокрпБроХро│рпН",
                mealPlanLabel: "роЙрогро╡рпБродрпН родро┐роЯрпНроЯрокрпН рокро░ро┐роирпНродрпБро░рпИроХро│рпН",
                moodAnalysisLabel: "роЙрогро░рпНро╡рпБрокрпН рокродро┐ро╡рпЗроЯрпБ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ",
                exerciseYogaLabel: "роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐ & ропрпЛроХро╛",
                diseasePreventionLabel: "роирпЛропрпН родроЯрпБрокрпНрокрпБ",
                wellnessChallengeLabel: "роЖро░рпЛроХрпНроХро┐роп роЪро╡ро╛ро▓рпНроХро│рпН",
                medicationReminderLabel: "рооро░рпБроирпНродрпБ роиро┐ройрпИро╡рпВроЯрпНроЯро▓рпН",
                bodyPainMappingLabel: "роЙроЯро▓рпН ро╡ро▓ро┐ роорпЗрокрпНрокро┐роЩрпН",
                firstAidEmergencyLabel: "роорпБродро▓рпБродро╡ро┐ & роЕро╡роЪро░ роЙродро╡ро┐",
                backButton: "тЖР рокро┐ройрпНроЪрпЖро▓рпН",

                // Step Tracker
                stepSectionTitle: "рокроЯро┐ роЯро┐ро░ро╛роХрпНроХро░рпН",
                addOneStepBtn: "роТро░рпБ рокроЯро┐ роЪрпЗро░рпН",
                toggleTrackingBtn: "роЯро┐ро░ро╛роХрпНроХро┐роЩрпНроХрпИ родрпКроЯроЩрпНроХрпБ/роиро┐ро▒рпБродрпНродрпБ",
                resetStepsBtn: "рокроЯро┐роХро│рпИ роорпАроЯрпНроЯроорпИ",
                stepResultOutputPlaceholder: "роЙроЩрпНроХро│рпН рокроЯро┐роХро│рпН роЗроЩрпНроХрпЗ родрпЛройрпНро▒рпБроорпН...",

                // Heart Rate Tracker
                heartRateSectionTitle: "роЗродропродрпН родрпБроЯро┐рокрпНрокрпБ роЯро┐ро░ро╛роХрпНроХро░рпН",
                simulateHeartRateBtn: "роЗродропродрпН родрпБроЯро┐рокрпНрокрпИ роЙро░рпБро╡роХрокрпНрокроЯрпБродрпНродрпБ",
                resetHeartRateBtn: "роЗродропродрпН родрпБроЯро┐рокрпНрокрпИ роорпАроЯрпНроЯроорпИ",
                heartRateResultOutputPlaceholder: "роЙроЩрпНроХро│рпН роЗродропродрпН родрпБроЯро┐рокрпНрокрпБ роЗроЩрпНроХрпЗ родрпЛройрпНро▒рпБроорпН...",

                // Water Tracker
                waterSectionTitle: "родрогрпНрогрпАро░рпН роЯро┐ро░ро╛роХрпНроХро░рпН",
                addWaterBtn: "250ml роЪрпЗро░рпН",
                resetWaterBtn: "родрогрпНрогрпАро░рпИ роорпАроЯрпНроЯроорпИ",
                waterResultOutputPlaceholder: "роЙроЩрпНроХро│рпН родрогрпНрогрпАро░рпН роЙроЯрпНроХрпКро│рпНро│ро▓рпН роЗроЩрпНроХрпЗ родрпЛройрпНро▒рпБроорпН...",

                // Journal
                journalSectionTitle: "рооройроиро┐ро▓рпИ & роиройрпНро▒ро┐ропрпБрогро░рпНро╡рпБ роЬро░рпНройро▓рпН",
                journalDescription: "роЙроЩрпНроХро│рпН рооройроиро┐ро▓рпИропрпИрокрпН рокродро┐ро╡рпБроЪрпЖропрпНродрпБ, роирпАроЩрпНроХро│рпН роиройрпНро▒ро┐ропрпБро│рпНро│ роТро░рпБ ро╡ро┐ро╖ропродрпНродрпИ роОро┤рпБродрпБроЩрпНроХро│рпН.",
                saveJournalEntryBtn: "рокродро┐ро╡рпИроЪрпН роЪрпЗрооро┐",
                journalEntriesOutputPlaceholder: "роЙроЩрпНроХро│рпН роЬро░рпНройро▓рпН рокродро┐ро╡рпБроХро│рпН роЗроЩрпНроХрпЗ родрпЛройрпНро▒рпБроорпН...",

                // Local Tips
                localTipsSectionTitle: "роЙро│рпНро│рпВро░рпН роЖро░рпЛроХрпНроХро┐роп роХрпБро▒ро┐рокрпНрокрпБроХро│рпН",
                localTipsDescription: "роЙро│рпНро│рпВро░рпН роорпВро▓ро┐роХрпИроХро│рпН, рокро╛ро░роорпНрокро░ро┐роп роироЯрпИроорпБро▒рпИроХро│рпН роЕро▓рпНро▓родрпБ роХрпБро▒ро┐рокрпНрокро┐роЯрпНроЯ роЙрогро╡рпБрокрпН рокро┤роХрпНроХро╡ро┤роХрпНроХроЩрпНроХро│рпН рокро▒рпНро▒ро┐роп роХрпБро▒ро┐рокрпНрокрпБроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.",
                getLocalTipBtn: "роХрпБро▒ро┐рокрпНрокрпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН",
                localTipOutputPlaceholder: "роЗроЩрпНроХрпЗ роТро░рпБ роЙро│рпНро│рпВро░рпН роЖро░рпЛроХрпНроХро┐роп роХрпБро▒ро┐рокрпНрокрпБ родрпЛройрпНро▒рпБроорпН...",

                // Meal Plan
                mealPlanSectionTitle: "роЙрогро╡рпБродрпН родро┐роЯрпНроЯрокрпН рокро░ро┐роирпНродрпБро░рпИроХро│рпН",
                mealPlanDescription: "роЙроЩрпНроХро│рпН роЙрогро╡рпБ роЗро▓роХрпНроХрпБроХро│рпН, ро╡ро┐ро░рпБрокрпНрокроЩрпНроХро│рпН рооро▒рпНро▒рпБроорпН роТро╡рпНро╡ро╛роорпИроХро│ро┐ройрпН роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓рпН родройро┐рокрпНрокропройро╛роХрпНроХрокрпНрокроЯрпНроЯ роЙрогро╡рпБродрпН родро┐роЯрпНроЯроЩрпНроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.",
                generateMealPlanBtn: "роЙрогро╡рпБродрпН родро┐роЯрпНроЯродрпНродрпИ роЙро░рпБро╡ро╛роХрпНроХрпБ",
                mealPlanOutputPlaceholder: "роЙроЩрпНроХро│рпН роЙрогро╡рпБродрпН родро┐роЯрпНроЯроорпН роЗроЩрпНроХрпЗ родрпЛройрпНро▒рпБроорпН...",

                // Mood Analysis
                moodAnalysisSectionTitle: "роЙрогро░рпНро╡рпБрокрпН рокродро┐ро╡рпЗроЯрпБ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ",
                moodAnalysisDescription: "роЙроЩрпНроХро│рпН роЬро░рпНройро▓рпН рокродро┐ро╡рпБроХро│ро┐ро▓ро┐ро░рпБроирпНродрпБ роЙроЩрпНроХро│рпН рооройроиро┐ро▓рпИ рокрпЛроХрпНроХрпБроХро│рпИрокрпН рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпНропрпБроЩрпНроХро│рпН.",
                analyzeMoodJournalBtn: "рооройроиро┐ро▓рпИропрпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпН",
                moodAnalysisOutputPlaceholder: "роЙроЩрпНроХро│рпН рооройроиро┐ро▓рпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЗроЩрпНроХрпЗ родрпЛройрпНро▒рпБроорпН...",

                // Exercise & Yoga
                exerciseYogaSectionTitle: "роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐ & ропрпЛроХро╛",
                exerciseYogaDescription: "роЙроЩрпНроХро│рпН роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐ роиро┐ро▓рпИ рооро▒рпНро▒рпБроорпН ро╡ро┐ро░рпБрокрпНрокрооро╛рой роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐ ро╡роХрпИропро┐ройрпН роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓рпН родройро┐рокрпНрокропройро╛роХрпНроХрокрпНрокроЯрпНроЯ роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐ роЕро▓рпНро▓родрпБ ропрпЛроХро╛ родро┐роЯрпНроЯроЩрпНроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.",
                generateExercisePlanBtn: "роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐ родро┐роЯрпНроЯродрпНродрпИ роЙро░рпБро╡ро╛роХрпНроХрпБ",
                exercisePlanOutputPlaceholder: "роЙроЩрпНроХро│рпН роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐ родро┐роЯрпНроЯроорпН роЗроЩрпНроХрпЗ родрпЛройрпНро▒рпБроорпН...",

                // Disease Prevention
                diseasePreventionSectionTitle: "роирпЛропрпН родроЯрпБрокрпНрокрпБ",
                diseasePreventionDescription: "роТро░рпБ роХрпБро▒ро┐рокрпНрокро┐роЯрпНроЯ роирпЛропрпН роЕро▓рпНро▓родрпБ роиро┐ро▓рпИропрпИродрпН родроЯрпБрокрпНрокродро▒рпНроХро╛рой роХрпБро▒ро┐рокрпНрокрпБроХро│рпН рооро▒рпНро▒рпБроорпН родроХро╡ро▓рпНроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.",
                getPreventionTipsBtn: "родроЯрпБрокрпНрокрпБ роХрпБро▒ро┐рокрпНрокрпБроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН",
                preventionTipsOutputPlaceholder: "роирпЛропрпН родроЯрпБрокрпНрокрпБ роХрпБро▒ро┐рокрпНрокрпБроХро│рпН роЗроЩрпНроХрпЗ родрпЛройрпНро▒рпБроорпН...",

                // Wellness Challenges
                wellnessChallengeSectionTitle: "роЖро░рпЛроХрпНроХро┐роп роЪро╡ро╛ро▓рпНроХро│рпН",
                wellnessChallengeDescription: "роЙроЩрпНроХро│рпН роЖро░рпЛроХрпНроХро┐ропродрпНродрпИ роорпЗроорпНрокроЯрпБродрпНрод роЪро╡ро╛ро▓рпНроХро│рпИроХрпН роХрогрпНроЯро▒ро┐ропро╡рпБроорпН роЕро▓рпНро▓родрпБ роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН.",
                generateChallengeBtn: "роЪро╡ро╛ро▓рпИ роЙро░рпБро╡ро╛роХрпНроХрпБ",
                challengeOutputPlaceholder: "роЖро░рпЛроХрпНроХро┐роп роЪро╡ро╛ро▓рпНроХро│рпН роЗроЩрпНроХрпЗ родрпЛройрпНро▒рпБроорпН...",

                // Medication Reminder
                medicationReminderSectionTitle: "рооро░рпБроирпНродрпБ роиро┐ройрпИро╡рпВроЯрпНроЯро▓рпН",
                medicationReminderDescription: "роЙроЩрпНроХро│рпН рооро░рпБроирпНродрпБроХро│рпБроХрпНроХро╛рой роиро┐ройрпИро╡рпВроЯрпНроЯро▓рпНроХро│рпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН.",
                addMedicationReminderBtn: "роиро┐ройрпИро╡рпВроЯрпНроЯро▓рпИроЪрпН роЪрпЗро░рпН",
                medicationRemindersOutputPlaceholder: "роЙроЩрпНроХро│рпН рооро░рпБроирпНродрпБ роиро┐ройрпИро╡рпВроЯрпНроЯро▓рпНроХро│рпН роЗроЩрпНроХрпЗ родрпЛройрпНро▒рпБроорпН...",

                // Body Pain Mapping
                bodyPainMappingSectionTitle: "роЙроЯро▓рпН ро╡ро▓ро┐ роорпЗрокрпНрокро┐роЩрпН",
                bodyPainMappingDescription: "роЙроЯро▓рпН ро╡ро░рпИрокроЯродрпНродро┐ро▓рпН ро╡ро▓ро┐ рокрпБро│рпНро│ро┐роХро│рпИроХрпН роХрпБро▒ро┐роХрпНроХро╡рпБроорпН, роорпЗро▓рпБроорпН рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпНропро╡рпБроорпН.",
                clearPainDotsBtn: "ро╡ро▓ро┐ рокрпБро│рпНро│ро┐роХро│рпИ роЕро┤ро┐",
                analyzePainBtn: "ро╡ро▓ро┐ропро┐ройрпН роХро╛ро░рогродрпНродрпИрокрпН рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпН",
                painAnalysisOutputPlaceholder: "ро╡ро▓ро┐ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЗроЩрпНроХрпЗ родрпЛройрпНро▒рпБроорпН...",

                // First Aid & Emergency
                firstAidEmergencySectionTitle: "роорпБродро▓рпБродро╡ро┐ & роЕро╡роЪро░ роЙродро╡ро┐",
                firstAidEmergencyDescription: "рокрпКродрпБро╡ро╛рой роЕро╡роЪро░роиро┐ро▓рпИроХро│рпБроХрпНроХро╛рой роорпБродро▓рпБродро╡ро┐ ро╡ро┤ро┐роХро╛роЯрпНроЯро┐роХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.",
                getEmergencyGuideBtn: "ро╡ро┤ро┐роХро╛роЯрпНроЯро┐ропрпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН",
                emergencyGuideOutputPlaceholder: "роорпБродро▓рпБродро╡ро┐ ро╡ро┤ро┐роХро╛роЯрпНроЯро┐ роЗроЩрпНроХрпЗ родрпЛройрпНро▒рпБроорпН...",

                // AI Voice Button
                aiVoiceButton: "AI роХрпБро░ро▓ро┐ро▓рпН роХрпЗро│рпБроЩрпНроХро│рпН",
            },
            en: {
                mainTitle: "Arogya Nanban - Your Health Companion",
                descriptionText: "Get personalized tips and features to achieve your health goals and improve well-being.",
                tipSectionTitle: "Enter your health goal",
                generateBtn: "Get Tip",
                loadingText: "Generating a healthy tip for you...",
                tipOutputPlaceholder: "A healthy tip will appear here...",
                showFeaturesLabel: "View All Features",
                featuresPageTitle: "Arogya Nanban Features",
                stepTrackerLabel: "Step Tracker",
                heartRateTrackerLabel: "Heart Rate Tracker",
                waterTrackerLabel: "Water Tracker",
                journalLabel: "Mood & Gratitude Journal",
                localTipsLabel: "Local Health Tips",
                mealPlanLabel: "Meal Plan Recommendations",
                moodAnalysisLabel: "Mood Journal Analysis",
                exerciseYogaLabel: "Exercise & Yoga",
                diseasePreventionLabel: "Disease Prevention",
                wellnessChallengeLabel: "Wellness Challenges",
                medicationReminderLabel: "Medication Reminder",
                bodyPainMappingLabel: "Body Pain Mapping",
                firstAidEmergencyLabel: "First Aid & Emergency",
                backButton: "тЖР Back",

                // Step Tracker
                stepSectionTitle: "Step Tracker",
                addOneStepBtn: "Add One Step",
                toggleTrackingBtn: "Start/Stop Tracking",
                resetStepsBtn: "Reset Steps",
                stepResultOutputPlaceholder: "Your steps will appear here...",

                // Heart Rate Tracker
                heartRateSectionTitle: "Heart Rate Tracker",
                simulateHeartRateBtn: "Simulate Heart Rate",
                resetHeartRateBtn: "Reset Heart Rate",
                heartRateResultOutputPlaceholder: "Your heart rate will appear here...",

                // Water Tracker
                waterSectionTitle: "Water Tracker",
                addWaterBtn: "Add 250ml",
                resetWaterBtn: "Reset Water",
                waterResultOutputPlaceholder: "Your water intake will appear here...",

                // Journal
                journalSectionTitle: "Mood & Gratitude Journal",
                journalDescription: "Log your mood and write down something you are grateful for.",
                saveJournalEntryBtn: "Save Entry",
                journalEntriesOutputPlaceholder: "Your journal entries will appear here...",

                // Local Tips
                localTipsSectionTitle: "Local Health Tips",
                localTipsDescription: "Get tips on local herbs, traditional practices, or specific dietary habits.",
                getLocalTipBtn: "Get Tip",
                localTipOutputPlaceholder: "A local health tip will appear here...",

                // Meal Plan
                mealPlanSectionTitle: "Meal Plan Recommendations",
                mealPlanDescription: "Get personalized meal plans based on your dietary goals, preferences, and allergies.",
                generateMealPlanBtn: "Generate Meal Plan",
                mealPlanOutputPlaceholder: "Your meal plan will appear here...",

                // Mood Analysis
                moodAnalysisSectionTitle: "Mood Journal Analysis",
                moodAnalysisDescription: "Analyze your mood trends from your journal entries.",
                analyzeMoodJournalBtn: "Analyze Mood",
                moodAnalysisOutputPlaceholder: "Your mood analysis will appear here...",

                // Exercise & Yoga
                exerciseYogaSectionTitle: "Exercise & Yoga",
                exerciseYogaDescription: "Get personalized exercise or yoga plans based on your fitness level and preferred exercise type.",
                generateExercisePlanBtn: "Generate Exercise Plan",
                exercisePlanOutputPlaceholder: "Your exercise plan will appear here...",

                // Disease Prevention
                diseasePreventionSectionTitle: "Disease Prevention",
                diseasePreventionDescription: "Get tips and information on preventing a specific disease or condition.",
                getPreventionTipsBtn: "Get Prevention Tips",
                preventionTipsOutputPlaceholder: "Disease prevention tips will appear here...",

                // Wellness Challenges
                wellnessChallengeSectionTitle: "Wellness Challenges",
                wellnessChallengeDescription: "Discover or create challenges to improve your well-being.",
                generateChallengeBtn: "Generate Challenge",
                challengeOutputPlaceholder: "Wellness challenges will appear here...",

                // Medication Reminder
                medicationReminderSectionTitle: "Medication Reminder",
                medicationReminderDescription: "Add reminders for your medications.",
                addMedicationReminderBtn: "Add Reminder",
                medicationRemindersOutputPlaceholder: "Your medication reminders will appear here...",

                // Body Pain Mapping
                bodyPainMappingSectionTitle: "Body Pain Mapping",
                bodyPainMappingDescription: "Mark pain points on the body map for further analysis.",
                clearPainDotsBtn: "Clear Pain Dots",
                analyzePainBtn: "Analyze Pain Cause",
                painAnalysisOutputPlaceholder: "Pain analysis will appear here...",

                // First Aid & Emergency
                firstAidEmergencySectionTitle: "First Aid & Emergency",
                firstAidEmergencyDescription: "Get first aid guides for common emergencies.",
                getEmergencyGuideBtn: "Get Guide",
                emergencyGuideOutputPlaceholder: "First aid guide will appear here...",

                // AI Voice Button
                aiVoiceButton: "Listen in AI Voice",
            }
        };

        let currentLanguage = 'ta'; // Default language

        // Function to update text content based on selected language
        function updateContent() {
            const lang = currentLanguage;
            document.getElementById('mainTitle').textContent = translations[lang].mainTitle;
            document.getElementById('descriptionText').textContent = translations[lang].descriptionText;
            document.getElementById('tipSectionTitle').textContent = translations[lang].tipSectionTitle;
            document.getElementById('goalInput').placeholder = translations[lang].tipSectionTitle;
            document.getElementById('micBtn').title = translations[lang].tipSectionTitle;
            document.getElementById('micBtn').setAttribute('aria-label', translations[lang].tipSectionTitle);
            document.getElementById('generateBtn').textContent = translations[lang].generateBtn;
            document.getElementById('loadingText').textContent = translations[lang].loadingText;
            document.getElementById('tipOutput').innerHTML = `<p>${translations[lang].tipOutputPlaceholder}</p>`;
            document.getElementById('featuresTitle').textContent = translations[lang].featuresTitle;
            document.querySelector('#toggleFeaturesBtn .label').textContent = translations[lang].showFeaturesLabel;
            document.getElementById('featuresPageTitle').textContent = translations[lang].featuresPageTitle;
            document.getElementById('backToMainFromFeaturesContainer').textContent = translations[lang].backButton;

            // Update feature icon labels
            document.querySelector('#iconStepTracker .label').textContent = translations[lang].stepTrackerLabel;
            document.querySelector('#iconHeartRateTracker .label').textContent = translations[lang].heartRateTrackerLabel;
            document.querySelector('#iconWaterTracker .label').textContent = translations[lang].waterTrackerLabel;
            document.querySelector('#iconJournal .label').textContent = translations[lang].journalLabel;
            document.querySelector('#iconLocalTips .label').textContent = translations[lang].localTipsLabel;
            document.querySelector('#iconMealPlan .label').textContent = translations[lang].mealPlanLabel;
            document.querySelector('#iconMoodAnalysis .label').textContent = translations[lang].moodAnalysisLabel;
            document.querySelector('#iconExerciseYoga .label').textContent = translations[lang].exerciseYogaLabel;
            document.querySelector('#iconDiseasePrevention .label').textContent = translations[lang].diseasePreventionLabel;
            document.querySelector('#iconWellnessChallenge .label').textContent = translations[lang].wellnessChallengeLabel;
            document.querySelector('#iconMedicationReminder .label').textContent = translations[lang].medicationReminderLabel;
            document.querySelector('#iconBodyPainMapping .label').textContent = translations[lang].bodyPainMappingLabel;
            document.querySelector('#iconFirstAidEmergency .label').textContent = translations[lang].firstAidEmergencyLabel;

            // Update specific feature section titles and buttons
            document.getElementById('stepSectionTitle').textContent = translations[lang].stepTrackerLabel;
            document.getElementById('addOneStepBtn').textContent = translations[lang].addOneStepBtn;
            document.getElementById('toggleTrackingBtn').textContent = translations[lang].toggleTrackingBtn;
            document.getElementById('resetStepsBtn').textContent = translations[lang].resetStepsBtn;
            document.getElementById('stepResultOutput').innerHTML = `<p>${translations[lang].stepResultOutputPlaceholder}</p>`;

            document.getElementById('heartRateSectionTitle').textContent = translations[lang].heartRateTrackerLabel;
            document.getElementById('simulateHeartRateBtn').textContent = translations[lang].simulateHeartRateBtn;
            document.getElementById('resetHeartRateBtn').textContent = translations[lang].resetHeartRateBtn;
            document.getElementById('heartRateResultOutput').innerHTML = `<p>${translations[lang].heartRateResultOutputPlaceholder}</p>`;

            document.getElementById('waterSectionTitle').textContent = translations[lang].waterTrackerLabel;
            document.getElementById('addWaterBtn').textContent = translations[lang].addWaterBtn;
            document.getElementById('resetWaterBtn').textContent = translations[lang].resetWaterBtn;
            document.getElementById('waterResultOutput').innerHTML = `<p>${translations[lang].waterResultOutputPlaceholder}</p>`;

            document.getElementById('journalSectionTitle').textContent = translations[lang].journalLabel;
            document.getElementById('journalDescription').textContent = translations[lang].journalDescription;
            document.getElementById('saveJournalEntryBtn').textContent = translations[lang].saveJournalEntryBtn;
            document.getElementById('gratitudeInput').placeholder = translations[lang].journalDescription;
            document.getElementById('journalEntriesOutput').innerHTML = `<p>${translations[lang].journalEntriesOutputPlaceholder}</p>`;

            document.getElementById('localTipsSectionTitle').textContent = translations[lang].localTipsLabel;
            document.getElementById('localTipsDescription').textContent = translations[lang].localTipsDescription;
            document.getElementById('getLocalTipBtn').textContent = translations[lang].getLocalTipBtn;
            document.getElementById('localTipOutput').innerHTML = `<p>${translations[lang].localTipOutputPlaceholder}</p>`;
            document.getElementById('localTipCategory').placeholder = "роО.роХро╛. роороЮрпНроЪро│рпН, роорпБро░рпБроЩрпНроХрпИ, родро┐ропро╛ройроорпН..."; // Example text for Tamil

            document.getElementById('mealPlanSectionTitle').textContent = translations[lang].mealPlanLabel;
            document.getElementById('mealPlanDescription').textContent = translations[lang].mealPlanDescription;
            document.getElementById('generateMealPlanBtn').textContent = translations[lang].generateMealPlanBtn;
            document.getElementById('dietGoalInput').placeholder = "роО.роХро╛. роОроЯрпИ роХрпБро▒рпИрокрпНрокрпБ, родроЪрпИ ро╡ро│ро░рпНроЪрпНроЪро┐..."; // Example text for Tamil
            document.getElementById('allergiesInput').placeholder = "роО.роХро╛. роиро┐ро▓роХрпНроХроЯро▓рпИ, рокро╛ро▓рпН..."; // Example text for Tamil
            document.getElementById('mealPlanOutput').innerHTML = `<p>${translations[lang].mealPlanOutputPlaceholder}</p>`;

            document.getElementById('moodAnalysisSectionTitle').textContent = translations[lang].moodAnalysisLabel;
            document.getElementById('moodAnalysisDescription').textContent = translations[lang].moodAnalysisDescription;
            document.getElementById('analyzeMoodJournalBtn').textContent = translations[lang].analyzeMoodJournalBtn;
            document.getElementById('moodAnalysisOutput').innerHTML = `<p>${translations[lang].moodAnalysisOutputPlaceholder}</p>`;

            document.getElementById('exerciseYogaSectionTitle').textContent = translations[lang].exerciseYogaLabel;
            document.getElementById('exerciseYogaDescription').textContent = translations[lang].exerciseYogaDescription;
            document.getElementById('generateExercisePlanBtn').textContent = translations[lang].generateExercisePlanBtn;
            document.getElementById('exercisePlanOutput').innerHTML = `<p>${translations[lang].exercisePlanOutputPlaceholder}</p>`;

            document.getElementById('diseasePreventionSectionTitle').textContent = translations[lang].diseasePreventionLabel;
            document.getElementById('diseasePreventionDescription').textContent = translations[lang].diseasePreventionDescription;
            document.getElementById('getPreventionTipsBtn').textContent = translations[lang].getPreventionTipsBtn;
            document.getElementById('diseaseInput').placeholder = "роО.роХро╛. роирпАро░ро┐ро┤ро┐ро╡рпБ, роЙропро░рпН роЗро░родрпНрод роЕро┤рпБродрпНродроорпН..."; // Example text for Tamil
            document.getElementById('preventionTipsOutput').innerHTML = `<p>${translations[lang].preventionTipsOutputPlaceholder}</p>`;

            document.getElementById('wellnessChallengeSectionTitle').textContent = translations[lang].wellnessChallengeLabel;
            document.getElementById('wellnessChallengeDescription').textContent = translations[lang].wellnessChallengeDescription;
            document.getElementById('generateChallengeBtn').textContent = translations[lang].generateChallengeBtn;
            document.getElementById('challengeTopicInput').placeholder = "роО.роХро╛. 30 роиро╛ро│рпН роироЯрпИрокропро┐ро▒рпНроЪро┐, роЪро░рпНроХрпНроХро░рпИ роЗро▓рпНро▓ро╛род роЪро╡ро╛ро▓рпН..."; // Example text for Tamil
            document.getElementById('challengeOutput').innerHTML = `<p>${translations[lang].challengeOutputPlaceholder}</p>`;

            document.getElementById('medicationReminderSectionTitle').textContent = translations[lang].medicationReminderLabel;
            document.getElementById('medicationReminderDescription').textContent = translations[lang].medicationReminderDescription;
            document.getElementById('addMedicationReminderBtn').textContent = translations[lang].addMedicationReminderBtn;
            document.getElementById('medicationRemindersOutput').innerHTML = `<p>${translations[lang].medicationRemindersOutputPlaceholder}</p>`;

            document.getElementById('bodyPainMappingSectionTitle').textContent = translations[lang].bodyPainMappingLabel;
            document.getElementById('bodyPainMappingDescription').textContent = translations[lang].bodyPainMappingDescription;
            document.getElementById('clearPainDotsBtn').textContent = translations[lang].clearPainDotsBtn;
            document.getElementById('analyzePainBtn').textContent = translations[lang].analyzePainBtn;
            document.getElementById('painAnalysisOutput').innerHTML = `<p>${translations[lang].painAnalysisOutputPlaceholder}</p>`;

            document.getElementById('firstAidEmergencySectionTitle').textContent = translations[lang].firstAidEmergencyLabel;
            document.getElementById('firstAidEmergencyDescription').textContent = translations[lang].firstAidEmergencyDescription;
            document.getElementById('getEmergencyGuideBtn').textContent = translations[lang].getEmergencyGuideBtn;
            document.getElementById('emergencyTopicInput').placeholder = "роО.роХро╛. родрпАроХрпНроХро╛ропроорпН, роорпВроЪрпНроЪрпБродрпНродро┐рогро▒ро▓рпН..."; // Example text for Tamil
            document.getElementById('emergencyGuideOutput').innerHTML = `<p>${translations[lang].emergencyGuideOutputPlaceholder}</p>`;

            document.getElementById('aiVoiceBtn').innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg> ${translations[lang].aiVoiceButton}`;
            document.getElementById('localTipAiVoiceBtn').innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg> ${translations[lang].aiVoiceButton}`;
            document.getElementById('mealPlanAiVoiceBtn').innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg> ${translations[lang].aiVoiceButton}`;
            document.getElementById('exerciseYogaAiVoiceBtn').innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg> ${translations[lang].aiVoiceButton}`;
            document.getElementById('diseasePreventionAiVoiceBtn').innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg> ${translations[lang].aiVoiceButton}`;
            document.getElementById('wellnessChallengeAiVoiceBtn').innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg> ${translations[lang].aiVoiceButton}`;
            document.getElementById('firstAidEmergencyAiVoiceBtn').innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg> ${translations[lang].aiVoiceButton}`;

            // Update back buttons
            document.querySelectorAll('.back-button').forEach(button => {
                button.textContent = translations[lang].backButton;
            });
        }

        // Event listener for language selection
        document.getElementById('languageSelect').addEventListener('change', (event) => {
            currentLanguage = event.target.value;
            updateContent();
            populateVoiceList(); // Repopulate voices for the new language
        });

        // Splash screen functionality
        window.onload = () => {
            const splashScreen = document.getElementById('splashScreen');
            const mainContent = document.getElementById('mainContent');

            setTimeout(() => {
                splashScreen.classList.add('fade-out');
                splashScreen.addEventListener('transitionend', () => {
                    splashScreen.style.display = 'none';
                    mainContent.style.display = 'block';
                    document.body.classList.add('main-content-active'); // Adjust body styling for main content
                    updateContent(); // Initial content update
                    populateVoiceList(); // Populate voices after content is loaded
                });
            }, 1000); // Show splash screen for 1 second
        };

        // UI State Management
        let currentView = 'initial'; // 'initial', 'featuresList', 'featureSection'

        function showView(viewId) {
            document.getElementById('initialView').style.display = 'none';
            document.getElementById('featuresContainer').style.display = 'none';
            document.getElementById('allFeatureIconsContainer').style.display = 'none';
            document.getElementById('backToMainFromFeaturesContainer').style.display = 'none';

            // Hide all feature sections
            document.querySelectorAll('.feature-section').forEach(section => {
                section.style.display = 'none';
            });

            if (viewId === 'initial') {
                document.getElementById('initialView').style.display = 'block';
                document.body.classList.add('main-content-active');
                currentView = 'initial';
            } else if (viewId === 'featuresList') {
                document.getElementById('featuresContainer').style.display = 'block';
                document.getElementById('allFeatureIconsContainer').style.display = 'flex'; // Use flex for icons
                document.getElementById('backToMainFromFeaturesContainer').style.display = 'block';
                document.body.classList.add('main-content-active');
                currentView = 'featuresList';
            } else if (document.getElementById(viewId) && document.getElementById(viewId).classList.contains('feature-section')) {
                document.getElementById('featuresContainer').style.display = 'block';
                document.getElementById(viewId).style.display = 'block';
                document.getElementById('backToMainFromFeaturesContainer').style.display = 'none'; // Hide this specific back button
                document.body.classList.add('main-content-active');
                currentView = 'featureSection';
            }
        }

        // Event listener for "View All Features" button
        document.getElementById('toggleFeaturesBtn').addEventListener('click', () => {
            showView('featuresList');
        });

        // Event listener for back button from features list to main view
        document.getElementById('backToMainFromFeaturesContainer').addEventListener('click', () => {
            showView('initial');
        });

        // Event listeners for feature icons
        document.querySelectorAll('.feature-icon').forEach(icon => {
            icon.addEventListener('click', (event) => {
                const targetSectionId = event.currentTarget.dataset.section;
                showView(targetSectionId);
            });
        });

        // Event listeners for back buttons within feature sections
        document.querySelectorAll('.feature-section .back-button').forEach(button => {
            button.addEventListener('click', (event) => {
                const targetView = event.currentTarget.dataset.target;
                if (targetView === 'allFeatureIconsContainer') {
                    showView('featuresList');
                } else {
                    showView(targetView); // For future, if sections link to other specific sections
                }
            });
        });

        // Speech Recognition (Mic Button)
        const micBtn = document.getElementById('micBtn');
        const goalInput = document.getElementById('goalInput');
        let recognition;

        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US'; // Set initial language

            micBtn.addEventListener('click', () => {
                if (micBtn.classList.contains('recording')) {
                    recognition.stop();
                } else {
                    recognition.start();
                }
            });

            recognition.onstart = () => {
                micBtn.classList.add('recording');
                goalInput.placeholder = currentLanguage === 'ta' ? "рокрпЗроЪро╡рпБроорпН..." : "Speak now...";
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                goalInput.value = transcript;
                micBtn.classList.remove('recording');
                goalInput.placeholder = translations[currentLanguage].tipSectionTitle;
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                micBtn.classList.remove('recording');
                goalInput.placeholder = translations[currentLanguage].tipSectionTitle;
                document.getElementById('tipOutput').innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "роХрпБро░ро▓рпН роЙро│рпНро│рпАроЯрпБ родрпЛро▓рпНро╡ро┐ропроЯрпИроирпНродродрпБ. роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН." : "Voice input failed. Please try again."}</p>`;
            };

            recognition.onend = () => {
                micBtn.classList.remove('recording');
                goalInput.placeholder = translations[currentLanguage].tipSectionTitle;
            };

            // Update recognition language when global language changes
            document.getElementById('languageSelect').addEventListener('change', () => {
                recognition.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US';
            });

        } else {
            micBtn.style.display = 'none';
            console.warn('Web Speech API is not supported in this browser.');
        }

        // Generic mic button handler for other sections
        function setupMicButton(micElementId, inputElementId) {
            const micButton = document.getElementById(micElementId);
            const inputField = document.getElementById(inputElementId);

            if ('webkitSpeechRecognition' in window && micButton) {
                const sectionRecognition = new webkitSpeechRecognition();
                sectionRecognition.continuous = false;
                sectionRecognition.interimResults = false;
                sectionRecognition.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US';

                micButton.addEventListener('click', () => {
                    if (micButton.classList.contains('recording')) {
                        sectionRecognition.stop();
                    } else {
                        sectionRecognition.start();
                    }
                });

                sectionRecognition.onstart = () => {
                    micButton.classList.add('recording');
                    inputField.placeholder = currentLanguage === 'ta' ? "рокрпЗроЪро╡рпБроорпН..." : "Speak now...";
                };

                sectionRecognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    inputField.value = transcript;
                    micButton.classList.remove('recording');
                    updateContent(); // Reset placeholder
                };

                sectionRecognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    micButton.classList.remove('recording');
                    updateContent(); // Reset placeholder
                    // Display error message in the respective section's output area if available
                };

                sectionRecognition.onend = () => {
                    micButton.classList.remove('recording');
                    updateContent(); // Reset placeholder
                };

                // Update recognition language when global language changes
                document.getElementById('languageSelect').addEventListener('change', () => {
                    sectionRecognition.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US';
                });

            } else if (micButton) {
                micButton.style.display = 'none';
            }
        }

        setupMicButton('localTipMicBtn', 'localTipCategory');
        setupMicButton('dietGoalMicBtn', 'dietGoalInput');
        setupMicButton('allergiesMicBtn', 'allergiesInput');
        setupMicButton('diseaseMicBtn', 'diseaseInput');
        setupMicButton('challengeTopicMicBtn', 'challengeTopicInput');
        setupMicButton('emergencyTopicMicBtn', 'emergencyTopicInput');

        // Text-to-Speech (AI Voice Button)
        const aiVoiceBtn = document.getElementById('aiVoiceBtn');
        const ttsVoiceSelect = document.getElementById('ttsVoiceSelect');
        let speechSynth = window.speechSynthesis;
        let voices = [];

        function populateVoiceList() {
            voices = speechSynth.getVoices();
            ttsVoiceSelect.innerHTML = ''; // Clear existing options

            // Filter voices by current language
            const filteredVoices = voices.filter(voice => voice.lang.startsWith(currentLanguage));

            // Add default option
            const defaultOption = document.createElement('option');
            defaultOption.textContent = currentLanguage === 'ta' ? 'роХрпБро░ро▓рпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН' : 'Select Voice';
            defaultOption.value = '';
            ttsVoiceSelect.appendChild(defaultOption);

            // Add filtered voices
            filteredVoices.forEach(voice => {
                const option = document.createElement('option');
                option.textContent = voice.name + ' (' + voice.lang + ')';
                option.value = voice.name;
                option.setAttribute('data-lang', voice.lang);
                option.setAttribute('data-name', voice.name);
                ttsVoiceSelect.appendChild(option);
            });

            // Show TTS controls if voices are available
            if (filteredVoices.length > 0) {
                aiVoiceBtn.style.display = 'inline-flex';
                ttsVoiceSelect.style.display = 'inline-block';
            } else {
                aiVoiceBtn.style.display = 'none';
                ttsVoiceSelect.style.display = 'none';
            }
        }

        // Populate voices when they are loaded
        speechSynth.onvoiceschanged = populateVoiceList;

        // Ensure voices are populated on load if already available
        if (speechSynth.getVoices().length > 0) {
            populateVoiceList();
        }

        function speakText(text, voiceName = null) {
            if (speechSynth.speaking) {
                speechSynth.cancel(); // Stop any ongoing speech
            }

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US'; // Set language for utterance

            if (voiceName) {
                const selectedVoice = voices.find(voice => voice.name === voiceName);
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                }
            }

            speechSynth.speak(utterance);
        }

        // Main AI Voice button
        aiVoiceBtn.addEventListener('click', () => {
            const outputText = document.getElementById('tipOutput').textContent;
            const selectedVoiceName = ttsVoiceSelect.value;
            if (outputText && outputText !== translations[currentLanguage].tipOutputPlaceholder) {
                speakText(outputText, selectedVoiceName);
            }
        });

        // Generic AI Voice button handler for other sections
        function setupAiVoiceButton(aiVoiceElementId, outputElementId) {
            const aiVoiceButton = document.getElementById(aiVoiceElementId);
            if (aiVoiceButton) {
                aiVoiceButton.addEventListener('click', () => {
                    const outputText = document.getElementById(outputElementId).textContent;
                    const selectedVoiceName = ttsVoiceSelect.value;
                    if (outputText && outputText !== translations[currentLanguage][outputElementId + 'Placeholder']) {
                        speakText(outputText, selectedVoiceName);
                    }
                });
            }
        }

        setupAiVoiceButton('localTipAiVoiceBtn', 'localTipOutput');
        setupAiVoiceButton('mealPlanAiVoiceBtn', 'mealPlanOutput');
        setupAiVoiceButton('exerciseYogaAiVoiceBtn', 'exercisePlanOutput');
        setupAiVoiceButton('diseasePreventionAiVoiceBtn', 'preventionTipsOutput');
        setupAiVoiceButton('wellnessChallengeAiVoiceBtn', 'challengeOutput');
        setupAiVoiceButton('firstAidEmergencyAiVoiceBtn', 'emergencyGuideOutput');


        // Main Generate Tip functionality
        document.getElementById('generateBtn').addEventListener('click', async () => {
            const goal = document.getElementById('goalInput').value.trim();
            const tipOutput = document.getElementById('tipOutput');
            const loading = document.getElementById('loading');

            if (!goal) {
                tipOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "роЙроЩрпНроХро│рпН роЖро░рпЛроХрпНроХро┐роп роЗро▓роХрпНроХрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН." : "Please enter your health goal."}</p>`;
                return;
            }

            loading.style.display = 'flex';
            tipOutput.innerHTML = ''; // Clear previous output
            aiVoiceBtn.style.display = 'none'; // Hide AI voice button during loading

            try {
                let chatHistory = [];
                const prompt = currentLanguage === 'ta' ?
                    `роОройроХрпНроХрпБ роТро░рпБ роЖро░рпЛроХрпНроХро┐ропрооро╛рой роХрпБро▒ро┐рокрпНрокрпИ роХрпКроЯрпБроЩрпНроХро│рпН: ${goal}. рокродро┐ро▓рпН родрооро┐ро┤ро┐ро▓рпН роЗро░рпБроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН.` :
                    `Give me a healthy tip for: ${goal}. The response should be in English.`;

                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; // Canvas will automatically provide it
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    tipOutput.innerHTML = `<p>${text}</p>`;
                    aiVoiceBtn.style.display = 'inline-flex'; // Show AI voice button after generation
                } else {
                    tipOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "роХрпБро▒ро┐рокрпНрокрпИ роЙро░рпБро╡ро╛роХрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ. роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН." : "Could not generate a tip. Please try again."}</p>`;
                }
            } catch (error) {
                console.error('Error generating tip:', error);
                tipOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "роХрпБро▒ро┐рокрпНрокрпИ роЙро░рпБро╡ро╛роХрпНроХрпБроорпН рокрпЛродрпБ рокро┐ро┤рпИ роПро▒рпНрокроЯрпНроЯродрпБ. роЗрогрпИроп роЗрогрпИрокрпНрокрпИроЪрпН роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН." : "An error occurred while generating the tip. Please check your internet connection."}</p>`;
            } finally {
                loading.style.display = 'none';
            }
        });

        // Firestore Listener Setup (for features that will use Firestore)
        function setupFirestoreListeners() {
            if (!db || !userId) {
                console.warn("Firestore or User ID not available for listeners.");
                return;
            }

            // Example: Listen to Journal Entries
            const journalCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/journalEntries`);
            onSnapshot(journalCollectionRef, (snapshot) => {
                const entries = [];
                snapshot.forEach(doc => {
                    entries.push({ id: doc.id, ...doc.data() });
                });
                displayJournalEntries(entries);
            }, (error) => {
                console.error("Error listening to journal entries:", error);
            });

            // Example: Listen to Medication Reminders
            const medicationCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/medicationReminders`);
            onSnapshot(medicationCollectionRef, (snapshot) => {
                const reminders = [];
                snapshot.forEach(doc => {
                    reminders.push({ id: doc.id, ...doc.data() });
                });
                displayMedicationReminders(reminders);
            }, (error) => {
                console.error("Error listening to medication reminders:", error);
            });

            // Listen for step tracker data
            const stepTrackerDocRef = doc(db, `artifacts/${appId}/users/${userId}/trackers/stepTracker`);
            onSnapshot(stepTrackerDocRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    currentSteps = data.steps || 0;
                    document.getElementById('currentStepsDisplay').value = currentSteps;
                    document.getElementById('stepResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? `роЗройрпНро▒рпИроп рокроЯро┐роХро│рпН: ${currentSteps}` : `Today's Steps: ${currentSteps}`}</p>`;
                } else {
                    currentSteps = 0;
                    document.getElementById('currentStepsDisplay').value = 0;
                    document.getElementById('stepResultOutput').innerHTML = `<p>${translations[currentLanguage].stepResultOutputPlaceholder}</p>`;
                }
            }, (error) => {
                console.error("Error listening to step tracker:", error);
            });

            // Listen for water tracker data
            const waterTrackerDocRef = doc(db, `artifacts/${appId}/users/${userId}/trackers/waterTracker`);
            onSnapshot(waterTrackerDocRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    currentWaterIntake = data.waterIntake || 0;
                    document.getElementById('waterIntakeDisplay').value = `${currentWaterIntake} ml`;
                    document.getElementById('waterResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? `роЗройрпНро▒рпИроп родрогрпНрогрпАро░рпН роЙроЯрпНроХрпКро│рпНро│ро▓рпН: ${currentWaterIntake} ml` : `Today's Water Intake: ${currentWaterIntake} ml`}</p>`;
                } else {
                    currentWaterIntake = 0;
                    document.getElementById('waterIntakeDisplay').value = '0 ml';
                    document.getElementById('waterResultOutput').innerHTML = `<p>${translations[currentLanguage].waterResultOutputPlaceholder}</p>`;
                }
            }, (error) => {
                console.error("Error listening to water tracker:", error);
            });
        }

        // Step Tracker Functionality
        let currentSteps = 0;
        let stepTrackingInterval;

        document.getElementById('addOneStepBtn').addEventListener('click', async () => {
            currentSteps += 1;
            document.getElementById('currentStepsDisplay').value = currentSteps;
            document.getElementById('stepResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? `роТро░рпБ рокроЯро┐ роЪрпЗро░рпНроХрпНроХрокрпНрокроЯрпНроЯродрпБ. роорпКродрпНрод рокроЯро┐роХро│рпН: ${currentSteps}` : `One step added. Total steps: ${currentSteps}`}</p>`;
            await saveStepData(currentSteps);
        });

        document.getElementById('toggleTrackingBtn').addEventListener('click', () => {
            if (stepTrackingInterval) {
                clearInterval(stepTrackingInterval);
                stepTrackingInterval = null;
                document.getElementById('toggleTrackingBtn').textContent = translations[currentLanguage].toggleTrackingBtn; // Reset button text
                document.getElementById('stepResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? "рокроЯро┐ роЯро┐ро░ро╛роХрпНроХро┐роЩрпН роиро┐ро▒рпБродрпНродрокрпНрокроЯрпНроЯродрпБ." : "Step tracking stopped."}</p>`;
            } else {
                stepTrackingInterval = setInterval(async () => {
                    currentSteps += 10; // Simulate steps
                    document.getElementById('currentStepsDisplay').value = currentSteps;
                    document.getElementById('stepResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? `рокроЯро┐роХро│рпН родро╛ройро╛роХ роЪрпЗро░рпНроХрпНроХрокрпНрокроЯрпБроХро┐ройрпНро▒рой. роорпКродрпНрод рокроЯро┐роХро│рпН: ${currentSteps}` : `Steps are being added automatically. Total steps: ${currentSteps}`}</p>`;
                    await saveStepData(currentSteps);
                }, 1000); // Add 10 steps every second
                document.getElementById('toggleTrackingBtn').textContent = currentLanguage === 'ta' ? "роЯро┐ро░ро╛роХрпНроХро┐роЩрпНроХрпИ роиро┐ро▒рпБродрпНродрпБ" : "Stop Tracking";
                document.getElementById('stepResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? "рокроЯро┐ роЯро┐ро░ро╛роХрпНроХро┐роЩрпН родрпКроЯроЩрпНроХрокрпНрокроЯрпНроЯродрпБ." : "Step tracking started."}</p>`;
            }
        });

        document.getElementById('resetStepsBtn').addEventListener('click', async () => {
            currentSteps = 0;
            document.getElementById('currentStepsDisplay').value = currentSteps;
            document.getElementById('stepResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? "рокроЯро┐роХро│рпН роорпАроЯрпНроЯроорпИроХрпНроХрокрпНрокроЯрпНроЯрой." : "Steps reset."}</p>`;
            if (stepTrackingInterval) {
                clearInterval(stepTrackingInterval);
                stepTrackingInterval = null;
                document.getElementById('toggleTrackingBtn').textContent = translations[currentLanguage].toggleTrackingBtn;
            }
            await saveStepData(currentSteps);
        });

        async function saveStepData(steps) {
            if (!db || !userId) {
                console.warn("Firestore not initialized. Cannot save step data.");
                return;
            }
            try {
                const stepTrackerDocRef = doc(db, `artifacts/${appId}/users/${userId}/trackers/stepTracker`);
                await setDoc(stepTrackerDocRef, { steps: steps, lastUpdated: new Date() }, { merge: true });
                console.log("Step data saved to Firestore:", steps);
            } catch (e) {
                console.error("Error saving step data: ", e);
            }
        }

        // Heart Rate Tracker Functionality
        let currentHeartRate = 0;
        let heartRateInterval;

        document.getElementById('simulateHeartRateBtn').addEventListener('click', () => {
            if (heartRateInterval) {
                clearInterval(heartRateInterval);
                heartRateInterval = null;
                document.getElementById('simulateHeartRateBtn').textContent = translations[currentLanguage].simulateHeartRateBtn;
                document.getElementById('heartRateResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? "роЗродропродрпН родрпБроЯро┐рокрпНрокрпБ роЙро░рпБро╡роХрокрпНрокроЯрпБродрпНродрпБродро▓рпН роиро┐ро▒рпБродрпНродрокрпНрокроЯрпНроЯродрпБ." : "Heart rate simulation stopped."}</p>`;
            } else {
                heartRateInterval = setInterval(() => {
                    currentHeartRate = Math.floor(Math.random() * (100 - 60 + 1)) + 60; // Simulate 60-100 BPM
                    document.getElementById('currentHeartRateDisplay').value = `${currentHeartRate} BPM`;
                    document.getElementById('heartRateResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? `родро▒рпНрокрпЛродрпИроп роЗродропродрпН родрпБроЯро┐рокрпНрокрпБ: ${currentHeartRate} BPM` : `Current Heart Rate: ${currentHeartRate} BPM`}</p>`;
                    // In a real app, you'd save this to Firestore
                }, 2000); // Update every 2 seconds
                document.getElementById('simulateHeartRateBtn').textContent = currentLanguage === 'ta' ? "роЙро░рпБро╡роХрокрпНрокроЯрпБродрпНродрпБродро▓рпИ роиро┐ро▒рпБродрпНродрпБ" : "Stop Simulation";
                document.getElementById('heartRateResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? "роЗродропродрпН родрпБроЯро┐рокрпНрокрпБ роЙро░рпБро╡роХрокрпНрокроЯрпБродрпНродрпБродро▓рпН родрпКроЯроЩрпНроХрокрпНрокроЯрпНроЯродрпБ." : "Heart rate simulation started."}</p>`;
            }
        });

        document.getElementById('resetHeartRateBtn').addEventListener('click', () => {
            currentHeartRate = 0;
            document.getElementById('currentHeartRateDisplay').value = currentHeartRate;
            document.getElementById('heartRateResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? "роЗродропродрпН родрпБроЯро┐рокрпНрокрпБ роорпАроЯрпНроЯроорпИроХрпНроХрокрпНрокроЯрпНроЯродрпБ." : "Heart rate reset."}</p>`;
            if (heartRateInterval) {
                clearInterval(heartRateInterval);
                heartRateInterval = null;
                document.getElementById('simulateHeartRateBtn').textContent = translations[currentLanguage].simulateHeartRateBtn;
            }
        });

        // Water Tracker Functionality
        let currentWaterIntake = 0;
        const waterPerClick = 250; // ml

        document.getElementById('addWaterBtn').addEventListener('click', async () => {
            currentWaterIntake += waterPerClick;
            document.getElementById('waterIntakeDisplay').value = `${currentWaterIntake} ml`;
            document.getElementById('waterResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? `${waterPerClick} ml родрогрпНрогрпАро░рпН роЪрпЗро░рпНроХрпНроХрокрпНрокроЯрпНроЯродрпБ. роорпКродрпНрод роЙроЯрпНроХрпКро│рпНро│ро▓рпН: ${currentWaterIntake} ml` : `${waterPerClick} ml water added. Total intake: ${currentWaterIntake} ml`}</p>`;
            await saveWaterData(currentWaterIntake);
        });

        document.getElementById('resetWaterBtn').addEventListener('click', async () => {
            currentWaterIntake = 0;
            document.getElementById('waterIntakeDisplay').value = `0 ml`;
            document.getElementById('waterResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? "родрогрпНрогрпАро░рпН роЙроЯрпНроХрпКро│рпНро│ро▓рпН роорпАроЯрпНроЯроорпИроХрпНроХрокрпНрокроЯрпНроЯродрпБ." : "Water intake reset."}</p>`;
            await saveWaterData(currentWaterIntake);
        });

        async function saveWaterData(waterIntake) {
            if (!db || !userId) {
                console.warn("Firestore not initialized. Cannot save water data.");
                return;
            }
            try {
                const waterTrackerDocRef = doc(db, `artifacts/${appId}/users/${userId}/trackers/waterTracker`);
                await setDoc(waterTrackerDocRef, { waterIntake: waterIntake, lastUpdated: new Date() }, { merge: true });
                console.log("Water data saved to Firestore:", waterIntake);
            } catch (e) {
                console.error("Error saving water data: ", e);
            }
        }

        // Journal Functionality
        document.getElementById('saveJournalEntryBtn').addEventListener('click', async () => {
            const mood = document.getElementById('moodSelect').value;
            const gratitude = document.getElementById('gratitudeInput').value.trim();
            const journalOutput = document.getElementById('journalEntriesOutput');

            if (!mood && !gratitude) {
                journalOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "рооройроиро┐ро▓рпИ роЕро▓рпНро▓родрпБ роиройрпНро▒ро┐ропрпБрогро░рпНро╡рпБ рокродро┐ро╡рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН." : "Please enter a mood or gratitude entry."}</p>`;
                return;
            }

            const entry = {
                mood: mood,
                gratitude: gratitude,
                timestamp: new Date().toISOString()
            };

            if (!db || !userId) {
                journalOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "родро░ро╡рпБродрпНродро│роорпН роХро┐роЯрпИроХрпНроХро╡ро┐ро▓рпНро▓рпИ. рокродро┐ро╡рпИроЪрпН роЪрпЗрооро┐роХрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ." : "Database not available. Cannot save entry."}</p>`;
                console.warn("Firestore not initialized. Cannot save journal entry.");
                return;
            }

            try {
                await addDoc(collection(db, `artifacts/${appId}/users/${userId}/journalEntries`), entry);
                document.getElementById('moodSelect').value = '';
                document.getElementById('gratitudeInput').value = '';
                journalOutput.innerHTML = `<p>${currentLanguage === 'ta' ? "роЬро░рпНройро▓рпН рокродро┐ро╡рпБ ро╡рпЖро▒рпНро▒ро┐роХро░рооро╛роХроЪрпН роЪрпЗрооро┐роХрпНроХрокрпНрокроЯрпНроЯродрпБ!" : "Journal entry saved successfully!"}</p>`;
            } catch (e) {
                console.error("Error adding document: ", e);
                journalOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "рокродро┐ро╡рпИроЪрпН роЪрпЗрооро┐роХрпНроХрпБроорпН рокрпЛродрпБ рокро┐ро┤рпИ роПро▒рпНрокроЯрпНроЯродрпБ." : "Error saving entry."}</p>`;
            }
        });

        function displayJournalEntries(entries) {
            const journalOutput = document.getElementById('journalEntriesOutput');
            if (entries.length === 0) {
                journalOutput.innerHTML = `<p>${translations[currentLanguage].journalEntriesOutputPlaceholder}</p>`;
                return;
            }

            let html = `<h3 class="font-semibold mb-2">${currentLanguage === 'ta' ? "роЙроЩрпНроХро│рпН роЬро░рпНройро▓рпН рокродро┐ро╡рпБроХро│рпН:" : "Your Journal Entries:"}</h3><ul class="list-disc pl-5 space-y-2">`;
            entries.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).forEach(entry => {
                const date = new Date(entry.timestamp).toLocaleString(currentLanguage === 'ta' ? 'ta-IN' : 'en-US');
                html += `<li><strong>${date}:</strong> `;
                if (entry.mood) html += `${currentLanguage === 'ta' ? "рооройроиро┐ро▓рпИ" : "Mood"}: ${entry.mood} `;
                if (entry.gratitude) html += `${currentLanguage === 'ta' ? "роиройрпНро▒ро┐ропрпБрогро░рпНро╡рпБ" : "Gratitude"}: ${entry.gratitude}`;
                html += `<button class="text-red-500 ml-2" onclick="deleteJournalEntry('${entry.id}')">(${currentLanguage === 'ta' ? "роЕро┤ро┐" : "Delete"})</button></li>`;
            });
            html += `</ul>`;
            journalOutput.innerHTML = html;
        }

        // Make deleteJournalEntry globally accessible for onclick
        window.deleteJournalEntry = async (id) => {
            if (!db || !userId) {
                console.warn("Firestore not initialized. Cannot delete journal entry.");
                return;
            }
            try {
                await deleteDoc(doc(db, `artifacts/${appId}/users/${userId}/journalEntries`, id));
                document.getElementById('journalEntriesOutput').innerHTML = `<p>${currentLanguage === 'ta' ? "роЬро░рпНройро▓рпН рокродро┐ро╡рпБ роирпАроХрпНроХрокрпНрокроЯрпНроЯродрпБ." : "Journal entry deleted."}</p>`;
            } catch (e) {
                console.error("Error deleting document: ", e);
                document.getElementById('journalEntriesOutput').innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "рокродро┐ро╡рпИ роирпАроХрпНроХрпБроорпН рокрпЛродрпБ рокро┐ро┤рпИ роПро▒рпНрокроЯрпНроЯродрпБ." : "Error deleting entry."}</p>`;
            }
        };

        // Local Health Tips Functionality
        const predefinedLocalTips = {
            ta: {
                "роороЮрпНроЪро│рпН": "роороЮрпНроЪро│рпН роТро░рпБ роЪроХрпНродро┐ро╡ро╛ропрпНроирпНрод роЕро┤ро▒рпНроЪро┐ роОродро┐ро░рпНрокрпНрокрпБ рооро▒рпНро▒рпБроорпН роЖроХрпНро╕ро┐роЬройрпЗро▒рпНро▒ро┐ропро╛роХрпБроорпН. роЗродрпИ роЙроЩрпНроХро│рпН роЙрогро╡ро┐ро▓рпН роЪрпЗро░рпНродрпНродрпБроХрпНроХрпКро│рпНро╡родрпБ роЕро▓рпНро▓родрпБ рокро╛ро▓рпН роХро▓роирпНродрпБ роХрпБроЯро┐рокрпНрокродрпБ роирпЛропрпН роОродро┐ро░рпНрокрпНрокрпБ роЪроХрпНродро┐ропрпИ роЕродро┐роХро░ро┐роХрпНроХрпБроорпН.",
                "роорпБро░рпБроЩрпНроХрпИ": "роорпБро░рпБроЩрпНроХрпИ роЗро▓рпИроХро│рпН ро╡рпИроЯрпНроЯрооро┐ройрпНроХро│рпН, родро╛родрпБроХрпНроХро│рпН рооро▒рпНро▒рпБроорпН роЖроХрпНро╕ро┐роЬройрпЗро▒рпНро▒роЩрпНроХро│ро╛ро▓рпН роиро┐ро▒рпИроирпНродрпБро│рпНро│рой. роЗродрпИ роЪрпВрокрпН, рокрпКро░ро┐ропро▓рпН роЕро▓рпНро▓родрпБ рокро╡рпБроЯро░ро╛роХ роЙроЯрпНроХрпКро│рпНро│ро▓ро╛роорпН. роЗродрпБ роЗро░родрпНрод роЪро░рпНроХрпНроХро░рпИ роЕро│ро╡рпИ роХроЯрпНроЯрпБрокрпНрокроЯрпБродрпНродро╡рпБроорпН, роОро▓рпБроорпНрокрпБроХро│рпБроХрпНроХрпБ ро╡ро▓рпБ роЪрпЗро░рпНроХрпНроХро╡рпБроорпН роЙродро╡рпБроорпН.",
                "родро┐ропро╛ройроорпН": "родро┐ройроЪро░ро┐ родро┐ропро╛ройроорпН роорой роЕро┤рпБродрпНродродрпНродрпИроХрпН роХрпБро▒рпИроХрпНроХро╡рпБроорпН, роорой роЕроорпИродро┐ропрпИ роорпЗроорпНрокроЯрпБродрпНродро╡рпБроорпН, роХро╡ройродрпНродрпИ роЕродро┐роХро░ро┐роХрпНроХро╡рпБроорпН роЙродро╡рпБроорпН. роХро╛ро▓рпИропро┐ро▓рпН 10-15 роиро┐рооро┐роЯроЩрпНроХро│рпН родро┐ропро╛ройроорпН роЪрпЖропрпНро╡родрпБ роЙроЩрпНроХро│рпН роиро╛ро│рпИ роЪро┐ро▒рокрпНрокро╛роХродрпН родрпКроЯроЩрпНроХ роЙродро╡рпБроорпН.",
                "роирпЖро▓рпНро▓ро┐роХрпНроХро╛ропрпН": "роирпЖро▓рпНро▓ро┐роХрпНроХро╛ропрпН ро╡рпИроЯрпНроЯрооро┐ройрпН роЪро┐ роиро┐ро▒рпИроирпНрод роТро░рпБ роЪрпВрокрпНрокро░рпНроГрокрпБроЯрпН роЖроХрпБроорпН. роЗродрпБ роирпЛропрпН роОродро┐ро░рпНрокрпНрокрпБ роЪроХрпНродро┐ропрпИ роЕродро┐роХро░ро┐роХрпНроХрпБроорпН, роЪрпЖро░ро┐рооро╛ройродрпНродро┐ро▒рпНроХрпБ роЙродро╡рпБроорпН рооро▒рпНро▒рпБроорпН роорпБроЯро┐ рооро▒рпНро▒рпБроорпН роЪро░рпБроо роЖро░рпЛроХрпНроХро┐ропродрпНродро┐ро▒рпНроХрпБ роиро▓рпНро▓родрпБ.",
                "ро╡рпЗрокрпНрокро┐ро▓рпИ": "ро╡рпЗрокрпНрокро┐ро▓рпИ рокро╛роХрпНроЯрпАро░ро┐ропро╛ роОродро┐ро░рпНрокрпНрокрпБ рооро▒рпНро▒рпБроорпН рокрпВроЮрпНроЪрпИ роОродро┐ро░рпНрокрпНрокрпБ рокрогрпНрокрпБроХро│рпИроХрпН роХрпКрогрпНроЯрпБро│рпНро│родрпБ. роЗродрпИ роЪро░рпБроо рокро┐ро░роЪрпНроЪройрпИроХро│рпБроХрпНроХрпБ рокропройрпНрокроЯрпБродрпНродро▓ро╛роорпН роЕро▓рпНро▓родрпБ роЗро░родрпНродродрпНродрпИ роЪрпБродрпНродрокрпНрокроЯрпБродрпНрод роЙроЯрпНроХрпКро│рпНро│ро▓ро╛роорпН (рооро░рпБродрпНродрпБро╡ро░рпН роЖро▓рпЛроЪройрпИрокрпНрокроЯро┐).",
                "родрпБро│роЪро┐": "родрпБро│роЪро┐ роТро░рпБ рокрпБройро┐родрооро╛рой роорпВро▓ро┐роХрпИ. роЗродрпБ роЪро│ро┐, роЗро░рпБрооро▓рпН рооро▒рпНро▒рпБроорпН роХро╛ропрпНроЪрпНроЪро▓рпБроХрпНроХрпБ роЪро┐роХро┐роЪрпНроЪрпИропро│ро┐роХрпНроХрокрпН рокропройрпНрокроЯрпБроХро┐ро▒родрпБ. родрпБро│роЪро┐ родрпЗроирпАро░рпН роирпЛропрпН роОродро┐ро░рпНрокрпНрокрпБ роЪроХрпНродро┐ропрпИ роЕродро┐роХро░ро┐роХрпНроХрпБроорпН.",
                "ропрпЛроХро╛": "ропрпЛроХро╛ роЙроЯро▓рпН рооро▒рпНро▒рпБроорпН роорой роЖро░рпЛроХрпНроХро┐ропродрпНродро┐ро▒рпНроХрпБ роЪро┐ро▒роирпНродродрпБ. роЗродрпБ роирпЖроХро┐ро┤рпНро╡рпБродрпНродройрпНроорпИропрпИ роорпЗроорпНрокроЯрпБродрпНродрпБроХро┐ро▒родрпБ, роорой роЕро┤рпБродрпНродродрпНродрпИроХрпН роХрпБро▒рпИроХрпНроХро┐ро▒родрпБ рооро▒рпНро▒рпБроорпН роЙро│рпН роЕроорпИродро┐ропрпИ роЕро│ро┐роХрпНроХро┐ро▒родрпБ.",
                "роЪрпАро░роХроорпН": "роЪрпАро░роХроорпН роЪрпЖро░ро┐рооро╛ройродрпНродро┐ро▒рпНроХрпБ роЙродро╡рпБроХро┐ро▒родрпБ рооро▒рпНро▒рпБроорпН ро╡ро╛ропрпБ родрпКро▓рпНро▓рпИропрпИ роХрпБро▒рпИроХрпНроХро┐ро▒родрпБ. роЪрпАро░роХ роирпАро░рпН роЙроЯро▓рпН роОроЯрпИропрпИ роХрпБро▒рпИроХрпНроХро╡рпБроорпН роЙродро╡рпБроорпН.",
                "рокрпВрогрпНроЯрпБ": "рокрпВрогрпНроЯрпБ роирпЛропрпН роОродро┐ро░рпНрокрпНрокрпБ роЪроХрпНродро┐ропрпИ роЕродро┐роХро░ро┐роХрпНроХро┐ро▒родрпБ, роЗро░родрпНрод роЕро┤рпБродрпНродродрпНродрпИроХрпН роХрпБро▒рпИроХрпНроХро┐ро▒родрпБ рооро▒рпНро▒рпБроорпН роЗродроп роЖро░рпЛроХрпНроХро┐ропродрпНродро┐ро▒рпНроХрпБ роиро▓рпНро▓родрпБ.",
                "роЗроЮрпНроЪро┐": "роЗроЮрпНроЪро┐ роЪрпЖро░ро┐рооро╛ройродрпНродро┐ро▒рпНроХрпБ роЙродро╡рпБроХро┐ро▒родрпБ, роХрпБроороЯрпНроЯро▓рпИроХрпН роХрпБро▒рпИроХрпНроХро┐ро▒родрпБ рооро▒рпНро▒рпБроорпН роЕро┤ро▒рпНроЪро┐ роОродро┐ро░рпНрокрпНрокрпБ рокрогрпНрокрпБроХро│рпИроХрпН роХрпКрогрпНроЯрпБро│рпНро│родрпБ."
            },
            en: {
                "turmeric": "Turmeric is a powerful anti-inflammatory and antioxidant. Incorporating it into your diet or drinking it with milk can boost immunity.",
                "moringa": "Moringa leaves are packed with vitamins, minerals, and antioxidants. It can be consumed as soup, stir-fry, or powder. It helps regulate blood sugar levels and strengthens bones.",
                "meditation": "Daily meditation can help reduce stress, improve mental clarity, and enhance focus. 10-15 minutes of meditation in the morning can help you start your day better.",
                "amla": "Amla (Indian Gooseberry) is a superfood rich in Vitamin C. It boosts immunity, aids digestion, and is good for hair and skin health.",
                "neem": "Neem leaves have antibacterial and antifungal properties. They can be used for skin issues or consumed to purify blood (under medical advice).",
                "tulsi": "Tulsi (Holy Basil) is a sacred herb. It's used to treat cold, cough, and fever. Tulsi tea can boost immunity.",
                "yoga": "Yoga is excellent for physical and mental well-being. It improves flexibility, reduces stress, and provides inner peace.",
                "cumin": "Cumin aids digestion and reduces flatulence. Cumin water can also help with weight loss.",
                "garlic": "Garlic boosts immunity, lowers blood pressure, and is good for heart health.",
                "ginger": "Ginger aids digestion, reduces nausea, and has anti-inflammatory properties."
            }
        };

        const localTipCategoryInput = document.getElementById('localTipCategory');
        const localTipCategoryDropdown = document.getElementById('localTipCategoryDropdown');

        localTipCategoryInput.addEventListener('input', () => {
            const query = localTipCategoryInput.value.toLowerCase();
            const tips = predefinedLocalTips[currentLanguage];
            const filteredCategories = Object.keys(tips).filter(category =>
                category.toLowerCase().includes(query)
            );

            localTipCategoryDropdown.innerHTML = '';
            if (filteredCategories.length > 0 && query.length > 0) {
                filteredCategories.forEach(category => {
                    const div = document.createElement('div');
                    div.textContent = category;
                    div.addEventListener('click', () => {
                        localTipCategoryInput.value = category;
                        localTipCategoryDropdown.classList.add('hidden');
                    });
                    localTipCategoryDropdown.appendChild(div);
                });
                localTipCategoryDropdown.classList.remove('hidden');
            } else {
                localTipCategoryDropdown.classList.add('hidden');
            }
        });

        document.addEventListener('click', (event) => {
            if (!localTipCategoryInput.contains(event.target) && !localTipCategoryDropdown.contains(event.target)) {
                localTipCategoryDropdown.classList.add('hidden');
            }
        });


        document.getElementById('getLocalTipBtn').addEventListener('click', async () => {
            const category = document.getElementById('localTipCategory').value.trim().toLowerCase();
            const localTipOutput = document.getElementById('localTipOutput');
            const loading = document.getElementById('loading');
            const localTipAiVoiceBtn = document.getElementById('localTipAiVoiceBtn');

            if (!category) {
                localTipOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "роЙродро╡ро┐роХрпНроХрпБро▒ро┐рокрпНрокрпБ ро╡роХрпИропрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН." : "Please enter a tip category."}</p>`;
                return;
            }

            loading.style.display = 'flex';
            localTipOutput.innerHTML = '';
            localTipAiVoiceBtn.style.display = 'none';

            try {
                const tip = predefinedLocalTips[currentLanguage][category];
                if (tip) {
                    localTipOutput.innerHTML = `<p>${tip}</p>`;
                    localTipAiVoiceBtn.style.display = 'inline-flex';
                } else {
                    let chatHistory = [];
                    const prompt = currentLanguage === 'ta' ?
                        `роЙро│рпНро│рпВро░рпН роЖро░рпЛроХрпНроХро┐роп роХрпБро▒ро┐рокрпНрокрпБ рокро▒рпНро▒ро┐ роОройроХрпНроХрпБ роЪрпКро▓рпНро▓рпБроЩрпНроХро│рпН: ${category}. рокродро┐ро▓рпН родрооро┐ро┤ро┐ро▓рпН роЗро░рпБроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН.` :
                        `Tell me about a local health tip regarding: ${category}. The response should be in English.`;

                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = "";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        localTipOutput.innerHTML = `<p>${text}</p>`;
                        localTipAiVoiceBtn.style.display = 'inline-flex';
                    } else {
                        localTipOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "роХрпБро▒ро┐рокрпНрокрпИ роЙро░рпБро╡ро╛роХрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ. роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН." : "Could not generate a tip. Please try again."}</p>`;
                    }
                }
            } catch (error) {
                console.error('Error generating local tip:', error);
                localTipOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "роХрпБро▒ро┐рокрпНрокрпИ роЙро░рпБро╡ро╛роХрпНроХрпБроорпН рокрпЛродрпБ рокро┐ро┤рпИ роПро▒рпНрокроЯрпНроЯродрпБ. роЗрогрпИроп роЗрогрпИрокрпНрокрпИроЪрпН роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН." : "An error occurred while generating the tip. Please check your internet connection."}</p>`;
            } finally {
                loading.style.display = 'none';
            }
        });

        // Meal Plan Functionality
        document.getElementById('generateMealPlanBtn').addEventListener('click', async () => {
            const dietGoal = document.getElementById('dietGoalInput').value.trim();
            const dietPreference = document.getElementById('dietPreferenceSelect').value;
            const allergies = document.getElementById('allergiesInput').value.trim();
            const mealPlanOutput = document.getElementById('mealPlanOutput');
            const loading = document.getElementById('loading');
            const mealPlanAiVoiceBtn = document.getElementById('mealPlanAiVoiceBtn');

            if (!dietGoal && !dietPreference) {
                mealPlanOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "роЙрогро╡рпБ роЗро▓роХрпНроХрпБ роЕро▓рпНро▓родрпБ роЙрогро╡рпБ ро╡ро┐ро░рпБрокрпНрокродрпНродрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН." : "Please enter a diet goal or preference."}</p>`;
                return;
            }

            loading.style.display = 'flex';
            mealPlanOutput.innerHTML = '';
            mealPlanAiVoiceBtn.style.display = 'none';

            try {
                let chatHistory = [];
                const prompt = currentLanguage === 'ta' ?
                    `роОройроХрпНроХрпБ роТро░рпБ роЙрогро╡рпБродрпН родро┐роЯрпНроЯродрпНродрпИ роЙро░рпБро╡ро╛роХрпНроХрпБроЩрпНроХро│рпН. роЗро▓роХрпНроХрпБ: ${dietGoal || 'рокрпКродрпБ роЖро░рпЛроХрпНроХро┐ропроорпН'}. ро╡ро┐ро░рпБрокрпНрокроорпН: ${dietPreference || 'роОродрпБро╡рпБроорпН роЗро▓рпНро▓рпИ'}. роТро╡рпНро╡ро╛роорпИроХро│рпН: ${allergies || 'роОродрпБро╡рпБроорпН роЗро▓рпНро▓рпИ'}. рокродро┐ро▓рпН родрооро┐ро┤ро┐ро▓рпН роЗро░рпБроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН.` :
                    `Generate a meal plan for me. Goal: ${dietGoal || 'general health'}. Preference: ${dietPreference || 'none'}. Allergies: ${allergies || 'none'}. The response should be in English.`;

                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    mealPlanOutput.innerHTML = `<p>${text}</p>`;
                    mealPlanAiVoiceBtn.style.display = 'inline-flex';
                } else {
                    mealPlanOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "роЙрогро╡рпБродрпН родро┐роЯрпНроЯродрпНродрпИ роЙро░рпБро╡ро╛роХрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ. роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН." : "Could not generate a meal plan. Please try again."}</p>`;
                }
            } catch (error) {
                console.error('Error generating meal plan:', error);
                mealPlanOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "роЙрогро╡рпБродрпН родро┐роЯрпНроЯродрпНродрпИ роЙро░рпБро╡ро╛роХрпНроХрпБроорпН рокрпЛродрпБ рокро┐ро┤рпИ роПро▒рпНрокроЯрпНроЯродрпБ. роЗрогрпИроп роЗрогрпИрокрпНрокрпИроЪрпН роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН." : "An error occurred while generating the meal plan. Please check your internet connection."}</p>`;
            } finally {
                loading.style.display = 'none';
            }
        });

        // Mood Analysis Functionality
        document.getElementById('analyzeMoodJournalBtn').addEventListener('click', async () => {
            const moodAnalysisOutput = document.getElementById('moodAnalysisOutput');
            const loading = document.getElementById('loading');

            if (!db || !userId) {
                moodAnalysisOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "родро░ро╡рпБродрпНродро│роорпН роХро┐роЯрпИроХрпНроХро╡ро┐ро▓рпНро▓рпИ. рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпНроп роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ." : "Database not available. Cannot perform analysis."}</p>`;
                console.warn("Firestore not initialized. Cannot analyze mood.");
                return;
            }

            loading.style.display = 'flex';
            moodAnalysisOutput.innerHTML = '';

            try {
                const journalCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/journalEntries`);
                const querySnapshot = await getDocs(journalCollectionRef);
                const entries = [];
                querySnapshot.forEach(doc => {
                    entries.push(doc.data());
                });

                if (entries.length === 0) {
                    moodAnalysisOutput.innerHTML = `<p>${currentLanguage === 'ta' ? "рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпНроп роЬро░рпНройро▓рпН рокродро┐ро╡рпБроХро│рпН роЗро▓рпНро▓рпИ." : "No journal entries to analyze."}</p>`;
                    return;
                }

                const moodCounts = {};
                entries.forEach(entry => {
                    if (entry.mood) {
                        moodCounts[entry.mood] = (moodCounts[entry.mood] || 0) + 1;
                    }
                });

                let analysisText = currentLanguage === 'ta' ? "роЙроЩрпНроХро│рпН рооройроиро┐ро▓рпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ:\n" : "Your Mood Analysis:\n";
                for (const mood in moodCounts) {
                    analysisText += `${mood}: ${moodCounts[mood]} ${currentLanguage === 'ta' ? "роорпБро▒рпИ" : "times"}\n`;
                }

                let chatHistory = [];
                const prompt = currentLanguage === 'ta' ?
                    `роЗроирпНрод рооройроиро┐ро▓рпИ рокродро┐ро╡рпБроХро│ро┐ройрпН роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓рпН роТро░рпБ роЪрпБро░рпБроХрпНроХрооро╛рой рооройроиро┐ро▓рпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпИ роХрпКроЯрпБроЩрпНроХро│рпН: ${JSON.stringify(moodCounts)}. рокродро┐ро▓рпН родрооро┐ро┤ро┐ро▓рпН роЗро░рпБроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН.` :
                    `Provide a brief mood analysis based on these mood entries: ${JSON.stringify(moodCounts)}. The response should be in English.`;

                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    moodAnalysisOutput.innerHTML = `<p>${analysisText}<br>${text}</p>`;
                } else {
                    moodAnalysisOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "рооройроиро┐ро▓рпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпИ роЙро░рпБро╡ро╛роХрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ." : "Could not generate mood analysis."}</p>`;
                }

            } catch (error) {
                console.error('Error analyzing mood:', error);
                moodAnalysisOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "рооройроиро┐ро▓рпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпНропрпБроорпН рокрпЛродрпБ рокро┐ро┤рпИ роПро▒рпНрокроЯрпНроЯродрпБ." : "An error occurred while analyzing mood."}</p>`;
            } finally {
                loading.style.display = 'none';
            }
        });

        // Exercise & Yoga Functionality
        document.getElementById('generateExercisePlanBtn').addEventListener('click', async () => {
            const fitnessLevel = document.getElementById('fitnessLevelSelect').value;
            const exerciseType = document.getElementById('exerciseTypeSelect').value;
            const exercisePlanOutput = document.getElementById('exercisePlanOutput');
            const loading = document.getElementById('loading');
            const exerciseYogaAiVoiceBtn = document.getElementById('exerciseYogaAiVoiceBtn');

            if (!fitnessLevel && !exerciseType) {
                exercisePlanOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐ роиро┐ро▓рпИ роЕро▓рпНро▓родрпБ ро╡роХрпИропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН." : "Please select a fitness level or exercise type."}</p>`;
                return;
            }

            loading.style.display = 'flex';
            exercisePlanOutput.innerHTML = '';
            exerciseYogaAiVoiceBtn.style.display = 'none';

            try {
                let chatHistory = [];
                const prompt = currentLanguage === 'ta' ?
                    `роОройроХрпНроХрпБ роТро░рпБ роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐ родро┐роЯрпНроЯродрпНродрпИ роЙро░рпБро╡ро╛роХрпНроХрпБроЩрпНроХро│рпН. роиро┐ро▓рпИ: ${fitnessLevel || 'роОродрпБро╡рпБроорпН роЗро▓рпНро▓рпИ'}. ро╡роХрпИ: ${exerciseType || 'роОродрпБро╡рпБроорпН роЗро▓рпНро▓рпИ'}. рокродро┐ро▓рпН родрооро┐ро┤ро┐ро▓рпН роЗро░рпБроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН.` :
                    `Generate an exercise plan for me. Level: ${fitnessLevel || 'any'}. Type: ${exerciseType || 'any'}. The response should be in English.`;

                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    exercisePlanOutput.innerHTML = `<p>${text}</p>`;
                    exerciseYogaAiVoiceBtn.style.display = 'inline-flex';
                } else {
                    exercisePlanOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐ родро┐роЯрпНроЯродрпНродрпИ роЙро░рпБро╡ро╛роХрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ. роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН." : "Could not generate an exercise plan. Please try again."}</p>`;
                }
            } catch (error) {
                console.error('Error generating exercise plan:', error);
                exercisePlanOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐ родро┐роЯрпНроЯродрпНродрпИ роЙро░рпБро╡ро╛роХрпНроХрпБроорпН рокрпЛродрпБ рокро┐ро┤рпИ роПро▒рпНрокроЯрпНроЯродрпБ. роЗрогрпИроп роЗрогрпИрокрпНрокрпИроЪрпН роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН." : "An error occurred while generating the exercise plan. Please check your internet connection."}</p>`;
            } finally {
                loading.style.display = 'none';
            }
        });

        // Disease Prevention Functionality
        document.getElementById('getPreventionTipsBtn').addEventListener('click', async () => {
            const disease = document.getElementById('diseaseInput').value.trim();
            const preventionTipsOutput = document.getElementById('preventionTipsOutput');
            const loading = document.getElementById('loading');
            const diseasePreventionAiVoiceBtn = document.getElementById('diseasePreventionAiVoiceBtn');

            if (!disease) {
                preventionTipsOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "роирпЛропрпН роЕро▓рпНро▓родрпБ роиро┐ро▓рпИропрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН." : "Please enter a disease or condition."}</p>`;
                return;
            }

            loading.style.display = 'flex';
            preventionTipsOutput.innerHTML = '';
            diseasePreventionAiVoiceBtn.style.display = 'none';

            try {
                let chatHistory = [];
                const prompt = currentLanguage === 'ta' ?
                    `роЗроирпНрод роирпЛропрпИродрпН родроЯрпБрокрпНрокродро▒рпНроХро╛рой роХрпБро▒ро┐рокрпНрокрпБроХро│рпИроХрпН роХрпКроЯрпБроЩрпНроХро│рпН: ${disease}. рокродро┐ро▓рпН родрооро┐ро┤ро┐ро▓рпН роЗро░рпБроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН.` :
                    `Give me tips for preventing this disease: ${disease}. The response should be in English.`;

                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    preventionTipsOutput.innerHTML = `<p>${text}</p>`;
                    diseasePreventionAiVoiceBtn.style.display = 'inline-flex';
                } else {
                    preventionTipsOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "родроЯрпБрокрпНрокрпБ роХрпБро▒ро┐рокрпНрокрпБроХро│рпИ роЙро░рпБро╡ро╛роХрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ. роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН." : "Could not generate prevention tips. Please try again."}</p>`;
                }
            } catch (error) {
                console.error('Error generating prevention tips:', error);
                preventionTipsOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "родроЯрпБрокрпНрокрпБ роХрпБро▒ро┐рокрпНрокрпБроХро│рпИ роЙро░рпБро╡ро╛роХрпНроХрпБроорпН рокрпЛродрпБ рокро┐ро┤рпИ роПро▒рпНрокроЯрпНроЯродрпБ. роЗрогрпИроп роЗрогрпИрокрпНрокрпИроЪрпН роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН." : "An error occurred while generating prevention tips. Please check your internet connection."}</p>`;
            } finally {
                loading.style.display = 'none';
            }
        });

        // Wellness Challenge Functionality
        document.getElementById('generateChallengeBtn').addEventListener('click', async () => {
            const challengeTopic = document.getElementById('challengeTopicInput').value.trim();
            const challengeOutput = document.getElementById('challengeOutput');
            const loading = document.getElementById('loading');
            const wellnessChallengeAiVoiceBtn = document.getElementById('wellnessChallengeAiVoiceBtn');

            if (!challengeTopic) {
                challengeOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "роЪро╡ро╛ро▓рпН родро▓рпИрокрпНрокрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН." : "Please enter a challenge topic."}</p>`;
                return;
            }

            loading.style.display = 'flex';
            challengeOutput.innerHTML = '';
            wellnessChallengeAiVoiceBtn.style.display = 'none';

            try {
                let chatHistory = [];
                const prompt = currentLanguage === 'ta' ?
                    `роОройроХрпНроХрпБ роТро░рпБ роЖро░рпЛроХрпНроХро┐роп роЪро╡ро╛ро▓рпИ роЙро░рпБро╡ро╛роХрпНроХрпБроЩрпНроХро│рпН: ${challengeTopic}. рокродро┐ро▓рпН родрооро┐ро┤ро┐ро▓рпН роЗро░рпБроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН.` :
                    `Generate a wellness challenge for me about: ${challengeTopic}. The response should be in English.`;

                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    challengeOutput.innerHTML = `<p>${text}</p>`;
                    wellnessChallengeAiVoiceBtn.style.display = 'inline-flex';
                } else {
                    challengeOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "роЪро╡ро╛ро▓рпИ роЙро░рпБро╡ро╛роХрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ. роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН." : "Could not generate a challenge. Please try again."}</p>`;
                }
            } catch (error) {
                console.error('Error generating challenge:', error);
                challengeOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "роЪро╡ро╛ро▓рпИ роЙро░рпБро╡ро╛роХрпНроХрпБроорпН рокрпЛродрпБ рокро┐ро┤рпИ роПро▒рпНрокроЯрпНроЯродрпБ. роЗрогрпИроп роЗрогрпИрокрпНрокрпИроЪрпН роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН." : "An error occurred while generating the challenge. Please check your internet connection."}</p>`;
            } finally {
                loading.style.display = 'none';
            }
        });

        // Medication Reminder Functionality
        document.getElementById('addMedicationReminderBtn').addEventListener('click', async () => {
            const medicationName = document.getElementById('medicationNameInput').value.trim();
            const medicationTime = document.getElementById('medicationTimeInput').value.trim();
            const medicationRemindersOutput = document.getElementById('medicationRemindersOutput');

            if (!medicationName || !medicationTime) {
                medicationRemindersOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "рооро░рпБроирпНродро┐ройрпН рокрпЖропро░рпН рооро▒рпНро▒рпБроорпН роирпЗро░родрпНродрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН." : "Please enter medication name and time."}</p>`;
                return;
            }

            const reminder = {
                name: medicationName,
                time: medicationTime,
                addedAt: new Date().toISOString()
            };

            if (!db || !userId) {
                medicationRemindersOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "родро░ро╡рпБродрпНродро│роорпН роХро┐роЯрпИроХрпНроХро╡ро┐ро▓рпНро▓рпИ. роиро┐ройрпИро╡рпВроЯрпНроЯро▓рпИроЪрпН роЪрпЗрооро┐роХрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ." : "Database not available. Cannot save reminder."}</p>`;
                console.warn("Firestore not initialized. Cannot save medication reminder.");
                return;
            }

            try {
                await addDoc(collection(db, `artifacts/${appId}/users/${userId}/medicationReminders`), reminder);
                document.getElementById('medicationNameInput').value = '';
                document.getElementById('medicationTimeInput').value = '';
                medicationRemindersOutput.innerHTML = `<p>${currentLanguage === 'ta' ? "рооро░рпБроирпНродрпБ роиро┐ройрпИро╡рпВроЯрпНроЯро▓рпН ро╡рпЖро▒рпНро▒ро┐роХро░рооро╛роХроЪрпН роЪрпЗро░рпНроХрпНроХрокрпНрокроЯрпНроЯродрпБ!" : "Medication reminder added successfully!"}</p>`;
            } catch (e) {
                console.error("Error adding medication reminder: ", e);
                medicationRemindersOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "роиро┐ройрпИро╡рпВроЯрпНроЯро▓рпИроЪрпН роЪрпЗро░рпНроХрпНроХрпБроорпН рокрпЛродрпБ рокро┐ро┤рпИ роПро▒рпНрокроЯрпНроЯродрпБ." : "Error adding reminder."}</p>`;
            }
        });

        function displayMedicationReminders(reminders) {
            const medicationRemindersOutput = document.getElementById('medicationRemindersOutput');
            if (reminders.length === 0) {
                medicationRemindersOutput.innerHTML = `<p>${translations[currentLanguage].medicationRemindersOutputPlaceholder}</p>`;
                return;
            }

            let html = `<h3 class="font-semibold mb-2">${currentLanguage === 'ta' ? "роЙроЩрпНроХро│рпН рооро░рпБроирпНродрпБ роиро┐ройрпИро╡рпВроЯрпНроЯро▓рпНроХро│рпН:" : "Your Medication Reminders:"}</h3><ul class="list-disc pl-5 space-y-2">`;
            reminders.sort((a, b) => a.time.localeCompare(b.time)).forEach(reminder => {
                html += `<li><strong>${reminder.name}</strong> - ${reminder.time} `;
                html += `<button class="text-red-500 ml-2" onclick="deleteMedicationReminder('${reminder.id}')">(${currentLanguage === 'ta' ? "роЕро┤ро┐" : "Delete"})</button></li>`;
            });
            html += `</ul>`;
            medicationRemindersOutput.innerHTML = html;
        }

        // Make deleteMedicationReminder globally accessible for onclick
        window.deleteMedicationReminder = async (id) => {
            if (!db || !userId) {
                console.warn("Firestore not initialized. Cannot delete medication reminder.");
                return;
            }
            try {
                await deleteDoc(doc(db, `artifacts/${appId}/users/${userId}/medicationReminders`, id));
                document.getElementById('medicationRemindersOutput').innerHTML = `<p>${currentLanguage === 'ta' ? "роиро┐ройрпИро╡рпВроЯрпНроЯро▓рпН роирпАроХрпНроХрокрпНрокроЯрпНроЯродрпБ." : "Reminder deleted."}</p>`;
            } catch (e) {
                console.error("Error deleting medication reminder: ", e);
                document.getElementById('medicationRemindersOutput').innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "роиро┐ройрпИро╡рпВроЯрпНроЯро▓рпИ роирпАроХрпНроХрпБроорпН рокрпЛродрпБ рокро┐ро┤рпИ роПро▒рпНрокроЯрпНроЯродрпБ." : "Error deleting reminder."}</p>`;
            }
        };

        // Body Pain Mapping Functionality
        const bodyMapImage = document.getElementById('bodyMapImage');
        const bodyMapContainer = document.querySelector('.body-map-container');
        let painDots = [];

        bodyMapContainer.addEventListener('click', (event) => {
            // Only add a dot if clicking directly on the image or container, not on an existing dot
            if (event.target === bodyMapImage || event.target === bodyMapContainer) {
                const rect = bodyMapImage.getBoundingClientRect();
                const x = (event.clientX - rect.left) / rect.width * 100; // Percentage X
                const y = (event.clientY - rect.top) / rect.height * 100; // Percentage Y

                const dot = document.createElement('div');
                dot.classList.add('pain-dot');
                dot.style.left = `${x}%`;
                dot.style.top = `${y}%`;
                dot.dataset.x = x;
                dot.dataset.y = y;

                dot.addEventListener('click', (e) => {
                    e.stopPropagation(); // Prevent container click when clicking on dot
                    dot.classList.toggle('selected');
                });

                bodyMapContainer.appendChild(dot);
                painDots.push({ x, y });
                document.getElementById('painAnalysisOutput').innerHTML = `<p>${currentLanguage === 'ta' ? `рокрпБро│рпНро│ро┐ (${x.toFixed(1)}%, ${y.toFixed(1)}%) роЪрпЗро░рпНроХрпНроХрокрпНрокроЯрпНроЯродрпБ.` : `Dot added at (${x.toFixed(1)}%, ${y.toFixed(1)}%).`}</p>`;
            }
        });

        document.getElementById('clearPainDotsBtn').addEventListener('click', () => {
            document.querySelectorAll('.pain-dot').forEach(dot => dot.remove());
            painDots = [];
            document.getElementById('painAnalysisOutput').innerHTML = `<p>${currentLanguage === 'ta' ? "роЕройрпИродрпНродрпБ ро╡ро▓ро┐ рокрпБро│рпНро│ро┐роХро│рпБроорпН роирпАроХрпНроХрокрпНрокроЯрпНроЯрой." : "All pain dots cleared."}</p>`;
        });

        document.getElementById('analyzePainBtn').addEventListener('click', async () => {
            const painAnalysisOutput = document.getElementById('painAnalysisOutput');
            const loading = document.getElementById('loading');

            if (painDots.length === 0) {
                painAnalysisOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпНроп ро╡ро▓ро┐ рокрпБро│рпНро│ро┐роХро│рпН роЗро▓рпНро▓рпИ." : "No pain points to analyze."}</p>`;
                return;
            }

            loading.style.display = 'flex';
            painAnalysisOutput.innerHTML = '';

            try {
                // In a real application, you'd send these coordinates to a more sophisticated AI for analysis
                // For this example, we'll just list them and ask for a general interpretation.
                const painPointsDescription = painDots.map(p => `(X: ${p.x.toFixed(1)}%, Y: ${p.y.toFixed(1)}%)`).join(', ');

                let chatHistory = [];
                const prompt = currentLanguage === 'ta' ?
                    `роЗроирпНрод роЙроЯро▓рпН ро╡ро▓ро┐ рокрпБро│рпНро│ро┐роХро│ро┐ройрпН роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓рпН роТро░рпБ рокрпКродрпБро╡ро╛рой рокроХрпБрокрпНрокро╛ропрпНро╡рпИ роХрпКроЯрпБроЩрпНроХро│рпН: ${painPointsDescription}. роТро░рпБ рооро░рпБродрпНродрпБро╡ роирпЛропро▒ро┐родро▓рпИ ро╡ро┤роЩрпНроХ ро╡рпЗрогрпНроЯро╛роорпН, рокрпКродрпБро╡ро╛рой роЪро╛родрпНродро┐ропрооро╛рой роХро╛ро░рогроЩрпНроХро│рпН роЕро▓рпНро▓родрпБ роЕроЯрпБродрпНрод рокроЯро┐роХро│рпИ рокро░ро┐роирпНродрпБро░рпИроХрпНроХро╡рпБроорпН. рокродро┐ро▓рпН родрооро┐ро┤ро┐ро▓рпН роЗро░рпБроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН.` :
                    `Provide a general analysis based on these body pain points: ${painPointsDescription}. Do not provide a medical diagnosis, just suggest general possible causes or next steps. The response should be in English.`;

                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content[0].parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    painAnalysisOutput.innerHTML = `<p>${text}</p>`;
                } else {
                    painAnalysisOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "ро╡ро▓ро┐ рокроХрпБрокрпНрокро╛ропрпНро╡рпИ роЙро░рпБро╡ро╛роХрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ. роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН." : "Could not generate pain analysis. Please try again."}</p>`;
                }
            } catch (error) {
                console.error('Error analyzing pain:', error);
                painAnalysisOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "ро╡ро▓ро┐ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпНропрпБроорпН рокрпЛродрпБ рокро┐ро┤рпИ роПро▒рпНрокроЯрпНроЯродрпБ. роЗрогрпИроп роЗрогрпИрокрпНрокрпИроЪрпН роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН." : "An error occurred while analyzing pain. Please check your internet connection."}</p>`;
            } finally {
                loading.style.display = 'none';
            }
        });

        // First Aid & Emergency Functionality
        document.getElementById('getEmergencyGuideBtn').addEventListener('click', async () => {
            const emergencyTopic = document.getElementById('emergencyTopicInput').value.trim();
            const emergencyGuideOutput = document.getElementById('emergencyGuideOutput');
            const loading = document.getElementById('loading');
            const firstAidEmergencyAiVoiceBtn = document.getElementById('firstAidEmergencyAiVoiceBtn');

            if (!emergencyTopic) {
                emergencyGuideOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "роЕро╡роЪро░ родро▓рпИрокрпНрокрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН." : "Please enter an emergency topic."}</p>`;
                return;
            }

            loading.style.display = 'flex';
            emergencyGuideOutput.innerHTML = '';
            firstAidEmergencyAiVoiceBtn.style.display = 'none';

            try {
                let chatHistory = [];
                const prompt = currentLanguage === 'ta' ?
                    `роЗроирпНрод роЕро╡роЪро░роиро┐ро▓рпИроХрпНроХро╛рой роорпБродро▓рпБродро╡ро┐ ро╡ро┤ро┐роХро╛роЯрпНроЯро┐ропрпИ роОройроХрпНроХрпБ роХрпКроЯрпБроЩрпНроХро│рпН: ${emergencyTopic}. рокродро┐ро▓рпН родрооро┐ро┤ро┐ро▓рпН роЗро░рпБроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН.` :
                    `Give me a first aid guide for this emergency: ${emergencyTopic}. The response should be in English.`;

                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    emergencyGuideOutput.innerHTML = `<p>${text}</p>`;
                    firstAidEmergencyAiVoiceBtn.style.display = 'inline-flex';
                } else {
                    emergencyGuideOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "ро╡ро┤ро┐роХро╛роЯрпНроЯро┐ропрпИ роЙро░рпБро╡ро╛роХрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ. роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН." : "Could not generate a guide. Please try again."}</p>`;
                }
            } catch (error) {
                console.error('Error generating emergency guide:', error);
                emergencyGuideOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? "ро╡ро┤ро┐роХро╛роЯрпНроЯро┐ропрпИ роЙро░рпБро╡ро╛роХрпНроХрпБроорпН рокрпЛродрпБ рокро┐ро┤рпИ роПро▒рпНрокроЯрпНроЯродрпБ. роЗрогрпИроп роЗрогрпИрокрпНрокрпИроЪрпН роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН." : "An error occurred while generating the guide. Please check your internet connection."}</p>`;
            } finally {
                loading.style.display = 'none';
            }
        });

    </script>
</body>
</html>
