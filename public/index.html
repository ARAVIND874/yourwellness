<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ஆரோக்கிய நண்பன் - Wellness Buddy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        /* ... (உங்கள் ஏற்கனவே உள்ள CSS பாணிகள்) ... */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #E6F7FF; /* Light Blue */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1.5rem;
            color: #333333;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            box-sizing: border-box;
            transition: all 0.5s ease-in-out;
        }

        body.main-content-active {
            min-height: auto;
            align-items: flex-start;
            padding-top: 2rem;
            padding-bottom: 2rem;
            overflow-y: auto;
        }

        .container {
            max-width: 640px;
            width: 100%;
            background-color: #ffffff;
            border-radius: 1.75rem;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08);
            padding: 2.5rem;
            text-align: center;
            position: relative;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .language-selector-wrapper {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
        }
        .input-wrapper {
            position: relative;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
        }
        .input-field {
            flex-grow: 1;
            padding: 1rem 1.25rem;
            padding-right: 3.5rem; /* Space for mic icon */
            border: 1px solid #D1D5DB;
            border-radius: 0.875rem;
            font-size: 1.05rem;
            box-sizing: border-box;
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .input-field:focus {
            border-color: #87CEEB;
            box-shadow: 0 0 0 3px rgba(135, 206, 235, 0.4);
        }
        .mic-button {
            position: absolute;
            right: 1rem;
            background: none;
            border: none;
            color: #0000FF;
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            transition: color 0.3s ease, background-color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        .mic-button:hover {
            color: #DC2626; /* Red */
            background-color: rgba(220, 38, 38, 0.1);
        }
        .mic-button.recording {
            color: #DC2626; /* Red */
            animation: pulse 1s infinite alternate;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.1); opacity: 0.7; }
        }

        .generate-button, .action-button, .ai-voice-button {
            background-color: #6A0DAD; /* Dark Violet */
            color: #ffffff;
            padding: 1rem 2rem;
            border-radius: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease;
            box-shadow: 0 6px 15px rgba(106, 13, 173, 0.4);
            letter-spacing: 0.025em;
            margin-top: 1rem;
            border: none;
            display: inline-flex; /* Ensure flex behavior for centering icon/text */
            align-items: center;
            justify-content: center;
            gap: 0.5rem; /* Space between icon and text */
        }
        .generate-button:hover, .action-button:hover, .ai-voice-button:hover {
            background-color: #4B0A7B; /* Darker Violet */
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(106, 13, 173, 0.5);
        }
        .generate-button:active, .action-button:active, .ai-voice-button:active {
            transform: translateY(0);
            box-shadow: 0 4px 10px rgba(106, 13, 173, 0.3);
        }
        .loading-indicator {
            display: none;
            margin-top: 2rem;
            font-size: 1.15rem;
            color: #6B7280;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #6A0DAD;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .tip-box, .result-box {
            background-color: #FFFFAA; /* Light Yellow */
            border: 1px solid #CCCC88; /* Darker Yellow */
            border-radius: 1.25rem;
            padding: 2rem;
            margin-top: 2rem;
            text-align: left;
            color: #333333;
            line-height: 1.7;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
            font-size: 1.05rem;
            transition: all 0.5s ease-in-out;
            word-break: break-word; /* Ensure long words break */
        }
        .tip-box p, .result-box p {
            margin: 0;
        }
        .text-red-600 {
            color: #DC2626; /* Red */
        }
        /* Responsive adjustments */
        @media (max-width: 640px) {
            body {
                padding: 1rem;
            }
            .container {
                padding: 1.5rem;
                border-radius: 1.25rem;
            }
            .generate-button, .action-button, .ai-voice-button {
                width: 100%;
                padding: 0.9rem 1.5rem;
            }
            .flex.flex-wrap.justify-center.gap-4 {
                flex-direction: column;
                gap: 0.75rem;
            }
            .language-selector-wrapper {
                top: 0.75rem;
                right: 0.75rem;
            }
            .input-wrapper {
                flex-direction: row;
                justify-content: center;
            }
            .mic-button {
                position: absolute;
                right: 0.5rem;
            }
        }
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #E6F7FF;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 1;
            transition: opacity 1s ease-out;
            overflow: hidden;
        }
        .splash-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }
        .splash-screen img {
            max-width: 25%;
            max-height: 25%;
            object-fit: contain;
        }

        .dropdown-menu {
            position: absolute;
            background-color: white;
            border: 1px solid #D1D5DB;
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            text-align: left;
            padding: 0.5rem 0;
            top: calc(100% + 5px); /* Position below input */
            left: 0;
        }
        .dropdown-menu div {
            padding: 0.75rem 1.25rem;
            cursor: pointer;
        }
        .dropdown-menu div:hover {
            background-color: #F3F4F6;
        }
        .dropdown-menu div.selected {
            background-color: #e0f2fe; /* light blue */
            font-weight: 500;
        }
        .feature-icon-container {
            display: flex;
            justify-content: center;
            gap: 1.5rem; /* Space between icons */
            margin-top: 2rem;
            flex-wrap: wrap; /* Allow icons to wrap on smaller screens */
        }
        .feature-icon {
            font-size: 3rem; /* Larger emoji size */
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.75rem;
            transition: transform 0.2s ease, background-color 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            line-height: 1;
        }
        .feature-icon:hover {
            transform: translateY(-5px);
            background-color: rgba(135, 206, 235, 0.1); /* Light blue hover */
        }
        .feature-icon span.label {
            font-size: 0.8rem; /* Smaller text label */
            margin-top: 0.5rem;
            color: #555;
            font-weight: 500;
        }
        /* Styles for feature sections (initially hidden) */
        .feature-section {
            display: none;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e5e7eb; /* Subtle separator */
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Voice selection dropdown for TTS */
        .tts-voice-selector {
            padding: 0.75rem;
            border: 1px solid #D1D5DB;
            border-radius: 0.875rem;
            font-size: 0.95rem;
            background-color: white;
            margin-left: 1rem;
            flex-grow: 1;
        }

        /* Styles for Body Pain Mapping - new */
        .body-map-container {
            position: relative;
            width: 100%;
            max-width: 300px; /* Adjust as needed */
            margin: 0 auto;
            border: 1px solid #ccc;
            border-radius: 10px;
            overflow: hidden;
        }
        .body-map-image {
            width: 100%;
            height: auto;
            display: block;
        }
        .pain-dot {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: red;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
            transform: translate(-50%, -50%); /* Center the dot on the click */
        }
        .pain-dot.selected {
            background-color: darkred;
            border: 2px solid yellow;
        }
    </style>
</head>
<body>
    <div id="splashScreen" class="splash-screen">
        <img src="healthcare.png" alt="Healthcare related image">
    </div>

    <div class="container" id="mainContent" style="display: none;">
        <div class="language-selector-wrapper">
            <select id="languageSelect" aria-label="Select Language" class="p-2 border border-gray-300 rounded-md text-sm bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-300">
                <option value="ta">தமிழ்</option>
                <option value="en">English</option>
            </select>
        </div>
        <h1 id="mainTitle" class="text-3xl font-bold text-gray-800 mb-4 lg:text-4xl"></h1>
        <p id="descriptionText" class="text-gray-600 mb-8 text-lg"></p>

        <h2 id="tipSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
        <div class="input-wrapper">
            <input type="text" id="goalInput" class="input-field" aria-label="உங்கள் ஆரோக்கிய இலக்கை உள்ளிடவும்">
            <button id="micBtn" class="mic-button" title="உங்கள் இலக்கைப் பேசுங்கள்" aria-label="உங்கள் ஆரோக்கிய இலக்கைப் பதிவு செய்யவும்">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                    <line x1="12" y1="19" x2="12" y2="23"></line>
                    <line x1="8" y1="23" x2="16" y2="23"></line>
                </svg>
            </button>
        </div>
        <div class="flex flex-wrap justify-center gap-4 mt-4">
            <button id="generateBtn" class="generate-button"></button>
            <button id="aiVoiceBtn" class="ai-voice-button" style="display: none;">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                    <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                </svg>
            </button>
            <select id="ttsVoiceSelect" class="tts-voice-selector" style="display: none;" aria-label="Select Voice"></select>
        </div>
        <div id="loading" class="loading-indicator" aria-live="polite">
            <div class="loading-spinner"></div>
            <p id="loadingText"></p>
        </div>
        <div id="tipOutput" class="tip-box" aria-live="polite"></div>

        <hr class="border-t border-gray-300 my-8">

        <h2 id="featuresTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
        <div class="feature-icon-container">
            <div id="iconStepTracker" class="feature-icon" title="படி டிராக்கர்">🚶‍♀️<span class="label" data-label-key="stepTrackerLabel"></span></div>
            <div id="iconHeartRateTracker" class="feature-icon" title="இதயத் துடிப்பு டிராக்கர்">❤️‍🩹<span class="label" data-label-key="heartRateTrackerLabel"></span></div>
            <div id="iconWaterTracker" class="feature-icon" title="தண்ணீர் டிராக்கர்">💧<span class="label" data-label-key="waterTrackerLabel"></span></div>
            <div id="iconJournal" class="feature-icon" title="மனநிலை & நன்றியுணர்வு ஜர்னல்">✍️<span class="label" data-label-key="journalLabel"></span></div>
            <div id="iconLocalTips" class="feature-icon" title="உள்ளூர் ஆரோக்கிய குறிப்புகள்">🌿<span class="label" data-label-key="localTipsLabel"></span></div>
            <div id="iconMealPlan" class="feature-icon" title="உணவுத் திட்டப் பரிந்துரைகள்">🍲<span class="label" data-label-key="mealPlanLabel"></span></div>
            <div id="iconMoodAnalysis" class="feature-icon" title="உணர்வுப் பதிவேடு பகுப்பாய்வு">🤔<span class="label" data-label-key="moodAnalysisLabel"></span></div>
            <div id="iconExerciseYoga" class="feature-icon" title="உடற்பயிற்சி & யோகா">🧘‍♀️<span class="label" data-label-key="exerciseYogaLabel"></span></div>
            <div id="iconDiseasePrevention" class="feature-icon" title="நோய் தடுப்பு">🛡️<span class="label" data-label-key="diseasePreventionLabel"></span></div>
            <div id="iconWellnessChallenge" class="feature-icon" title="ஆரோக்கிய சவால்கள்">🏆<span class="label" data-label-key="wellnessChallengeLabel"></span></div>
            <div id="iconMedicationReminder" class="feature-icon" title="மருந்து நினைவூட்டல்">💊<span class="label" data-label-key="medicationReminderLabel"></span></div>
            <div id="iconBodyPainMapping" class="feature-icon" title="உடல் வலி மேப்பிங்">🤕<span class="label" data-label-key="bodyPainMappingLabel"></span></div>
            <div id="iconFirstAidEmergency" class="feature-icon" title="முதலுதவி & அவசர உதவி">🚑<span class="label" data-label-key="firstAidEmergencyLabel"></span></div>
        </div>

        <div id="stepTrackerSection" class="feature-section">
            <h2 id="stepSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <div class="input-wrapper">
                <label for="currentStepsDisplay" class="sr-only">தற்போதைய படிகள்</label>
                <input type="text" id="currentStepsDisplay" class="input-field" value="0" readonly aria-atomic="true">
            </div>
            <div class="flex flex-wrap justify-center gap-4 mt-4">
                <button id="addOneStepBtn" class="action-button"></button>
                <button id="toggleTrackingBtn" class="action-button"></button>
                <button id="resetStepsBtn" class="action-button"></button>
            </div>
            <div id="stepResultOutput" class="result-box" aria-live="polite"></div>
        </div>

        <div id="heartRateTrackerSection" class="feature-section">
            <h2 id="heartRateSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <div class="input-wrapper">
                <label for="currentHeartRateDisplay" class="sr-only">தற்போதைய இதயத் துடிப்பு</label>
                <input type="text" id="currentHeartRateDisplay" class="input-field" value="0" readonly aria-atomic="true">
            </div>
            <div class="flex flex-wrap justify-center gap-4 mt-4">
                <button id="simulateHeartRateBtn" class="action-button"></button>
                <button id="resetHeartRateBtn" class="action-button"></button>
            </div>
            <div id="heartRateResultOutput" class="result-box" aria-live="polite"></div>
        </div>

        <div id="waterTrackerSection" class="feature-section">
            <h2 id="waterSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <div class="input-wrapper">
                <label for="waterIntakeDisplay" class="sr-only">தற்போதைய தண்ணீர் உட்கொள்ளல்</label>
                <input type="text" id="waterIntakeDisplay" class="input-field" value="0 ml" readonly aria-atomic="true">
            </div>
            <div class="flex flex-wrap justify-center gap-4 mt-4">
                <button id="addWaterBtn" class="action-button"></button>
                <button id="resetWaterBtn" class="action-button"></button>
            </div>
            <div id="waterResultOutput" class="result-box" aria-live="polite"></div>
        </div>

        <div id="journalSection" class="feature-section">
            <h2 id="journalSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <p id="journalDescription" class="text-gray-600 mb-4 text-lg"></p>
            <div class="input-wrapper flex-col items-stretch">
                <label for="moodSelect" class="sr-only">உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்</label>
                <select id="moodSelect" class="input-field mb-4" aria-label="உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்">
                    <option value="">உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்</option>
                    <option value="happy">மகிழ்ச்சி 😄</option>
                    <option value="neutral">சாதாரணம் 😐</option>
                    <option value="sad">சோகம் 😔</option>
                    <option value="stressed">மன அழுத்தம் 😩</option>
                    <option value="energetic">ஆற்றல் 💪</option>
                </select>
                <label for="gratitudeInput" class="sr-only">நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்</label>
                <textarea id="gratitudeInput" class="input-field min-h-[100px]" placeholder="நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்..." aria-label="நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்"></textarea>
            </div>
            <button id="saveJournalEntryBtn" class="action-button mt-4"></button>
            <div id="journalEntriesOutput" class="result-box mt-4 text-left"></div>
        </div>

        <div id="localTipsSection" class="feature-section">
            <h2 id="localTipsSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <p id="localTipsDescription" class="text-gray-600 mb-4 text-lg"></p>
            <div class="input-wrapper mb-4">
                <input type="text" id="localTipCategory" class="input-field" aria-label="உதவிக்குறிப்பு வகையை உள்ளிடவும்" placeholder="எ.கா. மஞ்சள், முருங்கை, தியானம்...">
                <div id="localTipCategoryDropdown" class="dropdown-menu hidden mt-2 top-full left-0"></div>
            </div>
            <button id="getLocalTipBtn" class="generate-button"></button>
            <div id="localTipOutput" class="tip-box" aria-live="polite"></div>
        </div>

        <div id="mealPlanSection" class="feature-section">
            <h2 id="mealPlanSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <p id="mealPlanDescription" class="text-gray-600 mb-4 text-lg"></p>
            <div class="input-wrapper flex-col items-stretch">
                <label for="dietGoalInput" class="sr-only">உணவு இலக்கு</label>
                <input type="text" id="dietGoalInput" class="input-field mb-4" placeholder="எ.கா. எடை குறைப்பு, தசை வளர்ச்சி..." aria-label="உணவு இலக்கு">

                <label for="dietPreferenceSelect" class="sr-only">உணவு விருப்பம்</label>
                <select id="dietPreferenceSelect" class="input-field mb-4" aria-label="உணவு விருப்பம்">
                    <option value="">உணவு விருப்பத்தைத் தேர்ந்தெடுக்கவும்</option>
                    <option value="vegetarian">சைவம்</option>
                    <option value="non-vegetarian">அசைவம்</option>
                    <option value="vegan">முழு சைவம்</option>
                </select>

                <label for="allergiesInput" class="sr-only">ஒவ்வாமைகள் (இருப்பின்)</label>
                <input type="text" id="allergiesInput" class="input-field mb-4" placeholder="எ.கா. நிலக்கடலை, பால்..." aria-label="ஒவ்வாமைகள்">
            </div>
            <button id="generateMealPlanBtn" class="action-button mt-4"></button>
            <div id="mealPlanOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
        </div>

        <div id="moodAnalysisSection" class="feature-section">
            <h2 id="moodAnalysisSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <p id="moodAnalysisDescription" class="text-gray-600 mb-4 text-lg"></p>
            <button id="analyzeMoodJournalBtn" class="action-button mt-4"></button>
            <div id="moodAnalysisOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
        </div>

        <div id="exerciseYogaSection" class="feature-section">
            <h2 id="exerciseYogaSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <p id="exerciseYogaDescription" class="text-gray-600 mb-4 text-lg"></p>
            <div class="input-wrapper flex-col items-stretch">
                <label for="fitnessLevelSelect" class="sr-only">உடற்பயிற்சி நிலை</label>
                <select id="fitnessLevelSelect" class="input-field mb-4" aria-label="உடற்பயிற்சி நிலை">
                    <option value="">உடற்பயிற்சி நிலையைத் தேர்ந்தெடுக்கவும்</option>
                    <option value="beginner">ஆரம்பநிலை</option>
                    <option value="intermediate">நடுநிலை</option>
                    <option value="advanced">மேம்பட்டது</option>
                </select>

                <label for="timeAvailableInput" class="sr-only">கிடைக்கக்கூடிய நேரம் (நிமிடங்கள்)</label>
                <input type="number" id="timeAvailableInput" class="input-field mb-4" placeholder="கிடைக்கக்கூடிய நேரம் (நிமிடங்கள்)..." aria-label="கிடைக்கக்கூடிய நேரம்">

                <label for="exerciseGoalInput" class="sr-only">உடற்பயிற்சி இலக்கு</label>
                <input type="text" id="exerciseGoalInput" class="input-field mb-4" placeholder="எ.கா. உடல் நெகிழ்வுத்தன்மை, தசைகளை உருவாக்குதல்..." aria-label="உடற்பயிற்சி இலக்கு">
            </div>
            <button id="generateExerciseRoutineBtn" class="action-button mt-4"></button>
            <div id="exerciseRoutineOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
        </div>

        <div id="diseasePreventionSection" class="feature-section">
            <h2 id="diseasePreventionSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <p id="diseasePreventionDescription" class="text-gray-600 mb-4 text-lg"></p>
            <div class="input-wrapper mb-4">
                <input type="text" id="healthConcernInput" class="input-field" aria-label="உடல்நலக் கவலையை உள்ளிடவும்" placeholder="எ.கா. ஜலதோஷம், செரிமானப் பிரச்சனை...">
            </div>
            <button id="getRemedyBtn" class="generate-button"></button>
            <div id="remedyOutput" class="tip-box" aria-live="polite"></div>
        </div>

        <div id="wellnessChallengeSection" class="feature-section">
            <h2 id="wellnessChallengeSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <p id="wellnessChallengeDescription" class="text-gray-600 mb-4 text-lg"></p>
            <div class="input-wrapper flex-col items-stretch">
                <label for="currentHabitInput" class="sr-only">தற்போதைய பழக்கம் (எ.கா. நீர் உட்கொள்ளல்)</label>
                <input type="text" id="currentHabitInput" class="input-field mb-4" placeholder="உங்கள் தற்போதைய பழக்கம் (எ.கா. 1000ml தண்ணீர்)..." aria-label="தற்போதைய பழக்கம்">
                
                <label for="challengeGoalInput" class="sr-only">சவால் இலக்கு (எ.கா. 2000ml தண்ணீர்)</label>
                <input type="text" id="challengeGoalInput" class="input-field mb-4" placeholder="உங்கள் சவால் இலக்கு (எ.கா. 2000ml தண்ணீர்)..." aria-label="சவால் இலக்கு">
            </div>
            <button id="generateChallengeBtn" class="action-button mt-4"></button>
            <div id="challengeOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
        </div>

        <div id="medicationReminderSection" class="feature-section">
            <h2 id="medicationReminderSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <p id="medicationReminderDescription" class="text-gray-600 mb-4 text-lg"></p>
            <div class="input-wrapper flex-col items-stretch">
                <label for="medicationNameInput" class="sr-only">மருந்தின் பெயர்</label>
                <input type="text" id="medicationNameInput" class="input-field mb-4" placeholder="மருந்தின் பெயர்..." aria-label="மருந்தின் பெயர்">
                
                <label for="medicationTimeInput" class="sr-only">நேரம் (எ.கா., 08:00 AM)</label>
                <input type="time" id="medicationTimeInput" class="input-field mb-4" aria-label="நேரம் (எ.கா., 08:00 AM)">

                <label for="medicationFrequencySelect" class="sr-only">எத்தனை முறை</label>
                <select id="medicationFrequencySelect" class="input-field mb-4" aria-label="எத்தனை முறை">
                    <option value="">எத்தனை முறை...</option>
                    <option value="daily">தினமும்</option>
                    <option value="weekly">வாராந்திரம்</option>
                    <option value="monthly">மாதாந்திரம்</option>
                </select>
            </div>
            <button id="addMedicationReminderBtn" class="action-button mt-4"></button>
            <div id="medicationRemindersList" class="result-box mt-4 text-left" aria-live="polite">
                </div>
        </div>

        <div id="bodyPainMappingSection" class="feature-section">
            <h2 id="bodyPainMappingSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <p id="bodyPainMappingDescription" class="text-gray-600 mb-4 text-lg"></p>
            <div class="body-map-container">
                <img id="bodyMapImage" src="human_body.png" alt="மனித உடல் வரைபடம்" class="body-map-image">
                </div>
            <div class="input-wrapper flex-col items-stretch mt-4">
                <label for="painDescriptionInput" class="sr-only">வலி விளக்கம்</label>
                <textarea id="painDescriptionInput" class="input-field min-h-[80px] mb-4" placeholder="வலியின் விளக்கம் (எ.கா., கூர்மையான வலி, துடிக்கும் வலி)..." aria-label="வலியின் விளக்கம்"></textarea>
                
                <label for="painLevelSelect" class="sr-only">வலியின் தீவிரம் (1-10)</label>
                <input type="number" id="painLevelSelect" class="input-field mb-4" min="1" max="10" placeholder="வலியின் தீவிரம் (1-10)" aria-label="வலியின் தீவிரம்">
            </div>
            <button id="savePainEntryBtn" class="action-button mt-4"></button>
            <div id="painEntriesOutput" class="result-box mt-4 text-left" aria-live="polite">
                </div>
        </div>

        <div id="firstAidEmergencySection" class="feature-section">
            <h2 id="firstAidEmergencySectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <p id="firstAidEmergencyDescription" class="text-gray-600 mb-4 text-lg"></p>

            <div class="flex flex-col gap-3 mb-6">
                <button class="action-button text-left" data-emergency-type="cut" id="firstAidCutBtn">
                    <span id="firstAidCutLabel">வெட்டுக்காயங்கள்</span>
                </button>
                <button class="action-button text-left" data-emergency-type="burn" id="firstAidBurnBtn">
                    <span id="firstAidBurnLabel">தீக்காயங்கள்</span>
                </button>
                <button class="action-button text-left" data-emergency-type="choking" id="firstAidChokingBtn">
                    <span id="firstAidChokingLabel">மூச்சுத்திணறல்</span>
                </button>
                <button class="action-button text-left" data-emergency-type="heart_attack" id="firstAidHeartAttackBtn">
                    <span id="firstAidHeartAttackLabel">மாரடைப்பு</span>
                </button>
                </div>

            <h3 id="emergencyNumbersTitle" class="text-xl font-semibold text-gray-700 mb-3"></h3>
            <div class="flex flex-col gap-3">
                <button class="action-button bg-red-600 hover:bg-red-700" id="callAmbulanceBtn">
                    <span id="callAmbulanceLabel">ஆம்புலன்ஸ் (108)</span>
                </button>
                <button class="action-button bg-blue-600 hover:bg-blue-700" id="callPoliceBtn">
                    <span id="callPoliceLabel">காவல்துறை (100)</span>
                </button>
                </div>

            <h3 id="nearbyHospitalsTitle" class="text-xl font-semibold text-gray-700 mt-6 mb-3"></h3>
            <button id="findHospitalsBtn" class="action-button mb-4"></button>
            <div id="hospitalsMap" class="w-full h-64 bg-gray-200 rounded-lg flex items-center justify-center text-gray-500">
                </div>

            <div id="firstAidOutput" class="result-box mt-6 text-left" aria-live="polite"></div>
        </div>

        </div> <script>
        // --- Configuration ---
        // IMPORTANT: The Gemini API Key is now handled securely via Netlify Functions.
        // No direct API key in frontend code.
        // The frontend will call '/.netlify/functions/generate-tip' which handles the key.

        // --- HTML Element References ---
        const goalInput = document.getElementById('goalInput');
        const generateBtn = document.getElementById('generateBtn');
        const loadingIndicator = document.getElementById('loading');
        const tipOutput = document.getElementById('tipOutput');
        const languageSelect = document.getElementById('languageSelect');
        const mainTitle = document.getElementById('mainTitle');
        const descriptionText = document.getElementById('descriptionText');
        const loadingText = document.getElementById('loadingText');
        const micBtn = document.getElementById('micBtn');
        const aiVoiceBtn = document.getElementById('aiVoiceBtn');
        const ttsVoiceSelect = document.getElementById('ttsVoiceSelect');

        const splashScreen = document.getElementById('splashScreen');
        const mainContent = document.getElementById('mainContent');

        const tipSectionTitle = document.getElementById('tipSectionTitle');
        const featuresTitle = document.getElementById('featuresTitle');

        // Emoji Icons
        const iconStepTracker = document.getElementById('iconStepTracker');
        const iconHeartRateTracker = document.getElementById('iconHeartRateTracker');
        const iconWaterTracker = document.getElementById('iconWaterTracker');
        const iconJournal = document.getElementById('iconJournal');
        const iconLocalTips = document.getElementById('iconLocalTips');
        // Existing NEW FEATURE ICONS
        const iconMealPlan = document.getElementById('iconMealPlan');
        const iconMoodAnalysis = document.getElementById('iconMoodAnalysis');
        const iconExerciseYoga = document.getElementById('iconExerciseYoga');
        const iconDiseasePrevention = document.getElementById('iconDiseasePrevention');
        const iconWellnessChallenge = document.getElementById('iconWellnessChallenge');
        // NEW FEATURE ICONS
        const iconMedicationReminder = document.getElementById('iconMedicationReminder');
        const iconBodyPainMapping = document.getElementById('iconBodyPainMapping');
        const iconFirstAidEmergency = document.getElementById('iconFirstAidEmergency');


        // Feature Sections (Existing)
        const stepTrackerSection = document.getElementById('stepTrackerSection');
        const heartRateTrackerSection = document.getElementById('heartRateTrackerSection');
        const waterTrackerSection = document.getElementById('waterTrackerSection');
        const journalSection = document.getElementById('journalSection');
        const localTipsSection = document.getElementById('localTipsSection');

        // Existing NEW FEATURE SECTIONS
        const mealPlanSection = document.getElementById('mealPlanSection');
        const moodAnalysisSection = document.getElementById('moodAnalysisSection');
        const exerciseYogaSection = document.getElementById('exerciseYogaSection');
        const diseasePreventionSection = document.getElementById('diseasePreventionSection');
        const wellnessChallengeSection = document.getElementById('wellnessChallengeSection');
        // NEW FEATURE SECTIONS
        const medicationReminderSection = document.getElementById('medicationReminderSection');
        const bodyPainMappingSection = document.getElementById('bodyPainMappingSection');
        const firstAidEmergencySection = document.getElementById('firstAidEmergencySection');


        // Step Tracker elements
        const stepSectionTitle = document.getElementById('stepSectionTitle');
        const currentStepsDisplay = document.getElementById('currentStepsDisplay');
        const addOneStepBtn = document.getElementById('addOneStepBtn');
        const toggleTrackingBtn = document.getElementById('toggleTrackingBtn');
        const resetStepsBtn = document.getElementById('resetStepsBtn');
        const stepResultOutput = document.getElementById('stepResultOutput');

        // Heart Rate elements
        const heartRateSectionTitle = document.getElementById('heartRateSectionTitle');
        const currentHeartRateDisplay = document.getElementById('currentHeartRateDisplay');
        const simulateHeartRateBtn = document.getElementById('simulateHeartRateBtn');
        const resetHeartRateBtn = document.getElementById('resetHeartRateBtn');
        const heartRateResultOutput = document.getElementById('heartRateResultOutput');

        // Water Intake elements
        const waterSectionTitle = document.getElementById('waterSectionTitle');
        const waterIntakeDisplay = document.getElementById('waterIntakeDisplay');
        const addWaterBtn = document.getElementById('addWaterBtn');
        const resetWaterBtn = document.getElementById('resetWaterBtn');
        const waterResultOutput = document.getElementById('waterResultOutput');

        // Mood & Gratitude Journal elements
        const journalSectionTitle = document.getElementById('journalSectionTitle');
        const journalDescription = document.getElementById('journalDescription');
        const moodSelect = document.getElementById('moodSelect');
        const gratitudeInput = document.getElementById('gratitudeInput');
        const saveJournalEntryBtn = document.getElementById('saveJournalEntryBtn');
        const journalEntriesOutput = document.getElementById('journalEntriesOutput');

        // Local & Traditional Wellness Tips elements
        const localTipsSectionTitle = document.getElementById('localTipsSectionTitle');
        const localTipsDescription = document.getElementById('localTipsDescription');
        const localTipCategory = document.getElementById('localTipCategory');
        const localTipCategoryDropdown = document.getElementById('localTipCategoryDropdown');
        const getLocalTipBtn = document.getElementById('getLocalTipBtn');
        const localTipOutput = document.getElementById('localTipOutput');


        // --- EXISTING NEW FEATURE ELEMENTS ---
        // Meal Plan elements
        const mealPlanSectionTitle = document.getElementById('mealPlanSectionTitle');
        const mealPlanDescription = document.getElementById('mealPlanDescription');
        const dietGoalInput = document.getElementById('dietGoalInput');
        const dietPreferenceSelect = document.getElementById('dietPreferenceSelect');
        const allergiesInput = document.getElementById('allergiesInput');
        const generateMealPlanBtn = document.getElementById('generateMealPlanBtn');
        const mealPlanOutput = document.getElementById('mealPlanOutput');

        // Mood Analysis elements
        const moodAnalysisSectionTitle = document.getElementById('moodAnalysisSectionTitle');
        const moodAnalysisDescription = document.getElementById('moodAnalysisDescription');
        const analyzeMoodJournalBtn = document.getElementById('analyzeMoodJournalBtn');
        const moodAnalysisOutput = document.getElementById('moodAnalysisOutput');

        // Exercise/Yoga elements
        const exerciseYogaSectionTitle = document.getElementById('exerciseYogaSectionTitle');
        const exerciseYogaDescription = document.getElementById('exerciseYogaDescription');
        const fitnessLevelSelect = document.getElementById('fitnessLevelSelect');
        const timeAvailableInput = document.getElementById('timeAvailableInput');
        const exerciseGoalInput = document.getElementById('exerciseGoalInput');
        const generateExerciseRoutineBtn = document.getElementById('generateExerciseRoutineBtn');
        const exerciseRoutineOutput = document.getElementById('exerciseRoutineOutput');

        // Disease Prevention elements
        const diseasePreventionSectionTitle = document.getElementById('diseasePreventionSectionTitle');
        const diseasePreventionDescription = document.getElementById('diseasePreventionDescription');
        const healthConcernInput = document.getElementById('healthConcernInput');
        const getRemedyBtn = document.getElementById('getRemedyBtn');
        const remedyOutput = document.getElementById('remedyOutput');

        // Wellness Challenge elements
        const wellnessChallengeSectionTitle = document.getElementById('wellnessChallengeSectionTitle');
        const wellnessChallengeDescription = document.getElementById('wellnessChallengeDescription');
        const currentHabitInput = document.getElementById('currentHabitInput');
        const challengeGoalInput = document.getElementById('challengeGoalInput');
        const generateChallengeBtn = document.getElementById('generateChallengeBtn');
        const challengeOutput = document.getElementById('challengeOutput');


        // --- NEW FEATURE ELEMENTS ---
        // Medication Reminder elements
        const medicationReminderSectionTitle = document.getElementById('medicationReminderSectionTitle');
        const medicationReminderDescription = document.getElementById('medicationReminderDescription');
        const medicationNameInput = document.getElementById('medicationNameInput');
        const medicationTimeInput = document.getElementById('medicationTimeInput');
        const medicationFrequencySelect = document.getElementById('medicationFrequencySelect');
        const addMedicationReminderBtn = document.getElementById('addMedicationReminderBtn');
        const medicationRemindersList = document.getElementById('medicationRemindersList');

        // Body Pain Mapping elements
        const bodyPainMappingSectionTitle = document.getElementById('bodyPainMappingSectionTitle');
        const bodyPainMappingDescription = document.getElementById('bodyPainMappingDescription');
        const bodyMapImage = document.getElementById('bodyMapImage');
        const painDescriptionInput = document.getElementById('painDescriptionInput');
        const painLevelSelect = document.getElementById('painLevelSelect');
        const savePainEntryBtn = document.getElementById('savePainEntryBtn');
        const painEntriesOutput = document.getElementById('painEntriesOutput');

        // First Aid & Emergency Assistance elements
        const firstAidEmergencySectionTitle = document.getElementById('firstAidEmergencySectionTitle');
        const firstAidEmergencyDescription = document.getElementById('firstAidEmergencyDescription');
        const firstAidCutBtn = document.getElementById('firstAidCutBtn');
        const firstAidBurnBtn = document.getElementById('firstAidBurnBtn');
        const firstAidChokingBtn = document.getElementById('firstAidChokingBtn');
        const firstAidHeartAttackBtn = document.getElementById('firstAidHeartAttackBtn'); // Add more as needed
        const firstAidOutput = document.getElementById('firstAidOutput');

        const emergencyNumbersTitle = document.getElementById('emergencyNumbersTitle');
        const callAmbulanceBtn = document.getElementById('callAmbulanceBtn');
        const callPoliceBtn = document.getElementById('callPoliceBtn');

        const nearbyHospitalsTitle = document.getElementById('nearbyHospitalsTitle');
        const findHospitalsBtn = document.getElementById('findHospitalsBtn');
        const hospitalsMap = document.getElementById('hospitalsMap');


        // --- Translations ---
        const translations = {
            'ta': {
                'mainTitle': 'ஆரோக்கிய நண்பன்',
                'descriptionText': 'உங்கள் ஆரோக்கியப் பயணத்தில் உங்களுக்கு உதவ நான் இங்கு இருக்கிறேன். உங்கள் இலக்கை உள்ளிடவும் அல்லது அம்சங்களைத் தேர்வு செய்யவும்.',
                'tipSectionTitle': 'உங்களுக்கு ஒரு உதவிக்குறிப்பு தேவைப்படுகிறதா?',
                'generateBtn': 'உதவிக்குறிப்பைப் பெறவும்',
                'loadingText': 'தயவுசெய்து காத்திருக்கவும்...',
                'featuresTitle': 'மற்ற அம்சங்கள்:',
                'stepTrackerLabel': 'படி டிராக்கர்',
                'heartRateTrackerLabel': 'இதயத் துடிப்பு',
                'waterTrackerLabel': 'தண்ணீர் டிராக்கர்',
                'journalLabel': 'ஜர்னல்',
                'localTipsLabel': 'உள்ளூர் குறிப்புகள்',
                'aiVoiceBtn': 'AI குரலில் கேட்கவும்',

                // Existing Feature Sections
                'stepSectionTitle': 'படி டிராக்கர்',
                'addOneStepBtn': 'ஒரு படி சேர்க்கவும்',
                'toggleTrackingBtn': 'கண்காணிப்பைத் தொடங்கு/நிறுத்து',
                'resetStepsBtn': 'படிகளை மீட்டமை',
                'stepResultOutputDefault': 'உங்கள் படிகளைக் கண்காணிக்கவும். இலக்கை அடைய மேலும் நடக்கவும்!',
                'heartRateSectionTitle': 'இதயத் துடிப்பு டிராக்கர்',
                'simulateHeartRateBtn': 'இதயத் துடிப்பை உருவகப்படுத்து',
                'resetHeartRateBtn': 'மீட்டமை',
                'heartRateResultOutputDefault': 'உங்கள் இதயத் துடிப்பைக் கண்காணிக்கவும். ஆரோக்கியமான இதயம், ஆரோக்கியமான வாழ்க்கை!',
                'waterSectionTitle': 'தண்ணீர் உட்கொள்ளல் டிராக்கர்',
                'addWaterBtn': '250ml சேர்க்கவும்',
                'resetWaterBtn': 'மீட்டமை',
                'waterResultOutputDefault': 'உங்கள் நீர் உட்கொள்ளலைக் கண்காணிக்கவும். நீரேற்றமாக இருங்கள்!',
                'journalSectionTitle': 'மனநிலை & நன்றியுணர்வு ஜர்னல்',
                'journalDescription': 'உங்கள் மனநிலை மற்றும் நீங்கள் நன்றியுள்ள விஷயங்களை இங்கே பதிவு செய்யவும்.',
                'saveJournalEntryBtn': 'பதிவைச் சேமிக்கவும்',
                'journalEntrySaved': 'ஜர்னல் பதிவு சேமிக்கப்பட்டது!',
                'localTipsSectionTitle': 'உள்ளூர் மற்றும் பாரம்பரிய ஆரோக்கிய குறிப்புகள்',
                'localTipsDescription': 'மஞ்சள், முருங்கை, தியானம் போன்ற உள்ளூர் மற்றும் பாரம்பரிய குறிப்புகள் பற்றி தெரிந்து கொள்ளுங்கள்.',
                'getLocalTipBtn': 'குறிப்பைப் பெறவும்',

                // Existing New Feature Sections
                'mealPlanLabel': 'உணவுத் திட்டம்',
                'mealPlanSectionTitle': 'உணவுத் திட்டப் பரிந்துரைகள்',
                'mealPlanDescription': 'உங்கள் உணவு இலக்கு, விருப்பம் மற்றும் ஒவ்வாமைகளின் அடிப்படையில் ஒரு உணவுத் திட்டத்தைப் பெறுங்கள்.',
                'generateMealPlanBtn': 'உணவுத் திட்டத்தை உருவாக்கவும்',
                'moodAnalysisLabel': 'உணர்வு பகுப்பாய்வு',
                'moodAnalysisSectionTitle': 'உணர்வுப் பதிவேடு பகுப்பாய்வு',
                'moodAnalysisDescription': 'உங்கள் ஜர்னல் பதிவுகளின் அடிப்படையில் உங்கள் மனநிலை போக்குகளைப் பகுப்பாய்வு செய்யுங்கள்.',
                'analyzeMoodJournalBtn': 'மனநிலையைப் பகுப்பாய்வு செய்யவும்',
                'exerciseYogaLabel': 'உடற்பயிற்சி & யோகா',
                'exerciseYogaSectionTitle': 'உடற்பயிற்சி & யோகா திட்டங்கள்',
                'exerciseYogaDescription': 'உங்கள் உடற்பயிற்சி நிலை, நேரம் மற்றும் இலக்கின் அடிப்படையில் ஒரு உடற்பயிற்சி/யோகா திட்டத்தைப் பெறுங்கள்.',
                'generateExerciseRoutineBtn': 'திட்டத்தை உருவாக்கவும்',
                'diseasePreventionLabel': 'நோய் தடுப்பு',
                'diseasePreventionSectionTitle': 'நோய் தடுப்பு & வீட்டு வைத்தியம்',
                'diseasePreventionDescription': 'பொதுவான உடல்நலக் கவலைகளுக்கான தடுப்பு மற்றும் வீட்டு வைத்தியங்கள் பற்றி தெரிந்து கொள்ளுங்கள்.',
                'getRemedyBtn': 'வைத்தியத்தைப் பெறவும்',
                'wellnessChallengeLabel': 'ஆரோக்கிய சவால்கள்',
                'wellnessChallengeSectionTitle': 'ஆரோக்கிய சவால்கள்',
                'wellnessChallengeDescription': 'உங்கள் இலக்குகளை அடையவும், புதிய பழக்கங்களை உருவாக்கவும் தனிப்பயனாக்கப்பட்ட சவால்களை உருவாக்கவும்.',
                'generateChallengeBtn': 'சவாலை உருவாக்கவும்',

                // NEW FEATURE TRANSLATIONS
                'medicationReminderLabel': 'மருந்து நினைவூட்டல்',
                'medicationReminderSectionTitle': 'மருந்து நினைவூட்டல்கள்',
                'medicationReminderDescription': 'உங்கள் மருந்துகளை சரியான நேரத்தில் எடுத்துக்கொள்ள நினைவூட்டல்களை அமைக்கவும்.',
                'addMedicationReminderBtn': 'நினைவூட்டலைச் சேர்க்கவும்',
                'medicationReminderAdded': 'மருந்து நினைவூட்டல் சேர்க்கப்பட்டது!',
                'medicationNamePlaceholder': 'மருந்தின் பெயர்...',
                'medicationTimePlaceholder': 'நேரம் (எ.கா., 08:00 AM)',
                'medicationFrequencyPlaceholder': 'எத்தனை முறை...',
                'daily': 'தினமும்',
                'weekly': 'வாராந்திரம்',
                'monthly': 'மாதாந்திரம்',

                'bodyPainMappingLabel': 'உடல் வலி மேப்பிங்',
                'bodyPainMappingSectionTitle': 'உடல் வலி மேப்பிங்',
                'bodyPainMappingDescription': 'உங்கள் உடலில் எங்கு வலி உள்ளது என்பதைக் குறிக்கவும், வலியின் தீவிரத்தைக் கண்காணிக்கவும்.',
                'painDescriptionPlaceholder': 'வலியின் விளக்கம்...',
                'painLevelPlaceholder': 'வலியின் தீவிரம் (1-10)',
                'savePainEntryBtn': 'வலியின் பதிவைச் சேமிக்கவும்',
                'painEntrySaved': 'வலி பதிவு சேமிக்கப்பட்டது!',

                'firstAidEmergencyLabel': 'முதலுதவி',
                'firstAidEmergencySectionTitle': 'முதலுதவி & அவசர உதவி',
                'firstAidEmergencyDescription': 'பொதுவான அவசர நிலைகளுக்கான முதலுதவி வழிகாட்டுதல்கள் மற்றும் அவசரகால சேவைகளுக்கான விரைவான அணுகல்.',
                'firstAidCutLabel': 'வெட்டுக்காயங்கள்',
                'firstAidBurnLabel': 'தீக்காயங்கள்',
                'firstAidChokingLabel': 'மூச்சுத்திணறல்',
                'firstAidHeartAttackLabel': 'மாரடைப்பு',
                'emergencyNumbersTitle': 'அவசர எண்கள்',
                'callAmbulanceLabel': 'ஆம்புலன்ஸ் (108)',
                'callPoliceLabel': 'காவல்துறை (100)',
                'nearbyHospitalsTitle': 'அருகிலுள்ள மருத்துவமனைகள்',
                'findHospitalsBtn': 'மருத்துவமனைகளைக் கண்டறியவும்',
                'firstAidOutputLoading': 'முதலுதவி தகவல்களைப் பெறுகிறோம்...',
                'firstAidOutputError': 'முதலுதவி தகவலைப் பெற முடியவில்லை. மீண்டும் முயற்சிக்கவும்.',
                'callingEmergencyService': 'அவசர சேவையை அழைக்கிறோம்...',
                'noLocationPermission': 'மருத்துவமனைகளைக் கண்டறிய இருப்பிட அனுமதி தேவை.'
            },
            'en': {
                'mainTitle': 'Wellness Buddy',
                'descriptionText': 'I am here to assist you on your wellness journey. Enter your goal or choose features below.',
                'tipSectionTitle': 'Need a Quick Wellness Tip?',
                'generateBtn': 'Get Tip',
                'loadingText': 'Please wait...',
                'featuresTitle': 'Explore Other Features:',
                'stepTrackerLabel': 'Step Tracker',
                'heartRateTrackerLabel': 'Heart Rate',
                'waterTrackerLabel': 'Water Tracker',
                'journalLabel': 'Journal',
                'localTipsLabel': 'Local Tips',
                'aiVoiceBtn': 'Listen in AI Voice',

                // Existing Feature Sections
                'stepSectionTitle': 'Step Tracker',
                'addOneStepBtn': 'Add One Step',
                'toggleTrackingBtn': 'Start/Stop Tracking',
                'resetStepsBtn': 'Reset Steps',
                'stepResultOutputDefault': 'Track your steps. Walk more to reach your goals!',
                'heartRateSectionTitle': 'Heart Rate Tracker',
                'simulateHeartRateBtn': 'Simulate Heart Rate',
                'resetHeartRateBtn': 'Reset',
                'heartRateResultOutputDefault': 'Monitor your heart rate. Healthy heart, healthy life!',
                'waterSectionTitle': 'Water Intake Tracker',
                'addWaterBtn': 'Add 250ml',
                'resetWaterBtn': 'Reset',
                'waterResultOutputDefault': 'Track your water intake. Stay hydrated!',
                'journalSectionTitle': 'Mood & Gratitude Journal',
                'journalDescription': 'Record your mood and what you are grateful for here.',
                'saveJournalEntryBtn': 'Save Entry',
                'journalEntrySaved': 'Journal entry saved!',
                'localTipsSectionTitle': 'Local & Traditional Wellness Tips',
                'localTipsDescription': 'Learn about local and traditional tips like Turmeric, Moringa, Meditation, and more.',
                'getLocalTipBtn': 'Get Tip',

                // Existing New Feature Sections
                'mealPlanLabel': 'Meal Plan',
                'mealPlanSectionTitle': 'Meal Plan Suggestions',
                'mealPlanDescription': 'Get a personalized meal plan based on your diet goal, preference, and allergies.',
                'generateMealPlanBtn': 'Generate Meal Plan',
                'moodAnalysisLabel': 'Mood Analysis',
                'moodAnalysisSectionTitle': 'Mood Journal Analysis',
                'moodAnalysisDescription': 'Analyze your mood trends based on your journal entries.',
                'analyzeMoodJournalBtn': 'Analyze Mood',
                'exerciseYogaLabel': 'Exercise & Yoga',
                'exerciseYogaSectionTitle': 'Exercise & Yoga Routines',
                'exerciseYogaDescription': 'Get an exercise/yoga routine based on your fitness level, time available, and goal.',
                'generateExerciseRoutineBtn': 'Generate Routine',
                'diseasePreventionLabel': 'Disease Prevention',
                'diseasePreventionSectionTitle': 'Disease Prevention & Home Remedies',
                'diseasePreventionDescription': 'Learn about prevention and home remedies for common health concerns.',
                'getRemedyBtn': 'Get Remedy',
                'wellnessChallengeLabel': 'Wellness Challenges',
                'wellnessChallengeSectionTitle': 'Wellness Challenges',
                'wellnessChallengeDescription': 'Create personalized challenges to help you reach your goals and build new habits.',
                'generateChallengeBtn': 'Generate Challenge',

                // NEW FEATURE TRANSLATIONS
                'medicationReminderLabel': 'Medication Reminder',
                'medicationReminderSectionTitle': 'Medication Reminders',
                'medicationReminderDescription': 'Set reminders to take your medications on time.',
                'addMedicationReminderBtn': 'Add Reminder',
                'medicationReminderAdded': 'Medication reminder added!',
                'medicationNamePlaceholder': 'Medication Name...',
                'medicationTimePlaceholder': 'Time (e.g., 08:00 AM)',
                'medicationFrequencyPlaceholder': 'Frequency...',
                'daily': 'Daily',
                'weekly': 'Weekly',
                'monthly': 'Monthly',

                'bodyPainMappingLabel': 'Body Pain Mapping',
                'bodyPainMappingSectionTitle': 'Body Pain Mapping & Tracking',
                'bodyPainMappingDescription': 'Mark where you feel pain on the body map and track its intensity.',
                'painDescriptionPlaceholder': 'Pain description (e.g., sharp pain, throbbing)...',
                'painLevelPlaceholder': 'Pain level (1-10)',
                'savePainEntryBtn': 'Save Pain Entry',
                'painEntrySaved': 'Pain entry saved!',

                'firstAidEmergencyLabel': 'First Aid',
                'firstAidEmergencySectionTitle': 'First Aid & Emergency Assistance',
                'firstAidEmergencyDescription': 'First aid guidelines for common emergencies and quick access to emergency services.',
                'firstAidCutLabel': 'Cuts',
                'firstAidBurnLabel': 'Burns',
                'firstAidChokingLabel': 'Choking',
                'firstAidHeartAttackLabel': 'Heart Attack',
                'emergencyNumbersTitle': 'Emergency Numbers',
                'callAmbulanceLabel': 'Ambulance (108)',
                'callPoliceLabel': 'Police (100)',
                'nearbyHospitalsTitle': 'Nearby Hospitals',
                'findHospitalsBtn': 'Find Hospitals',
                'firstAidOutputLoading': 'Getting first aid information...',
                'firstAidOutputError': 'Could not get first aid information. Please try again.',
                'callingEmergencyService': 'Calling emergency service...',
                'noLocationPermission': 'Location permission is required to find hospitals.'
            }
        };

        // --- Speech Recognition ---
        let recognition;
        let isRecording = false;

        function startSpeechRecognition() {
            if (!('webkitSpeechRecognition' in window)) {
                alert(languageSelect.value === 'ta' ? 'மன்னிக்கவும், உங்கள் உலாவி குரல் உள்ளீட்டை ஆதரிக்கவில்லை.' : 'Sorry, your browser does not support speech input.');
                return;
            }

            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = languageSelect.value === 'ta' ? 'ta-IN' : 'en-US'; // Set language based on selection

            recognition.onstart = () => {
                isRecording = true;
                micBtn.classList.add('recording');
                goalInput.placeholder = languageSelect.value === 'ta' ? 'கேட்கிறது...' : 'Listening...';
                console.log('Speech recognition started');
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                goalInput.value = transcript;
                console.log('Speech result:', transcript);
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                alert(languageSelect.value === 'ta' ? `குரல் உள்ளீட்டில் பிழை: ${event.error}` : `Speech input error: ${event.error}`);
            };

            recognition.onend = () => {
                isRecording = false;
                micBtn.classList.remove('recording');
                goalInput.placeholder = languageSelect.value === 'ta' ? 'உங்கள் ஆரோக்கிய இலக்கை உள்ளிடவும்' : 'Enter your wellness goal';
                console.log('Speech recognition ended');
            };

            recognition.start();
        }

        micBtn.addEventListener('click', () => {
            if (isRecording) {
                recognition.stop();
            } else {
                startSpeechRecognition();
            }
        });

        // --- Text-to-Speech (TTS) ---
        let synth = window.speechSynthesis;
        let voices = [];

        function populateVoiceList() {
            voices = synth.getVoices().sort((a, b) => a.name.localeCompare(b.name));
            updateVoiceOptions();
        }

        function updateVoiceOptions() {
            ttsVoiceSelect.innerHTML = ''; // Clear existing options
            const currentLang = languageSelect.value;
            const preferredVoices = voices.filter(voice => {
                // Filter for relevant languages (e.g., 'en', 'ta')
                // and prioritize 'Google' voices if available for better quality
                return voice.lang.startsWith(currentLang);
            });

            if (preferredVoices.length === 0 && voices.length > 0) {
                // Fallback: If no specific voices for the selected language, show any available
                preferredVoices.push(...voices.filter(voice => voice.lang.startsWith('en') || voice.lang.startsWith('ta')).slice(0,5)); // Limit fallback
            }

            if (preferredVoices.length === 0) {
                const option = document.createElement('option');
                option.textContent = currentLang === 'ta' ? 'குரல்கள் கிடைக்கவில்லை' : 'No voices available';
                option.value = '';
                ttsVoiceSelect.appendChild(option);
                aiVoiceBtn.style.display = 'none'; // Hide button if no voices
                return;
            }

            preferredVoices.forEach(voice => {
                const option = document.createElement('option');
                option.textContent = `${voice.name} (${voice.lang})`;
                if (voice.default) {
                    option.textContent += currentLang === 'ta' ? ' — இயல்புநிலை' : ' — Default';
                }
                option.setAttribute('data-lang', voice.lang);
                option.setAttribute('data-name', voice.name);
                option.value = voice.name;
                ttsVoiceSelect.appendChild(option);
            });

            // Try to pre-select a good voice
            const defaultVoice = preferredVoices.find(voice => voice.default && voice.lang.startsWith(currentLang)) ||
                                 preferredVoices.find(voice => voice.name.includes('Google') && voice.lang.startsWith(currentLang)) ||
                                 preferredVoices[0]; // Fallback to first available

            if (defaultVoice) {
                ttsVoiceSelect.value = defaultVoice.name;
            }

            aiVoiceBtn.style.display = 'inline-flex'; // Show button if voices are populated
            ttsVoiceSelect.style.display = 'inline-block';
        }


        if (synth.onvoiceschanged !== undefined) {
            synth.onvoiceschanged = populateVoiceList;
        } else {
            populateVoiceList(); // Call immediately if onvoiceschanged is not supported (e.g., Chrome)
        }

        aiVoiceBtn.addEventListener('click', () => {
            const textToSpeak = tipOutput.innerText || tipOutput.textContent;
            if (textToSpeak) {
                speakText(textToSpeak);
            } else {
                alert(languageSelect.value === 'ta' ? 'பேசுவதற்கு எந்த உரை இல்லையே!' : 'No text to speak!');
            }
        });

        function speakText(text) {
            if (synth.speaking) {
                synth.cancel(); // Stop any current speech
            }

            const utterThis = new SpeechSynthesisUtterance(text);
            const selectedVoiceName = ttsVoiceSelect.value;
            const selectedVoice = voices.find(voice => voice.name === selectedVoiceName);

            if (selectedVoice) {
                utterThis.voice = selectedVoice;
            } else {
                // Fallback to a default voice for the current language if selected voice not found
                const currentLang = languageSelect.value;
                const defaultVoice = voices.find(voice => voice.lang.startsWith(currentLang) && voice.default) ||
                                     voices.find(voice => voice.lang.startsWith(currentLang));
                if (defaultVoice) {
                    utterThis.voice = defaultVoice;
                } else {
                    console.warn('No suitable voice found for speaking.');
                    return; // Cannot speak without a voice
                }
            }

            utterThis.pitch = 1;
            utterThis.rate = 1;
            synth.speak(utterThis);
        }

        // --- Language Change Logic ---
        function updateContent(lang) {
            mainTitle.textContent = translations[lang]['mainTitle'];
            descriptionText.textContent = translations[lang]['descriptionText'];
            tipSectionTitle.textContent = translations[lang]['tipSectionTitle'];
            generateBtn.textContent = translations[lang]['generateBtn'];
            loadingText.textContent = translations[lang]['loadingText'];
            featuresTitle.textContent = translations[lang]['featuresTitle'];
            goalInput.placeholder = translations[lang]['descriptionText'].split('.')[1].trim(); // Use a part of description for placeholder
            micBtn.title = translations[lang]['micBtn'];
            aiVoiceBtn.textContent = translations[lang]['aiVoiceBtn'];

            // Update feature icon labels
            document.querySelectorAll('.feature-icon .label').forEach(labelSpan => {
                const key = labelSpan.dataset.labelKey;
                if (translations[lang][key]) {
                    labelSpan.textContent = translations[lang][key];
                }
            });

            // Update specific section titles and descriptions
            stepSectionTitle.textContent = translations[lang]['stepSectionTitle'];
            addOneStepBtn.textContent = translations[lang]['addOneStepBtn'];
            toggleTrackingBtn.textContent = translations[lang]['toggleTrackingBtn'];
            resetStepsBtn.textContent = translations[lang]['resetStepsBtn'];
            stepResultOutput.innerHTML = `<p class="italic">${translations[lang]['stepResultOutputDefault']}</p>`;

            heartRateSectionTitle.textContent = translations[lang]['heartRateSectionTitle'];
            simulateHeartRateBtn.textContent = translations[lang]['simulateHeartRateBtn'];
            resetHeartRateBtn.textContent = translations[lang]['resetHeartRateBtn'];
            heartRateResultOutput.innerHTML = `<p class="italic">${translations[lang]['heartRateResultOutputDefault']}</p>`;

            waterSectionTitle.textContent = translations[lang]['waterSectionTitle'];
            addWaterBtn.textContent = translations[lang]['addWaterBtn'];
            resetWaterBtn.textContent = translations[lang]['resetWaterBtn'];
            waterResultOutput.innerHTML = `<p class="italic">${translations[lang]['waterResultOutputDefault']}</p>`;

            journalSectionTitle.textContent = translations[lang]['journalSectionTitle'];
            journalDescription.textContent = translations[lang]['journalDescription'];
            saveJournalEntryBtn.textContent = translations[lang]['saveJournalEntryBtn'];
            moodSelect.querySelector('option[value=""]').textContent = translations[lang]['moodSelectPlaceholder'] || 'உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்';
            gratitudeInput.placeholder = translations[lang]['gratitudeInputPlaceholder'] || 'நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்...';


            localTipsSectionTitle.textContent = translations[lang]['localTipsSectionTitle'];
            localTipsDescription.textContent = translations[lang]['localTipsDescription'];
            getLocalTipBtn.textContent = translations[lang]['getLocalTipBtn'];
            localTipOutput.innerHTML = `<p class="italic">${translations[lang]['localTipsDescription']}</p>`; // Reset with description

            // Update NEW feature titles and descriptions
            mealPlanSectionTitle.textContent = translations[lang]['mealPlanSectionTitle'];
            mealPlanDescription.textContent = translations[lang]['mealPlanDescription'];
            generateMealPlanBtn.textContent = translations[lang]['generateMealPlanBtn'];
            dietGoalInput.placeholder = translations[lang]['dietGoalInputPlaceholder'] || 'எ.கா. எடை குறைப்பு, தசை வளர்ச்சி...';
            dietPreferenceSelect.querySelector('option[value=""]').textContent = translations[lang]['dietPreferenceSelectPlaceholder'] || 'உணவு விருப்பத்தைத் தேர்ந்தெடுக்கவும்';
            allergiesInput.placeholder = translations[lang]['allergiesInputPlaceholder'] || 'எ.கா. நிலக்கடலை, பால்...';

            moodAnalysisSectionTitle.textContent = translations[lang]['moodAnalysisSectionTitle'];
            moodAnalysisDescription.textContent = translations[lang]['moodAnalysisDescription'];
            analyzeMoodJournalBtn.textContent = translations[lang]['analyzeMoodJournalBtn'];

            exerciseYogaSectionTitle.textContent = translations[lang]['exerciseYogaSectionTitle'];
            exerciseYogaDescription.textContent = translations[lang]['exerciseYogaDescription'];
            generateExerciseRoutineBtn.textContent = translations[lang]['generateExerciseRoutineBtn'];
            fitnessLevelSelect.querySelector('option[value=""]').textContent = translations[lang]['fitnessLevelSelectPlaceholder'] || 'உடற்பயிற்சி நிலையைத் தேர்ந்தெடுக்கவும்';
            timeAvailableInput.placeholder = translations[lang]['timeAvailableInputPlaceholder'] || 'கிடைக்கக்கூடிய நேரம் (நிமிடங்கள்)...';
            exerciseGoalInput.placeholder = translations[lang]['exerciseGoalInputPlaceholder'] || 'எ.கா. உடல் நெகிழ்வுத்தன்மை, தசைகளை உருவாக்குதல்...';

            diseasePreventionSectionTitle.textContent = translations[lang]['diseasePreventionSectionTitle'];
            diseasePreventionDescription.textContent = translations[lang]['diseasePreventionDescription'];
            getRemedyBtn.textContent = translations[lang]['getRemedyBtn'];
            healthConcernInput.placeholder = translations[lang]['healthConcernInputPlaceholder'] || 'எ.கா. ஜலதோஷம், செரிமானப் பிரச்சனை...';

            wellnessChallengeSectionTitle.textContent = translations[lang]['wellnessChallengeSectionTitle'];
            wellnessChallengeDescription.textContent = translations[lang]['wellnessChallengeDescription'];
            generateChallengeBtn.textContent = translations[lang]['generateChallengeBtn'];
            currentHabitInput.placeholder = translations[lang]['currentHabitInputPlaceholder'] || 'உங்கள் தற்போதைய பழக்கம் (எ.கா. 1000ml தண்ணீர்)...';
            challengeGoalInput.placeholder = translations[lang]['challengeGoalInputPlaceholder'] || 'உங்கள் சவால் இலக்கு (எ.கா. 2000ml தண்ணீர்)...';

            // NEW FEATURE UI UPDATES
            medicationReminderSectionTitle.textContent = translations[lang]['medicationReminderSectionTitle'];
            medicationReminderDescription.textContent = translations[lang]['medicationReminderDescription'];
            medicationNameInput.placeholder = translations[lang]['medicationNamePlaceholder'];
            medicationTimeInput.placeholder = translations[lang]['medicationTimePlaceholder'];
            medicationFrequencySelect.querySelector('option[value=""]').textContent = translations[lang]['medicationFrequencyPlaceholder'];
            medicationFrequencySelect.querySelector('option[value="daily"]').textContent = translations[lang]['daily'];
            medicationFrequencySelect.querySelector('option[value="weekly"]').textContent = translations[lang]['weekly'];
            medicationFrequencySelect.querySelector('option[value="monthly"]').textContent = translations[lang]['monthly'];
            addMedicationReminderBtn.textContent = translations[lang]['addMedicationReminderBtn'];

            bodyPainMappingSectionTitle.textContent = translations[lang]['bodyPainMappingSectionTitle'];
            bodyPainMappingDescription.textContent = translations[lang]['bodyPainMappingDescription'];
            painDescriptionInput.placeholder = translations[lang]['painDescriptionPlaceholder'];
            painLevelSelect.placeholder = translations[lang]['painLevelPlaceholder'];
            savePainEntryBtn.textContent = translations[lang]['savePainEntryBtn'];

            firstAidEmergencySectionTitle.textContent = translations[lang]['firstAidEmergencySectionTitle'];
            firstAidEmergencyDescription.textContent = translations[lang]['firstAidEmergencyDescription'];
            firstAidCutBtn.querySelector('span').textContent = translations[lang]['firstAidCutLabel'];
            firstAidBurnBtn.querySelector('span').textContent = translations[lang]['firstAidBurnLabel'];
            firstAidChokingBtn.querySelector('span').textContent = translations[lang]['firstAidChokingLabel'];
            firstAidHeartAttackBtn.querySelector('span').textContent = translations[lang]['firstAidHeartAttackLabel'];
            emergencyNumbersTitle.textContent = translations[lang]['emergencyNumbersTitle'];
            callAmbulanceBtn.querySelector('span').textContent = translations[lang]['callAmbulanceLabel'];
            callPoliceBtn.querySelector('span').textContent = translations[lang]['callPoliceLabel'];
            nearbyHospitalsTitle.textContent = translations[lang]['nearbyHospitalsTitle'];
            findHospitalsBtn.textContent = translations[lang]['findHospitalsBtn'];

            populateVoiceList(); // Re-populate TTS voices for the new language
        }

        languageSelect.addEventListener('change', (event) => {
            updateContent(event.target.value);
            // Optionally, clear current outputs when language changes
            tipOutput.innerHTML = '';
            document.querySelectorAll('.result-box').forEach(box => box.innerHTML = '');
        });

        // Initial content load (after splash screen)
        window.addEventListener('load', () => {
            splashScreen.classList.add('fade-out');
            setTimeout(() => {
                splashScreen.style.display = 'none';
                mainContent.style.display = 'block';
                document.body.classList.add('main-content-active');
                updateContent(languageSelect.value); // Set initial content based on default language
            }, 1000); // Wait for fade-out animation to complete
        });

        // --- Feature Section Switching Logic ---
        const featureSections = document.querySelectorAll('.feature-section');
        const allFeatureIcons = document.querySelectorAll('.feature-icon');

        function hideAllFeatureSections() {
            featureSections.forEach(section => {
                section.style.display = 'none';
            });
            allFeatureIcons.forEach(icon => {
                icon.classList.remove('selected'); // Remove selected state from all icons
            });
            // Also hide AI voice button when switching features
            aiVoiceBtn.style.display = 'none';
            ttsVoiceSelect.style.display = 'none';
            tipOutput.innerHTML = ''; // Clear main tip output
        }

        function showSection(sectionId) {
            hideAllFeatureSections();
            const sectionToShow = document.getElementById(sectionId);
            if (sectionToShow) {
                sectionToShow.style.display = 'block';
                const iconToSelect = document.getElementById(`icon${sectionId.replace('Section', '')}`);
                if (iconToSelect) {
                    iconToSelect.classList.add('selected'); // Add selected state to the clicked icon
                }
                // Scroll to the top of the container to show the new section clearly
                mainContent.scrollTop = 0;
            }
        }

        // Event Listeners for Feature Icons
        iconStepTracker.addEventListener('click', () => showSection('stepTrackerSection'));
        iconHeartRateTracker.addEventListener('click', () => showSection('heartRateTrackerSection'));
        iconWaterTracker.addEventListener('click', () => showSection('waterTrackerSection'));
        iconJournal.addEventListener('click', () => showSection('journalSection'));
        iconLocalTips.addEventListener('click', () => showSection('localTipsSection'));
        iconMealPlan.addEventListener('click', () => showSection('mealPlanSection'));
        iconMoodAnalysis.addEventListener('click', () => showSection('moodAnalysisSection'));
        iconExerciseYoga.addEventListener('click', () => showSection('exerciseYogaSection'));
        iconDiseasePrevention.addEventListener('click', () => showSection('diseasePreventionSection'));
        iconWellnessChallenge.addEventListener('click', () => showSection('wellnessChallengeSection'));

        // NEW FEATURE ICON EVENT LISTENERS
        iconMedicationReminder.addEventListener('click', () => showSection('medicationReminderSection'));
        iconBodyPainMapping.addEventListener('click', () => showSection('bodyPainMappingSection'));
        iconFirstAidEmergency.addEventListener('click', () => showSection('firstAidEmergencySection'));


        // --- Main Tip Generation Logic ---
        generateBtn.addEventListener('click', async () => {
            const goal = goalInput.value.trim();
            const currentLang = languageSelect.value;
            if (!goal) {
                tipOutput.innerHTML = `<p class="text-red-600">${currentLang === 'ta' ? 'தயவுசெய்து உங்கள் இலக்கை உள்ளிடவும்.' : 'Please enter your goal.'}</p>`;
                aiVoiceBtn.style.display = 'none';
                return;
            }

            loadingIndicator.style.display = 'flex';
            tipOutput.innerHTML = '';
            generateBtn.disabled = true;
            aiVoiceBtn.style.display = 'none'; // Hide AI voice button during loading

            try {
                // Call the Netlify serverless function to get the tip
                const response = await fetch('/.netlify/functions/generate-tip', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ goal, lang: currentLang }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Unknown error');
                }

                const data = await response.json();
                tipOutput.innerHTML = `<p>${data.tip}</p>`;
                aiVoiceBtn.style.display = 'inline-flex'; // Show AI voice button after tip is generated
            } catch (error) {
                console.error('Error generating tip:', error);
                tipOutput.innerHTML = `<p class="text-red-600">${currentLang === 'ta' ? 'உதவிக்குறிப்பை உருவாக்க முடியவில்லை. மீண்டும் முயற்சிக்கவும்.' : 'Could not generate tip. Please try again.'}</p>`;
            } finally {
                loadingIndicator.style.display = 'none';
                generateBtn.disabled = false;
            }
        });


        // --- Feature Specific Logics (Simplified for Frontend Only) ---

        // Step Tracker
        let currentSteps = 0;
        let isTrackingSteps = false;
        const stepGoal = 10000; // Example goal

        addOneStepBtn.addEventListener('click', () => {
            if (isTrackingSteps) {
                currentSteps += 1;
                currentStepsDisplay.value = currentSteps;
                updateStepResult();
            } else {
                stepResultOutput.innerHTML = `<p class="text-red-600">${languageSelect.value === 'ta' ? 'படிகளைக் கண்காணிக்க, முதலில் கண்காணிப்பைத் தொடங்கவும்.' : 'To track steps, please start tracking first.'}</p>`;
            }
        });

        toggleTrackingBtn.addEventListener('click', () => {
            isTrackingSteps = !isTrackingSteps;
            toggleTrackingBtn.textContent = languageSelect.value === 'ta' ?
                (isTrackingSteps ? 'கண்காணிப்பை நிறுத்து' : 'கண்காணிப்பைத் தொடங்கு') :
                (isTrackingSteps ? 'Stop Tracking' : 'Start Tracking');
            stepResultOutput.innerHTML = `<p>${languageSelect.value === 'ta' ? (isTrackingSteps ? 'படி கண்காணிப்பு தொடங்கப்பட்டது.' : 'படி கண்காணிப்பு நிறுத்தப்பட்டது.') : (isTrackingSteps ? 'Step tracking started.' : 'Step tracking stopped.')}</p>`;
        });

        resetStepsBtn.addEventListener('click', () => {
            currentSteps = 0;
            currentStepsDisplay.value = currentSteps;
            isTrackingSteps = false;
            toggleTrackingBtn.textContent = languageSelect.value === 'ta' ? 'கண்காணிப்பைத் தொடங்கு' : 'Start Tracking';
            stepResultOutput.innerHTML = `<p>${languageSelect.value === 'ta' ? 'படிகள் மீட்டமைக்கப்பட்டன.' : 'Steps reset.'}</p>`;
        });

        function updateStepResult() {
            const currentLang = languageSelect.value;
            let message = '';
            if (currentSteps >= stepGoal) {
                message = currentLang === 'ta' ? `வாழ்த்துக்கள்! நீங்கள் உங்கள் இலக்கான ${stepGoal} படிகளை அடைந்துவிட்டீர்கள்!` : `Congratulations! You've reached your goal of ${stepGoal} steps!`;
            } else {
                const remaining = stepGoal - currentSteps;
                message = currentLang === 'ta' ? `உங்கள் இலக்கான ${stepGoal} படிகளை அடைய இன்னும் ${remaining} படிகள் தேவை.` : `You need ${remaining} more steps to reach your goal of ${stepGoal}.`;
            }
            stepResultOutput.innerHTML = `<p>${message}</p>`;
        }


        // Heart Rate Tracker (Simulated)
        simulateHeartRateBtn.addEventListener('click', () => {
            const randomHeartRate = Math.floor(Math.random() * (120 - 60 + 1)) + 60; // Simulate 60-120 BPM
            currentHeartRateDisplay.value = `${randomHeartRate} BPM`;
            heartRateResultOutput.innerHTML = `<p>${languageSelect.value === 'ta' ? 'உங்கள் இதயத் துடிப்பு உருவகப்படுத்தப்பட்டது.' : 'Your heart rate has been simulated.'}</p>`;
            if (randomHeartRate > 100) {
                heartRateResultOutput.innerHTML += `<p class="text-red-600">${languageSelect.value === 'ta' ? 'உயர் இதயத் துடிப்பு கண்டறியப்பட்டது. ஓய்வெடுக்கவும்.' : 'High heart rate detected. Please rest.'}</p>`;
            }
        });

        resetHeartRateBtn.addEventListener('click', () => {
            currentHeartRateDisplay.value = '0';
            heartRateResultOutput.innerHTML = `<p>${languageSelect.value === 'ta' ? 'இதயத் துடிப்பு மீட்டமைக்கப்பட்டது.' : 'Heart rate reset.'}</p>`;
        });

        // Water Intake Tracker
        let waterIntakeMl = 0;
        const dailyWaterGoalMl = 2000; // 2 Liters

        addWaterBtn.addEventListener('click', () => {
            waterIntakeMl += 250;
            waterIntakeDisplay.value = `${waterIntakeMl} ml`;
            updateWaterResult();
        });

        resetWaterBtn.addEventListener('click', () => {
            waterIntakeMl = 0;
            waterIntakeDisplay.value = '0 ml';
            waterResultOutput.innerHTML = `<p>${languageSelect.value === 'ta' ? 'தண்ணீர் உட்கொள்ளல் மீட்டமைக்கப்பட்டது.' : 'Water intake reset.'}</p>`;
        });

        function updateWaterResult() {
            const currentLang = languageSelect.value;
            let message = '';
            if (waterIntakeMl >= dailyWaterGoalMl) {
                message = currentLang === 'ta' ? `வாழ்த்துக்கள்! நீங்கள் உங்கள் தினசரி இலக்கான ${dailyWaterGoalMl}ml தண்ணீர் உட்கொள்ளலை அடைந்துவிட்டீர்கள்!` : `Congratulations! You've reached your daily goal of ${dailyWaterGoalMl}ml water intake!`;
            } else {
                const remaining = dailyWaterGoalMl - waterIntakeMl;
                message = currentLang === 'ta' ? `உங்கள் இலக்கான ${dailyWaterGoalMl}ml ஐ அடைய இன்னும் ${remaining}ml தண்ணீர் தேவை.` : `You need ${remaining}ml more water to reach your goal of ${dailyWaterGoalMl}ml.`;
            }
            waterResultOutput.innerHTML = `<p>${message}</p>`;
        }

        // Mood & Gratitude Journal
        let journalEntries = []; // Stores entries for current session

        saveJournalEntryBtn.addEventListener('click', () => {
            const mood = moodSelect.value;
            const gratitude = gratitudeInput.value.trim();
            const timestamp = new Date().toLocaleString(languageSelect.value === 'ta' ? 'ta-IN' : 'en-US');

            if (!mood || !gratitude) {
                journalEntriesOutput.innerHTML = `<p class="text-red-600">${languageSelect.value === 'ta' ? 'மனநிலை மற்றும் நன்றியுணர்வு இரண்டையும் உள்ளிடவும்.' : 'Please enter both mood and gratitude.'}</p>`;
                return;
            }

            const entry = { timestamp, mood, gratitude };
            journalEntries.push(entry);
            displayJournalEntries();
            moodSelect.value = '';
            gratitudeInput.value = '';
            journalEntriesOutput.innerHTML += `<p class="text-green-600 mt-2">${translations[languageSelect.value]['journalEntrySaved']}</p>`;
            console.log("Journal Entries:", journalEntries);
        });

        function displayJournalEntries() {
            journalEntriesOutput.innerHTML = '<h3>Recent Entries:</h3>';
            if (journalEntries.length === 0) {
                journalEntriesOutput.innerHTML += `<p>${languageSelect.value === 'ta' ? 'இன்னும் பதிவுகள் இல்லை.' : 'No entries yet.'}</p>`;
                return;
            }
            journalEntries.slice(-3).forEach(entry => { // Display last 3 entries
                journalEntriesOutput.innerHTML += `
                    <div class="mb-2 p-2 border rounded-md bg-blue-50">
                        <p><strong>${entry.timestamp}</strong></p>
                        <p>${languageSelect.value === 'ta' ? 'மனநிலை' : 'Mood'}: ${entry.mood}</p>
                        <p>${languageSelect.value === 'ta' ? 'நன்றியுணர்வு' : 'Gratitude'}: ${entry.gratitude}</p>
                    </div>
                `;
            });
        }


        // Local & Traditional Wellness Tips (Simulated Dropdown/Search)
        const localTipCategories = [
            { id: 'turmeric', ta: 'மஞ்சள்', en: 'Turmeric' },
            { id: 'moringa', ta: 'முருங்கை', en: 'Moringa' },
            { id: 'meditation', ta: 'தியானம்', en: 'Meditation' },
            { id: 'ayurveda', ta: 'ஆயுர்வேதம்', en: 'Ayurveda' },
            { id: 'yoga', ta: 'யோகா', en: 'Yoga' }
        ];

        localTipCategory.addEventListener('input', () => {
            const query = localTipCategory.value.toLowerCase();
            localTipCategoryDropdown.innerHTML = '';
            localTipCategoryDropdown.classList.remove('hidden');

            const filteredCategories = localTipCategories.filter(cat =>
                cat.ta.toLowerCase().includes(query) || cat.en.toLowerCase().includes(query)
            );

            if (filteredCategories.length > 0 && query.length > 0) {
                filteredCategories.forEach(cat => {
                    const div = document.createElement('div');
                    div.textContent = languageSelect.value === 'ta' ? cat.ta : cat.en;
                    div.dataset.value = cat.id;
                    div.addEventListener('click', () => {
                        localTipCategory.value = languageSelect.value === 'ta' ? cat.ta : cat.en;
                        localTipCategoryDropdown.classList.add('hidden');
                    });
                    localTipCategoryDropdown.appendChild(div);
                });
            } else {
                localTipCategoryDropdown.classList.add('hidden');
            }
        });

        document.addEventListener('click', (event) => {
            if (!localTipCategory.contains(event.target) && !localTipCategoryDropdown.contains(event.target)) {
                localTipCategoryDropdown.classList.add('hidden');
            }
        });

        getLocalTipBtn.addEventListener('click', async () => {
            const category = localTipCategory.value.trim();
            const currentLang = languageSelect.value;
            if (!category) {
                localTipOutput.innerHTML = `<p class="text-red-600">${currentLang === 'ta' ? 'தயவுசெய்து ஒரு வகையை உள்ளிடவும்.' : 'Please enter a category.'}</p>`;
                aiVoiceBtn.style.display = 'none';
                return;
            }

            loadingIndicator.style.display = 'flex';
            localTipOutput.innerHTML = '';
            getLocalTipBtn.disabled = true;
            aiVoiceBtn.style.display = 'none';

            try {
                // Call the Netlify serverless function (or simulate)
                const response = await fetch('/.netlify/functions/generate-local-tip', { // You'd need to create this function
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ category, lang: currentLang }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Unknown error');
                }

                const data = await response.json();
                localTipOutput.innerHTML = `<p>${data.tip}</p>`;
                aiVoiceBtn.style.display = 'inline-flex';
            } catch (error) {
                console.error('Error generating local tip:', error);
                localTipOutput.innerHTML = `<p class="text-red-600">${currentLang === 'ta' ? 'உள்ளூர் குறிப்பை உருவாக்க முடியவில்லை. மீண்டும் முயற்சிக்கவும்.' : 'Could not generate local tip. Please try again.'}</p>`;
            } finally {
                loadingIndicator.style.display = 'none';
                getLocalTipBtn.disabled = false;
            }
        });


        // Meal Plan Generation (Simulated)
        generateMealPlanBtn.addEventListener('click', async () => {
            const dietGoal = dietGoalInput.value.trim();
            const dietPreference = dietPreferenceSelect.value;
            const allergies = allergiesInput.value.trim();
            const currentLang = languageSelect.value;

            if (!dietGoal || !dietPreference) {
                mealPlanOutput.innerHTML = `<p class="text-red-600">${currentLang === 'ta' ? 'உணவு இலக்கு மற்றும் விருப்பத்தைத் தேர்ந்தெடுக்கவும்.' : 'Please enter diet goal and preference.'}</p>`;
                return;
            }

            loadingIndicator.style.display = 'flex';
            mealPlanOutput.innerHTML = '';
            generateMealPlanBtn.disabled = true;

            try {
                // Simulate API call to backend or AI model
                const response = await fetch('/.netlify/functions/generate-meal-plan', { // Create this Netlify function
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ dietGoal, dietPreference, allergies, lang: currentLang }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Unknown error');
                }
                const data = await response.json();
                mealPlanOutput.innerHTML = `<p>${data.plan}</p>`;
            } catch (error) {
                console.error('Error generating meal plan:', error);
                mealPlanOutput.innerHTML = `<p class="text-red-600">${currentLang === 'ta' ? 'உணவுத் திட்டத்தை உருவாக்க முடியவில்லை. மீண்டும் முயற்சிக்கவும்.' : 'Could not generate meal plan. Please try again.'}</p>`;
            } finally {
                loadingIndicator.style.display = 'none';
                generateMealPlanBtn.disabled = false;
            }
        });


        // Mood Analysis (Simulated based on existing journal entries)
        analyzeMoodJournalBtn.addEventListener('click', () => {
            const currentLang = languageSelect.value;
            if (journalEntries.length === 0) {
                moodAnalysisOutput.innerHTML = `<p class="text-red-600">${currentLang === 'ta' ? 'பகுப்பாய்வு செய்ய ஜர்னல் பதிவுகள் இல்லை.' : 'No journal entries to analyze.'}</p>`;
                return;
            }

            const moodCounts = {};
            journalEntries.forEach(entry => {
                moodCounts[entry.mood] = (moodCounts[entry.mood] || 0) + 1;
            });

            let analysis = currentLang === 'ta' ? 'உங்கள் மனநிலை போக்குகள்:' : 'Your mood trends:';
            for (const mood in moodCounts) {
                analysis += `<br>- ${translations[currentLang][mood] || mood}: ${moodCounts[mood]} ${currentLang === 'ta' ? 'முறை' : 'times'}`;
            }

            moodAnalysisOutput.innerHTML = `<p>${analysis}</p>`;
        });


        // Exercise/Yoga Routine Generation (Simulated)
        generateExerciseRoutineBtn.addEventListener('click', async () => {
            const fitnessLevel = fitnessLevelSelect.value;
            const timeAvailable = timeAvailableInput.value.trim();
            const exerciseGoal = exerciseGoalInput.value.trim();
            const currentLang = languageSelect.value;

            if (!fitnessLevel || !timeAvailable || !exerciseGoal) {
                exerciseRoutineOutput.innerHTML = `<p class="text-red-600">${currentLang === 'ta' ? 'அனைத்து விவரங்களையும் நிரப்பவும்.' : 'Please fill in all details.'}</p>`;
                return;
            }

            loadingIndicator.style.display = 'flex';
            exerciseRoutineOutput.innerHTML = '';
            generateExerciseRoutineBtn.disabled = true;

            try {
                // Simulate API call to backend or AI model
                const response = await fetch('/.netlify/functions/generate-exercise-routine', { // Create this Netlify function
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ fitnessLevel, timeAvailable, exerciseGoal, lang: currentLang }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Unknown error');
                }
                const data = await response.json();
                exerciseRoutineOutput.innerHTML = `<p>${data.routine}</p>`;
            } catch (error) {
                console.error('Error generating exercise routine:', error);
                exerciseRoutineOutput.innerHTML = `<p class="text-red-600">${currentLang === 'ta' ? 'உடற்பயிற்சி திட்டத்தை உருவாக்க முடியவில்லை. மீண்டும் முயற்சிக்கவும்.' : 'Could not generate exercise routine. Please try again.'}</p>`;
            } finally {
                loadingIndicator.style.display = 'none';
                generateExerciseRoutineBtn.disabled = false;
            }
        });


        // Disease Prevention / Home Remedy (Simulated)
        getRemedyBtn.addEventListener('click', async () => {
            const concern = healthConcernInput.value.trim();
            const currentLang = languageSelect.value;

            if (!concern) {
                remedyOutput.innerHTML = `<p class="text-red-600">${currentLang === 'ta' ? 'உடல்நலக் கவலையை உள்ளிடவும்.' : 'Please enter a health concern.'}</p>`;
                return;
            }

            loadingIndicator.style.display = 'flex';
            remedyOutput.innerHTML = '';
            getRemedyBtn.disabled = true;

            try {
                // Simulate API call to backend or AI model
                const response = await fetch('/.netlify/functions/get-remedy', { // Create this Netlify function
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ concern, lang: currentLang }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Unknown error');
                }
                const data = await response.json();
                remedyOutput.innerHTML = `<p>${data.remedy}</p>`;
            } catch (error) {
                console.error('Error getting remedy:', error);
                remedyOutput.innerHTML = `<p class="text-red-600">${currentLang === 'ta' ? 'வைத்தியம் பெற முடியவில்லை. மீண்டும் முயற்சிக்கவும்.' : 'Could not get remedy. Please try again.'}</p>`;
            } finally {
                loadingIndicator.style.display = 'none';
                getRemedyBtn.disabled = false;
            }
        });


        // Wellness Challenge (Simulated)
        generateChallengeBtn.addEventListener('click', async () => {
            const currentHabit = currentHabitInput.value.trim();
            const challengeGoal = challengeGoalInput.value.trim();
            const currentLang = languageSelect.value;

            if (!currentHabit || !challengeGoal) {
                challengeOutput.innerHTML = `<p class="text-red-600">${currentLang === 'ta' ? 'தற்போதைய பழக்கம் மற்றும் சவால் இலக்கை உள்ளிடவும்.' : 'Please enter current habit and challenge goal.'}</p>`;
                return;
            }

            loadingIndicator.style.display = 'flex';
            challengeOutput.innerHTML = '';
            generateChallengeBtn.disabled = true;

            try {
                // Simulate API call to backend or AI model
                const response = await fetch('/.netlify/functions/generate-challenge', { // Create this Netlify function
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ currentHabit, challengeGoal, lang: currentLang }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Unknown error');
                }
                const data = await response.json();
                challengeOutput.innerHTML = `<p>${data.challenge}</p>`;
            } catch (error) {
                console.error('Error generating challenge:', error);
                challengeOutput.innerHTML = `<p class="text-red-600">${currentLang === 'ta' ? 'சவாலை உருவாக்க முடியவில்லை. மீண்டும் முயற்சிக்கவும்.' : 'Could not generate challenge. Please try again.'}</p>`;
            } finally {
                loadingIndicator.style.display = 'none';
                generateChallengeBtn.disabled = false;
            }
        });


        // --- NEW FEATURE LOGICS ---

        // Medication Reminder
        let medicationReminders = []; // Store reminders locally for this session

        addMedicationReminderBtn.addEventListener('click', () => {
            const name = medicationNameInput.value.trim();
            const time = medicationTimeInput.value;
            const frequency = medicationFrequencySelect.value;
            const currentLang = languageSelect.value;

            if (!name || !time || !frequency) {
                medicationRemindersList.innerHTML = `<p class="text-red-600">${currentLang === 'ta' ? 'மருந்து பெயர், நேரம் மற்றும் அதிர்வெண் ஆகியவற்றை உள்ளிடவும்.' : 'Please enter medication name, time, and frequency.'}</p>`;
                return;
            }

            const reminder = { name, time, frequency };
            medicationReminders.push(reminder);
            displayMedicationReminders();

            medicationNameInput.value = '';
            medicationTimeInput.value = '';
            medicationFrequencySelect.value = '';

            medicationRemindersList.innerHTML += `<p class="text-green-600 mt-2">${translations[currentLang]['medicationReminderAdded']}</p>`;
            console.log("Medication Reminders:", medicationReminders);

            // In a real app, you'd send this to a backend for persistent storage and push notifications
        });

        function displayMedicationReminders() {
            medicationRemindersList.innerHTML = '<h3>' + (languageSelect.value === 'ta' ? 'அமைக்கப்பட்ட நினைவூட்டல்கள்:' : 'Set Reminders:') + '</h3>';
            if (medicationReminders.length === 0) {
                medicationRemindersList.innerHTML += `<p>${languageSelect.value === 'ta' ? 'நினைவூட்டல்கள் எதுவும் இல்லை.' : 'No reminders set yet.'}</p>`;
                return;
            }
            medicationReminders.forEach((reminder, index) => {
                medicationRemindersList.innerHTML += `
                    <div class="mb-2 p-2 border rounded-md bg-purple-50 flex justify-between items-center">
                        <div>
                            <p><strong>${reminder.name}</strong> at ${reminder.time} (${translations[languageSelect.value][reminder.frequency]})</p>
                        </div>
                        <button class="text-red-500 hover:text-red-700" onclick="removeMedicationReminder(${index})">❌</button>
                    </div>
                `;
            });
        }

        function removeMedicationReminder(index) {
            medicationReminders.splice(index, 1);
            displayMedicationReminders();
        }


        // Body Pain Mapping
        let painEntries = []; // Stores pain entries locally for this session

        bodyMapImage.addEventListener('click', (event) => {
            const rect = bodyMapImage.getBoundingClientRect();
            const x = (event.clientX - rect.left) / rect.width * 100; // X as percentage
            const y = (event.clientY - rect.top) / rect.height * 100; // Y as percentage

            // Create a visual dot
            const dot = document.createElement('div');
            dot.classList.add('pain-dot');
            dot.style.left = `${x}%`;
            dot.style.top = `${y}%`;
            bodyMapImage.parentElement.appendChild(dot); // Add to parent container

            // Select this dot for current input
            document.querySelectorAll('.pain-dot').forEach(d => d.classList.remove('selected'));
            dot.classList.add('selected');
            dot.dataset.x = x; // Store coordinates on the dot itself
            dot.dataset.y = y;

            painDescriptionInput.value = ''; // Clear previous input
            painLevelSelect.value = '';
            painDescriptionInput.focus();
        });

        savePainEntryBtn.addEventListener('click', () => {
            const selectedDot = document.querySelector('.pain-dot.selected');
            const currentLang = languageSelect.value;

            if (!selectedDot) {
                painEntriesOutput.innerHTML = `<p class="text-red-600">${currentLang === 'ta' ? 'முதலில் வரைபடத்தில் வலி உள்ள இடத்தைக் குறிக்கவும்.' : 'Please mark the pain location on the map first.'}</p>`;
                return;
            }

            const description = painDescriptionInput.value.trim();
            const level = painLevelSelect.value;
            const x = selectedDot.dataset.x;
            const y = selectedDot.dataset.y;
            const timestamp = new Date().toLocaleString(currentLang === 'ta' ? 'ta-IN' : 'en-US');

            if (!description || !level) {
                painEntriesOutput.innerHTML = `<p class="text-red-600">${currentLang === 'ta' ? 'வலியின் விளக்கம் மற்றும் தீவிரத்தை உள்ளிடவும்.' : 'Please enter pain description and level.'}</p>`;
                return;
            }

            const entry = { timestamp, x, y, description, level };
            painEntries.push(entry);
            displayPainEntries();

            painDescriptionInput.value = '';
            painLevelSelect.value = '';
            selectedDot.classList.remove('selected'); // Deselect the dot

            painEntriesOutput.innerHTML += `<p class="text-green-600 mt-2">${translations[currentLang]['painEntrySaved']}</p>`;
            console.log("Pain Entries:", painEntries);

            // In a real app, you'd send this to a backend for persistent storage
        });

        function displayPainEntries() {
            painEntriesOutput.innerHTML = '<h3>' + (languageSelect.value === 'ta' ? 'பதிவு செய்யப்பட்ட வலிகள்:' : 'Recorded Pains:') + '</h3>';
            if (painEntries.length === 0) {
                painEntriesOutput.innerHTML += `<p>${languageSelect.value === 'ta' ? 'வலி பதிவுகள் எதுவும் இல்லை.' : 'No pain entries yet.'}</p>`;
                return;
            }
            painEntries.slice(-3).forEach((entry, index) => { // Display last 3 entries
                painEntriesOutput.innerHTML += `
                    <div class="mb-2 p-2 border rounded-md bg-red-50">
                        <p><strong>${entry.timestamp}</strong> - (${Math.round(entry.x)}%, ${Math.round(entry.y)}%)</p>
                        <p>${languageSelect.value === 'ta' ? 'விளக்கம்' : 'Description'}: ${entry.description}</p>
                        <p>${languageSelect.value === 'ta' ? 'தீவிரம்' : 'Level'}: ${entry.level}/10</p>
                        <button class="text-red-500 hover:text-red-700" onclick="removePainEntry(${index})">❌</button>
                    </div>
                `;
            });
        }

        function removePainEntry(index) {
            painEntries.splice(index, 1);
            displayPainEntries();
            // Remove the corresponding dot from the map (more complex if dots are persisted)
        }


        // First Aid & Emergency Assistance (Data and logic as provided in previous response)
        const firstAidData = {
            'cut': {
                'ta': 'வெட்டுக்காயம்: 1. இரத்தப்போக்கை நிறுத்த அழுத்தம் கொடுக்கவும். 2. சோப்பு மற்றும் தண்ணீரால் காயத்தை சுத்தம் செய்யவும். 3. கிருமிநாசினி தடவி கட்டுப்போடவும்.',
                'en': 'Cuts: 1. Apply direct pressure to stop bleeding. 2. Clean the wound with soap and water. 3. Apply antiseptic and cover with a clean bandage.'
            },
            'burn': {
                'ta': 'தீக்காயம்: 1. குளிர்ந்த நீரில் 10-20 நிமிடங்கள் வைக்கவும். 2. கொப்புளங்களை உடைக்க வேண்டாம். 3. சுத்தமான துணியால் மூடவும்.',
                'en': 'Burns: 1. Cool the burn under cold water for 10-20 mins. 2. Do not break blisters. 3. Cover with a clean cloth.'
            },
            'choking': {
                'ta': 'மூச்சுத்திணறல்: 1. நபரை இரும ஊக்குவிக்கவும். 2. ஐந்து முதுகு அடிகள் கொடுக்கவும். 3. ஹெம்லிச் சூழ்ச்சியை செய்யவும் (முறையாக பயிற்சி பெற்றிருந்தால்). 4. உடனடியாக மருத்துவ உதவியை நாடவும்.',
                'en': 'Choking: 1. Encourage the person to cough. 2. Administer 5 back blows. 3. Perform Heimlich maneuver (if trained). 4. Seek immediate medical help.'
            },
            'heart_attack': {
                'ta': 'மாரடைப்பு: 1. உடனடியாக 108 ஐ அழைக்கவும். 2. ஆஸ்பிரின் கொடுக்கவும் (அலர்ஜி இல்லை என்றால்). 3. ஆடைகளை தளர்த்தவும். 4. அமைதியாக இருக்கச் சொல்லவும்.',
                'en': 'Heart Attack: 1. Call 108 immediately. 2. Administer aspirin (if no allergy). 3. Loosen clothing. 4. Keep the person calm.'
            }
            // Add more conditions
        };

        // Event listeners for specific first aid buttons
        document.querySelectorAll('#firstAidEmergencySection .action-button[data-emergency-type]').forEach(button => {
            button.addEventListener('click', (event) => {
                const type = event.target.dataset.emergencyType || event.target.closest('button').dataset.emergencyType;
                const currentLang = languageSelect.value;
                if (firstAidData[type]) {
                    firstAidOutput.innerHTML = `<p>${firstAidData[type][currentLang]}</p>`;
                    // Show AI voice button if you want to read out first aid steps
                    aiVoiceBtn.style.display = 'inline-flex';
                } else {
                    firstAidOutput.innerHTML = `<p class="text-red-600">${translations[currentLang]['firstAidOutputError']}</p>`;
                }
            });
        });

        // Emergency Call Buttons
        callAmbulanceBtn.addEventListener('click', () => {
            const currentLang = languageSelect.value;
            alert(translations[currentLang]['callingEmergencyService'] + ' 108');
            window.location.href = `tel:108`; // Directly dial 108
        });

        callPoliceBtn.addEventListener('click', () => {
            const currentLang = languageSelect.value;
            alert(translations[currentLang]['callingEmergencyService'] + ' 100');
            window.location.href = `tel:100`; // Directly dial 100
        });

        // Find Hospitals Button
        findHospitalsBtn.addEventListener('click', async () => {
            const currentLang = languageSelect.value;
            firstAidOutput.innerHTML = `<p>${translations[currentLang]['firstAidOutputLoading']}</p>`;

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;

                    // In a real application, you'd use a Places API (like Google Places API)
                    // with your backend to find hospitals near (lat, lon).
                    // For now, we'll just simulate or show a placeholder.
                    console.log(`Finding hospitals near: ${lat}, ${lon}`);

                    firstAidOutput.innerHTML = `<p>${translations[currentLang]['firstAidOutputLoading']}</p>`;
                    setTimeout(() => {
                        const hospitalMessage = currentLang === 'ta' ?
                            'உங்கள் இருப்பிடத்திற்கு அருகில் உள்ள மருத்துவமனைகளை வரைபடத்தில் காட்டுகிறோம். (இது ஒரு உருவகப்படுத்தப்பட்ட செயல்பாடு. உண்மையான வரைபட ஒருங்கிணைப்பிற்கு Google Maps API தேவை.)' :
                            'Displaying nearby hospitals on the map. (This is a simulated function. Real map integration requires Google Maps API.)';
                        firstAidOutput.innerHTML = `<p>${hospitalMessage}</p>`;
                        // Replace this with actual map integration (e.g., Google Maps JS API)
                        hospitalsMap.innerHTML = `<img src="https://via.placeholder.com/600x250?text=Map+of+Hospitals" alt="Map of Hospitals" class="w-full h-full object-cover rounded-lg">`;
                    }, 2000);

                }, (error) => {
                    console.error("Geolocation error:", error);
                    if (error.code === error.PERMISSION_DENIED) {
                        firstAidOutput.innerHTML = `<p class="text-red-600">${translations[currentLang]['noLocationPermission']}</p>`;
                    } else {
                        firstAidOutput.innerHTML = `<p class="text-red-600">${translations[currentLang]['firstAidOutputError']} ${error.message}</p>`;
                    }
                });
            } else {
                firstAidOutput.innerHTML = `<p class="text-red-600">${translations[currentLang]['firstAidOutputError']} ${currentLang === 'ta' ? 'உங்கள் உலாவி இருப்பிடச் சேவைகளை ஆதரிக்கவில்லை.' : 'Your browser does not support geolocation.'}</p>`;
            }
        });
    </script>
</body>
</html>
