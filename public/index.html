<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ஆரோக்கிய நண்பன் - Wellness Buddy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        /* ... (உங்கள் ஏற்கனவே உள்ள CSS பாணிகள்) ... */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #E6F7FF; /* Light Blue */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1.5rem;
            color: #333333;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            box-sizing: border-box;
            transition: all 0.5s ease-in-out;
        }

        body.main-content-active {
            min-height: auto;
            align-items: flex-start;
            padding-top: 2rem;
            padding-bottom: 2rem;
            overflow-y: auto;
        }

        .container {
            max-width: 640px;
            width: 100%;
            background-color: #ffffff;
            border-radius: 1.75rem;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08);
            padding: 2.5rem;
            text-align: center;
            position: relative;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .language-selector-wrapper {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
        }
        .input-wrapper {
            position: relative;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
        }
        .input-field {
            flex-grow: 1;
            padding: 1rem 1.25rem;
            padding-right: 3.5rem; /* Space for mic icon */
            border: 1px solid #D1D5DB;
            border-radius: 0.875rem;
            font-size: 1.05rem;
            box-sizing: border-box;
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .input-field:focus {
            border-color: #87CEEB;
            box-shadow: 0 0 0 3px rgba(135, 206, 235, 0.4);
        }
        .mic-button {
            position: absolute;
            right: 1rem;
            background: none;
            border: none;
            color: #0000FF;
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            transition: color 0.3s ease, background-color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        .mic-button:hover {
            color: #DC2626; /* Red */
            background-color: rgba(220, 38, 38, 0.1);
        }
        .mic-button.recording {
            color: #DC2626; /* Red */
            animation: pulse 1s infinite alternate;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.1); opacity: 0.7; }
        }

        .generate-button, .action-button, .ai-voice-button {
            background-color: #6A0DAD; /* Dark Violet */
            color: #ffffff;
            padding: 1rem 2rem;
            border-radius: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease;
            box-shadow: 0 6px 15px rgba(106, 13, 173, 0.4);
            letter-spacing: 0.025em;
            margin-top: 1rem;
            border: none;
            display: inline-flex; /* Ensure flex behavior for centering icon/text */
            align-items: center;
            justify-content: center;
            gap: 0.5rem; /* Space between icon and text */
        }
        .generate-button:hover, .action-button:hover, .ai-voice-button:hover {
            background-color: #4B0A7B; /* Darker Violet */
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(106, 13, 173, 0.5);
        }
        .generate-button:active, .action-button:active, .ai-voice-button:active {
            transform: translateY(0);
            box-shadow: 0 4px 10px rgba(106, 13, 173, 0.3);
        }
        .loading-indicator {
            display: none;
            margin-top: 2rem;
            font-size: 1.15rem;
            color: #6B7280;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #6A0DAD;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .tip-box, .result-box {
            background-color: #FFFFAA; /* Light Yellow */
            border: 1px solid #CCCC88; /* Darker Yellow */
            border-radius: 1.25rem;
            padding: 2rem;
            margin-top: 2rem;
            text-align: left;
            color: #333333;
            line-height: 1.7;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
            font-size: 1.05rem;
            transition: all 0.5s ease-in-out;
            word-break: break-word; /* Ensure long words break */
        }
        .tip-box p, .result-box p {
            margin: 0;
        }
        .text-red-600 {
            color: #DC2626; /* Red */
        }
        /* Responsive adjustments */
        @media (max-width: 640px) {
            body {
                padding: 1rem;
            }
            .container {
                padding: 1.5rem;
                border-radius: 1.25rem;
            }
            .generate-button, .action-button, .ai-voice-button {
                width: 100%;
                padding: 0.9rem 1.5rem;
            }
            .flex.flex-wrap.justify-center.gap-4 {
                flex-direction: column;
                gap: 0.75rem;
            }
            .language-selector-wrapper {
                top: 0.75rem;
                right: 0.75rem;
            }
            .input-wrapper {
                flex-direction: row;
                justify-content: center;
            }
            .mic-button {
                position: absolute;
                right: 0.5rem;
            }
        }
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #E6F7FF;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 1;
            transition: opacity 1s ease-out;
            overflow: hidden;
        }
        .splash-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }
        .splash-screen img {
            max-width: 25%;
            max-height: 25%;
            object-fit: contain;
        }

        .dropdown-menu {
            position: absolute;
            background-color: white;
            border: 1px solid #D1D5DB;
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            text-align: left;
            padding: 0.5rem 0;
            top: calc(100% + 5px); /* Position below input */
            left: 0;
        }
        .dropdown-menu div {
            padding: 0.75rem 1.25rem;
            cursor: pointer;
        }
        .dropdown-menu div:hover {
            background-color: #F3F4F6;
        }
        .dropdown-menu div.selected {
            background-color: #e0f2fe; /* light blue */
            font-weight: 500;
        }
        .feature-icon-container {
            display: flex;
            justify-content: center;
            gap: 1.5rem; /* Space between icons */
            margin-top: 2rem;
            flex-wrap: wrap; /* Allow icons to wrap on smaller screens */
        }
        .feature-icon {
            font-size: 3rem; /* Larger emoji size */
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.75rem;
            transition: transform 0.2s ease, background-color 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            line-height: 1;
        }
        .feature-icon:hover {
            transform: translateY(-5px);
            background-color: rgba(135, 206, 235, 0.1); /* Light blue hover */
        }
        .feature-icon span.label {
            font-size: 0.8rem; /* Smaller text label */
            margin-top: 0.5rem;
            color: #555;
            font-weight: 500;
        }
        /* Styles for feature sections (initially hidden) */
        .feature-section {
            display: none;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e5e7eb; /* Subtle separator */
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Voice selection dropdown for TTS */
        .tts-voice-selector {
            padding: 0.75rem;
            border: 1px solid #D1D5DB;
            border-radius: 0.875rem;
            font-size: 0.95rem;
            background-color: white;
            margin-left: 1rem;
            flex-grow: 1;
        }
    </style>
</head>
<body>
    <div id="splashScreen" class="splash-screen">
        <img src="healthcare.png" alt="Healthcare related image">
    </div>

    <div class="container" id="mainContent" style="display: none;">
        <div class="language-selector-wrapper">
            <select id="languageSelect" aria-label="Select Language" class="p-2 border border-gray-300 rounded-md text-sm bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-300">
                <option value="ta">தமிழ்</option>
                <option value="en">English</option>
            </select>
        </div>
        <h1 id="mainTitle" class="text-3xl font-bold text-gray-800 mb-4 lg:text-4xl"></h1>
        <p id="descriptionText" class="text-gray-600 mb-8 text-lg"></p>

        <h2 id="tipSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
        <div class="input-wrapper">
            <input type="text" id="goalInput" class="input-field" aria-label="உங்கள் ஆரோக்கிய இலக்கை உள்ளிடவும்">
            <button id="micBtn" class="mic-button" title="உங்கள் இலக்கைப் பேசுங்கள்" aria-label="உங்கள் ஆரோக்கிய இலக்கைப் பதிவு செய்யவும்">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                    <line x1="12" y1="19" x2="12" y2="23"></line>
                    <line x1="8" y1="23" x2="16" y2="23"></line>
                </svg>
            </button>
        </div>
        <div class="flex flex-wrap justify-center gap-4 mt-4">
            <button id="generateBtn" class="generate-button"></button>
            <button id="aiVoiceBtn" class="ai-voice-button" style="display: none;">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                    <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                </svg>
            </button>
            <select id="ttsVoiceSelect" class="tts-voice-selector" style="display: none;" aria-label="Select Voice"></select>
        </div>
        <div id="loading" class="loading-indicator" aria-live="polite">
            <div class="loading-spinner"></div>
            <p id="loadingText"></p>
        </div>
        <div id="tipOutput" class="tip-box" aria-live="polite"></div>

        <hr class="border-t border-gray-300 my-8">

        <h2 id="featuresTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
        <div class="feature-icon-container">
            <div id="iconStepTracker" class="feature-icon" title="படி டிராக்கர்">🚶‍♀️<span class="label" data-label-key="stepTrackerLabel"></span></div>
            <div id="iconHeartRateTracker" class="feature-icon" title="இதயத் துடிப்பு டிராக்கர்">❤️‍🩹<span class="label" data-label-key="heartRateTrackerLabel"></span></div>
            <div id="iconWaterTracker" class="feature-icon" title="தண்ணீர் டிராக்கர்">💧<span class="label" data-label-key="waterTrackerLabel"></span></div>
            <div id="iconJournal" class="feature-icon" title="மனநிலை & நன்றியுணர்வு ஜர்னல்">✍️<span class="label" data-label-key="journalLabel"></span></div>
            <div id="iconLocalTips" class="feature-icon" title="உள்ளூர் ஆரோக்கிய குறிப்புகள்">🌿<span class="label" data-label-key="localTipsLabel"></span></div>
            <div id="iconMealPlan" class="feature-icon" title="உணவுத் திட்டப் பரிந்துரைகள்">🍲<span class="label" data-label-key="mealPlanLabel"></span></div>
            <div id="iconMoodAnalysis" class="feature-icon" title="உணர்வுப் பதிவேடு பகுப்பாய்வு">🤔<span class="label" data-label-key="moodAnalysisLabel"></span></div>
            <div id="iconExerciseYoga" class="feature-icon" title="உடற்பயிற்சி & யோகா">🧘‍♀️<span class="label" data-label-key="exerciseYogaLabel"></span></div>
            <div id="iconDiseasePrevention" class="feature-icon" title="நோய் தடுப்பு">🛡️<span class="label" data-label-key="diseasePreventionLabel"></span></div>
            <div id="iconWellnessChallenge" class="feature-icon" title="ஆரோக்கிய சவால்கள்">🏆<span class="label" data-label-key="wellnessChallengeLabel"></span></div>
        </div>

        <div id="stepTrackerSection" class="feature-section">
            <h2 id="stepSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <div class="input-wrapper">
                <label for="currentStepsDisplay" class="sr-only">தற்போதைய படிகள்</label>
                <input type="text" id="currentStepsDisplay" class="input-field" value="0" readonly aria-atomic="true">
            </div>
            <div class="flex flex-wrap justify-center gap-4 mt-4">
                <button id="addOneStepBtn" class="action-button"></button>
                <button id="toggleTrackingBtn" class="action-button"></button>
                <button id="resetStepsBtn" class="action-button"></button>
            </div>
            <div id="stepResultOutput" class="result-box" aria-live="polite"></div>
        </div>

        <div id="heartRateTrackerSection" class="feature-section">
            <h2 id="heartRateSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <div class="input-wrapper">
                <label for="currentHeartRateDisplay" class="sr-only">தற்போதைய இதயத் துடிப்பு</label>
                <input type="text" id="currentHeartRateDisplay" class="input-field" value="0" readonly aria-atomic="true">
            </div>
            <div class="flex flex-wrap justify-center gap-4 mt-4">
                <button id="simulateHeartRateBtn" class="action-button"></button>
                <button id="resetHeartRateBtn" class="action-button"></button>
            </div>
            <div id="heartRateResultOutput" class="result-box" aria-live="polite"></div>
        </div>

        <div id="waterTrackerSection" class="feature-section">
            <h2 id="waterSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <div class="input-wrapper">
                <label for="waterIntakeDisplay" class="sr-only">தற்போதைய தண்ணீர் உட்கொள்ளல்</label>
                <input type="text" id="waterIntakeDisplay" class="input-field" value="0 ml" readonly aria-atomic="true">
            </div>
            <div class="flex flex-wrap justify-center gap-4 mt-4">
                <button id="addWaterBtn" class="action-button"></button>
                <button id="resetWaterBtn" class="action-button"></button>
            </div>
            <div id="waterResultOutput" class="result-box" aria-live="polite"></div>
        </div>

        <div id="journalSection" class="feature-section">
            <h2 id="journalSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <p id="journalDescription" class="text-gray-600 mb-4 text-lg"></p>
            <div class="input-wrapper flex-col items-stretch">
                <label for="moodSelect" class="sr-only">உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்</label>
                <select id="moodSelect" class="input-field mb-4" aria-label="உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்">
                    <option value="">உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்</option>
                    <option value="happy">மகிழ்ச்சி 😄</option>
                    <option value="neutral">சாதாரணம் 😐</option>
                    <option value="sad">சோகம் 😔</option>
                    <option value="stressed">மன அழுத்தம் 😩</option>
                    <option value="energetic">ஆற்றல் 💪</option>
                </select>
                <label for="gratitudeInput" class="sr-only">நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்</label>
                <textarea id="gratitudeInput" class="input-field min-h-[100px]" placeholder="நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்..." aria-label="நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்"></textarea>
            </div>
            <button id="saveJournalEntryBtn" class="action-button mt-4"></button>
            <div id="journalEntriesOutput" class="result-box mt-4 text-left"></div>
        </div>

        <div id="localTipsSection" class="feature-section">
            <h2 id="localTipsSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <p id="localTipsDescription" class="text-gray-600 mb-4 text-lg"></p>
            <div class="input-wrapper mb-4">
                <input type="text" id="localTipCategory" class="input-field" aria-label="உதவிக்குறிப்பு வகையை உள்ளிடவும்" placeholder="எ.கா. மஞ்சள், முருங்கை, தியானம்...">
                <div id="localTipCategoryDropdown" class="dropdown-menu hidden mt-2 top-full left-0"></div>
            </div>
            <button id="getLocalTipBtn" class="generate-button"></button>
            <div id="localTipOutput" class="tip-box" aria-live="polite"></div>
        </div>

        <div id="mealPlanSection" class="feature-section">
            <h2 id="mealPlanSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <p id="mealPlanDescription" class="text-gray-600 mb-4 text-lg"></p>
            <div class="input-wrapper flex-col items-stretch">
                <label for="dietGoalInput" class="sr-only">உணவு இலக்கு</label>
                <input type="text" id="dietGoalInput" class="input-field mb-4" placeholder="எ.கா. எடை குறைப்பு, தசை வளர்ச்சி..." aria-label="உணவு இலக்கு">

                <label for="dietPreferenceSelect" class="sr-only">உணவு விருப்பம்</label>
                <select id="dietPreferenceSelect" class="input-field mb-4" aria-label="உணவு விருப்பம்">
                    <option value="">உணவு விருப்பத்தைத் தேர்ந்தெடுக்கவும்</option>
                    <option value="vegetarian">சைவம்</option>
                    <option value="non-vegetarian">அசைவம்</option>
                    <option value="vegan">முழு சைவம்</option>
                </select>

                <label for="allergiesInput" class="sr-only">ஒவ்வாமைகள் (இருப்பின்)</label>
                <input type="text" id="allergiesInput" class="input-field mb-4" placeholder="எ.கா. நிலக்கடலை, பால்..." aria-label="ஒவ்வாமைகள்">
            </div>
            <button id="generateMealPlanBtn" class="action-button mt-4"></button>
            <div id="mealPlanOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
        </div>

        <div id="moodAnalysisSection" class="feature-section">
            <h2 id="moodAnalysisSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <p id="moodAnalysisDescription" class="text-gray-600 mb-4 text-lg"></p>
            <button id="analyzeMoodJournalBtn" class="action-button mt-4"></button>
            <div id="moodAnalysisOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
        </div>

        <div id="exerciseYogaSection" class="feature-section">
            <h2 id="exerciseYogaSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <p id="exerciseYogaDescription" class="text-gray-600 mb-4 text-lg"></p>
            <div class="input-wrapper flex-col items-stretch">
                <label for="fitnessLevelSelect" class="sr-only">உடற்பயிற்சி நிலை</label>
                <select id="fitnessLevelSelect" class="input-field mb-4" aria-label="உடற்பயிற்சி நிலை">
                    <option value="">உடற்பயிற்சி நிலையைத் தேர்ந்தெடுக்கவும்</option>
                    <option value="beginner">ஆரம்பநிலை</option>
                    <option value="intermediate">நடுநிலை</option>
                    <option value="advanced">மேம்பட்டது</option>
                </select>

                <label for="timeAvailableInput" class="sr-only">கிடைக்கக்கூடிய நேரம் (நிமிடங்கள்)</label>
                <input type="number" id="timeAvailableInput" class="input-field mb-4" placeholder="கிடைக்கக்கூடிய நேரம் (நிமிடங்கள்)..." aria-label="கிடைக்கக்கூடிய நேரம்">

                <label for="exerciseGoalInput" class="sr-only">உடற்பயிற்சி இலக்கு</label>
                <input type="text" id="exerciseGoalInput" class="input-field mb-4" placeholder="எ.கா. உடல் நெகிழ்வுத்தன்மை, தசைகளை உருவாக்குதல்..." aria-label="உடற்பயிற்சி இலக்கு">
            </div>
            <button id="generateExerciseRoutineBtn" class="action-button mt-4"></button>
            <div id="exerciseRoutineOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
        </div>

        <div id="diseasePreventionSection" class="feature-section">
            <h2 id="diseasePreventionSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <p id="diseasePreventionDescription" class="text-gray-600 mb-4 text-lg"></p>
            <div class="input-wrapper mb-4">
                <input type="text" id="healthConcernInput" class="input-field" aria-label="உடல்நலக் கவலையை உள்ளிடவும்" placeholder="எ.கா. ஜலதோஷம், செரிமானப் பிரச்சனை...">
            </div>
            <button id="getRemedyBtn" class="generate-button"></button>
            <div id="remedyOutput" class="tip-box" aria-live="polite"></div>
        </div>

        <div id="wellnessChallengeSection" class="feature-section">
            <h2 id="wellnessChallengeSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <p id="wellnessChallengeDescription" class="text-gray-600 mb-4 text-lg"></p>
            <div class="input-wrapper flex-col items-stretch">
                <label for="currentHabitInput" class="sr-only">தற்போதைய பழக்கம் (எ.கா. நீர் உட்கொள்ளல்)</label>
                <input type="text" id="currentHabitInput" class="input-field mb-4" placeholder="உங்கள் தற்போதைய பழக்கம் (எ.கா. 1000ml தண்ணீர்)..." aria-label="தற்போதைய பழக்கம்">
                
                <label for="challengeGoalInput" class="sr-only">சவால் இலக்கு (எ.கா. 2000ml தண்ணீர்)</label>
                <input type="text" id="challengeGoalInput" class="input-field mb-4" placeholder="உங்கள் சவால் இலக்கு (எ.கா. 2000ml தண்ணீர்)..." aria-label="சவால் இலக்கு">
            </div>
            <button id="generateChallengeBtn" class="action-button mt-4"></button>
            <div id="challengeOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
        </div>

        </div>

    <script>
        // --- Configuration ---
        // IMPORTANT: The Gemini API Key is now handled securely via Netlify Functions.
        // No direct API key in frontend code.
        // The frontend will call '/.netlify/functions/generate-tip' which handles the key.

        // --- HTML Element References ---
        const goalInput = document.getElementById('goalInput');
        const generateBtn = document.getElementById('generateBtn');
        const loadingIndicator = document.getElementById('loading');
        const tipOutput = document.getElementById('tipOutput');
        const languageSelect = document.getElementById('languageSelect');
        const mainTitle = document.getElementById('mainTitle');
        const descriptionText = document.getElementById('descriptionText');
        const loadingText = document.getElementById('loadingText');
        const micBtn = document.getElementById('micBtn');
        const aiVoiceBtn = document.getElementById('aiVoiceBtn');
        const ttsVoiceSelect = document.getElementById('ttsVoiceSelect');

        const splashScreen = document.getElementById('splashScreen');
        const mainContent = document.getElementById('mainContent');

        const tipSectionTitle = document.getElementById('tipSectionTitle');
        const featuresTitle = document.getElementById('featuresTitle');

        // Emoji Icons
        const iconStepTracker = document.getElementById('iconStepTracker');
        const iconHeartRateTracker = document.getElementById('iconHeartRateTracker');
        const iconWaterTracker = document.getElementById('iconWaterTracker');
        const iconJournal = document.getElementById('iconJournal');
        const iconLocalTips = document.getElementById('iconLocalTips');
        // NEW FEATURE ICONS
        const iconMealPlan = document.getElementById('iconMealPlan');
        const iconMoodAnalysis = document.getElementById('iconMoodAnalysis');
        const iconExerciseYoga = document.getElementById('iconExerciseYoga');
        const iconDiseasePrevention = document.getElementById('iconDiseasePrevention');
        const iconWellnessChallenge = document.getElementById('iconWellnessChallenge');


        // Feature Sections (Existing)
        const stepTrackerSection = document.getElementById('stepTrackerSection');
        const heartRateTrackerSection = document.getElementById('heartRateTrackerSection');
        const waterTrackerSection = document.getElementById('waterTrackerSection');
        const journalSection = document.getElementById('journalSection');
        const localTipsSection = document.getElementById('localTipsSection');

        // NEW FEATURE SECTIONS
        const mealPlanSection = document.getElementById('mealPlanSection');
        const moodAnalysisSection = document.getElementById('moodAnalysisSection');
        const exerciseYogaSection = document.getElementById('exerciseYogaSection');
        const diseasePreventionSection = document.getElementById('diseasePreventionSection');
        const wellnessChallengeSection = document.getElementById('wellnessChallengeSection');


        // Step Tracker elements
        const stepSectionTitle = document.getElementById('stepSectionTitle');
        const currentStepsDisplay = document.getElementById('currentStepsDisplay');
        const addOneStepBtn = document.getElementById('addOneStepBtn');
        const toggleTrackingBtn = document.getElementById('toggleTrackingBtn');
        const resetStepsBtn = document.getElementById('resetStepsBtn');
        const stepResultOutput = document.getElementById('stepResultOutput');

        // Heart Rate elements
        const heartRateSectionTitle = document.getElementById('heartRateSectionTitle');
        const currentHeartRateDisplay = document.getElementById('currentHeartRateDisplay');
        const simulateHeartRateBtn = document.getElementById('simulateHeartRateBtn');
        const resetHeartRateBtn = document.getElementById('resetHeartRateBtn');
        const heartRateResultOutput = document.getElementById('heartRateResultOutput');

        // Water Intake elements
        const waterSectionTitle = document.getElementById('waterSectionTitle');
        const waterIntakeDisplay = document.getElementById('waterIntakeDisplay');
        const addWaterBtn = document.getElementById('addWaterBtn');
        const resetWaterBtn = document.getElementById('resetWaterBtn');
        const waterResultOutput = document.getElementById('waterResultOutput');

        // Mood & Gratitude Journal elements
        const journalSectionTitle = document.getElementById('journalSectionTitle');
        const journalDescription = document.getElementById('journalDescription');
        const moodSelect = document.getElementById('moodSelect');
        const gratitudeInput = document.getElementById('gratitudeInput');
        const saveJournalEntryBtn = document.getElementById('saveJournalEntryBtn');
        const journalEntriesOutput = document.getElementById('journalEntriesOutput');

        // Local & Traditional Wellness Tips elements
        const localTipsSectionTitle = document.getElementById('localTipsSectionTitle');
        const localTipsDescription = document.getElementById('localTipsDescription');
        const localTipCategory = document.getElementById('localTipCategory');
        const localTipCategoryDropdown = document.getElementById('localTipCategoryDropdown');
        const getLocalTipBtn = document.getElementById('getLocalTipBtn');
        const localTipOutput = document.getElementById('localTipOutput');


        // --- NEW FEATURE ELEMENTS ---
        // Meal Plan elements
        const mealPlanSectionTitle = document.getElementById('mealPlanSectionTitle');
        const mealPlanDescription = document.getElementById('mealPlanDescription');
        const dietGoalInput = document.getElementById('dietGoalInput');
        const dietPreferenceSelect = document.getElementById('dietPreferenceSelect');
        const allergiesInput = document.getElementById('allergiesInput');
        const generateMealPlanBtn = document.getElementById('generateMealPlanBtn');
        const mealPlanOutput = document.getElementById('mealPlanOutput');

        // Mood Analysis elements
        const moodAnalysisSectionTitle = document.getElementById('moodAnalysisSectionTitle');
        const moodAnalysisDescription = document.getElementById('moodAnalysisDescription');
        const analyzeMoodJournalBtn = document.getElementById('analyzeMoodJournalBtn');
        const moodAnalysisOutput = document.getElementById('moodAnalysisOutput');

        // Exercise/Yoga elements
        const exerciseYogaSectionTitle = document.getElementById('exerciseYogaSectionTitle');
        const exerciseYogaDescription = document.getElementById('exerciseYogaDescription');
        const fitnessLevelSelect = document.getElementById('fitnessLevelSelect');
        const timeAvailableInput = document.getElementById('timeAvailableInput');
        const exerciseGoalInput = document.getElementById('exerciseGoalInput');
        const generateExerciseRoutineBtn = document.getElementById('generateExerciseRoutineBtn');
        const exerciseRoutineOutput = document.getElementById('exerciseRoutineOutput');

        // Disease Prevention elements
        const diseasePreventionSectionTitle = document.getElementById('diseasePreventionSectionTitle');
        const diseasePreventionDescription = document.getElementById('diseasePreventionDescription');
        const healthConcernInput = document.getElementById('healthConcernInput');
        const getRemedyBtn = document.getElementById('getRemedyBtn');
        const remedyOutput = document.getElementById('remedyOutput');

        // Wellness Challenge elements
        const wellnessChallengeSectionTitle = document.getElementById('wellnessChallengeSectionTitle');
        const wellnessChallengeDescription = document.getElementById('wellnessChallengeDescription');
        const currentHabitInput = document.getElementById('currentHabitInput');
        const challengeGoalInput = document.getElementById('challengeGoalInput');
        const generateChallengeBtn = document.getElementById('generateChallengeBtn');
        const challengeOutput = document.getElementById('challengeOutput');


        // --- Global Variables ---
        let mediaRecorder;
        let audioChunks = [];
        let recognition;
        let selectedLanguage = 'ta'; // Default to Tamil
        let currentJournalEntries = []; // To store journal entries
        let isStepTrackingActive = false;
        let stepsCount = 0;
        let waterIntakeMl = 0;

        const translations = {
            'ta': {
                mainTitle: "ஆரோக்கிய நண்பன் - உங்கள் ஆரோக்கிய துணை",
                descriptionText: "உங்கள் உடல்நல இலக்குகளை அடையவும், ஆரோக்கியமான வாழ்க்கை முறையை வாழவும் உங்களுக்கு உதவ இங்கே இருக்கிறேன். உங்கள் இலக்கை உள்ளிடவும்!",
                tipSectionTitle: "உங்கள் தினசரி ஆரோக்கிய குறிப்பை உருவாக்குங்கள்",
                featuresTitle: "சிறப்பம்சங்கள்",
                goalInputPlaceholder: "எ.கா. 'தினமும் 10,000 படிகள் நடக்க வேண்டும்' அல்லது 'சத்தான உணவு சாப்பிட வேண்டும்'",
                generateBtnText: "குறிப்பு உருவாக்கு",
                loadingText: "குறிப்பை உருவாக்குகிறது...",
                tipOutputDefault: "உங்கள் இலக்கை உள்ளிட்டு, 'குறிப்பு உருவாக்கு' பொத்தானை அழுத்தவும்.",
                micButtonTitle: "உங்கள் இலக்கைப் பேசுங்கள்",
                aiVoiceButtonText: "AI குரலில் கேட்க",

                // Feature labels
                stepTrackerLabel: "படி டிராக்கர்",
                heartRateTrackerLabel: "இதயத் துடிப்பு டிராக்கர்",
                waterTrackerLabel: "தண்ணீர் டிராக்கர்",
                journalLabel: "மனநிலை & நன்றியுணர்வு",
                localTipsLabel: "உள்ளூர் குறிப்புகள்",
                mealPlanLabel: "உணவுத் திட்டம்",
                moodAnalysisLabel: "உணர்வு பகுப்பாய்வு",
                exerciseYogaLabel: "உடற்பயிற்சி & யோகா",
                diseasePreventionLabel: "நோய் தடுப்பு",
                wellnessChallengeLabel: "சவால்கள்",

                // Step Tracker
                stepSectionTitle: "படி டிராக்கர்",
                currentStepsDisplayLabel: "தற்போதைய படிகள்:",
                addOneStepBtnText: "ஒரு படி சேர்",
                toggleTrackingBtnStart: "டிராக்கிங்கை தொடங்கு",
                toggleTrackingBtnStop: "டிராக்கிங்கை நிறுத்து",
                resetStepsBtnText: "படிகளை மீட்டமை",
                stepResultOutputDefault: "உங்கள் படிகளைக் கண்காணிக்கத் தொடங்குங்கள்.",
                stepTrackingStarted: "படி டிராக்கிங் தொடங்கப்பட்டது!",
                stepTrackingStopped: "படி டிராக்கிங் நிறுத்தப்பட்டது.",
                stepTrackingReset: "படிகள் மீட்டமைக்கப்பட்டன.",
                stepGoalReached: "வாழ்த்துக்கள்! உங்கள் தினசரி படி இலக்கை அடைந்துவிட்டீர்கள்!",
                stepUpdate: "தற்போதைய படிகள்: {steps} - {remaining} படிகள் இலக்கிற்கு.",

                // Heart Rate Tracker
                heartRateSectionTitle: "இதயத் துடிப்பு டிராக்கர்",
                currentHeartRateDisplayLabel: "தற்போதைய இதயத் துடிப்பு:",
                simulateHeartRateBtnText: "இதயத் துடிப்பை உருவகப்படுத்து",
                resetHeartRateBtnText: "இதயத் துடிப்பை மீட்டமை",
                heartRateResultOutputDefault: "உங்கள் இதயத் துடிப்பைப் பதிவுசெய்ய 'இதயத் துடிப்பை உருவகப்படுத்து' அழுத்தவும்.",
                heartRateNormal: "உங்கள் இதயத் துடிப்பு {hr} bpm (சாதாரணம்).",
                heartRateHigh: "உங்கள் இதயத் துடிப்பு {hr} bpm (உயர்வாக உள்ளது). ஒரு மருத்துவரை அணுகுவது நல்லது.",
                heartRateLow: "உங்கள் இதயத் துடிப்பு {hr} bpm (குறைவாக உள்ளது). ஒரு மருத்துவரை அணுகுவது நல்லது.",
                heartRateReset: "இதயத் துடிப்பு மீட்டமைக்கப்பட்டது.",

                // Water Tracker
                waterSectionTitle: "தண்ணீர் டிராக்கர்",
                waterIntakeDisplayLabel: "தண்ணீர் உட்கொள்ளல்:",
                addWaterBtnText: "250 மில்லி தண்ணீர் சேர்",
                resetWaterBtnText: "தண்ணீர் உட்கொள்ளலை மீட்டமை",
                waterResultOutputDefault: "உங்கள் தினசரி தண்ணீர் உட்கொள்ளலை கண்காணிக்கவும்.",
                waterIntakeUpdate: "நீங்கள் இன்று {amount} தண்ணீர் குடித்துள்ளீர்கள். இன்னும் {remaining} மி.லி. இலக்கிற்கு.",
                waterGoalReached: "அருமை! உங்கள் தினசரி தண்ணீர் இலக்கை அடைந்துவிட்டீர்கள்!",
                waterReset: "தண்ணீர் உட்கொள்ளல் மீட்டமைக்கப்பட்டது.",

                // Mood & Gratitude Journal
                journalSectionTitle: "மனநிலை & நன்றியுணர்வு ஜர்னல்",
                journalDescription: "உங்கள் மனநிலையை பதிவு செய்து, நீங்கள் நன்றியுள்ள விஷயங்களை எழுதுங்கள்.",
                moodSelectPlaceholder: "உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்",
                gratitudeInputPlaceholder: "நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்...",
                saveJournalEntryBtnText: "பதிவை சேமி",
                journalEntrySaved: "உங்கள் பதிவு சேமிக்கப்பட்டது!",
                noJournalEntries: "இன்று நீங்கள் எந்தப் பதிவையும் சேமிக்கவில்லை.",
                moodHappy: "மகிழ்ச்சி 😄",
                moodNeutral: "சாதாரணம் 😐",
                moodSad: "சோகம் 😔",
                moodStressed: "மன அழுத்தம் 😩",
                moodEnergetic: "ஆற்றல் 💪",
                journalDisplayFormat: "<b>நாள்:</b> {date}<br><b>மனநிலை:</b> {mood}<br><b>நன்றியுணர்வு:</b> {gratitude}<br><br>",

                // Local & Traditional Wellness Tips
                localTipsSectionTitle: "உள்ளூர் மற்றும் பாரம்பரிய ஆரோக்கிய குறிப்புகள்",
                localTipsDescription: "குறிப்பிட்ட உள்ளூர் பொருட்கள் அல்லது பாரம்பரிய முறைகள் பற்றிய குறிப்புகளைப் பெறுங்கள்.",
                localTipCategoryPlaceholder: "எ.கா. மஞ்சள், முருங்கை, தியானம்...",
                getLocalTipBtnText: "குறிப்பு பெறு",
                localTipOutputDefault: "ஒரு வகையை உள்ளிட்டு, 'குறிப்பு பெறு' பொத்தானை அழுத்தவும்.",
                localTipNotFound: "இந்த வகைக்கான குறிப்பு எதுவும் கிடைக்கவில்லை. வேறு ஏதாவது முயற்சி செய்யவும்.",

                // Meal Plan Recommendations
                mealPlanSectionTitle: "உணவுத் திட்டப் பரிந்துரைகள்",
                mealPlanDescription: "உங்கள் உணவு இலக்குகள், விருப்பங்கள் மற்றும் ஒவ்வாமைகளின் அடிப்படையில் தனிப்பயனாக்கப்பட்ட உணவுத் திட்டங்களைப் பெறுங்கள்.",
                dietGoalInputPlaceholder: "எ.கா. எடை குறைப்பு, தசை வளர்ச்சி, ஆரோக்கியமான உணவு...",
                dietPreferenceSelectPlaceholder: "உணவு விருப்பத்தைத் தேர்ந்தெடுக்கவும்",
                dietPreferenceVegetarian: "சைவம்",
                dietPreferenceNonVegetarian: "அசைவம்",
                dietPreferenceVegan: "முழு சைவம்",
                allergiesInputPlaceholder: "ஒவ்வாமைகள் (இருப்பின், கமாவால் பிரித்து எழுதவும்)",
                generateMealPlanBtnText: "உணவுத் திட்டத்தை உருவாக்கு",
                mealPlanOutputDefault: "உங்கள் உணவுத் திட்ட விவரங்களை உள்ளிட்டு, 'உணவுத் திட்டத்தை உருவாக்கு' பொத்தானை அழுத்தவும்.",
                mealPlanGenerating: "உணவுத் திட்டத்தை உருவாக்குகிறது...",
                mealPlanError: "உணவுத் திட்டத்தை உருவாக்க முடியவில்லை. மீண்டும் முயற்சிக்கவும்.",
                noMealPlanInput: "உணவு இலக்கு மற்றும் உணவு விருப்பத்தை உள்ளிடவும்.",

                // Mood Analysis
                moodAnalysisSectionTitle: "மனநிலை பகுப்பாய்வு",
                moodAnalysisDescription: "உங்கள் ஜர்னல் பதிவுகளின் அடிப்படையில் உங்கள் மனநிலை போக்குகளைப் பகுப்பாய்வு செய்யுங்கள்.",
                analyzeMoodJournalBtnText: "மனநிலையைப் பகுப்பாய்வு செய்",
                moodAnalysisOutputDefault: "உங்கள் மனநிலை பதிவுகளைப் பகுப்பாய்வு செய்ய 'மனநிலையைப் பகுப்பாய்வு செய்' பொத்தானை அழுத்தவும்.",
                noJournalEntriesForAnalysis: "பகுப்பாய்வு செய்ய ஜர்னல் பதிவுகள் எதுவும் இல்லை.",
                moodAnalysisResult: "உங்கள் கடந்தகால மனநிலை பதிவுகளின் அடிப்படையில், உங்கள் மனநிலை போக்கு: {analysis}.",

                // Exercise & Yoga Routines
                exerciseYogaSectionTitle: "உடற்பயிற்சி மற்றும் யோகா வழிமுறைகள்",
                exerciseYogaDescription: "உங்கள் உடற்பயிற்சி நிலை, நேரம் மற்றும் இலக்குகளுக்கு ஏற்ற தனிப்பயனாக்கப்பட்ட உடற்பயிற்சி மற்றும் யோகா வழிமுறைகளைப் பெறுங்கள்.",
                fitnessLevelSelectPlaceholder: "உடற்பயிற்சி நிலையைத் தேர்ந்தெடுக்கவும்",
                fitnessLevelBeginner: "ஆரம்பநிலை",
                fitnessLevelIntermediate: "நடுநிலை",
                fitnessLevelAdvanced: "மேம்பட்டது",
                timeAvailableInputPlaceholder: "கிடைக்கக்கூடிய நேரம் (நிமிடங்கள்)...",
                exerciseGoalInputPlaceholder: "எ.கா. உடல் நெகிழ்வுத்தன்மை, தசைகளை உருவாக்குதல், மன அழுத்தத்தைக் குறைத்தல்...",
                generateExerciseRoutineBtnText: "வழிமுறையை உருவாக்கு",
                exerciseRoutineOutputDefault: "உங்கள் உடற்பயிற்சி விவரங்களை உள்ளிட்டு, 'வழிமுறையை உருவாக்கு' பொத்தானை அழுத்தவும்.",
                exerciseRoutineGenerating: "உடற்பயிற்சி வழிமுறையை உருவாக்குகிறது...",
                exerciseRoutineError: "உடற்பயிற்சி வழிமுறையை உருவாக்க முடியவில்லை. மீண்டும் முயற்சிக்கவும்.",
                noExerciseRoutineInput: "உடற்பயிற்சி நிலை, நேரம் மற்றும் இலக்கை உள்ளிடவும்.",

                // Disease Prevention & Home Remedies
                diseasePreventionSectionTitle: "நோய் தடுப்பு மற்றும் வீட்டு வைத்தியங்கள்",
                diseasePreventionDescription: "பொதுவான உடல்நலக் கவலைகளுக்கான வீட்டு வைத்தியங்கள் மற்றும் தடுப்பு குறிப்புகளைக் கண்டறியவும்.",
                healthConcernInputPlaceholder: "எ.கா. ஜலதோஷம், செரிமானப் பிரச்சனை, தலைவலி...",
                getRemedyBtnText: "வைத்தியம் பெறு",
                remedyOutputDefault: "ஒரு உடல்நலக் கவலையை உள்ளிட்டு, 'வைத்தியம் பெறு' பொத்தானை அழுத்தவும்.",
                remedyNotFound: "இந்த உடல்நலக் கவலைக்கான வைத்தியம் எதுவும் கிடைக்கவில்லை. வேறு ஏதாவது முயற்சி செய்யவும்.",

                // Wellness Challenges
                wellnessChallengeSectionTitle: "ஆரோக்கிய சவால்கள்",
                wellnessChallengeDescription: "உங்கள் ஆரோக்கியமான பழக்கங்களை மேம்படுத்த தனிப்பயனாக்கப்பட்ட சவால்களை உருவாக்கவும்.",
                currentHabitInputPlaceholder: "உங்கள் தற்போதைய பழக்கம் (எ.கா. 1000ml தண்ணீர்)...",
                challengeGoalInputPlaceholder: "உங்கள் சவால் இலக்கு (எ.கா. 2000ml தண்ணீர்)...",
                generateChallengeBtnText: "சவாலை உருவாக்கு",
                challengeOutputDefault: "உங்கள் தற்போதைய பழக்கம் மற்றும் சவால் இலக்கை உள்ளிட்டு, 'சவாலை உருவாக்கு' பொத்தானை அழுத்தவும்.",
                challengeGenerating: "சவாலை உருவாக்குகிறது...",
                challengeError: "சவாலை உருவாக்க முடியவில்லை. மீண்டும் முயற்சிக்கவும்.",
                noChallengeInput: "தற்போதைய பழக்கம் மற்றும் சவால் இலக்கை உள்ளிடவும்."
            },
            'en': {
                mainTitle: "Wellness Buddy - Your Health Companion",
                descriptionText: "I'm here to help you achieve your health goals and live a healthier lifestyle. Enter your goal!",
                tipSectionTitle: "Generate Your Daily Wellness Tip",
                featuresTitle: "Key Features",
                goalInputPlaceholder: "e.g., 'walk 10,000 steps daily' or 'eat healthier meals'",
                generateBtnText: "Generate Tip",
                loadingText: "Generating tip...",
                tipOutputDefault: "Enter your goal and press 'Generate Tip' to get started.",
                micButtonTitle: "Speak your goal",
                aiVoiceButtonText: "Listen in AI Voice",

                // Feature labels
                stepTrackerLabel: "Step Tracker",
                heartRateTrackerLabel: "Heart Rate Tracker",
                waterTrackerLabel: "Water Tracker",
                journalLabel: "Mood & Gratitude",
                localTipsLabel: "Local Tips",
                mealPlanLabel: "Meal Plan",
                moodAnalysisLabel: "Mood Analysis",
                exerciseYogaLabel: "Exercise & Yoga",
                diseasePreventionLabel: "Disease Prevention",
                wellnessChallengeLabel: "Wellness Challenges",

                // Step Tracker
                stepSectionTitle: "Step Tracker",
                currentStepsDisplayLabel: "Current Steps:",
                addOneStepBtnText: "Add One Step",
                toggleTrackingBtnStart: "Start Tracking",
                toggleTrackingBtnStop: "Stop Tracking",
                resetStepsBtnText: "Reset Steps",
                stepResultOutputDefault: "Start tracking your steps.",
                stepTrackingStarted: "Step tracking started!",
                stepTrackingStopped: "Step tracking stopped.",
                stepTrackingReset: "Steps reset.",
                stepGoalReached: "Congratulations! You've reached your daily step goal!",
                stepUpdate: "Current Steps: {steps} - {remaining} steps to goal.",

                // Heart Rate Tracker
                heartRateSectionTitle: "Heart Rate Tracker",
                currentHeartRateDisplayLabel: "Current Heart Rate:",
                simulateHeartRateBtnText: "Simulate Heart Rate",
                resetHeartRateBtnText: "Reset Heart Rate",
                heartRateResultOutputDefault: "Press 'Simulate Heart Rate' to record your heart rate.",
                heartRateNormal: "Your heart rate is {hr} bpm (Normal).",
                heartRateHigh: "Your heart rate is {hr} bpm (High). It might be good to consult a doctor.",
                heartRateLow: "Your heart rate is {hr} bpm (Low). It might be good to consult a doctor.",
                heartRateReset: "Heart rate reset.",

                // Water Tracker
                waterSectionTitle: "Water Tracker",
                waterIntakeDisplayLabel: "Water Intake:",
                addWaterBtnText: "Add 250 ml Water",
                resetWaterBtnText: "Reset Water Intake",
                waterResultOutputDefault: "Track your daily water intake.",
                waterIntakeUpdate: "You've had {amount} ml of water today. {remaining} ml more to your goal.",
                waterGoalReached: "Great job! You've reached your daily water goal!",
                waterReset: "Water intake reset.",

                // Mood & Gratitude Journal
                journalSectionTitle: "Mood & Gratitude Journal",
                journalDescription: "Record your mood and write down things you're grateful for.",
                moodSelectPlaceholder: "Select your mood",
                gratitudeInputPlaceholder: "Write something you're grateful for...",
                saveJournalEntryBtnText: "Save Entry",
                journalEntrySaved: "Your journal entry has been saved!",
                noJournalEntries: "You haven't saved any journal entries today.",
                moodHappy: "Happy 😄",
                moodNeutral: "Neutral 😐",
                moodSad: "Sad 😔",
                moodStressed: "Stressed 😩",
                moodEnergetic: "Energetic 💪",
                journalDisplayFormat: "<b>Date:</b> {date}<br><b>Mood:</b> {mood}<br><b>Gratitude:</b> {gratitude}<br><br>",

                // Local & Traditional Wellness Tips
                localTipsSectionTitle: "Local & Traditional Wellness Tips",
                localTipsDescription: "Get tips on specific local ingredients or traditional practices.",
                localTipCategoryPlaceholder: "e.g. Turmeric, Moringa, Meditation...",
                getLocalTipBtnText: "Get Tip",
                localTipOutputDefault: "Enter a category and press 'Get Tip'.",
                localTipNotFound: "No tip found for this category. Please try something else.",

                // Meal Plan Recommendations
                mealPlanSectionTitle: "Meal Plan Recommendations",
                mealPlanDescription: "Get personalized meal plans based on your dietary goals, preferences, and allergies.",
                dietGoalInputPlaceholder: "e.g., Weight loss, Muscle gain, Healthy eating...",
                dietPreferenceSelectPlaceholder: "Select diet preference",
                dietPreferenceVegetarian: "Vegetarian",
                dietPreferenceNonVegetarian: "Non-Vegetarian",
                dietPreferenceVegan: "Vegan",
                allergiesInputPlaceholder: "Allergies (if any, comma-separated)",
                generateMealPlanBtnText: "Generate Meal Plan",
                mealPlanOutputDefault: "Enter your meal plan details and press 'Generate Meal Plan'.",
                mealPlanGenerating: "Generating meal plan...",
                mealPlanError: "Could not generate meal plan. Please try again.",
                noMealPlanInput: "Please enter a diet goal and diet preference.",

                // Mood Analysis
                moodAnalysisSectionTitle: "Mood Analysis",
                moodAnalysisDescription: "Analyze your mood trends based on your journal entries.",
                analyzeMoodJournalBtnText: "Analyze Mood",
                moodAnalysisOutputDefault: "Press 'Analyze Mood' to get insights from your journal entries.",
                noJournalEntriesForAnalysis: "No journal entries available for analysis.",
                moodAnalysisResult: "Based on your past journal entries, your mood trend is: {analysis}.",

                // Exercise & Yoga Routines
                exerciseYogaSectionTitle: "Exercise & Yoga Routines",
                exerciseYogaDescription: "Get personalized exercise and yoga routines tailored to your fitness level, time, and goals.",
                fitnessLevelSelectPlaceholder: "Select fitness level",
                fitnessLevelBeginner: "Beginner",
                fitnessLevelIntermediate: "Intermediate",
                fitnessLevelAdvanced: "Advanced",
                timeAvailableInputPlaceholder: "Time available (in minutes)...",
                exerciseGoalInputPlaceholder: "e.g., Flexibility, Build muscle, Stress reduction...",
                generateExerciseRoutineBtnText: "Generate Routine",
                exerciseRoutineOutputDefault: "Enter your exercise details and press 'Generate Routine'.",
                exerciseRoutineGenerating: "Generating exercise routine...",
                exerciseRoutineError: "Could not generate exercise routine. Please try again.",
                noExerciseRoutineInput: "Please enter fitness level, time, and exercise goal.",

                // Disease Prevention & Home Remedies
                diseasePreventionSectionTitle: "Disease Prevention & Home Remedies",
                diseasePreventionDescription: "Discover home remedies and preventive tips for common health concerns.",
                healthConcernInputPlaceholder: "e.g., Cold, Indigestion, Headache...",
                getRemedyBtnText: "Get Remedy",
                remedyOutputDefault: "Enter a health concern and press 'Get Remedy'.",
                remedyNotFound: "No remedy found for this health concern. Please try something else.",

                // Wellness Challenges
                wellnessChallengeSectionTitle: "Wellness Challenges",
                wellnessChallengeDescription: "Create personalized challenges to improve your healthy habits.",
                currentHabitInputPlaceholder: "Your current habit (e.g., 1000ml water)...",
                challengeGoalInputPlaceholder: "Your challenge goal (e.g., 2000ml water)...",
                generateChallengeBtnText: "Generate Challenge",
                challengeOutputDefault: "Enter your current habit and challenge goal, then press 'Generate Challenge'.",
                challengeGenerating: "Generating challenge...",
                challengeError: "Could not generate challenge. Please try again.",
                noChallengeInput: "Please enter your current habit and challenge goal."

            }
        };

        const localTipSuggestions = {
            'ta': [
                "மஞ்சள்", "வேப்பிலை", "துளசி", "முருங்கை", "ஆயுர்வேதம்", "யோகா", "தியானம்", "சித்த மருத்துவம்", "கற்றாழை", "கீழாநெல்லி", "நெல்லிக்காய்", "சுக்கு", "மிளகு", "திப்பிலி"
            ],
            'en': [
                "Turmeric", "Neem", "Holy Basil", "Moringa", "Ayurveda", "Yoga", "Meditation", "Siddha Medicine", "Aloe Vera", "Bhumyamalaki", "Amla", "Dry Ginger", "Black Pepper", "Long Pepper"
            ]
        };


        // --- Functions ---
        function updateContent() {
            const lang = languageSelect.value;
            mainTitle.textContent = translations[lang].mainTitle;
            descriptionText.textContent = translations[lang].descriptionText;
            tipSectionTitle.textContent = translations[lang].tipSectionTitle;
            featuresTitle.textContent = translations[lang].featuresTitle;
            goalInput.placeholder = translations[lang].goalInputPlaceholder;
            generateBtn.textContent = translations[lang].generateBtnText;
            loadingText.textContent = translations[lang].loadingText;
            tipOutput.innerHTML = `<p>${translations[lang].tipOutputDefault}</p>`;
            micBtn.title = translations[lang].micButtonTitle;
            aiVoiceBtn.textContent = translations[lang].aiVoiceButtonText;

            // Update feature labels
            document.querySelectorAll('.feature-icon .label').forEach(label => {
                const key = label.dataset.labelKey;
                if (translations[lang][key]) {
                    label.textContent = translations[lang][key];
                }
            });

            // Step Tracker
            stepSectionTitle.textContent = translations[lang].stepSectionTitle;
            addOneStepBtn.textContent = translations[lang].addOneStepBtnText;
            toggleTrackingBtn.textContent = isStepTrackingActive ? translations[lang].toggleTrackingBtnStop : translations[lang].toggleTrackingBtnStart;
            resetStepsBtn.textContent = translations[lang].resetStepsBtnText;
            stepResultOutput.innerHTML = `<p>${translations[lang].stepResultOutputDefault}</p>`;

            // Heart Rate Tracker
            heartRateSectionTitle.textContent = translations[lang].heartRateSectionTitle;
            simulateHeartRateBtn.textContent = translations[lang].simulateHeartRateBtnText;
            resetHeartRateBtn.textContent = translations[lang].resetHeartRateBtnText;
            heartRateResultOutput.innerHTML = `<p>${translations[lang].heartRateResultOutputDefault}</p>`;

            // Water Tracker
            waterSectionTitle.textContent = translations[lang].waterSectionTitle;
            addWaterBtn.textContent = translations[lang].addWaterBtnText;
            resetWaterBtn.textContent = translations[lang].resetWaterBtnText;
            waterResultOutput.innerHTML = `<p>${translations[lang].waterResultOutputDefault}</p>`;

            // Mood & Gratitude Journal
            journalSectionTitle.textContent = translations[lang].journalSectionTitle;
            journalDescription.textContent = translations[lang].journalDescription;
            moodSelect.querySelector('option[value=""]').textContent = translations[lang].moodSelectPlaceholder;
            moodSelect.querySelector('option[value="happy"]').textContent = translations[lang].moodHappy;
            moodSelect.querySelector('option[value="neutral"]').textContent = translations[lang].moodNeutral;
            moodSelect.querySelector('option[value="sad"]').textContent = translations[lang].moodSad;
            moodSelect.querySelector('option[value="stressed"]').textContent = translations[lang].moodStressed;
            moodSelect.querySelector('option[value="energetic"]').textContent = translations[lang].moodEnergetic;
            gratitudeInput.placeholder = translations[lang].gratitudeInputPlaceholder;
            saveJournalEntryBtn.textContent = translations[lang].saveJournalEntryBtnText;
            displayJournalEntries(); // Re-render journal entries in selected language

            // Local & Traditional Wellness Tips
            localTipsSectionTitle.textContent = translations[lang].localTipsSectionTitle;
            localTipsDescription.textContent = translations[lang].localTipsDescription;
            localTipCategory.placeholder = translations[lang].localTipCategoryPlaceholder;
            getLocalTipBtn.textContent = translations[lang].getLocalTipBtnText;
            localTipOutput.innerHTML = `<p>${translations[lang].localTipOutputDefault}</p>`;

            // NEW FEATURES
            // Meal Plan
            mealPlanSectionTitle.textContent = translations[lang].mealPlanSectionTitle;
            mealPlanDescription.textContent = translations[lang].mealPlanDescription;
            dietGoalInput.placeholder = translations[lang].dietGoalInputPlaceholder;
            dietPreferenceSelect.querySelector('option[value=""]').textContent = translations[lang].dietPreferenceSelectPlaceholder;
            dietPreferenceSelect.querySelector('option[value="vegetarian"]').textContent = translations[lang].dietPreferenceVegetarian;
            dietPreferenceSelect.querySelector('option[value="non-vegetarian"]').textContent = translations[lang].dietPreferenceNonVegetarian;
            dietPreferenceSelect.querySelector('option[value="vegan"]').textContent = translations[lang].dietPreferenceVegan;
            allergiesInput.placeholder = translations[lang].allergiesInputPlaceholder;
            generateMealPlanBtn.textContent = translations[lang].generateMealPlanBtnText;
            mealPlanOutput.innerHTML = `<p>${translations[lang].mealPlanOutputDefault}</p>`;

            // Mood Analysis
            moodAnalysisSectionTitle.textContent = translations[lang].moodAnalysisSectionTitle;
            moodAnalysisDescription.textContent = translations[lang].moodAnalysisDescription;
            analyzeMoodJournalBtn.textContent = translations[lang].analyzeMoodJournalBtnText;
            moodAnalysisOutput.innerHTML = `<p>${translations[lang].moodAnalysisOutputDefault}</p>`;

            // Exercise & Yoga
            exerciseYogaSectionTitle.textContent = translations[lang].exerciseYogaSectionTitle;
            exerciseYogaDescription.textContent = translations[lang].exerciseYogaDescription;
            fitnessLevelSelect.querySelector('option[value=""]').textContent = translations[lang].fitnessLevelSelectPlaceholder;
            fitnessLevelSelect.querySelector('option[value="beginner"]').textContent = translations[lang].fitnessLevelBeginner;
            fitnessLevelSelect.querySelector('option[value="intermediate"]').textContent = translations[lang].fitnessLevelIntermediate;
            fitnessLevelSelect.querySelector('option[value="advanced"]').textContent = translations[lang].fitnessLevelAdvanced;
            timeAvailableInput.placeholder = translations[lang].timeAvailableInputPlaceholder;
            exerciseGoalInput.placeholder = translations[lang].exerciseGoalInputPlaceholder;
            generateExerciseRoutineBtn.textContent = translations[lang].generateExerciseRoutineBtnText;
            exerciseRoutineOutput.innerHTML = `<p>${translations[lang].exerciseRoutineOutputDefault}</p>`;

            // Disease Prevention
            diseasePreventionSectionTitle.textContent = translations[lang].diseasePreventionSectionTitle;
            diseasePreventionDescription.textContent = translations[lang].diseasePreventionDescription;
            healthConcernInput.placeholder = translations[lang].healthConcernInputPlaceholder;
            getRemedyBtn.textContent = translations[lang].getRemedyBtnText;
            remedyOutput.innerHTML = `<p>${translations[lang].remedyOutputDefault}</p>`;

            // Wellness Challenges
            wellnessChallengeSectionTitle.textContent = translations[lang].wellnessChallengeSectionTitle;
            wellnessChallengeDescription.textContent = translations[lang].wellnessChallengeDescription;
            currentHabitInput.placeholder = translations[lang].currentHabitInputPlaceholder;
            challengeGoalInput.placeholder = translations[lang].challengeGoalInputPlaceholder;
            generateChallengeBtn.textContent = translations[lang].generateChallengeBtnText;
            challengeOutput.innerHTML = `<p>${translations[lang].challengeOutputDefault}</p>`;
        }

        // Function to show a specific feature section and hide others
        function showFeatureSection(sectionId) {
            document.querySelectorAll('.feature-section').forEach(section => {
                section.style.display = 'none';
            });
            const selectedSection = document.getElementById(sectionId);
            if (selectedSection) {
                selectedSection.style.display = 'block';
                document.body.classList.add('main-content-active');
            }
        }

        async function fetchAIResponse(endpoint, payload) {
            loadingIndicator.style.display = 'flex';
            tipOutput.style.display = 'none'; // Hide general tip output
            aiVoiceBtn.style.display = 'none';
            ttsVoiceSelect.style.display = 'none';

            // Determine which output element to use based on the endpoint
            let targetOutput = tipOutput;
            if (endpoint === '/.netlify/functions/generate-meal-plan') {
                targetOutput = mealPlanOutput;
            } else if (endpoint === '/.netlify/functions/analyze-mood') {
                targetOutput = moodAnalysisOutput;
            } else if (endpoint === '/.netlify/functions/generate-exercise-routine') {
                targetOutput = exerciseRoutineOutput;
            } else if (endpoint === '/.netlify/functions/get-remedy') {
                targetOutput = remedyOutput;
            } else if (endpoint === '/.netlify/functions/generate-challenge') {
                targetOutput = challengeOutput;
            } else if (endpoint === '/.netlify/functions/get-local-tip') {
                targetOutput = localTipOutput;
            }

            targetOutput.style.display = 'none'; // Hide specific output during loading
            targetOutput.innerHTML = ''; // Clear previous content

            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                targetOutput.style.display = 'flex'; // Show specific output
                targetOutput.innerHTML = `<p>${data.tip || data.mealPlan || data.analysis || data.routine || data.remedy || data.challenge}</p>`;
                if (data.tip || data.mealPlan || data.analysis || data.routine || data.remedy || data.challenge) {
                    aiVoiceBtn.style.display = 'inline-flex';
                    ttsVoiceSelect.style.display = 'inline-flex';
                }
            } catch (error) {
                console.error('Error fetching AI response:', error);
                targetOutput.style.display = 'flex';
                targetOutput.innerHTML = `<p class="text-red-600">${error.message || translations[selectedLanguage].errorGeneratingTip}</p>`;
            } finally {
                loadingIndicator.style.display = 'none';
            }
        }


        // Text-to-Speech (TTS) functionality
        let voices = [];

        function populateVoiceList() {
            voices = speechSynthesis.getVoices();
            ttsVoiceSelect.innerHTML = ''; // Clear existing options

            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Select Voice'; // Placeholder
            ttsVoiceSelect.appendChild(defaultOption);

            // Filter for relevant languages
            const targetLang = selectedLanguage === 'ta' ? 'ta-IN' : 'en-US';
            const filteredVoices = voices.filter(voice => voice.lang.startsWith(targetLang));

            filteredVoices.forEach((voice, index) => {
                const option = document.createElement('option');
                option.value = voice.name;
                option.textContent = `${voice.name} (${voice.lang})`;
                if (voice.default) {
                    option.textContent += ' (Default)';
                }
                ttsVoiceSelect.appendChild(option);
            });
        }

        populateVoiceList();
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = populateVoiceList;
        }

        aiVoiceBtn.addEventListener('click', () => {
            let textToSpeak = tipOutput.textContent; // Default to general tip
            // Check specific feature outputs for text
            if (mealPlanOutput.style.display === 'flex') {
                textToSpeak = mealPlanOutput.textContent;
            } else if (moodAnalysisOutput.style.display === 'flex') {
                textToSpeak = moodAnalysisOutput.textContent;
            } else if (exerciseRoutineOutput.style.display === 'flex') {
                textToSpeak = exerciseRoutineOutput.textContent;
            } else if (remedyOutput.style.display === 'flex') {
                textToSpeak = remedyOutput.textContent;
            } else if (challengeOutput.style.display === 'flex') {
                textToSpeak = challengeOutput.textContent;
            } else if (localTipOutput.style.display === 'flex') {
                textToSpeak = localTipOutput.textContent;
            }


            if (textToSpeak) {
                const utterance = new SpeechSynthesisUtterance(textToSpeak);
                const selectedVoiceName = ttsVoiceSelect.value;
                if (selectedVoiceName) {
                    const selectedVoice = voices.find(voice => voice.name === selectedVoiceName);
                    if (selectedVoice) {
                        utterance.voice = selectedVoice;
                    }
                }
                speechSynthesis.speak(utterance);
            }
        });

        // Speech Recognition (for goal input)
        function startSpeechRecognition() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('Your browser does not support Speech Recognition. Please use Chrome or a compatible browser.');
                return;
            }

            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = selectedLanguage === 'ta' ? 'ta-IN' : 'en-US';

            micBtn.classList.add('recording');
            micBtn.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic-off">
                    <line x1="1" y1="1" x2="23" y2="23"></line>
                    <path d="M9 9v3a3 3 0 0 0 5.12 2.21M16 16v-4a4 4 0 0 0-8-1.88"></path>
                    <path d="M15 9.3V4a3 3 0 0 0-6 0v2"></path>
                    <path d="M7.34 14.66L.67 21.33"></path>
                    <path d="M23.33 6.67L16.66 13.34"></path>
                </svg>
            `;


            recognition.onstart = () => {
                console.log('Speech recognition started...');
                goalInput.placeholder = translations[selectedLanguage].listening || "Listening...";
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                goalInput.value = transcript;
                micBtn.classList.remove('recording');
                micBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" x2="12" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                    </svg>
                `;
                goalInput.placeholder = translations[selectedLanguage].goalInputPlaceholder; // Reset placeholder
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                micBtn.classList.remove('recording');
                micBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" x2="12" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                    </svg>
                `;
                goalInput.placeholder = translations[selectedLanguage].goalInputPlaceholder; // Reset placeholder
                alert(translations[selectedLanguage].speechRecognitionError || 'Speech recognition error. Please try again.');
            };

            recognition.onend = () => {
                console.log('Speech recognition ended.');
                micBtn.classList.remove('recording');
                micBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" x2="12" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                    </svg>
                `;
                goalInput.placeholder = translations[selectedLanguage].goalInputPlaceholder; // Reset placeholder
            };

            recognition.start();
        }

        micBtn.addEventListener('click', startSpeechRecognition);


        // Step Tracker Logic
        let stepTrackingInterval;
        const dailyStepGoal = 10000; // Example goal

        function updateStepsDisplay() {
            currentStepsDisplay.value = `${stepsCount} ${translations[selectedLanguage].stepsUnit || 'steps'}`;
            const remainingSteps = dailyStepGoal - stepsCount;
            if (remainingSteps <= 0) {
                stepResultOutput.innerHTML = `<p>${translations[selectedLanguage].stepGoalReached}</p>`;
            } else {
                stepResultOutput.innerHTML = `<p>${translations[selectedLanguage].stepUpdate.replace('{steps}', stepsCount).replace('{remaining}', remainingSteps)}</p>`;
            }
        }

        addOneStepBtn.addEventListener('click', () => {
            stepsCount++;
            updateStepsDisplay();
        });

        toggleTrackingBtn.addEventListener('click', () => {
            if (isStepTrackingActive) {
                clearInterval(stepTrackingInterval);
                isStepTrackingActive = false;
                toggleTrackingBtn.textContent = translations[selectedLanguage].toggleTrackingBtnStart;
                stepResultOutput.innerHTML = `<p>${translations[selectedLanguage].stepTrackingStopped}</p>`;
            } else {
                isStepTrackingActive = true;
                toggleTrackingBtn.textContent = translations[selectedLanguage].toggleTrackingBtnStop;
                stepResultOutput.innerHTML = `<p>${translations[selectedLanguage].stepTrackingStarted}</p>`;
                // Simulate step increase every few seconds (for demonstration)
                stepTrackingInterval = setInterval(() => {
                    stepsCount += Math.floor(Math.random() * 50) + 1; // Add random steps
                    updateStepsDisplay();
                }, 5000); // Every 5 seconds
            }
        });

        resetStepsBtn.addEventListener('click', () => {
            clearInterval(stepTrackingInterval);
            isStepTrackingActive = false;
            stepsCount = 0;
            updateStepsDisplay();
            toggleTrackingBtn.textContent = translations[selectedLanguage].toggleTrackingBtnStart;
            stepResultOutput.innerHTML = `<p>${translations[selectedLanguage].stepTrackingReset}</p>`;
        });


        // Heart Rate Tracker Logic
        function simulateHeartRate() {
            const min = 60;
            const max = 100;
            const simulatedHr = Math.floor(Math.random() * (max - min + 1)) + min;
            currentHeartRateDisplay.value = `${simulatedHr} bpm`;

            if (simulatedHr >= 60 && simulatedHr <= 100) {
                heartRateResultOutput.innerHTML = `<p>${translations[selectedLanguage].heartRateNormal.replace('{hr}', simulatedHr)}</p>`;
            } else if (simulatedHr > 100) {
                heartRateResultOutput.innerHTML = `<p class="text-red-600">${translations[selectedLanguage].heartRateHigh.replace('{hr}', simulatedHr)}</p>`;
            } else {
                heartRateResultOutput.innerHTML = `<p class="text-red-600">${translations[selectedLanguage].heartRateLow.replace('{hr}', simulatedHr)}</p>`;
            }
        }

        simulateHeartRateBtn.addEventListener('click', simulateHeartRate);

        resetHeartRateBtn.addEventListener('click', () => {
            currentHeartRateDisplay.value = '0 bpm';
            heartRateResultOutput.innerHTML = `<p>${translations[selectedLanguage].heartRateReset}</p>`;
        });


        // Water Tracker Logic
        const dailyWaterGoalMl = 2000; // 2 liters

        function updateWaterDisplay() {
            waterIntakeDisplay.value = `${waterIntakeMl} ml`;
            const remainingWater = dailyWaterGoalMl - waterIntakeMl;
            if (remainingWater <= 0) {
                waterResultOutput.innerHTML = `<p>${translations[selectedLanguage].waterGoalReached}</p>`;
            } else {
                waterResultOutput.innerHTML = `<p>${translations[selectedLanguage].waterIntakeUpdate.replace('{amount}', waterIntakeMl).replace('{remaining}', remainingWater)}</p>`;
            }
        }

        addWaterBtn.addEventListener('click', () => {
            waterIntakeMl += 250;
            updateWaterDisplay();
        });

        resetWaterBtn.addEventListener('click', () => {
            waterIntakeMl = 0;
            updateWaterDisplay();
            waterResultOutput.innerHTML = `<p>${translations[selectedLanguage].waterReset}</p>`;
        });


        // Mood & Gratitude Journal Logic
        function saveJournalEntry() {
            const mood = moodSelect.value;
            const gratitude = gratitudeInput.value.trim();
            const date = new Date().toLocaleDateString(selectedLanguage === 'ta' ? 'ta-IN' : 'en-US');

            if (mood && gratitude) {
                const entry = { date, mood, gratitude };
                currentJournalEntries.push(entry);
                localStorage.setItem('journalEntries', JSON.stringify(currentJournalEntries));
                displayJournalEntries();
                moodSelect.value = '';
                gratitudeInput.value = '';
                journalEntriesOutput.innerHTML += `<p class="text-green-600">${translations[selectedLanguage].journalEntrySaved}</p>`;
            } else {
                alert(translations[selectedLanguage].fillAllFields || "Please select a mood and write something you're grateful for.");
            }
        }

        function displayJournalEntries() {
            journalEntriesOutput.innerHTML = '';
            if (currentJournalEntries.length === 0) {
                journalEntriesOutput.innerHTML = `<p>${translations[selectedLanguage].noJournalEntries}</p>`;
                return;
            }

            currentJournalEntries.forEach(entry => {
                let moodText = '';
                switch(entry.mood) {
                    case 'happy': moodText = translations[selectedLanguage].moodHappy; break;
                    case 'neutral': moodText = translations[selectedLanguage].moodNeutral; break;
                    case 'sad': moodText = translations[selectedLanguage].moodSad; break;
                    case 'stressed': moodText = translations[selectedLanguage].moodStressed; break;
                    case 'energetic': moodText = translations[selectedLanguage].moodEnergetic; break;
                    default: moodText = entry.mood;
                }
                journalEntriesOutput.innerHTML += translations[selectedLanguage].journalDisplayFormat
                    .replace('{date}', entry.date)
                    .replace('{mood}', moodText)
                    .replace('{gratitude}', entry.gratitude);
            });
        }

        saveJournalEntryBtn.addEventListener('click', saveJournalEntry);


        // Local & Traditional Wellness Tips Logic
        function updateLocalTipSuggestions() {
            const inputVal = localTipCategory.value.toLowerCase();
            localTipCategoryDropdown.innerHTML = '';
            localTipCategoryDropdown.classList.add('hidden');

            const suggestions = localTipSuggestions[selectedLanguage].filter(tip =>
                tip.toLowerCase().includes(inputVal)
            );

            if (inputVal && suggestions.length > 0) {
                suggestions.forEach(suggestion => {
                    const div = document.createElement('div');
                    div.textContent = suggestion;
                    div.addEventListener('click', () => {
                        localTipCategory.value = suggestion;
                        localTipCategoryDropdown.classList.add('hidden');
                    });
                    localTipCategoryDropdown.appendChild(div);
                });
                localTipCategoryDropdown.classList.remove('hidden');
            }
        }

        localTipCategory.addEventListener('input', updateLocalTipSuggestions);
        localTipCategory.addEventListener('focus', updateLocalTipSuggestions);
        localTipCategory.addEventListener('blur', () => {
            // Delay hiding to allow click event on dropdown
            setTimeout(() => {
                localTipCategoryDropdown.classList.add('hidden');
            }, 200);
        });

        getLocalTipBtn.addEventListener('click', () => {
            const category = localTipCategory.value.trim();
            if (category) {
                fetchAIResponse('/.netlify/functions/get-local-tip', { category, language: selectedLanguage });
            } else {
                localTipOutput.innerHTML = `<p class="text-red-600">${translations[selectedLanguage].localTipOutputDefault}</p>`;
            }
        });


        // NEW FEATURE EVENT LISTENERS

        // Meal Plan
        generateMealPlanBtn.addEventListener('click', () => {
            const dietGoal = dietGoalInput.value.trim();
            const dietPreference = dietPreferenceSelect.value;
            const allergies = allergiesInput.value.trim();

            if (dietGoal && dietPreference) {
                fetchAIResponse('/.netlify/functions/generate-meal-plan', { dietGoal, dietPreference, allergies, language: selectedLanguage });
            } else {
                mealPlanOutput.innerHTML = `<p class="text-red-600">${translations[selectedLanguage].noMealPlanInput}</p>`;
            }
        });

        // Mood Analysis
        analyzeMoodJournalBtn.addEventListener('click', () => {
            if (currentJournalEntries.length > 0) {
                fetchAIResponse('/.netlify/functions/analyze-mood', { journalEntries: currentJournalEntries, language: selectedLanguage });
            } else {
                moodAnalysisOutput.innerHTML = `<p class="text-red-600">${translations[selectedLanguage].noJournalEntriesForAnalysis}</p>`;
            }
        });

        // Exercise & Yoga
        generateExerciseRoutineBtn.addEventListener('click', () => {
            const fitnessLevel = fitnessLevelSelect.value;
            const timeAvailable = timeAvailableInput.value.trim();
            const exerciseGoal = exerciseGoalInput.value.trim();

            if (fitnessLevel && timeAvailable && exerciseGoal) {
                fetchAIResponse('/.netlify/functions/generate-exercise-routine', { fitnessLevel, timeAvailable, exerciseGoal, language: selectedLanguage });
            } else {
                exerciseRoutineOutput.innerHTML = `<p class="text-red-600">${translations[selectedLanguage].noExerciseRoutineInput}</p>`;
            }
        });

        // Disease Prevention
        getRemedyBtn.addEventListener('click', () => {
            const healthConcern = healthConcernInput.value.trim();
            if (healthConcern) {
                fetchAIResponse('/.netlify/functions/get-remedy', { healthConcern, language: selectedLanguage });
            } else {
                remedyOutput.innerHTML = `<p class="text-red-600">${translations[selectedLanguage].remedyOutputDefault}</p>`;
            }
        });

        // Wellness Challenges
        generateChallengeBtn.addEventListener('click', () => {
            const currentHabit = currentHabitInput.value.trim();
            const challengeGoal = challengeGoalInput.value.trim();

            if (currentHabit && challengeGoal) {
                fetchAIResponse('/.netlify/functions/generate-challenge', { currentHabit, challengeGoal, language: selectedLanguage });
            } else {
                challengeOutput.innerHTML = `<p class="text-red-600">${translations[selectedLanguage].noChallengeInput}</p>`;
            }
        });


        // --- Event Listeners ---
        generateBtn.addEventListener('click', () => {
            const goal = goalInput.value.trim();
            if (goal) {
                fetchAIResponse('/.netlify/functions/generate-tip', { goal, language: selectedLanguage });
            } else {
                tipOutput.innerHTML = `<p class="text-red-600">${translations[selectedLanguage].tipOutputDefault}</p>`;
            }
        });

        languageSelect.addEventListener('change', (event) => {
            selectedLanguage = event.target.value;
            updateContent();
            populateVoiceList(); // Update TTS voices for new language
        });

        // Feature Icon Click Handlers
        iconStepTracker.addEventListener('click', () => showFeatureSection('stepTrackerSection'));
        iconHeartRateTracker.addEventListener('click', () => showFeatureSection('heartRateTrackerSection'));
        iconWaterTracker.addEventListener('click', () => showFeatureSection('waterTrackerSection'));
        iconJournal.addEventListener('click', () => showFeatureSection('journalSection'));
        iconLocalTips.addEventListener('click', () => showFeatureSection('localTipsSection'));
        iconMealPlan.addEventListener('click', () => showFeatureSection('mealPlanSection'));
        iconMoodAnalysis.addEventListener('click', () => showFeatureSection('moodAnalysisSection'));
        iconExerciseYoga.addEventListener('click', () => showFeatureSection('exerciseYogaSection'));
        iconDiseasePrevention.addEventListener('click', () => showFeatureSection('diseasePreventionSection'));
        iconWellnessChallenge.addEventListener('click', () => showFeatureSection('wellnessChallengeSection'));


        // --- Initial Load ---
        window.addEventListener('load', () => {
            setTimeout(() => {
                splashScreen.classList.add('fade-out');
                splashScreen.addEventListener('transitionend', () => {
                    splashScreen.style.display = 'none';
                    mainContent.style.display = 'block';
                    document.body.classList.add('main-content-active'); // Add class after splash screen
                }, { once: true });
            }, 2000); // Show splash screen for 2 seconds

            updateContent();
            populateVoiceList();
            // Load journal entries from localStorage
            const storedEntries = localStorage.getItem('journalEntries');
            if (storedEntries) {
                currentJournalEntries = JSON.parse(storedEntries);
            }
            displayJournalEntries(); // Display loaded entries
            updateStepsDisplay(); // Initialize step display
            updateWaterDisplay(); // Initialize water display
        });

    </script>
</body>
</html>
