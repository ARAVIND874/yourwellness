<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ஆரோக்கிய நண்பன் - உங்கள் ஆரோக்கிய வழிகாட்டி</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #E6F7FF; /* Light Blue */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1.5rem;
            color: #333333;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            box-sizing: border-box;
            transition: all 0.5s ease-in-out;
            overflow-y: auto; /* Allow scrolling for features */
        }

        .container {
            max-width: 640px;
            width: 100%;
            background-color: #ffffff;
            border-radius: 1.75rem;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08);
            padding: 2.5rem;
            text-align: center;
            position: relative;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .language-selector-wrapper {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
        }
        .input-wrapper {
            position: relative;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
        }
        .input-field {
            flex-grow: 1;
            padding: 1rem 1.25rem;
            padding-right: 3.5rem; /* Space for mic icon */
            border: 1px solid #D1D5DB;
            border-radius: 0.875rem;
            font-size: 1.05rem;
            box-sizing: border-box;
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .input-field:focus {
            border-color: #87CEEB;
            box-shadow: 0 0 0 3px rgba(135, 206, 235, 0.4);
        }
        .mic-button {
            position: absolute;
            right: 1rem;
            background: none;
            border: none;
            color: #0000FF;
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            transition: color 0.3s ease, background-color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        .mic-button:hover {
            color: #DC2626; /* Red */
            background-color: rgba(220, 38, 38, 0.1);
        }
        .mic-button.recording {
            color: #DC2626; /* Red */
            animation: pulse 1s infinite alternate;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.1); opacity: 0.7; }
        }

        .generate-button, .action-button, .ai-voice-button, .back-to-main-button {
            background-color: #6A0DAD; /* Dark Violet */
            color: #ffffff;
            padding: 1rem 2rem;
            border-radius: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease;
            box-shadow: 0 6px 15px rgba(106, 13, 173, 0.4);
            letter-spacing: 0.025em;
            margin-top: 1rem;
            border: none;
            display: inline-flex; /* Ensure flex behavior for centering icon/text */
            align-items: center;
            justify-content: center;
            gap: 0.5rem; /* Space between icon and text */
        }
        .generate-button:hover, .action-button:hover, .ai-voice-button:hover, .back-to-main-button:hover {
            background-color: #4B0A7B; /* Darker Violet */
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(106, 13, 173, 0.5);
        }
        .generate-button:active, .action-button:active, .ai-voice-button:active, .back-to-main-button:active {
            transform: translateY(0);
            box-shadow: 0 4px 10px rgba(106, 13, 173, 0.3);
        }
        .loading-indicator {
            display: none;
            margin-top: 2rem;
            font-size: 1.15rem;
            color: #6B7280;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #6A0DAD;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .tip-box, .result-box { /* Unified style for all output boxes */
            background-color: #FFFFAA; /* Light Yellow */
            border: 1px solid #CCCC88; /* Darker Yellow */
            border-radius: 1.25rem;
            padding: 2rem;
            margin-top: 2rem;
            text-align: left;
            color: #333333;
            line-height: 1.7;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
            font-size: 1.05rem;
            transition: all 0.5s ease-in-out;
            word-break: break-word; /* Ensure long words break */
        }
        .tip-box p, .result-box p {
            margin: 0;
        }
        .text-red-600 {
            color: #DC2626; /* Red */
        }
        /* Responsive adjustments */
        @media (max-width: 640px) {
            body {
                padding: 1rem;
            }
            .container {
                padding: 1.5rem;
                border-radius: 1.25rem;
            }
            .generate-button, .action-button, .ai-voice-button, .back-to-main-button {
                width: 100%;
                padding: 0.9rem 1.5rem;
            }
            .language-selector-wrapper {
                top: 0.75rem;
                right: 0.75rem;
            }
            .input-wrapper {
                flex-direction: row;
                justify-content: center;
            }
            .mic-button {
                position: absolute;
                right: 0.5rem;
            }
        }
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #E6F7FF;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 1;
            transition: opacity 1s ease-out;
            overflow: hidden;
        }
        .splash-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }
        .splash-screen img {
            max-width: 25%;
            max-height: 25%;
            object-fit: contain;
        }

        /* Feature Button for Main Page */
        .features-toggle-button {
            font-size: 4rem; /* Even larger emoji size for the main toggle */
            cursor: pointer;
            padding: 1rem;
            border-radius: 1rem;
            transition: transform 0.3s ease, background-color 0.3s ease;
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            line-height: 1;
            margin-top: 2rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            background-color: #e0f2fe; /* Light blue background */
        }
        .features-toggle-button:hover {
            transform: scale(1.05);
            background-color: #bee3f8; /* Slightly darker blue hover */
        }
        .features-toggle-button span.label {
            font-size: 1rem;
            margin-top: 0.75rem;
            color: #333;
            font-weight: 600;
        }

        /* Feature Icons and Sections */
        .feature-icon-container {
            display: flex;
            justify-content: center;
            gap: 1.5rem; /* Space between icons */
            margin-top: 2rem;
            flex-wrap: wrap; /* Allow icons to wrap on smaller screens */
        }
        .feature-icon {
            font-size: 3rem; /* Larger emoji size */
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.75rem;
            transition: transform 0.2s ease, background-color 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            line-height: 1;
        }
        .feature-icon:hover {
            transform: translateY(-5px);
            background-color: rgba(135, 206, 235, 0.1); /* Light blue hover */
        }
        .feature-icon span.label {
            font-size: 0.8rem; /* Smaller text label */
            margin-top: 0.5rem;
            color: #555;
            font-weight: 500;
        }

        /* Feature sections (initially hidden, shown by JS) */
        .feature-section {
            display: none;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e5e7eb; /* Subtle separator */
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Specific feature section styles */
        .dropdown-menu {
            position: absolute;
            background-color: white;
            border: 1px solid #D1D5DB;
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            text-align: left;
            padding: 0.5rem 0;
            top: calc(100% + 5px); /* Position below input */
            left: 0;
        }
        .dropdown-menu div {
            padding: 0.75rem 1.25rem;
            cursor: pointer;
        }
        .dropdown-menu div:hover {
            background-color: #F3F4F6;
        }
        .dropdown-menu div.selected {
            background-color: #e0f2fe; /* light blue */
            font-weight: 500;
        }
        
        .tts-voice-selector {
            padding: 0.75rem;
            border: 1px solid #D1D5DB;
            border-radius: 0.875rem;
            font-size: 0.95rem;
            background-color: white;
            margin-left: 1rem;
            flex-grow: 1;
        }
        .body-map-container {
            position: relative;
            width: 100%;
            max-width: 300px; /* Adjust as needed */
            margin: 0 auto;
            border: 1px solid #ccc;
            border-radius: 10px;
            overflow: hidden;
        }
        .body-map-image {
            width: 100%;
            height: auto;
            display: block;
        }
        .pain-dot {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: red;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
            transform: translate(-50%, -50%); /* Center the dot on the click */
        }
        .pain-dot.selected {
            background-color: darkred;
            border: 2px solid yellow;
        }
        /* Hide all feature sections by default */
        .feature-section {
            display: none;
        }
        /* Show the main view or a specific section */
        #initialView, #allFeatureIconsContainer.active, .feature-section.active {
            display: block;
        }
        .back-button {
            background: none;
            border: none;
            color: #6A0DAD;
            font-weight: 600;
            cursor: pointer;
            padding: 0.5rem 0;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            font-size: 1rem;
            transition: color 0.3s ease;
        }
        .back-button:hover {
            color: #4B0A7B;
        }
    </style>
</head>
<body>
    <div id="splashScreen" class="splash-screen">
        <img src="healthcare.png" alt="Healthcare related image">
    </div>

    <div class="container" id="mainContent" style="display: none;">
        <div class="language-selector-wrapper">
            <select id="languageSelect" aria-label="Select Language" class="p-2 border border-gray-300 rounded-md text-sm bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-300">
                <option value="ta">தமிழ்</option>
                <option value="en">English</option>
            </select>
        </div>

        <div id="initialView">
            <h1 id="mainTitle" class="text-3xl font-bold text-gray-800 mb-4 lg:text-4xl"></h1>
            <p id="descriptionText" class="text-gray-600 mb-8 text-lg"></p>

            <h2 id="tipSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <div class="input-wrapper">
                <input type="text" id="goalInput" class="input-field" aria-label="உங்கள் ஆரோக்கிய இலக்கை உள்ளிடவும்">
                <button id="micBtn" class="mic-button" title="உங்கள் இலக்கைப் பேசுங்கள்" aria-label="உங்கள் ஆரோக்கிய இலக்கைப் பதிவு செய்யவும்">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" x2="12" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                    </svg>
                </button>
            </div>
            <div class="flex flex-wrap justify-center gap-4 mt-4">
                <button id="generateBtn" class="generate-button"></button>
                <button id="aiVoiceBtn" class="ai-voice-button" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg>
                </button>
                <select id="ttsVoiceSelect" class="tts-voice-selector" style="display: none;" aria-label="Select Voice"></select>
            </div>
            <div id="loading" class="loading-indicator" aria-live="polite">
                <div class="loading-spinner"></div>
                <p id="loadingText"></p>
            </div>
            <div id="tipOutput" class="tip-box" aria-live="polite"></div>

            <hr class="border-t border-gray-300 my-8">

            <h2 id="featuresTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <button id="toggleFeaturesBtn" class="features-toggle-button" title="அனைத்து அம்சங்களையும் காண்க">
                ✨<span class="label" data-label-key="showFeaturesLabel"></span>
            </button>
        </div>

        <div id="featuresListView" style="display: none;">
            <button class="back-to-main-button" id="backToMainFromFeaturesList">← பின்செல்</button>
            <h1 id="featuresPageTitle" class="text-3xl font-bold text-gray-800 mb-6 mt-4 lg:text-4xl"></h1>
            <div id="allFeatureIconsContainer" class="feature-icon-container">
                <div id="iconStepTracker" class="feature-icon" data-section="stepTrackerSection" title="படி டிராக்கர்">👟<span class="label" data-label-key="stepTrackerLabel"></span></div>
                <div id="iconHeartRateTracker" class="feature-icon" data-section="heartRateTrackerSection" title="இதயத் துடிப்பு டிராக்கர்">💓<span class="label" data-label-key="heartRateTrackerLabel"></span></div>
                <div id="iconWaterTracker" class="feature-icon" data-section="waterTrackerSection" title="தண்ணீர் டிராக்கர்">💧<span class="label" data-label-key="waterTrackerLabel"></span></div>
                <div id="iconJournal" class="feature-icon" data-section="journalSection" title="மனநிலை & நன்றியுணர்வு ஜர்னல்">📝<span class="label" data-label-key="journalLabel"></span></div>
                <div id="iconLocalTips" class="feature-icon" data-section="localTipsSection" title="உள்ளூர் ஆரோக்கிய குறிப்புகள்">🌱<span class="label" data-label-key="localTipsLabel"></span></div>
                <div id="iconMealPlan" class="feature-icon" data-section="mealPlanSection" title="உணவுத் திட்டப் பரிந்துரைகள்">🍽️<span class="label" data-label-key="mealPlanLabel"></span></div>
                <div id="iconMoodAnalysis" class="feature-icon" data-section="moodAnalysisSection" title="உணர்வுப் பதிவேடு பகுப்பாய்வு">🧠<span class="label" data-label-key="moodAnalysisLabel"></span></div>
                <div id="iconExerciseYoga" class="feature-icon" data-section="exerciseYogaSection" title="உடற்பயிற்சி & யோகா">🤸‍♀️<span class="label" data-label-key="exerciseYogaLabel"></span></div>
                <div id="iconDiseasePrevention" class="feature-icon" data-section="diseasePreventionSection" title="நோய் தடுப்பு">🛡️<span class="label" data-label-key="diseasePreventionLabel"></span></div>
                <div id="iconWellnessChallenge" class="feature-icon" data-section="wellnessChallengeSection" title="ஆரோக்கிய சவால்கள்">🏅<span class="label" data-label-key="wellnessChallengeLabel"></span></div>
                <div id="iconMedicationReminder" class="feature-icon" data-section="medicationReminderSection" title="மருந்து நினைவூட்டல்">⏰<span class="label" data-label-key="medicationReminderLabel"></span></div>
                <div id="iconBodyPainMapping" class="feature-icon" data-section="bodyPainMappingSection" title="உடல் வலி மேப்பிங்">📍<span class="label" data-label-key="bodyPainMappingLabel"></span></div>
                <div id="iconFirstAidEmergency" class="feature-icon" data-section="firstAidEmergencySection" title="முதலுதவி & அவசர உதவி">🆘<span class="label" data-label-key="firstAidEmergencyLabel"></span></div>
            </div>
        </div>

        <div id="stepTrackerSection" class="feature-section">
            <button class="back-to-main-button" data-target="featuresListView">← பின்செல்</button>
            <h2 id="stepSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
            <div class="input-wrapper">
                <label for="currentStepsDisplay" class="sr-only">தற்போதைய படிகள்</label>
                <input type="text" id="currentStepsDisplay" class="input-field" value="0" readonly aria-atomic="true">
            </div>
            <div class="flex flex-wrap justify-center gap-4 mt-4">
                <button id="addOneStepBtn" class="action-button"></button>
                <button id="toggleTrackingBtn" class="action-button"></button>
                <button id="resetStepsBtn" class="action-button"></button>
            </div>
            <div id="stepResultOutput" class="result-box" aria-live="polite"></div>
        </div>

        <div id="heartRateTrackerSection" class="feature-section">
            <button class="back-to-main-button" data-target="featuresListView">← பின்செல்</button>
            <h2 id="heartRateSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
            <div class="input-wrapper">
                <label for="currentHeartRateDisplay" class="sr-only">தற்போதைய இதயத் துடிப்பு</label>
                <input type="text" id="currentHeartRateDisplay" class="input-field" value="0" readonly aria-atomic="true">
            </div>
            <div class="flex flex-wrap justify-center gap-4 mt-4">
                <button id="simulateHeartRateBtn" class="action-button"></button>
                <button id="resetHeartRateBtn" class="action-button"></button>
            </div>
            <div id="heartRateResultOutput" class="result-box" aria-live="polite"></div>
        </div>

        <div id="waterTrackerSection" class="feature-section">
            <button class="back-to-main-button" data-target="featuresListView">← பின்செல்</button>
            <h2 id="waterSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
            <div class="input-wrapper">
                <label for="waterIntakeDisplay" class="sr-only">தற்போதைய தண்ணீர் உட்கொள்ளல்</label>
                <input type="text" id="waterIntakeDisplay" class="input-field" value="0 ml" readonly aria-atomic="true">
            </div>
            <div class="flex flex-wrap justify-center gap-4 mt-4">
                <button id="addWaterBtn" class="action-button"></button>
                <button id="resetWaterBtn" class="action-button"></button>
            </div>
            <div id="waterResultOutput" class="result-box" aria-live="polite"></div>
        </div>

        <div id="journalSection" class="feature-section">
            <button class="back-to-main-button" data-target="featuresListView">← பின்செல்</button>
            <h2 id="journalSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
            <p id="journalDescription" class="text-gray-600 mb-4 text-lg"></p>
            <div class="input-wrapper flex-col items-stretch">
                <label for="moodSelect" class="sr-only">உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்</label>
                <select id="moodSelect" class="input-field mb-4" aria-label="உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்">
                    <option value="">உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்</option>
                    <option value="happy">மகிழ்ச்சி 😄</option>
                    <option value="neutral">சாதாரணம் 😐</option>
                    <option value="sad">சோகம் 😔</option>
                    <option value="stressed">மன அழுத்தம் 😩</option>
                    <option value="energetic">ஆற்றல் 💪</option>
                </select>
                <label for="gratitudeInput" class="sr-only">நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்</label>
                <textarea id="gratitudeInput" class="input-field min-h-[100px]" placeholder="நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்..." aria-label="நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்"></textarea>
            </div>
            <button id="saveJournalEntryBtn" class="action-button mt-4"></button>
            <div id="journalEntriesOutput" class="result-box mt-4 text-left"></div>
        </div>

        <div id="localTipsSection" class="feature-section">
            <button class="back-to-main-button" data-target="featuresListView">← பின்செல்</button>
            <h2 id="localTipsSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
            <p id="localTipsDescription" class="text-gray-600 mb-4 text-lg"></p>
            <div class="input-wrapper mb-4">
                <input type="text" id="localTipCategory" class="input-field" aria-label="உதவிக்குறிப்பு வகையை உள்ளிடவும்" placeholder="எ.கா. மஞ்சள், முருங்கை, தியானம்...">
                <div id="localTipCategoryDropdown" class="dropdown-menu hidden mt-2 top-full left-0"></div>
            </div>
            <button id="getLocalTipBtn" class="generate-button"></button>
            <div id="localTipOutput" class="tip-box" aria-live="polite"></div>
        </div>

        <div id="mealPlanSection" class="feature-section">
            <button class="back-to-main-button" data-target="featuresListView">← பின்செல்</button>
            <h2 id="mealPlanSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
            <p id="mealPlanDescription" class="text-gray-600 mb-4 text-lg"></p>
            <div class="input-wrapper flex-col items-stretch">
                <label for="dietGoalInput" class="sr-only">உணவு இலக்கு</label>
                <input type="text" id="dietGoalInput" class="input-field mb-4" placeholder="எ.கா. எடை குறைப்பு, தசை வளர்ச்சி..." aria-label="உணவு இலக்கு">

                <label for="dietPreferenceSelect" class="sr-only">உணவு விருப்பம்</label>
                <select id="dietPreferenceSelect" class="input-field mb-4" aria-label="உணவு விருப்பம்">
                    <option value="">உணவு விருப்பத்தைத் தேர்ந்தெடுக்கவும்</option>
                    <option value="vegetarian">சைவம்</option>
                    <option value="non-vegetarian">அசைவம்</option>
                    <option value="vegan">முழு சைவம்</option>
                </select>

                <label for="allergiesInput" class="sr-only">ஒவ்வாமைகள் (இருப்பின்)</label>
                <input type="text" id="allergiesInput" class="input-field mb-4" placeholder="எ.கா. நிலக்கடலை, பால்..." aria-label="ஒவ்வாமைகள்">
            </div>
            <button id="generateMealPlanBtn" class="action-button mt-4"></button>
            <div id="mealPlanOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
        </div>

        <div id="moodAnalysisSection" class="feature-section">
            <button class="back-to-main-button" data-target="featuresListView">← பின்செல்</button>
            <h2 id="moodAnalysisSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
            <p id="moodAnalysisDescription" class="text-gray-600 mb-4 text-lg"></p>
            <button id="analyzeMoodJournalBtn" class="action-button mt-4"></button>
            <div id="moodAnalysisOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
        </div>

        <div id="exerciseYogaSection" class="feature-section">
            <button class="back-to-main-button" data-target="featuresListView">← பின்செல்</button>
            <h2 id="exerciseYogaSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
            <p id="exerciseYogaDescription" class="text-gray-600 mb-4 text-lg"></p>
            <div class="input-wrapper flex-col items-stretch">
                <label for="fitnessLevelSelect" class="sr-only">உடற்பயிற்சி நிலை</label>
                <select id="fitnessLevelSelect" class="input-field mb-4" aria-label="உடற்பயிற்சி நிலை">
                    <option value="">உடற்பயிற்சி நிலையைத் தேர்ந்தெடுக்கவும்</option>
                    <option value="beginner">ஆரம்பநிலை</option>
                    <option value="intermediate">நடுநிலை</option>
                    <option value="advanced">மேம்பட்டது</option>
                </select>

                <label for="timeAvailableInput" class="sr-only">கிடைக்கக்கூடிய நேரம் (நிமிடங்கள்)</label>
                <input type="number" id="timeAvailableInput" class="input-field mb-4" placeholder="கிடைக்கக்கூடிய நேரம் (நிமிடங்கள்)..." aria-label="கிடைக்கக்கூடிய நேரம்">

                <label for="exerciseGoalInput" class="sr-only">உடற்பயிற்சி இலக்கு</label>
                <input type="text" id="exerciseGoalInput" class="input-field mb-4" placeholder="எ.கா. உடல் நெகிழ்வுத்தன்மை, தசைகளை உருவாக்குதல்..." aria-label="உடற்பயிற்சி இலக்கு">
            </div>
            <button id="generateExerciseRoutineBtn" class="action-button mt-4"></button>
            <div id="exerciseRoutineOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
        </div>

        <div id="diseasePreventionSection" class="feature-section">
            <button class="back-to-main-button" data-target="featuresListView">← பின்செல்</button>
            <h2 id="diseasePreventionSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
            <p id="diseasePreventionDescription" class="text-gray-600 mb-4 text-lg"></p>
            <div class="input-wrapper mb-4">
                <input type="text" id="healthConcernInput" class="input-field" aria-label="உடல்நலக் கவலையை உள்ளிடவும்" placeholder="எ.கா. ஜலதோஷம், செரிமானப் பிரச்சனை...">
            </div>
            <button id="getRemedyBtn" class="generate-button"></button>
            <div id="remedyOutput" class="tip-box" aria-live="polite"></div>
        </div>

        <div id="wellnessChallengeSection" class="feature-section">
            <button class="back-to-main-button" data-target="featuresListView">← பின்செல்</button>
            <h2 id="wellnessChallengeSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
            <p id="wellnessChallengeDescription" class="text-gray-600 mb-4 text-lg"></p>
            <div class="input-wrapper flex-col items-stretch">
                <label for="currentHabitInput" class="sr-only">தற்போதைய பழக்கம் (எ.கா. நீர் உட்கொள்ளல்)</label>
                <input type="text" id="currentHabitInput" class="input-field mb-4" placeholder="உங்கள் தற்போதைய பழக்கம் (எ.கா. 1000ml தண்ணீர்)..." aria-label="தற்போதைய பழக்கம்">
                
                <label for="challengeGoalInput" class="sr-only">சவால் இலக்கு (எ.கா. 2000ml தண்ணீர்)</label>
                <input type="text" id="challengeGoalInput" class="input-field mb-4" placeholder="உங்கள் சவால் இலக்கு (எ.கா. 2000ml தண்ணீர்)..." aria-label="சவால் இலக்கு">
            </div>
            <button id="generateChallengeBtn" class="action-button mt-4"></button>
            <div id="challengeOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
        </div>

        <div id="medicationReminderSection" class="feature-section">
            <button class="back-to-main-button" data-target="featuresListView">← பின்செல்</button>
            <h2 id="medicationReminderSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
            <p id="medicationReminderDescription" class="text-gray-600 mb-4 text-lg"></p>
            <div class="input-wrapper flex-col items-stretch">
                <label for="medicationNameInput" class="sr-only">மருந்தின் பெயர்</label>
                <input type="text" id="medicationNameInput" class="input-field mb-4" placeholder="மருந்தின் பெயர்..." aria-label="மருந்தின் பெயர்">
                
                <label for="medicationTimeInput" class="sr-only">நேரம் (எ.கா., 08:00 AM)</label>
                <input type="time" id="medicationTimeInput" class="input-field mb-4" aria-label="நேரம் (எ.கா., 08:00 AM)">

                <label for="medicationFrequencySelect" class="sr-only">எத்தனை முறை</label>
                <select id="medicationFrequencySelect" class="input-field mb-4" aria-label="எத்தனை முறை">
                    <option value="">எத்தனை முறை...</option>
                    <option value="daily">தினமும்</option>
                    <option value="weekly">வாராந்திரம்</option>
                    <option value="monthly">மாதாந்திரம்</option>
                </select>
            </div>
            <button id="addMedicationReminderBtn" class="action-button mt-4"></button>
            <div id="medicationRemindersList" class="result-box mt-4 text-left">
                </div>
        </div>

        <div id="bodyPainMappingSection" class="feature-section">
            <button class="back-to-main-button" data-target="featuresListView">← பின்செல்</button>
            <h2 id="bodyPainMappingSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
            <p id="bodyPainMappingDescription" class="text-gray-600 mb-4 text-lg"></p>
            <div class="body-map-container">
                <img id="bodyMapImage" src="human_body.png" alt="மனித உடல் வரைபடம்" class="body-map-image">
                </div>
            <div class="input-wrapper flex-col items-stretch mt-4">
                <label for="painDescriptionInput" class="sr-only">வலி விளக்கம்</label>
                <textarea id="painDescriptionInput" class="input-field min-h-[80px] mb-4" placeholder="வலியின் விளக்கம் (எ.கா., கூர்மையான வலி, துடிக்கும் வலி)..." aria-label="வலியின் விளக்கம்"></textarea>
                
                <label for="painLevelSelect" class="sr-only">வலியின் தீவிரம் (1-10)</label>
                <input type="number" id="painLevelSelect" class="input-field mb-4" min="1" max="10" placeholder="வலியின் தீவிரம் (1-10)" aria-label="வலியின் தீவிரம்">
            </div>
            <button id="savePainEntryBtn" class="action-button mt-4"></button>
            <div id="painEntriesOutput" class="result-box mt-4 text-left">
                </div>
        </div>

        <div id="firstAidEmergencySection" class="feature-section">
            <button class="back-to-main-button" data-target="featuresListView">← பின்செல்</button>
            <h2 id="firstAidEmergencySectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
            <p id="firstAidEmergencyDescription" class="text-gray-600 mb-4 text-lg"></p>

            <div class="flex flex-col gap-3 mb-6">
                <button class="action-button text-left" data-emergency-type="cut" id="firstAidCutBtn">
                    <span id="firstAidCutLabel">வெட்டுக்காயங்கள்</span>
                </button>
                <button class="action-button text-left" data-emergency-type="burn" id="firstAidBurnBtn">
                    <span id="firstAidBurnLabel">தீக்காயங்கள்</span>
                </button>
                <button class="action-button text-left" data-emergency-type="choking" id="firstAidChokingBtn">
                    <span id="firstAidChokingLabel">மூச்சுத்திணறல்</span>
                </button>
                <button class="action-button text-left" data-emergency-type="heart_attack" id="firstAidHeartAttackBtn">
                    <span id="firstAidHeartAttackLabel">மாரடைப்பு</span>
                </button>
                </div>

            <h3 id="emergencyNumbersTitle" class="text-xl font-semibold text-gray-700 mb-3"></h3>
            <div class="flex flex-col gap-3">
                <button class="action-button bg-red-600 hover:bg-red-700" id="callAmbulanceBtn">
                    <span id="callAmbulanceLabel">ஆம்புலன்ஸ் (108)</span>
                </button>
                <button class="action-button bg-blue-600 hover:bg-blue-700" id="callPoliceBtn">
                    <span id="callPoliceLabel">காவல்துறை (100)</span>
                </button>
                </div>

            <h3 id="nearbyHospitalsTitle" class="text-xl font-semibold text-gray-700 mt-6 mb-3"></h3>
            <button id="findHospitalsBtn" class="action-button mb-4"></button>
            <div id="hospitalsMap" class="w-full h-64 bg-gray-200 rounded-lg flex items-center justify-center text-gray-500">
                </div>

            <div id="firstAidOutput" class="result-box mt-6 text-left" aria-live="polite"></div>
        </div>

    </div>
    <script>
        // --- Configuration ---
        // IMPORTANT: The Gemini API Key is now handled securely via Netlify Functions.
        // The frontend will call '/.netlify/functions/generate-tip' which handles the key.

        // --- HTML Element References ---
        const goalInput = document.getElementById('goalInput');
        const generateBtn = document.getElementById('generateBtn');
        const loadingIndicator = document.getElementById('loading');
        const loadingText = document.getElementById('loadingText');
        const tipOutput = document.getElementById('tipOutput');
        const languageSelect = document.getElementById('languageSelect');
        const mainTitle = document.getElementById('mainTitle');
        const descriptionText = document.getElementById('descriptionText');
        const tipSectionTitle = document.getElementById('tipSectionTitle');
        const featuresTitle = document.getElementById('featuresTitle');
        const splashScreen = document.getElementById('splashScreen');
        const mainContent = document.getElementById('mainContent');
        const micBtn = document.getElementById('micBtn');
        const aiVoiceBtn = document.getElementById('aiVoiceBtn');
        const ttsVoiceSelect = document.getElementById('ttsVoiceSelect');
        const toggleFeaturesBtn = document.getElementById('toggleFeaturesBtn'); // New button for features
        const initialView = document.getElementById('initialView');
        const featuresListView = document.getElementById('featuresListView');
        const featuresPageTitle = document.getElementById('featuresPageTitle');
        const allFeatureIconsContainer = document.getElementById('allFeatureIconsContainer');
        const featureIcons = document.querySelectorAll('.feature-icon');
        const featureSections = document.querySelectorAll('.feature-section');
        const backToMainFromFeaturesList = document.getElementById('backToMainFromFeaturesList');
        const backToFeaturesListButtons = document.querySelectorAll('.feature-section .back-to-main-button'); // Back buttons within feature sections

        // Text content for different languages
        const translations = {
            'ta': {
                'mainTitle': 'ஆரோக்கிய நண்பன் - உங்கள் ஆரோக்கிய வழிகாட்டி',
                'descriptionText': 'உங்கள் ஆரோக்கிய இலக்குகளை அடைய உங்களுக்கு உதவும் ஒரு தனிப்பட்ட உதவியாளர். ஒரு குறிப்பை உருவாக்க உங்கள் இலக்கை உள்ளிடவும் அல்லது எங்கள் அம்சங்களை ஆராயவும்.',
                'tipSectionTitle': 'உங்கள் ஆரோக்கிய இலக்கை உள்ளிடவும்',
                'goalInputPlaceholder': 'எ.கா. தினமும் 10,000 படிகள் நடக்க...',
                'generateBtn': 'குறிப்பை உருவாக்கு',
                'loadingText': 'குறிப்பை உருவாக்குகிறோம்...',
                'featuresTitle': 'எங்கள் அம்சங்களை ஆராயுங்கள்',
                'showFeaturesLabel': 'அம்சங்களைக் காட்டு', // Label for the button to navigate to features section
                'aiVoiceBtn': 'AI குரலில் கேட்க',
                'ttsVoiceSelectDefault': 'குரலைத் தேர்ந்தெடுக்கவும்',
                'featuresPageTitle': 'அம்சங்கள்',
                'backButtonLabel': '← பின்செல்',
                'stepTrackerLabel': 'படி டிராக்கர்',
                'heartRateTrackerLabel': 'இதயத் துடிப்பு டிராக்கர்',
                'waterTrackerLabel': 'தண்ணீர் டிராக்கர்',
                'journalLabel': 'மனநிலை & நன்றியுணர்வு',
                'localTipsLabel': 'உள்ளூர் குறிப்புகள்',
                'mealPlanLabel': 'உணவுத் திட்டம்',
                'moodAnalysisLabel': 'உணர்வுப் பகுப்பாய்வு',
                'exerciseYogaLabel': 'உடற்பயிற்சி & யோகா',
                'diseasePreventionLabel': 'நோய் தடுப்பு',
                'wellnessChallengeLabel': 'சவால்கள்',
                'medicationReminderLabel': 'மருந்து நினைவூட்டல்',
                'bodyPainMappingLabel': 'உடல் வலி மேப்பிங்',
                'firstAidEmergencyLabel': 'முதலுதவி',

                // Feature specific titles and descriptions
                'stepSectionTitle': 'படி டிராக்கர்',
                'addOneStepBtn': 'ஒரு படி சேர்',
                'toggleTrackingBtn': 'டிராக்கிங்கை தொடங்கு/நிறுத்து',
                'resetStepsBtn': 'படிகளை மீட்டமை',
                'stepResultOutputDefault': 'இங்கு படி டிராக்கர் தகவல் தோன்றும்.',

                'heartRateSectionTitle': 'இதயத் துடிப்பு டிராக்கர்',
                'simulateHeartRateBtn': 'இதயத் துடிப்பை உருவகப்படுத்து',
                'resetHeartRateBtn': 'இதயத் துடிப்பை மீட்டமை',
                'heartRateResultOutputDefault': 'இங்கு இதயத் துடிப்பு தகவல் தோன்றும்.',

                'waterSectionTitle': 'தண்ணீர் உட்கொள்ளல் டிராக்கர்',
                'addWaterBtn': '250ml சேர்',
                'resetWaterBtn': 'தண்ணீரை மீட்டமை',
                'waterResultOutputDefault': 'இங்கு தண்ணீர் உட்கொள்ளல் தகவல் தோன்றும்.',

                'journalSectionTitle': 'மனநிலை & நன்றியுணர்வு ஜர்னல்',
                'journalDescription': 'உங்கள் மனநிலையைப் பதிவுசெய்து, நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்.',
                'moodSelectPlaceholder': 'உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்',
                'gratitudeInputPlaceholder': 'நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்...',
                'saveJournalEntryBtn': 'பதிவைச் சேமி',
                'journalEntriesOutputDefault': 'உங்கள் ஜர்னல் உள்ளீடுகள் இங்கு தோன்றும்.',

                'localTipsSectionTitle': 'உள்ளூர் ஆரோக்கிய குறிப்புகள்',
                'localTipsDescription': 'பாரம்பரிய தமிழ் ஆரோக்கிய குறிப்புகள் மற்றும் வீட்டு வைத்தியங்களைப் பெறுங்கள்.',
                'localTipCategoryPlaceholder': 'எ.கா. மஞ்சள், முருங்கை, தியானம்...',
                'getLocalTipBtn': 'உதவிக்குறிப்பைப் பெறு',
                'localTipOutputDefault': 'இங்கு உள்ளூர் ஆரோக்கிய குறிப்புகள் தோன்றும்.',
                'localTipSuggestions': ['மஞ்சள்', 'முருங்கை', 'நெல்லிக்காய்', 'வெந்தயம்', 'கற்றாழை', 'தியானம்', 'யோகா', 'பாரம்பரிய உணவு'],

                'mealPlanSectionTitle': 'தனிப்பயனாக்கப்பட்ட உணவுத் திட்டப் பரிந்துரைகள்',
                'mealPlanDescription': 'உங்கள் இலக்குகள் மற்றும் விருப்பங்களின் அடிப்படையில் உணவுத் திட்டத்தைப் பெறுங்கள்.',
                'dietGoalInputPlaceholder': 'எ.கா. எடை குறைப்பு, தசை வளர்ச்சி...',
                'dietPreferenceSelectDefault': 'உணவு விருப்பத்தைத் தேர்ந்தெடுக்கவும்',
                'allergiesInputPlaceholder': 'எ.கா. நிலக்கடலை, பால்...',
                'generateMealPlanBtn': 'உணவுத் திட்டத்தை உருவாக்கு',
                'mealPlanOutputDefault': 'உங்கள் உணவுத் திட்டம் இங்கு தோன்றும்.',

                'moodAnalysisSectionTitle': 'உணர்வுப் பதிவேடு பகுப்பாய்வு',
                'moodAnalysisDescription': 'உங்கள் ஜர்னல் உள்ளீடுகளின் அடிப்படையில் உங்கள் உணர்வுப் போக்குகளைப் பகுப்பாய்வு செய்யுங்கள்.',
                'analyzeMoodJournalBtn': 'உணர்வைப் பகுப்பாய்வு செய்',
                'moodAnalysisOutputDefault': 'உங்கள் மனநிலை பகுப்பாய்வு இங்கு தோன்றும்.',

                'exerciseYogaSectionTitle': 'தனிப்பயனாக்கப்பட்ட உடற்பயிற்சி & யோகா திட்டங்கள்',
                'exerciseYogaDescription': 'உங்கள் உடற்பயிற்சி நிலை மற்றும் இலக்குகளின் அடிப்படையில் ஒரு உடற்பயிற்சி வழக்கத்தைப் பெறுங்கள்.',
                'fitnessLevelSelectDefault': 'உடற்பயிற்சி நிலையைத் தேர்ந்தெடுக்கவும்',
                'timeAvailableInputPlaceholder': 'கிடைக்கக்கூடிய நேரம் (நிமிடங்கள்)...',
                'exerciseGoalInputPlaceholder': 'எ.கா. உடல் நெகிழ்வுத்தன்மை, தசைகளை உருவாக்குதல்...',
                'generateExerciseRoutineBtn': 'வழக்கத்தை உருவாக்கு',
                'exerciseRoutineOutputDefault': 'உங்கள் உடற்பயிற்சி வழக்கம் இங்கு தோன்றும்.',

                'diseasePreventionSectionTitle': 'பொதுவான நோய்களுக்கு நோய் தடுப்பு மற்றும் வீட்டு வைத்தியம்',
                'diseasePreventionDescription': 'பொதுவான நோய்களைத் தடுக்க அல்லது நிர்வகிக்க உதவும் பாரம்பரிய வைத்தியம் மற்றும் குறிப்புகளைக் கண்டறியவும்.',
                'healthConcernInputPlaceholder': 'எ.கா. ஜலதோஷம், செரிமானப் பிரச்சனை...',
                'getRemedyBtn': 'தீர்வைப் பெறு',
                'remedyOutputDefault': 'இங்கு நோய் தடுப்பு குறிப்புகள் தோன்றும்.',

                'wellnessChallengeSectionTitle': 'ஆரோக்கிய சவால்கள்',
                'wellnessChallengeDescription': 'உங்கள் ஆரோக்கியப் பழக்கங்களை மேம்படுத்த தனிப்பயனாக்கப்பட்ட சவால்களை உருவாக்கவும்.',
                'currentHabitInputPlaceholder': 'உங்கள் தற்போதைய பழக்கம் (எ.கா. நீர் உட்கொள்ளல்)...',
                'challengeGoalInputPlaceholder': 'உங்கள் சவால் இலக்கு (எ.கா. 2000ml தண்ணீர்)...',
                'generateChallengeBtn': 'சவாலை உருவாக்கு',
                'challengeOutputDefault': 'உங்கள் சவால் இங்கு தோன்றும்.',

                'medicationReminderSectionTitle': 'மருந்து நினைவூட்டல்',
                'medicationReminderDescription': 'உங்கள் மருந்துகளை சரியான நேரத்தில் எடுத்துக்கொள்ள நினைவூட்டல்களை அமைக்கவும்.',
                'medicationNameInputPlaceholder': 'மருந்தின் பெயர்...',
                'medicationTimeInputPlaceholder': 'நேரம் (எ.கா., 08:00 AM)',
                'medicationFrequencySelectDefault': 'எத்தனை முறை...',
                'addMedicationReminderBtn': 'நினைவூட்டலைச் சேர்',
                'medicationRemindersListDefault': 'உங்கள் மருந்து நினைவூட்டல்கள் இங்கு தோன்றும்.',

                'bodyPainMappingSectionTitle': 'உடல் வலி மேப்பிங்',
                'bodyPainMappingDescription': 'உங்கள் உடலில் வலி இருக்கும் பகுதியைக் குறியிட்டு, அதன் விவரங்களைப் பதிவு செய்யுங்கள்.',
                'painDescriptionInputPlaceholder': 'வலியின் விளக்கம் (எ.கா., கூர்மையான வலி, துடிக்கும் வலி)...',
                'painLevelSelectPlaceholder': 'வலியின் தீவிரம் (1-10)',
                'savePainEntryBtn': 'வலி பதிவைச் சேமி',
                'painEntriesOutputDefault': 'உங்கள் வலி பதிவுகள் இங்கு தோன்றும்.',

                'firstAidEmergencySectionTitle': 'முதலுதவி & அவசர உதவி',
                'firstAidEmergencyDescription': 'வெட்டுக்காயங்கள், தீக்காயங்கள், மூச்சுத்திணறல், மாரடைப்பு போன்ற பொதுவான அவசரநிலைகளுக்கான வழிகாட்டுதல்களைப் பெறுங்கள்.',
                'firstAidCutLabel': 'வெட்டுக்காயங்கள்',
                'firstAidBurnLabel': 'தீக்காயங்கள்',
                'firstAidChokingLabel': 'மூச்சுத்திணறல்',
                'firstAidHeartAttackLabel': 'மாரடைப்பு',
                'emergencyNumbersTitle': 'அவசர எண்கள்',
                'callAmbulanceLabel': 'ஆம்புலன்ஸ் (108)',
                'callPoliceLabel': 'காவல்துறை (100)',
                'nearbyHospitalsTitle': 'அருகிலுள்ள மருத்துவமனைகள்',
                'findHospitalsBtn': 'மருத்துவமனைகளைக் கண்டறி',
                'firstAidOutputDefault': 'முதலுதவி அல்லது அவசர உதவி தகவல் இங்கு தோன்றும்.',
            },
            'en': {
                'mainTitle': 'Aarogya Nanban - Your Wellness Buddy',
                'descriptionText': 'A personalized assistant to help you achieve your wellness goals. Enter a goal to generate a tip or explore our features.',
                'tipSectionTitle': 'Enter your Wellness Goal',
                'goalInputPlaceholder': 'e.g., Walk 10,000 steps daily...',
                'generateBtn': 'Generate Tip',
                'loadingText': 'Generating tip...',
                'featuresTitle': 'Explore Our Features',
                'showFeaturesLabel': 'Show Features', // Label for the button to navigate to features section
                'aiVoiceBtn': 'Listen in AI Voice',
                'ttsVoiceSelectDefault': 'Select Voice',
                'featuresPageTitle': 'Features',
                'backButtonLabel': '← Back',
                'stepTrackerLabel': 'Step Tracker',
                'heartRateTrackerLabel': 'Heart Rate',
                'waterTrackerLabel': 'Water Tracker',
                'journalLabel': 'Mood & Gratitude',
                'localTipsLabel': 'Local Tips',
                'mealPlanLabel': 'Meal Plan',
                'moodAnalysisLabel': 'Mood Analysis',
                'exerciseYogaLabel': 'Exercise & Yoga',
                'diseasePreventionLabel': 'Disease Prev.',
                'wellnessChallengeLabel': 'Challenges',
                'medicationReminderLabel': 'Medication',
                'bodyPainMappingLabel': 'Body Pain Map',
                'firstAidEmergencyLabel': 'First Aid',

                // Feature specific titles and descriptions
                'stepSectionTitle': 'Step Tracker',
                'addOneStepBtn': 'Add One Step',
                'toggleTrackingBtn': 'Start/Stop Tracking',
                'resetStepsBtn': 'Reset Steps',
                'stepResultOutputDefault': 'Step tracker information will appear here.',

                'heartRateSectionTitle': 'Heart Rate Tracker',
                'simulateHeartRateBtn': 'Simulate Heart Rate',
                'resetHeartRateBtn': 'Reset Heart Rate',
                'heartRateResultOutputDefault': 'Heart rate information will appear here.',

                'waterSectionTitle': 'Water Intake Tracker',
                'addWaterBtn': 'Add 250ml',
                'resetWaterBtn': 'Reset Water',
                'waterResultOutputDefault': 'Water intake information will appear here.',

                'journalSectionTitle': 'Mood & Gratitude Journal',
                'journalDescription': 'Log your mood and write down something you are grateful for.',
                'moodSelectPlaceholder': 'Select your mood',
                'gratitudeInputPlaceholder': 'Write something you are grateful for...',
                'saveJournalEntryBtn': 'Save Entry',
                'journalEntriesOutputDefault': 'Your journal entries will appear here.',

                'localTipsSectionTitle': 'Local Wellness Tips',
                'localTipsDescription': 'Get traditional Tamil wellness tips and home remedies.',
                'localTipCategoryPlaceholder': 'e.g., Turmeric, Drumstick, Meditation...',
                'getLocalTipBtn': 'Get Tip',
                'localTipOutputDefault': 'Local wellness tips will appear here.',
                'localTipSuggestions': ['Turmeric', 'Drumstick', 'Amla', 'Fenugreek', 'Aloe Vera', 'Meditation', 'Yoga', 'Traditional food'],

                'mealPlanSectionTitle': 'Personalized Meal Plan Recommendations',
                'mealPlanDescription': 'Get a meal plan based on your goals and preferences.',
                'dietGoalInputPlaceholder': 'e.g., Weight loss, Muscle gain...',
                'dietPreferenceSelectDefault': 'Select diet preference',
                'allergiesInputPlaceholder': 'e.g., Peanuts, Dairy...',
                'generateMealPlanBtn': 'Generate Meal Plan',
                'mealPlanOutputDefault': 'Your meal plan will appear here.',

                'moodAnalysisSectionTitle': 'Mood Journal Analysis',
                'moodAnalysisDescription': 'Analyze your emotional trends based on your journal entries.',
                'analyzeMoodJournalBtn': 'Analyze Mood',
                'moodAnalysisOutputDefault': 'Your mood analysis will appear here.',

                'exerciseYogaSectionTitle': 'Personalized Exercise & Yoga Routines',
                'exerciseYogaDescription': 'Get an exercise routine based on your fitness level and goals.',
                'fitnessLevelSelectDefault': 'Select fitness level',
                'timeAvailableInputPlaceholder': 'Time available (minutes)...',
                'exerciseGoalInputPlaceholder': 'e.g., Flexibility, Build muscle...',
                'generateExerciseRoutineBtn': 'Generate Routine',
                'exerciseRoutineOutputDefault': 'Your exercise routine will appear here.',

                'diseasePreventionSectionTitle': 'Disease Prevention & Home Remedies for Common Ailments',
                'diseasePreventionDescription': 'Discover traditional remedies and tips to help prevent or manage common ailments.',
                'healthConcernInputPlaceholder': 'e.g., Cold, Digestion issue...',
                'getRemedyBtn': 'Get Remedy',
                'remedyOutputDefault': 'Disease prevention tips will appear here.',

                'wellnessChallengeSectionTitle': 'Wellness Challenges',
                'wellnessChallengeDescription': 'Create personalized challenges to improve your health habits.',
                'currentHabitInputPlaceholder': 'Your current habit (e.g., 1000ml water)...',
                'challengeGoalInputPlaceholder': 'Your challenge goal (e.g., 2000ml water)...',
                'generateChallengeBtn': 'Generate Challenge',
                'challengeOutputDefault': 'Your challenge will appear here.',

                'medicationReminderSectionTitle': 'Medication Reminder',
                'medicationReminderDescription': 'Set reminders to take your medications on time.',
                'medicationNameInputPlaceholder': 'Medication Name...',
                'medicationTimeInputPlaceholder': 'Time (e.g., 08:00 AM)',
                'medicationFrequencySelectDefault': 'Frequency...',
                'addMedicationReminderBtn': 'Add Reminder',
                'medicationRemindersListDefault': 'Your medication reminders will appear here.',

                'bodyPainMappingSectionTitle': 'Body Pain Mapping',
                'bodyPainMappingDescription': 'Mark areas on your body where you feel pain and describe it.',
                'painDescriptionInputPlaceholder': 'Description of pain (e.g., sharp pain, throbbing pain)...',
                'painLevelSelectPlaceholder': 'Pain intensity (1-10)',
                'savePainEntryBtn': 'Save Pain Entry',
                'painEntriesOutputDefault': 'Your pain entries will appear here.',

                'firstAidEmergencySectionTitle': 'First Aid & Emergency',
                'firstAidEmergencyDescription': 'Get guidance for common emergencies like cuts, burns, choking, and heart attack.',
                'firstAidCutLabel': 'Cuts',
                'firstAidBurnLabel': 'Burns',
                'firstAidChokingLabel': 'Choking',
                'firstAidHeartAttackLabel': 'Heart Attack',
                'emergencyNumbersTitle': 'Emergency Numbers',
                'callAmbulanceLabel': 'Ambulance (108)',
                'callPoliceLabel': 'Police (100)',
                'nearbyHospitalsTitle': 'Nearby Hospitals',
                'findHospitalsBtn': 'Find Hospitals',
                'firstAidOutputDefault': 'First Aid or Emergency information will appear here.',
            }
        };

        // Current language state
        let currentLanguage = 'ta';

        // --- View Management ---
        function showView(viewId) {
            document.getElementById('initialView').style.display = 'none';
            document.getElementById('featuresListView').style.display = 'none';
            featureSections.forEach(section => section.style.display = 'none');

            document.getElementById(viewId).style.display = 'block';
            if (viewId === 'featuresListView') {
                allFeatureIconsContainer.classList.add('active');
            } else {
                allFeatureIconsContainer.classList.remove('active');
            }
            window.scrollTo({ top: 0, behavior: 'smooth' }); // Scroll to top when changing views
        }

        function showFeatureSection(sectionId) {
            showView(sectionId);
            document.getElementById(sectionId).classList.add('active');
        }

        // --- Utility Functions ---
        function setTextContent() {
            const lang = currentLanguage;
            mainTitle.textContent = translations[lang].mainTitle;
            descriptionText.textContent = translations[lang].descriptionText;
            tipSectionTitle.textContent = translations[lang].tipSectionTitle;
            goalInput.placeholder = translations[lang].goalInputPlaceholder;
            generateBtn.textContent = translations[lang].generateBtn;
            loadingText.textContent = translations[lang].loadingText;
            featuresTitle.textContent = translations[lang].featuresTitle;
            aiVoiceBtn.textContent = translations[lang].aiVoiceBtn;
            if (ttsVoiceSelect.options.length > 0) {
                ttsVoiceSelect.options[0].textContent = translations[lang].ttsVoiceSelectDefault;
            }
            document.querySelector('#toggleFeaturesBtn .label').textContent = translations[lang].showFeaturesLabel;
            featuresPageTitle.textContent = translations[lang].featuresPageTitle;
            document.querySelectorAll('.back-to-main-button').forEach(button => {
                button.textContent = translations[lang].backButtonLabel;
            });
            

            // Update feature icon labels
            document.querySelectorAll('.feature-icon .label').forEach(label => {
                const key = label.dataset.labelKey;
                if (translations[lang][key]) {
                    label.textContent = translations[lang][key];
                }
            });

            // Update feature specific elements
            document.getElementById('stepSectionTitle').textContent = translations[lang].stepSectionTitle;
            document.getElementById('addOneStepBtn').textContent = translations[lang].addOneStepBtn;
            document.getElementById('toggleTrackingBtn').textContent = translations[lang].toggleTrackingBtn;
            document.getElementById('resetStepsBtn').textContent = translations[lang].resetStepsBtn;
            if (stepResultOutput.textContent.trim() === '' || stepResultOutput.textContent.trim() === translations[currentLanguage === 'en' ? 'ta' : 'en'].stepResultOutputDefault) {
                stepResultOutput.textContent = translations[lang].stepResultOutputDefault;
            }

            document.getElementById('heartRateSectionTitle').textContent = translations[lang].heartRateSectionTitle;
            document.getElementById('simulateHeartRateBtn').textContent = translations[lang].simulateHeartRateBtn;
            document.getElementById('resetHeartRateBtn').textContent = translations[lang].resetHeartRateBtn;
            if (heartRateResultOutput.textContent.trim() === '' || heartRateResultOutput.textContent.trim() === translations[currentLanguage === 'en' ? 'ta' : 'en'].heartRateResultOutputDefault) {
                heartRateResultOutput.textContent = translations[lang].heartRateResultOutputDefault;
            }

            document.getElementById('waterSectionTitle').textContent = translations[lang].waterSectionTitle;
            document.getElementById('addWaterBtn').textContent = translations[lang].addWaterBtn;
            document.getElementById('resetWaterBtn').textContent = translations[lang].resetWaterBtn;
            if (waterResultOutput.textContent.trim() === '' || waterResultOutput.textContent.trim() === translations[currentLanguage === 'en' ? 'ta' : 'en'].waterResultOutputDefault) {
                waterResultOutput.textContent = translations[lang].waterResultOutputDefault;
            }
            
            document.getElementById('journalSectionTitle').textContent = translations[lang].journalSectionTitle;
            document.getElementById('journalDescription').textContent = translations[lang].journalDescription;
            document.getElementById('moodSelect').options[0].textContent = translations[lang].moodSelectPlaceholder;
            document.getElementById('gratitudeInput').placeholder = translations[lang].gratitudeInputPlaceholder;
            document.getElementById('saveJournalEntryBtn').textContent = translations[lang].saveJournalEntryBtn;
            if (journalEntriesOutput.textContent.trim() === '' || journalEntriesOutput.textContent.trim() === translations[currentLanguage === 'en' ? 'ta' : 'en'].journalEntriesOutputDefault) {
                journalEntriesOutput.textContent = translations[lang].journalEntriesOutputDefault;
            }

            document.getElementById('localTipsSectionTitle').textContent = translations[lang].localTipsSectionTitle;
            document.getElementById('localTipsDescription').textContent = translations[lang].localTipsDescription;
            document.getElementById('localTipCategory').placeholder = translations[lang].localTipCategoryPlaceholder;
            document.getElementById('getLocalTipBtn').textContent = translations[lang].getLocalTipBtn;
            if (localTipOutput.textContent.trim() === '' || localTipOutput.textContent.trim() === translations[currentLanguage === 'en' ? 'ta' : 'en'].localTipOutputDefault) {
                localTipOutput.textContent = translations[lang].localTipOutputDefault;
            }

            document.getElementById('mealPlanSectionTitle').textContent = translations[lang].mealPlanSectionTitle;
            document.getElementById('mealPlanDescription').textContent = translations[lang].mealPlanDescription;
            document.getElementById('dietGoalInput').placeholder = translations[lang].dietGoalInputPlaceholder;
            document.getElementById('dietPreferenceSelect').options[0].textContent = translations[lang].dietPreferenceSelectDefault;
            document.getElementById('allergiesInput').placeholder = translations[lang].allergiesInputPlaceholder;
            document.getElementById('generateMealPlanBtn').textContent = translations[lang].generateMealPlanBtn;
            if (mealPlanOutput.textContent.trim() === '' || mealPlanOutput.textContent.trim() === translations[currentLanguage === 'en' ? 'ta' : 'en'].mealPlanOutputDefault) {
                mealPlanOutput.textContent = translations[lang].mealPlanOutputDefault;
            }

            document.getElementById('moodAnalysisSectionTitle').textContent = translations[lang].moodAnalysisSectionTitle;
            document.getElementById('moodAnalysisDescription').textContent = translations[lang].moodAnalysisDescription;
            document.getElementById('analyzeMoodJournalBtn').textContent = translations[lang].analyzeMoodJournalBtn;
            if (moodAnalysisOutput.textContent.trim() === '' || moodAnalysisOutput.textContent.trim() === translations[currentLanguage === 'en' ? 'ta' : 'en'].moodAnalysisOutputDefault) {
                moodAnalysisOutput.textContent = translations[lang].moodAnalysisOutputDefault;
            }

            document.getElementById('exerciseYogaSectionTitle').textContent = translations[lang].exerciseYogaSectionTitle;
            document.getElementById('exerciseYogaDescription').textContent = translations[lang].exerciseYogaDescription;
            document.getElementById('fitnessLevelSelect').options[0].textContent = translations[lang].fitnessLevelSelectDefault;
            document.getElementById('timeAvailableInput').placeholder = translations[lang].timeAvailableInputPlaceholder;
            document.getElementById('exerciseGoalInput').placeholder = translations[lang].exerciseGoalInputPlaceholder;
            document.getElementById('generateExerciseRoutineBtn').textContent = translations[lang].generateExerciseRoutineBtn;
            if (exerciseRoutineOutput.textContent.trim() === '' || exerciseRoutineOutput.textContent.trim() === translations[currentLanguage === 'en' ? 'ta' : 'en'].exerciseRoutineOutputDefault) {
                exerciseRoutineOutput.textContent = translations[lang].exerciseRoutineOutputDefault;
            }

            document.getElementById('diseasePreventionSectionTitle').textContent = translations[lang].diseasePreventionSectionTitle;
            document.getElementById('diseasePreventionDescription').textContent = translations[lang].diseasePreventionDescription;
            document.getElementById('healthConcernInput').placeholder = translations[lang].healthConcernInputPlaceholder;
            document.getElementById('getRemedyBtn').textContent = translations[lang].getRemedyBtn;
            if (remedyOutput.textContent.trim() === '' || remedyOutput.textContent.trim() === translations[currentLanguage === 'en' ? 'ta' : 'en'].remedyOutputDefault) {
                remedyOutput.textContent = translations[lang].remedyOutputDefault;
            }

            document.getElementById('wellnessChallengeSectionTitle').textContent = translations[lang].wellnessChallengeSectionTitle;
            document.getElementById('wellnessChallengeDescription').textContent = translations[lang].wellnessChallengeDescription;
            document.getElementById('currentHabitInput').placeholder = translations[lang].currentHabitInputPlaceholder;
            document.getElementById('challengeGoalInput').placeholder = translations[lang].challengeGoalInputPlaceholder;
            document.getElementById('generateChallengeBtn').textContent = translations[lang].generateChallengeBtn;
            if (challengeOutput.textContent.trim() === '' || challengeOutput.textContent.trim() === translations[currentLanguage === 'en' ? 'ta' : 'en'].challengeOutputDefault) {
                challengeOutput.textContent = translations[lang].challengeOutputDefault;
            }

            document.getElementById('medicationReminderSectionTitle').textContent = translations[lang].medicationReminderSectionTitle;
            document.getElementById('medicationReminderDescription').textContent = translations[lang].medicationReminderDescription;
            document.getElementById('medicationNameInput').placeholder = translations[lang].medicationNameInputPlaceholder;
            document.getElementById('medicationTimeInput').setAttribute('aria-label', translations[lang].medicationTimeInputPlaceholder);
            document.getElementById('medicationFrequencySelect').options[0].textContent = translations[lang].medicationFrequencySelectDefault;
            document.getElementById('addMedicationReminderBtn').textContent = translations[lang].addMedicationReminderBtn;
            if (medicationRemindersList.textContent.trim() === '' || medicationRemindersList.textContent.trim() === translations[currentLanguage === 'en' ? 'ta' : 'en'].medicationRemindersListDefault) {
                medicationRemindersList.textContent = translations[lang].medicationRemindersListDefault;
            }

            document.getElementById('bodyPainMappingSectionTitle').textContent = translations[lang].bodyPainMappingSectionTitle;
            document.getElementById('bodyPainMappingDescription').textContent = translations[lang].bodyPainMappingDescription;
            document.getElementById('painDescriptionInput').placeholder = translations[lang].painDescriptionInputPlaceholder;
            document.getElementById('painLevelSelect').placeholder = translations[lang].painLevelSelectPlaceholder;
            document.getElementById('savePainEntryBtn').textContent = translations[lang].savePainEntryBtn;
            if (painEntriesOutput.textContent.trim() === '' || painEntriesOutput.textContent.trim() === translations[currentLanguage === 'en' ? 'ta' : 'en'].painEntriesOutputDefault) {
                painEntriesOutput.textContent = translations[lang].painEntriesOutputDefault;
            }

            document.getElementById('firstAidEmergencySectionTitle').textContent = translations[lang].firstAidEmergencySectionTitle;
            document.getElementById('firstAidEmergencyDescription').textContent = translations[lang].firstAidEmergencyDescription;
            document.getElementById('firstAidCutLabel').textContent = translations[lang].firstAidCutLabel;
            document.getElementById('firstAidBurnLabel').textContent = translations[lang].firstAidBurnLabel;
            document.getElementById('firstAidChokingLabel').textContent = translations[lang].firstAidChokingLabel;
            document.getElementById('firstAidHeartAttackLabel').textContent = translations[lang].firstAidHeartAttackLabel;
            document.getElementById('emergencyNumbersTitle').textContent = translations[lang].emergencyNumbersTitle;
            document.getElementById('callAmbulanceLabel').textContent = translations[lang].callAmbulanceLabel;
            document.getElementById('callPoliceLabel').textContent = translations[lang].callPoliceLabel;
            document.getElementById('nearbyHospitalsTitle').textContent = translations[lang].nearbyHospitalsTitle;
            document.getElementById('findHospitalsBtn').textContent = translations[lang].findHospitalsBtn;
            if (firstAidOutput.textContent.trim() === '' || firstAidOutput.textContent.trim() === translations[currentLanguage === 'en' ? 'ta' : 'en'].firstAidOutputDefault) {
                firstAidOutput.textContent = translations[lang].firstAidOutputDefault;
            }

            // Update tip output default if it matches old default for previous language
            if (tipOutput.textContent.trim() === '' || tipOutput.textContent.trim() === translations[currentLanguage === 'en' ? 'ta' : 'en'].tipOutputDefault) {
                tipOutput.textContent = ''; // Clear it or set a new initial default if desired
            }
        }

        // --- Speech Recognition (Web Speech API) ---
        let recognition;
        let isRecording = false;

        if (window.webkitSpeechRecognition) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US';

            recognition.onstart = () => {
                isRecording = true;
                micBtn.classList.add('recording');
                goalInput.placeholder = currentLanguage === 'ta' ? "பேசுகிறீர்கள்..." : "Listening...";
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                goalInput.value = transcript;
                isRecording = false;
                micBtn.classList.remove('recording');
                goalInput.placeholder = translations[currentLanguage].goalInputPlaceholder;
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                isRecording = false;
                micBtn.classList.remove('recording');
                goalInput.placeholder = translations[currentLanguage].goalInputPlaceholder;
                alert(currentLanguage === 'ta' ? "குரல் உள்ளீடு தோல்வியடைந்தது. மீண்டும் முயற்சிக்கவும்." : "Voice input failed. Please try again.");
            };

            recognition.onend = () => {
                isRecording = false;
                micBtn.classList.remove('recording');
                goalInput.placeholder = translations[currentLanguage].goalInputPlaceholder;
            };

            micBtn.addEventListener('click', () => {
                if (isRecording) {
                    recognition.stop();
                } else {
                    recognition.start();
                }
            });
        } else {
            micBtn.style.display = 'none'; // Hide mic button if not supported
            console.warn('Web Speech API not supported in this browser.');
        }

        // --- Text-to-Speech (Web Speech API) ---
        let speechSynth = window.speechSynthesis;
        let voices = [];

        function populateVoiceList() {
            voices = speechSynth.getVoices();
            ttsVoiceSelect.innerHTML = ''; // Clear existing options
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = translations[currentLanguage].ttsVoiceSelectDefault;
            ttsVoiceSelect.appendChild(defaultOption);

            voices.forEach((voice) => {
                // Filter for relevant languages (Tamil and English)
                if (voice.lang.startsWith('ta') || voice.lang.startsWith('en')) {
                    const option = document.createElement('option');
                    option.value = voice.name;
                    option.textContent = `${voice.name} (${voice.lang})`;
                    if (voice.default) {
                        option.textContent += ' (Default)';
                    }
                    ttsVoiceSelect.appendChild(option);
                }
            });
            // Try to select a default voice for the current language
            const preferredVoice = voices.find(voice => voice.lang.startsWith(currentLanguage === 'ta' ? 'ta' : 'en') && voice.default);
            if (preferredVoice) {
                ttsVoiceSelect.value = preferredVoice.name;
            } else {
                const firstAvailableVoice = voices.find(voice => voice.lang.startsWith(currentLanguage === 'ta' ? 'ta' : 'en'));
                if (firstAvailableVoice) {
                    ttsVoiceSelect.value = firstAvailableVoice.name;
                }
            }
        }

        populateVoiceList();
        if (speechSynth.onvoiceschanged !== undefined) {
            speechSynth.onvoiceschanged = populateVoiceList;
        }

        function speakText(text) {
            if (speechSynth.speaking) {
                speechSynth.cancel();
            }
            const utterance = new SpeechSynthesisUtterance(text);
            const selectedVoiceName = ttsVoiceSelect.value;
            const selectedVoice = voices.find(voice => voice.name === selectedVoiceName);

            if (selectedVoice) {
                utterance.voice = selectedVoice;
            } else {
                // Fallback to a default voice for the current language if specific voice not found
                const fallbackVoice = voices.find(voice => voice.lang.startsWith(currentLanguage === 'ta' ? 'ta' : 'en'));
                if (fallbackVoice) {
                    utterance.voice = fallbackVoice;
                }
            }
            utterance.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US';
            utterance.pitch = 1;
            utterance.rate = 1;
            speechSynth.speak(utterance);
        }

        aiVoiceBtn.addEventListener('click', () => {
            const textToSpeak = tipOutput.textContent;
            if (textToSpeak) {
                speakText(textToSpeak);
            } else {
                alert(currentLanguage === 'ta' ? "படிக்க ஒரு குறிப்பை உருவாக்கவும்." : "Please generate a tip to read aloud.");
            }
        });

        // --- Language Switching ---
        languageSelect.addEventListener('change', (event) => {
            currentLanguage = event.target.value;
            localStorage.setItem('appLanguage', currentLanguage); // Save language preference
            setTextContent();
            // Update speech recognition language
            if (recognition) {
                recognition.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US';
            }
            // Repopulate TTS voices to select default for new language
            populateVoiceList();
        });

        // --- Initial Tip Generation ---
        generateBtn.addEventListener('click', async () => {
            const goal = goalInput.value.trim();
            if (!goal) {
                tipOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'தயவுசெய்து ஒரு ஆரோக்கிய இலக்கை உள்ளிடவும்.' : 'Please enter a wellness goal.'}</p>`;
                return;
            }

            loadingIndicator.style.display = 'flex';
            tipOutput.textContent = ''; // Clear previous tip
            aiVoiceBtn.style.display = 'none'; // Hide AI voice button during loading
            ttsVoiceSelect.style.display = 'none'; // Hide voice select during loading

            try {
                // Call Netlify Function
                const response = await fetch('/.netlify/functions/generate-tip', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ goal, language: currentLanguage }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `${currentLanguage === 'ta' ? 'API கோரிக்கை தோல்வியடைந்தது' : 'API request failed'}: ${response.statusText}`);
                }

                const data = await response.json();
                tipOutput.innerHTML = `<p>${data.tip}</p>`;
                aiVoiceBtn.style.display = 'inline-flex'; // Show AI voice button after successful generation
                ttsVoiceSelect.style.display = 'inline-block'; // Show voice select after successful generation

            } catch (error) {
                console.error('Error:', error);
                tipOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'குறிப்பை உருவாக்குவதில் பிழை ஏற்பட்டது. மீண்டும் முயற்சிக்கவும்.' : 'Failed to generate tip. Please try again.'}</p>`;
            } finally {
                loadingIndicator.style.display = 'none';
            }
        });

        // --- Splash Screen Logic ---
        window.addEventListener('load', () => {
            setTimeout(() => {
                splashScreen.classList.add('fade-out');
                splashScreen.addEventListener('transitionend', () => {
                    splashScreen.style.display = 'none';
                    mainContent.style.display = 'block';
                }, { once: true });
            }, 2000); // Show splash screen for 2 seconds
            setTextContent(); // Set initial language content
        });

        // --- Feature Section Logic ---

        // Event listener for the main "Show Features" button
        toggleFeaturesBtn.addEventListener('click', () => {
            showView('featuresListView');
        });

        // Event listener for back button from features list to main view
        backToMainFromFeaturesList.addEventListener('click', () => {
            showView('initialView');
        });

        // Event listeners for feature icons to show respective sections
        featureIcons.forEach(icon => {
            icon.addEventListener('click', () => {
                const targetSectionId = icon.dataset.section;
                showFeatureSection(targetSectionId);
            });
        });

        // Event listeners for back buttons within feature sections
        backToFeaturesListButtons.forEach(button => {
            button.addEventListener('click', (event) => {
                showView('featuresListView');
            });
        });

        // --- Individual Feature Logic (simplified examples) ---

        // Step Tracker
        const currentStepsDisplay = document.getElementById('currentStepsDisplay');
        const addOneStepBtn = document.getElementById('addOneStepBtn');
        const toggleTrackingBtn = document.getElementById('toggleTrackingBtn');
        const resetStepsBtn = document.getElementById('resetStepsBtn');
        const stepResultOutput = document.getElementById('stepResultOutput');
        let steps = 0;
        let isTrackingSteps = false;
        let stepInterval;

        addOneStepBtn.addEventListener('click', () => {
            steps++;
            currentStepsDisplay.value = steps;
            stepResultOutput.textContent = `${currentLanguage === 'ta' ? 'நீங்கள் எடுத்த மொத்த படிகள்:' : 'Total steps taken:'} ${steps}`;
        });

        toggleTrackingBtn.addEventListener('click', () => {
            if (isTrackingSteps) {
                clearInterval(stepInterval);
                isTrackingSteps = false;
                toggleTrackingBtn.textContent = currentLanguage === 'ta' ? 'டிராக்கிங்கை தொடங்கு' : 'Start Tracking';
                stepResultOutput.textContent = currentLanguage === 'ta' ? 'படி டிராக்கிங் நிறுத்தப்பட்டது.' : 'Step tracking stopped.';
            } else {
                stepInterval = setInterval(() => {
                    steps += Math.floor(Math.random() * 5) + 1; // Simulate steps
                    currentStepsDisplay.value = steps;
                    stepResultOutput.textContent = `${currentLanguage === 'ta' ? 'நீங்கள் எடுத்த மொத்த படிகள்:' : 'Total steps taken:'} ${steps}`;
                }, 1000);
                isTrackingSteps = true;
                toggleTrackingBtn.textContent = currentLanguage === 'ta' ? 'டிராக்கிங்கை நிறுத்து' : 'Stop Tracking';
                stepResultOutput.textContent = currentLanguage === 'ta' ? 'படி டிராக்கிங் தொடங்கப்பட்டது.' : 'Step tracking started.';
            }
        });

        resetStepsBtn.addEventListener('click', () => {
            clearInterval(stepInterval);
            isTrackingSteps = false;
            steps = 0;
            currentStepsDisplay.value = steps;
            toggleTrackingBtn.textContent = currentLanguage === 'ta' ? 'டிராக்கிங்கை தொடங்கு' : 'Start Tracking';
            stepResultOutput.textContent = currentLanguage === 'ta' ? 'படிகள் மீட்டமைக்கப்பட்டன.' : 'Steps reset.';
        });

        // Heart Rate Tracker
        const currentHeartRateDisplay = document.getElementById('currentHeartRateDisplay');
        const simulateHeartRateBtn = document.getElementById('simulateHeartRateBtn');
        const resetHeartRateBtn = document.getElementById('resetHeartRateBtn');
        const heartRateResultOutput = document.getElementById('heartRateResultOutput');

        simulateHeartRateBtn.addEventListener('click', () => {
            const min = 60;
            const max = 100;
            const simulatedRate = Math.floor(Math.random() * (max - min + 1)) + min;
            currentHeartRateDisplay.value = `${simulatedRate} bpm`;
            heartRateResultOutput.textContent = `${currentLanguage === 'ta' ? 'உங்கள் தற்போதைய இதயத் துடிப்பு:' : 'Your current heart rate:'} ${simulatedRate} bpm. ${currentLanguage === 'ta' ? 'இது இயல்பானது.' : 'This is a normal range.'}`;
        });

        resetHeartRateBtn.addEventListener('click', () => {
            currentHeartRateDisplay.value = '0';
            heartRateResultOutput.textContent = currentLanguage === 'ta' ? 'இதயத் துடிப்பு மீட்டமைக்கப்பட்டது.' : 'Heart rate reset.';
        });

        // Water Tracker
        const waterIntakeDisplay = document.getElementById('waterIntakeDisplay');
        const addWaterBtn = document.getElementById('addWaterBtn');
        const resetWaterBtn = document.getElementById('resetWaterBtn');
        const waterResultOutput = document.getElementById('waterResultOutput');
        let waterIntake = 0;

        addWaterBtn.addEventListener('click', () => {
            waterIntake += 250; // Add 250ml
            waterIntakeDisplay.value = `${waterIntake} ml`;
            waterResultOutput.textContent = `${currentLanguage === 'ta' ? 'மொத்த தண்ணீர் உட்கொள்ளல்:' : 'Total water intake:'} ${waterIntake} ml. ${currentLanguage === 'ta' ? 'நீங்கள் நன்றாக நீர்ச்சத்து பெறுகிறீர்கள்!' : 'You are hydrating well!'}`;
        });

        resetWaterBtn.addEventListener('click', () => {
            waterIntake = 0;
            waterIntakeDisplay.value = '0 ml';
            waterResultOutput.textContent = currentLanguage === 'ta' ? 'தண்ணீர் உட்கொள்ளல் மீட்டமைக்கப்பட்டது.' : 'Water intake reset.';
        });

        // Journal
        const moodSelect = document.getElementById('moodSelect');
        const gratitudeInput = document.getElementById('gratitudeInput');
        const saveJournalEntryBtn = document.getElementById('saveJournalEntryBtn');
        const journalEntriesOutput = document.getElementById('journalEntriesOutput');
        let journalEntries = [];

        saveJournalEntryBtn.addEventListener('click', () => {
            const mood = moodSelect.value;
            const gratitude = gratitudeInput.value.trim();

            if (!mood || !gratitude) {
                journalEntriesOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'மனநிலையையும் நன்றியையும் உள்ளிடவும்.' : 'Please enter both mood and gratitude.'}</p>`;
                return;
            }

            const newEntry = {
                date: new Date().toLocaleDateString(currentLanguage === 'ta' ? 'ta-IN' : 'en-US'),
                time: new Date().toLocaleTimeString(currentLanguage === 'ta' ? 'ta-IN' : 'en-US'),
                mood: mood,
                gratitude: gratitude
            };
            journalEntries.push(newEntry);
            renderJournalEntries();
            moodSelect.value = '';
            gratitudeInput.value = '';
        });

        function renderJournalEntries() {
            if (journalEntries.length === 0) {
                journalEntriesOutput.textContent = translations[currentLanguage].journalEntriesOutputDefault;
                return;
            }
            journalEntriesOutput.innerHTML = journalEntries.map(entry => `
                <div class="mb-2 p-3 border rounded-md bg-white">
                    <p><strong>${currentLanguage === 'ta' ? 'தேதி:' : 'Date:'}</strong> ${entry.date} ${currentLanguage === 'ta' ? 'நேரம்:' : 'Time:'} ${entry.time}</p>
                    <p><strong>${currentLanguage === 'ta' ? 'மனநிலை:' : 'Mood:'}</strong> ${entry.mood}</p>
                    <p><strong>${currentLanguage === 'ta' ? 'நன்றியுணர்வு:' : 'Gratitude:'}</strong> ${entry.gratitude}</p>
                </div>
            `).join('');
        }

        // Local Tips
        const localTipCategory = document.getElementById('localTipCategory');
        const localTipCategoryDropdown = document.getElementById('localTipCategoryDropdown');
        const getLocalTipBtn = document.getElementById('getLocalTipBtn');
        const localTipOutput = document.getElementById('localTipOutput');

        localTipCategory.addEventListener('input', () => {
            const input = localTipCategory.value.toLowerCase();
            localTipCategoryDropdown.innerHTML = '';
            if (input.length === 0) {
                localTipCategoryDropdown.classList.add('hidden');
                return;
            }

            const suggestions = translations[currentLanguage].localTipSuggestions.filter(tip =>
                tip.toLowerCase().includes(input)
            );

            if (suggestions.length > 0) {
                suggestions.forEach(suggestion => {
                    const div = document.createElement('div');
                    div.textContent = suggestion;
                    div.addEventListener('click', () => {
                        localTipCategory.value = suggestion;
                        localTipCategoryDropdown.classList.add('hidden');
                    });
                    localTipCategoryDropdown.appendChild(div);
                });
                localTipCategoryDropdown.classList.remove('hidden');
            } else {
                localTipCategoryDropdown.classList.add('hidden');
            }
        });

        document.addEventListener('click', (event) => {
            if (!localTipCategory.contains(event.target) && !localTipCategoryDropdown.contains(event.target)) {
                localTipCategoryDropdown.classList.add('hidden');
            }
        });

        getLocalTipBtn.addEventListener('click', async () => {
            const category = localTipCategory.value.trim();
            if (!category) {
                localTipOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'தயவுசெய்து ஒரு வகையை உள்ளிடவும்.' : 'Please enter a category.'}</p>`;
                return;
            }

            loadingIndicator.style.display = 'flex';
            localTipOutput.textContent = '';

            try {
                const response = await fetch('/.netlify/functions/get-local-tip', { // You'd need a new Netlify function for this
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ category, language: currentLanguage })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `${currentLanguage === 'ta' ? 'உதவிக்குறிப்பைப் பெறுவதில் தோல்வி' : 'Failed to get tip'}: ${response.statusText}`);
                }

                const data = await response.json();
                localTipOutput.innerHTML = `<p>${data.tip}</p>`;
            } catch (error) {
                console.error('Error fetching local tip:', error);
                localTipOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'உதவிக்குறிப்பைப் பெறுவதில் பிழை ஏற்பட்டது.' : 'Error fetching tip.'}</p>`;
            } finally {
                loadingIndicator.style.display = 'none';
            }
        });

        // Meal Plan
        const dietGoalInput = document.getElementById('dietGoalInput');
        const dietPreferenceSelect = document.getElementById('dietPreferenceSelect');
        const allergiesInput = document.getElementById('allergiesInput');
        const generateMealPlanBtn = document.getElementById('generateMealPlanBtn');
        const mealPlanOutput = document.getElementById('mealPlanOutput');

        generateMealPlanBtn.addEventListener('click', async () => {
            const dietGoal = dietGoalInput.value.trim();
            const dietPreference = dietPreferenceSelect.value;
            const allergies = allergiesInput.value.trim();

            if (!dietGoal || !dietPreference) {
                mealPlanOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'உணவு இலக்கு மற்றும் விருப்பத்தைத் தேர்ந்தெடுக்கவும்.' : 'Please enter diet goal and preference.'}</p>`;
                return;
            }

            loadingIndicator.style.display = 'flex';
            mealPlanOutput.textContent = '';

            try {
                const response = await fetch('/.netlify/functions/generate-meal-plan', { // New Netlify function
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ dietGoal, dietPreference, allergies, language: currentLanguage })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `${currentLanguage === 'ta' ? 'உணவுத் திட்டத்தை உருவாக்குவதில் தோல்வி' : 'Failed to generate meal plan'}: ${response.statusText}`);
                }

                const data = await response.json();
                mealPlanOutput.innerHTML = `<p>${data.mealPlan}</p>`;
            } catch (error) {
                console.error('Error generating meal plan:', error);
                mealPlanOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'உணவுத் திட்டத்தை உருவாக்குவதில் பிழை ஏற்பட்டது.' : 'Error generating meal plan.'}</p>`;
            } finally {
                loadingIndicator.style.display = 'none';
            }
        });

        // Mood Analysis
        const analyzeMoodJournalBtn = document.getElementById('analyzeMoodJournalBtn');
        const moodAnalysisOutput = document.getElementById('moodAnalysisOutput');

        analyzeMoodJournalBtn.addEventListener('click', async () => {
            if (journalEntries.length === 0) {
                moodAnalysisOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'பகுப்பாய்வு செய்ய ஜர்னல் உள்ளீடுகள் இல்லை.' : 'No journal entries to analyze.'}</p>`;
                return;
            }

            loadingIndicator.style.display = 'flex';
            moodAnalysisOutput.textContent = '';

            try {
                const response = await fetch('/.netlify/functions/analyze-mood', { // New Netlify function
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ journalEntries, language: currentLanguage })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `${currentLanguage === 'ta' ? 'மனநிலைப் பகுப்பாய்வு தோல்வி' : 'Mood analysis failed'}: ${response.statusText}`);
                }

                const data = await response.json();
                moodAnalysisOutput.innerHTML = `<p>${data.analysis}</p>`;
            } catch (error) {
                console.error('Error analyzing mood:', error);
                moodAnalysisOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'மனநிலைப் பகுப்பாய்வில் பிழை ஏற்பட்டது.' : 'Error analyzing mood.'}</p>`;
            } finally {
                loadingIndicator.style.display = 'none';
            }
        });

        // Exercise & Yoga
        const fitnessLevelSelect = document.getElementById('fitnessLevelSelect');
        const timeAvailableInput = document.getElementById('timeAvailableInput');
        const exerciseGoalInput = document.getElementById('exerciseGoalInput');
        const generateExerciseRoutineBtn = document.getElementById('generateExerciseRoutineBtn');
        const exerciseRoutineOutput = document.getElementById('exerciseRoutineOutput');

        generateExerciseRoutineBtn.addEventListener('click', async () => {
            const fitnessLevel = fitnessLevelSelect.value;
            const timeAvailable = timeAvailableInput.value.trim();
            const exerciseGoal = exerciseGoalInput.value.trim();

            if (!fitnessLevel || !timeAvailable || !exerciseGoal) {
                exerciseRoutineOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'அனைத்து புலங்களையும் நிரப்பவும்.' : 'Please fill all fields.'}</p>`;
                return;
            }

            loadingIndicator.style.display = 'flex';
            exerciseRoutineOutput.textContent = '';

            try {
                const response = await fetch('/.netlify/functions/generate-exercise-routine', { // New Netlify function
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ fitnessLevel, timeAvailable, exerciseGoal, language: currentLanguage })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `${currentLanguage === 'ta' ? 'உடற்பயிற்சி வழக்கத்தை உருவாக்குவதில் தோல்வி' : 'Failed to generate exercise routine'}: ${response.statusText}`);
                }

                const data = await response.json();
                exerciseRoutineOutput.innerHTML = `<p>${data.routine}</p>`;
            } catch (error) {
                console.error('Error generating exercise routine:', error);
                exerciseRoutineOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'உடற்பயிற்சி வழக்கத்தை உருவாக்குவதில் பிழை ஏற்பட்டது.' : 'Error generating exercise routine.'}</p>`;
            } finally {
                loadingIndicator.style.display = 'none';
            }
        });

        // Disease Prevention
        const healthConcernInput = document.getElementById('healthConcernInput');
        const getRemedyBtn = document.getElementById('getRemedyBtn');
        const remedyOutput = document.getElementById('remedyOutput');

        getRemedyBtn.addEventListener('click', async () => {
            const healthConcern = healthConcernInput.value.trim();
            if (!healthConcern) {
                remedyOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'தயவுசெய்து ஒரு உடல்நலக் கவலையை உள்ளிடவும்.' : 'Please enter a health concern.'}</p>`;
                return;
            }

            loadingIndicator.style.display = 'flex';
            remedyOutput.textContent = '';

            try {
                const response = await fetch('/.netlify/functions/get-remedy', { // New Netlify function
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ healthConcern, language: currentLanguage })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `${currentLanguage === 'ta' ? 'தீர்வைப் பெறுவதில் தோல்வி' : 'Failed to get remedy'}: ${response.statusText}`);
                }

                const data = await response.json();
                remedyOutput.innerHTML = `<p>${data.remedy}</p>`;
            } catch (error) {
                console.error('Error fetching remedy:', error);
                remedyOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'தீர்வைப் பெறுவதில் பிழை ஏற்பட்டது.' : 'Error fetching remedy.'}</p>`;
            } finally {
                loadingIndicator.style.display = 'none';
            }
        });

        // Wellness Challenge
        const currentHabitInput = document.getElementById('currentHabitInput');
        const challengeGoalInput = document.getElementById('challengeGoalInput');
        const generateChallengeBtn = document.getElementById('generateChallengeBtn');
        const challengeOutput = document.getElementById('challengeOutput');

        generateChallengeBtn.addEventListener('click', async () => {
            const currentHabit = currentHabitInput.value.trim();
            const challengeGoal = challengeGoalInput.value.trim();

            if (!currentHabit || !challengeGoal) {
                challengeOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'தற்போதைய பழக்கம் மற்றும் சவால் இலக்கை உள்ளிடவும்.' : 'Please enter current habit and challenge goal.'}</p>`;
                return;
            }

            loadingIndicator.style.display = 'flex';
            challengeOutput.textContent = '';

            try {
                const response = await fetch('/.netlify/functions/generate-challenge', { // New Netlify function
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ currentHabit, challengeGoal, language: currentLanguage })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `${currentLanguage === 'ta' ? 'சவாலை உருவாக்குவதில் தோல்வி' : 'Failed to generate challenge'}: ${response.statusText}`);
                }

                const data = await response.json();
                challengeOutput.innerHTML = `<p>${data.challenge}</p>`;
            } catch (error) {
                console.error('Error generating challenge:', error);
                challengeOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'சவாலை உருவாக்குவதில் பிழை ஏற்பட்டது.' : 'Error generating challenge.'}</p>`;
            } finally {
                loadingIndicator.style.display = 'none';
            }
        });

        // Medication Reminder
        const medicationNameInput = document.getElementById('medicationNameInput');
        const medicationTimeInput = document.getElementById('medicationTimeInput');
        const medicationFrequencySelect = document.getElementById('medicationFrequencySelect');
        const addMedicationReminderBtn = document.getElementById('addMedicationReminderBtn');
        const medicationRemindersList = document.getElementById('medicationRemindersList');
        let reminders = [];

        addMedicationReminderBtn.addEventListener('click', () => {
            const name = medicationNameInput.value.trim();
            const time = medicationTimeInput.value;
            const frequency = medicationFrequencySelect.value;

            if (!name || !time || !frequency) {
                medicationRemindersList.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'அனைத்து புலங்களையும் நிரப்பவும்.' : 'Please fill all fields.'}</p>`;
                return;
            }

            const newReminder = { name, time, frequency };
            reminders.push(newReminder);
            renderReminders();

            // Optionally, set a browser notification (requires user permission and HTTPS)
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(currentLanguage === 'ta' ? 'மருந்து நினைவூட்டல்' : 'Medication Reminder', {
                    body: `${name} ${currentLanguage === 'ta' ? 'எடுத்துக்கொள்ளும் நேரம்' : 'is due at'} ${time} ${currentLanguage === 'ta' ? 'தினமும்' : frequency}.`,
                    icon: 'healthcare.png'
                });
            } else if (Notification.permission !== 'denied') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        new Notification(currentLanguage === 'ta' ? 'மருந்து நினைவூட்டல்' : 'Medication Reminder', {
                            body: `${name} ${currentLanguage === 'ta' ? 'எடுத்துக்கொள்ளும் நேரம்' : 'is due at'} ${time} ${currentLanguage === 'ta' ? 'தினமும்' : frequency}.`,
                            icon: 'healthcare.png'
                        });
                    }
                });
            }

            medicationNameInput.value = '';
            medicationTimeInput.value = '';
            medicationFrequencySelect.value = '';
        });

        function renderReminders() {
            if (reminders.length === 0) {
                medicationRemindersList.textContent = translations[currentLanguage].medicationRemindersListDefault;
                return;
            }
            medicationRemindersList.innerHTML = reminders.map((r, index) => `
                <div class="mb-2 p-3 border rounded-md bg-white flex justify-between items-center">
                    <div>
                        <p><strong>${currentLanguage === 'ta' ? 'மருந்து:' : 'Medicine:'}</strong> ${r.name}</p>
                        <p><strong>${currentLanguage === 'ta' ? 'நேரம்:' : 'Time:'}</strong> ${r.time}</p>
                        <p><strong>${currentLanguage === 'ta' ? 'அதிர்வெண்:' : 'Frequency:'}</strong> ${translations[currentLanguage][r.frequency] || r.frequency}</p>
                    </div>
                    <button onclick="deleteReminder(${index})" class="text-red-500 hover:text-red-700">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            <line x1="10" y1="11" x2="10" y2="17"></line>
                            <line x1="14" y1="11" x2="14" y2="17"></line>
                        </svg>
                    </button>
                </div>
            `).join('');
        }

        window.deleteReminder = (index) => {
            reminders.splice(index, 1);
            renderReminders();
        };

        // Body Pain Mapping
        const bodyMapImage = document.getElementById('bodyMapImage');
        const painDescriptionInput = document.getElementById('painDescriptionInput');
        const painLevelSelect = document.getElementById('painLevelSelect');
        const savePainEntryBtn = document.getElementById('savePainEntryBtn');
        const painEntriesOutput = document.getElementById('painEntriesOutput');
        let painPoints = [];
        let selectedPainDot = null;

        bodyMapImage.addEventListener('click', (e) => {
            const rect = bodyMapImage.getBoundingClientRect();
            const x = (e.clientX - rect.left) / rect.width * 100; // Percentage X
            const y = (e.clientY - rect.top) / rect.height * 100; // Percentage Y

            const dot = document.createElement('div');
            dot.classList.add('pain-dot');
            dot.style.left = `${x}%`;
            dot.style.top = `${y}%`;
            dot.dataset.x = x;
            dot.dataset.y = y;

            dot.addEventListener('click', (event) => {
                event.stopPropagation(); // Prevent re-triggering bodyMapImage click
                if (selectedPainDot) {
                    selectedPainDot.classList.remove('selected');
                }
                selectedPainDot = dot;
                dot.classList.add('selected');

                // Load existing data for this dot if it corresponds to a saved entry
                const existingEntry = painPoints.find(p => p.x === parseFloat(dot.dataset.x) && p.y === parseFloat(dot.dataset.y));
                if (existingEntry) {
                    painDescriptionInput.value = existingEntry.description;
                    painLevelSelect.value = existingEntry.level;
                } else {
                    painDescriptionInput.value = '';
                    painLevelSelect.value = '';
                }
            });

            bodyMapImage.parentElement.appendChild(dot);
            
            // Immediately select the new dot
            if (selectedPainDot) {
                selectedPainDot.classList.remove('selected');
            }
            selectedPainDot = dot;
            dot.classList.add('selected');
            painDescriptionInput.value = '';
            painLevelSelect.value = '';
        });

        savePainEntryBtn.addEventListener('click', () => {
            if (!selectedPainDot) {
                painEntriesOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'வரைபடத்தில் ஒரு புள்ளியைத் தேர்ந்தெடுக்கவும் அல்லது சேர்க்கவும்.' : 'Please select or add a point on the map.'}</p>`;
                return;
            }

            const description = painDescriptionInput.value.trim();
            const level = painLevelSelect.value;
            const x = parseFloat(selectedPainDot.dataset.x);
            const y = parseFloat(selectedPainDot.dataset.y);

            if (!description || !level) {
                painEntriesOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'வலி விளக்கம் மற்றும் தீவிரத்தை உள்ளிடவும்.' : 'Please enter pain description and intensity.'}</p>`;
                return;
            }

            // Check if this point already exists and update, otherwise add new
            const existingIndex = painPoints.findIndex(p => p.x === x && p.y === y);
            if (existingIndex > -1) {
                painPoints[existingIndex] = { x, y, description, level };
            } else {
                painPoints.push({ x, y, description, level });
            }
            renderPainEntries();
            
            // Deselect the dot after saving
            selectedPainDot.classList.remove('selected');
            selectedPainDot = null;
            painDescriptionInput.value = '';
            painLevelSelect.value = '';
        });

        function renderPainEntries() {
            if (painPoints.length === 0) {
                painEntriesOutput.textContent = translations[currentLanguage].painEntriesOutputDefault;
                return;
            }
            painEntriesOutput.innerHTML = painPoints.map((p, index) => `
                <div class="mb-2 p-3 border rounded-md bg-white flex justify-between items-center">
                    <div>
                        <p><strong>${currentLanguage === 'ta' ? 'பகுதி:' : 'Area:'}</strong> X:${p.x.toFixed(1)}%, Y:${p.y.toFixed(1)}%</p>
                        <p><strong>${currentLanguage === 'ta' ? 'விளக்கம்:' : 'Description:'}</strong> ${p.description}</p>
                        <p><strong>${currentLanguage === 'ta' ? 'தீவிரம்:' : 'Intensity:'}</strong> ${p.level}/10</p>
                    </div>
                    <button onclick="deletePainEntry(${index})" class="text-red-500 hover:text-red-700">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            <line x1="10" y1="11" x2="10" y2="17"></line>
                            <line x1="14" y1="11" x2="14" y2="17"></line>
                        </svg>
                    </button>
                </div>
            `).join('');
            // Re-render dots
            document.querySelectorAll('.pain-dot').forEach(dot => dot.remove());
            painPoints.forEach(p => {
                const dot = document.createElement('div');
                dot.classList.add('pain-dot');
                dot.style.left = `${p.x}%`;
                dot.style.top = `${p.y}%`;
                dot.dataset.x = p.x;
                dot.dataset.y = p.y;
                dot.addEventListener('click', (event) => {
                    event.stopPropagation(); // Prevent re-triggering bodyMapImage click
                    if (selectedPainDot) {
                        selectedPainDot.classList.remove('selected');
                    }
                    selectedPainDot = dot;
                    dot.classList.add('selected');
                    painDescriptionInput.value = p.description;
                    painLevelSelect.value = p.level;
                });
                bodyMapImage.parentElement.appendChild(dot);
            });
        }

        window.deletePainEntry = (index) => {
            painPoints.splice(index, 1);
            renderPainEntries();
        };

        // First Aid & Emergency
        const firstAidOutput = document.getElementById('firstAidOutput');
        const firstAidCutBtn = document.getElementById('firstAidCutBtn');
        const firstAidBurnBtn = document.getElementById('firstAidBurnBtn');
        const firstAidChokingBtn = document.getElementById('firstAidChokingBtn');
        const firstAidHeartAttackBtn = document.getElementById('firstAidHeartAttackBtn');
        const callAmbulanceBtn = document.getElementById('callAmbulanceBtn');
        const callPoliceBtn = document.getElementById('callPoliceBtn');
        const findHospitalsBtn = document.getElementById('findHospitalsBtn');
        const hospitalsMap = document.getElementById('hospitalsMap');

        const firstAidGuidance = {
            'cut': {
                'ta': 'வெட்டுக்காயங்கள்: காயத்தை சுத்தமான நீரில் கழுவவும். கிருமி நாசினி தடவி, கட்டு போடவும். ஆழமான காயம் எனில் மருத்துவரை அணுகவும்.',
                'en': 'Cuts: Clean the wound with clean water. Apply antiseptic and bandage. Consult a doctor for deep cuts.'
            },
            'burn': {
                'ta': 'தீக்காயங்கள்: தீக்காயத்தை 10-15 நிமிடங்களுக்கு குளிர்ந்த நீரில் வைக்கவும். கொப்புளங்களை உடைக்க வேண்டாம். சுத்தமான கட்டு போடவும். கடுமையான தீக்காயத்திற்கு மருத்துவரை அணுகவும்.',
                'en': 'Burns: Hold the burn under cool water for 10-15 minutes. Do not break blisters. Apply a clean dressing. Seek medical attention for severe burns.'
            },
            'choking': {
                'ta': 'மூச்சுத்திணறல்: ஹெய்ம்லிச் சூழ்ச்சியைப் பயன்படுத்தவும். நபர் சுவாசிக்கவோ, பேசவோ அல்லது இருமவோ முடியாவிட்டால், அவசர எண்ணுக்கு அழைக்கவும்.',
                'en': 'Choking: Administer the Heimlich maneuver. Call emergency if the person cannot breathe, speak, or cough.'
            },
            'heart_attack': {
                'ta': 'மாரடைப்பு: உடனடியாக 108 ஐ அழைக்கவும். ஆஸ்பிரின் கொடுக்கவும் (அலர்ஜி இல்லை என்றால்). பாதிக்கப்பட்டவர் ஓய்வெடுக்க உதவுங்கள். இறுக்கமான ஆடைகளை தளர்த்தவும்.',
                'en': 'Heart Attack: Call 108 immediately. Administer aspirin (if no allergy). Help the person rest. Loosen tight clothing.'
            }
        };

        firstAidCutBtn.addEventListener('click', () => {
            firstAidOutput.innerHTML = `<p>${firstAidGuidance.cut[currentLanguage]}</p>`;
        });
        firstAidBurnBtn.addEventListener('click', () => {
            firstAidOutput.innerHTML = `<p>${firstAidGuidance.burn[currentLanguage]}</p>`;
        });
        firstAidChokingBtn.addEventListener('click', () => {
            firstAidOutput.innerHTML = `<p>${firstAidGuidance.choking[currentLanguage]}</p>`;
        });
        firstAidHeartAttackBtn.addEventListener('click', () => {
            firstAidOutput.innerHTML = `<p>${firstAidGuidance.heart_attack[currentLanguage]}</p>`;
        });

        callAmbulanceBtn.addEventListener('click', () => {
            window.open('tel:108');
        });

        callPoliceBtn.addEventListener('click', () => {
            window.open('tel:100');
        });

        findHospitalsBtn.addEventListener('click', () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    const googleMapsUrl = `https://www.google.com/maps/search/hospitals/@${lat},${lon},15z`;
                    hospitalsMap.innerHTML = `<iframe src="${googleMapsUrl}" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>`;
                    hospitalsMap.style.backgroundColor = 'transparent'; // Remove gray background
                }, (error) => {
                    console.error('Error getting location:', error);
                    hospitalsMap.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'இருப்பிடத்தைக் கண்டறிய முடியவில்லை. இருப்பிட அனுமதியை உறுதிப்படுத்தவும்.' : 'Could not find location. Please ensure location permissions are granted.'}</p>`;
                });
            } else {
                hospitalsMap.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'உங்கள் உலாவி இருப்பிடத்தை ஆதரிக்கவில்லை.' : 'Geolocation is not supported by your browser.'}</p>`;
            }
        });

        // Initial setting of text content based on default language
        setTextContent();
        renderJournalEntries(); // Render any initial or saved journal entries
        renderReminders(); // Render any initial or saved medication reminders
        renderPainEntries(); // Render any initial or saved pain entries
    </script>
</body>
</html>
