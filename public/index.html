<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ஆரோக்கிய நண்பன் - உங்கள் ஆரோக்கிய வழிகாட்டி</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #E6F7FF; /* Light Blue */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1.5rem;
            color: #333333;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            box-sizing: border-box;
            transition: all 0.5s ease-in-out;
            overflow-y: auto; /* Allow scrolling for features */
        }

        .container {
            max-width: 640px;
            width: 100%;
            background-color: #ffffff;
            border-radius: 1.75rem;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08);
            padding: 2.5rem;
            text-align: center;
            position: relative;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .language-selector-wrapper {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
        }
        .input-wrapper {
            position: relative;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
        }
        .input-field {
            flex-grow: 1;
            padding: 1rem 1.25rem;
            padding-right: 3.5rem; /* Space for mic icon */
            border: 1px solid #D1D5DB;
            border-radius: 0.875rem;
            font-size: 1.05rem;
            box-sizing: border-box;
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .input-field:focus {
            border-color: #87CEEB;
            box-shadow: 0 0 0 3px rgba(135, 206, 235, 0.4);
        }
        .mic-button {
            position: absolute;
            right: 1rem;
            background: none;
            border: none;
            color: #0000FF;
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            transition: color 0.3s ease, background-color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        .mic-button:hover {
            color: #DC2626; /* Red */
            background-color: rgba(220, 38, 38, 0.1);
        }
        .mic-button.recording {
            color: #DC2626; /* Red */
            animation: pulse 1s infinite alternate;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.1); opacity: 0.7); }
        }

        .generate-button, .action-button, .ai-voice-button {
            background-color: #6A0DAD; /* Dark Violet */
            color: #ffffff;
            padding: 1rem 2rem;
            border-radius: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease;
            box-shadow: 0 6px 15px rgba(106, 13, 173, 0.4);
            letter-spacing: 0.025em;
            margin-top: 1rem;
            border: none;
            display: inline-flex; /* Ensure flex behavior for centering icon/text */
            align-items: center;
            justify-content: center;
            gap: 0.5rem; /* Space between icon and text */
        }
        .generate-button:hover, .action-button:hover, .ai-voice-button:hover {
            background-color: #4B0A7B; /* Darker Violet */
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(106, 13, 173, 0.5);
        }
        .generate-button:active, .action-button:active, .ai-voice-button:active {
            transform: translateY(0);
            box-shadow: 0 4px 10px rgba(106, 13, 173, 0.3);
        }
        .loading-indicator {
            display: none;
            margin-top: 2rem;
            font-size: 1.15rem;
            color: #6B7280;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #6A0DAD;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .tip-box, .result-box { /* Unified style for all output boxes */
            background-color: #FFFFAA; /* Light Yellow */
            border: 1px solid #CCCC88; /* Darker Yellow */
            border-radius: 1.25rem;
            padding: 2rem;
            margin-top: 2rem;
            text-align: left;
            color: #333333;
            line-height: 1.7;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
            font-size: 1.05rem;
            transition: all 0.5s ease-in-out;
            word-break: break-word; /* Ensure long words break */
        }
        .tip-box p, .result-box p {
            margin: 0;
        }
        .text-red-600 {
            color: #DC2626; /* Red */
        }
        /* Responsive adjustments */
        @media (max-width: 640px) {
            body {
                padding: 1rem;
            }
            .container {
                padding: 1.5rem;
                border-radius: 1.25rem;
            }
            .generate-button, .action-button, .ai-voice-button {
                width: 100%;
                padding: 0.9rem 1.5rem;
            }
            .language-selector-wrapper {
                top: 0.75rem;
                right: 0.75rem;
            }
            .input-wrapper {
                flex-direction: row;
                justify-content: center;
            }
            .mic-button {
                right: 0.5rem;
            }
        }
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #E6F7FF;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 1;
            transition: opacity 1s ease-out;
            overflow: hidden;
        }
        .splash-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }
        .splash-screen img {
            max-width: 25%;
            max-height: 25%;
            object-fit: contain;
        }

        /* Feature Button for Main Page */
        .features-toggle-button {
            font-size: 4rem; /* Even larger emoji size for the main toggle */
            cursor: pointer;
            padding: 1rem;
            border-radius: 1rem;
            transition: transform 0.3s ease, background-color 0.3s ease;
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            line-height: 1;
            margin-top: 2rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            background-color: #e0f2fe; /* Light blue background */
        }
        .features-toggle-button:hover {
            transform: scale(1.05);
            background-color: #bee3f8; /* Slightly darker blue hover */
        }
        .features-toggle-button span.label {
            font-size: 1rem;
            margin-top: 0.75rem;
            color: #333;
            font-weight: 600;
        }

        /* Feature Icons and Sections */
        .feature-icon-container {
            display: flex;
            justify-content: center;
            gap: 1.5rem; /* Space between icons */
            margin-top: 2rem;
            flex-wrap: wrap; /* Allow icons to wrap on smaller screens */
        }
        .feature-icon {
            font-size: 3rem; /* Larger emoji size */
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.75rem;
            transition: transform 0.2s ease, background-color 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            line-height: 1;
        }
        .feature-icon:hover {
            transform: translateY(-5px);
            background-color: rgba(135, 206, 235, 0.1); /* Light blue hover */
        }
        .feature-icon span.label {
            font-size: 0.8rem; /* Smaller text label */
            margin-top: 0.5rem;
            color: #555;
            font-weight: 500;
        }

        /* Feature sections (initially hidden, shown by JS) */
        .feature-section {
            display: none;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e5e7eb; /* Subtle separator */
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Specific feature section styles */
        .dropdown-menu {
            position: absolute;
            background-color: white;
            border: 1px solid #D1D5DB;
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            text-align: left;
            padding: 0.5rem 0;
            top: calc(100% + 5px); /* Position below input */
            left: 0;
        }
        .dropdown-menu div {
            padding: 0.75rem 1.25rem;
            cursor: pointer;
        }
        .dropdown-menu div:hover {
            background-color: #F3F4F6;
        }
        .dropdown-menu div.selected {
            background-color: #e0f2fe; /* light blue */
            font-weight: 500;
        }
        
        .tts-voice-selector {
            padding: 0.75rem;
            border: 1px solid #D1D5DB;
            border-radius: 0.875rem;
            font-size: 0.95rem;
            background-color: white;
            margin-left: 1rem;
            flex-grow: 1;
        }
        .body-map-container {
            position: relative;
            width: 100%;
            max-width: 300px; /* Adjust as needed */
            margin: 0 auto;
            border: 1px solid #ccc;
            border-radius: 10px;
            overflow: hidden;
        }
        .body-map-image {
            width: 100%;
            height: auto;
            display: block;
        }
        .pain-dot {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: red;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
            transform: translate(-50%, -50%); /* Center the dot on the click */
        }
        .pain-dot.selected {
            background-color: darkred;
            border: 2px solid yellow;
        }
        /* Hide all feature sections by default */
        .feature-section {
            display: none;
        }
        /* Show the main view or a specific section */
        #initialView, #allFeatureIconsContainer.active, .feature-section.active {
            display: block;
        }
        .back-button {
            background: none;
            border: none;
            color: #6A0DAD;
            font-weight: 600;
            cursor: pointer;
            padding: 0.5rem 0;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            font-size: 1rem;
            transition: color 0.3s ease;
        }
        .back-button:hover {
            color: #4B0A7B;
        }
    </style>
</head>
<body>
    <div id="splashScreen" class="splash-screen">
        <img src="https://via.placeholder.com/150/E6F7FF/000000?text=Healthcare+Logo" alt="Healthcare related image">
    </div>

    <div class="container" id="mainContent" style="display: none;">
        <div class="language-selector-wrapper">
            <select id="languageSelect" aria-label="Select Language" class="p-2 border border-gray-300 rounded-md text-sm bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-300">
                <option value="ta">தமிழ்</option>
                <option value="en">English</option>
            </select>
        </div>

        <div id="initialView">
            <h1 id="mainTitle" class="text-3xl font-bold text-gray-800 mb-4 lg:text-4xl"></h1>
            <p id="descriptionText" class="text-gray-600 mb-8 text-lg"></p>

            <h2 id="tipSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <div class="input-wrapper">
                <input type="text" id="goalInput" class="input-field" aria-label="உங்கள் ஆரோக்கிய இலக்கை உள்ளிடவும்">
                <button id="micBtn" class="mic-button" title="உங்கள் இலக்கைப் பேசுங்கள்" aria-label="உங்கள் ஆரோக்கிய இலக்கைப் பதிவு செய்யவும்">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" x2="12" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                    </svg>
                </button>
            </div>
            <div class="flex flex-wrap justify-center gap-4 mt-4">
                <button id="generateBtn" class="generate-button"></button>
                <button id="aiVoiceBtn" class="ai-voice-button" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg>
                </button>
                <select id="ttsVoiceSelect" class="tts-voice-selector" style="display: none;" aria-label="Select Voice"></select>
            </div>
            <div id="loading" class="loading-indicator" aria-live="polite">
                <div class="loading-spinner"></div>
                <p id="loadingText"></p>
            </div>
            <div id="tipOutput" class="tip-box" aria-live="polite"></div>

            <hr class="border-t border-gray-300 my-8">

            <h2 id="featuresTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <button id="toggleFeaturesBtn" class="features-toggle-button" title="அனைத்து அம்சங்களையும் காண்க">
                ✨<span class="label" data-label-key="showFeaturesLabel"></span>
            </button>
        </div>

        <!-- This div will now contain both the list of icons and the individual feature sections -->
        <div id="featuresContainer" style="display: none;">
            <!-- This button takes you back to the initial view from the features section -->
            <button class="back-button" id="backToMainFromFeaturesContainer" style="display: none;">← பின்செல்</button>
            <h1 id="featuresPageTitle" class="text-3xl font-bold text-gray-800 mb-6 mt-4 lg:text-4xl"></h1>

            <!-- All feature icons container -->
            <div id="allFeatureIconsContainer" class="feature-icon-container">
                <div id="iconStepTracker" class="feature-icon" data-section="stepTrackerSection" title="படி டிராக்கர்">👟<span class="label" data-label-key="stepTrackerLabel"></span></div>
                <div id="iconHeartRateTracker" class="feature-icon" data-section="heartRateTrackerSection" title="இதயத் துடிப்பு டிராக்கர்">💓<span class="label" data-label-key="heartRateTrackerLabel"></span></div>
                <div id="iconWaterTracker" class="feature-icon" data-section="waterTrackerSection" title="தண்ணீர் டிராக்கர்">💧<span class="label" data-label-key="waterTrackerLabel"></span></div>
                <div id="iconJournal" class="feature-icon" data-section="journalSection" title="மனநிலை & நன்றியுணர்வு ஜர்னல்">📝<span class="label" data-label-key="journalLabel"></span></div>
                <div id="iconLocalTips" class="feature-icon" data-section="localTipsSection" title="உள்ளூர் ஆரோக்கிய குறிப்புகள்">🌱<span class="label" data-label-key="localTipsLabel"></span></div>
                <div id="iconMealPlan" class="feature-icon" data-section="mealPlanSection" title="உணவுத் திட்டப் பரிந்துரைகள்">🍽️<span class="label" data-label-key="mealPlanLabel"></span></div>
                <div id="iconMoodAnalysis" class="feature-icon" data-section="moodAnalysisSection" title="உணர்வுப் பதிவேடு பகுப்பாய்வு">🧠<span class="label" data-label-key="moodAnalysisLabel"></span></div>
                <div id="iconExerciseYoga" class="feature-icon" data-section="exerciseYogaSection" title="உடற்பயிற்சி & யோகா">🤸‍♀️<span class="label" data-label-key="exerciseYogaLabel"></span></div>
                <div id="iconDiseasePrevention" class="feature-icon" data-section="diseasePreventionSection" title="நோய் தடுப்பு">🛡️<span class="label" data-label-key="diseasePreventionLabel"></span></div>
                <div id="iconWellnessChallenge" class="feature-icon" data-section="wellnessChallengeSection" title="ஆரோக்கிய சவால்கள்">🏅<span class="label" data-label-key="wellnessChallengeLabel"></span></div>
                <div id="iconMedicationReminder" class="feature-icon" data-section="medicationReminderSection" title="மருந்து நினைவூட்டல்">⏰<span class="label" data-label-key="medicationReminderLabel"></span></div>
                <div id="iconBodyPainMapping" class="feature-icon" data-section="bodyPainMappingSection" title="உடல் வலி மேப்பிங்">📍<span class="label" data-label-key="bodyPainMappingLabel"></span></div>
                <div id="iconFirstAidEmergency" class="feature-icon" data-section="firstAidEmergencySection" title="முதலுதவி & அவசர உதவி">🆘<span class="label" data-label-key="firstAidEmergencyLabel"></span></div>
            </div>

            <!-- All feature sections are now children of featuresContainer -->
            <div id="stepTrackerSection" class="feature-section">
                <!-- Data target for back button now points to the icons container -->
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="stepSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <div class="input-wrapper">
                    <label for="currentStepsDisplay" class="sr-only">தற்போதைய படிகள்</label>
                    <input type="text" id="currentStepsDisplay" class="input-field" value="0" readonly aria-atomic="true">
                </div>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="addOneStepBtn" class="action-button"></button>
                    <button id="toggleTrackingBtn" class="action-button"></button>
                    <button id="resetStepsBtn" class="action-button"></button>
                </div>
                <div id="stepResultOutput" class="result-box" aria-live="polite"></div>
            </div>

            <div id="heartRateTrackerSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="heartRateSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <div class="input-wrapper">
                    <label for="currentHeartRateDisplay" class="sr-only">தற்போதைய இதயத் துடிப்பு</label>
                    <input type="text" id="currentHeartRateDisplay" class="input-field" value="0" readonly aria-atomic="true">
                </div>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="simulateHeartRateBtn" class="action-button"></button>
                    <button id="resetHeartRateBtn" class="action-button"></button>
                </div>
                <div id="heartRateResultOutput" class="result-box" aria-live="polite"></div>
            </div>

            <div id="waterTrackerSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="waterSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <div class="input-wrapper">
                    <label for="waterIntakeDisplay" class="sr-only">தற்போதைய தண்ணீர் உட்கொள்ளல்</label>
                    <input type="text" id="waterIntakeDisplay" class="input-field" value="0 ml" readonly aria-atomic="true">
                </div>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="addWaterBtn" class="action-button"></button>
                    <button id="resetWaterBtn" class="action-button"></button>
                </div>
                <div id="waterResultOutput" class="result-box" aria-live="polite"></div>
            </div>

            <div id="journalSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="journalSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="journalDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper flex-col items-stretch">
                    <label for="moodSelect" class="sr-only">உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்</label>
                    <select id="moodSelect" class="input-field mb-4" aria-label="உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்">
                        <option value="">உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்</option>
                        <option value="happy">மகிழ்ச்சி 😄</option>
                        <option value="neutral">சாதாரணம் 😐</option>
                        <option value="sad">சோகம் 😔</option>
                        <option value="stressed">மன அழுத்தம் 😩</option>
                        <option value="energetic">ஆற்றல் 💪</option>
                    </select>
                    <label for="gratitudeInput" class="sr-only">நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்</label>
                    <textarea id="gratitudeInput" class="input-field min-h-[100px]" placeholder="நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்..." aria-label="நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்"></textarea>
                </div>
                <button id="saveJournalEntryBtn" class="action-button mt-4"></button>
                <div id="journalEntriesOutput" class="result-box mt-4 text-left"></div>
            </div>

            <div id="localTipsSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="localTipsSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="localTipsDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper mb-4">
                    <input type="text" id="localTipCategory" class="input-field" aria-label="உதவிக்குறிப்பு வகையை உள்ளிடவும்" placeholder="எ.கா. மஞ்சள், முருங்கை, தியானம்...">
                    <div id="localTipCategoryDropdown" class="dropdown-menu hidden mt-2 top-full left-0"></div>
                </div>
                <button id="getLocalTipBtn" class="generate-button"></button>
                <div id="localTipOutput" class="tip-box" aria-live="polite"></div>
            </div>

            <div id="mealPlanSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="mealPlanSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="mealPlanDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper flex-col items-stretch">
                    <label for="dietGoalInput" class="sr-only">உணவு இலக்கு</label>
                    <input type="text" id="dietGoalInput" class="input-field mb-4" placeholder="எ.கா. எடை குறைப்பு, தசை வளர்ச்சி..." aria-label="உணவு இலக்கு">

                    <label for="dietPreferenceSelect" class="sr-only">உணவு விருப்பம்</label>
                    <select id="dietPreferenceSelect" class="input-field mb-4" aria-label="உணவு விருப்பம்">
                        <option value="">உணவு விருப்பத்தைத் தேர்ந்தெடுக்கவும்</option>
                        <option value="vegetarian">சைவம்</option>
                        <option value="non-vegetarian">அசைவம்</option>
                        <option value="vegan">முழு சைவம்</option>
                    </select>

                    <label for="allergiesInput" class="sr-only">ஒவ்வாமைகள் (இருப்பின்)</label>
                    <input type="text" id="allergiesInput" class="input-field mb-4" placeholder="எ.கா. நிலக்கடலை, பால்..." aria-label="ஒவ்வாமைகள்">
                </div>
                <button id="generateMealPlanBtn" class="action-button mt-4"></button>
                <div id="mealPlanOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
            </div>

            <div id="moodAnalysisSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="moodAnalysisSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="moodAnalysisDescription" class="text-gray-600 mb-4 text-lg"></p>
                <button id="analyzeMoodJournalBtn" class="action-button mt-4"></button>
                <div id="moodAnalysisOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
            </div>

            <div id="exerciseYogaSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="exerciseYogaSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="exerciseYogaDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper flex-col items-stretch">
                    <label for="fitnessLevelSelect" class="sr-only">உடற்பயிற்சி நிலை</label>
                    <select id="fitnessLevelSelect" class="input-field mb-4" aria-label="உடற்பயிற்சி நிலை">
                        <option value="">உடற்பயிற்சி நிலையைத் தேர்ந்தெடுக்கவும்</option>
                        <option value="beginner">ஆரம்பநிலை</option>
                        <option value="intermediate">நடுநிலை</option>
                        <option value="advanced">மேம்பட்டது</option>
                    </select>

                    <label for="timeAvailableInput" class="sr-only">கிடைக்கக்கூடிய நேரம் (நிமிடங்கள்)</label>
                    <input type="number" id="timeAvailableInput" class="input-field mb-4" placeholder="கிடைக்கக்கூடிய நேரம் (நிமிடங்கள்)..." aria-label="கிடைக்கக்கூடிய நேரம்">

                    <label for="exerciseGoalInput" class="sr-only">உடற்பயிற்சி இலக்கு</label>
                    <input type="text" id="exerciseGoalInput" class="input-field mb-4" placeholder="எ.கா. உடல் நெகிழ்வுத்தன்மை, தசைகளை உருவாக்குதல்..." aria-label="உடற்பயிற்சி இலக்கு">
                </div>
                <button id="generateExerciseRoutineBtn" class="action-button mt-4"></button>
                <div id="exerciseRoutineOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
            </div>

            <div id="diseasePreventionSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="diseasePreventionSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="diseasePreventionDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper mb-4">
                    <input type="text" id="healthConcernInput" class="input-field" aria-label="உடல்நலக் கவலையை உள்ளிடவும்" placeholder="எ.கா. ஜலதோஷம், செரிமானப் பிரச்சனை...">
                </div>
                <button id="getRemedyBtn" class="generate-button"></button>
                <div id="remedyOutput" class="tip-box" aria-live="polite"></div>
            </div>

            <div id="wellnessChallengeSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="wellnessChallengeSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="wellnessChallengeDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper flex-col items-stretch">
                    <label for="currentHabitInput" class="sr-only">தற்போதைய பழக்கம் (எ.கா. நீர் உட்கொள்ளல்)</label>
                    <input type="text" id="currentHabitInput" class="input-field mb-4" placeholder="உங்கள் தற்போதைய பழக்கம் (எ.கா. 1000ml தண்ணீர்)..." aria-label="தற்போதைய பழக்கம்">
                    
                    <label for="challengeGoalInput" class="sr-only">சவால் இலக்கு (எ.கா. 2000ml தண்ணீர்)</label>
                    <input type="text" id="challengeGoalInput" class="input-field mb-4" placeholder="உங்கள் சவால் இலக்கு (எ.கா. 2000ml தண்ணீர்)..." aria-label="சவால் இலக்கு">
                </div>
                <button id="generateChallengeBtn" class="action-button mt-4"></button>
                <div id="challengeOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
            </div>

            <div id="medicationReminderSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="medicationReminderSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="medicationReminderDescription" class="text-gray-600 mb-4 text-lg"></p>

                <div class="input-wrapper flex-col items-stretch mb-4">
                    <label for="medicationNameInput" class="sr-only">மருந்தின் பெயர்</label>
                    <input type="text" id="medicationNameInput" class="input-field mb-4" placeholder="மருந்தின் பெயர்..." aria-label="மருந்தின் பெயர்">

                    <label for="medicationTimeInput" class="sr-only">நேரம்</label>
                    <input type="time" id="medicationTimeInput" class="input-field mb-4" aria-label="நேரம்">

                    <label for="medicationFrequencySelect" class="sr-only">நினைவூட்டல் அதிர்வெண்</label>
                    <select id="medicationFrequencySelect" class="input-field mb-4" aria-label="நினைவூட்டல் அதிர்வெண்">
                        <option value="">நினைவூட்டல் அதிர்வெண்ணைத் தேர்ந்தெடுக்கவும்</option>
                        <option value="daily">தினமும்</option>
                        <option value="weekly">வாராந்திர</option>
                        <option value="once">ஒரு முறை</option>
                    </select>
                </div>
                <button id="addMedicationReminderBtn" class="action-button mt-4"></button>
                <div id="medicationRemindersOutput" class="result-box mt-4 text-left" aria-live="polite">
                    <h3 class="text-xl font-semibold text-gray-700 mb-3" id="activeRemindersTitle"></h3>
                    <ul id="activeRemindersList" class="list-disc pl-5">
                        </ul>
                    <p id="noRemindersMessage" class="text-gray-500 italic mt-2"></p>
                </div>
            </div>

            <div id="bodyPainMappingSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="bodyPainMappingSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="bodyPainMappingDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="body-map-container">
                    <img id="bodyMapImage" src="https://via.placeholder.com/300x500/E0E0E0/333333?text=Human+Body+Map" alt="Human Body Map" class="body-map-image">
                    <!-- Pain dots will be added here dynamically by JavaScript -->
                </div>
                <p id="selectedPainAreas" class="text-gray-700 mt-4 text-lg font-semibold"></p>
                <button id="getPainSuggestionsBtn" class="action-button mt-4"></button>
                <div id="painSuggestionOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
            </div>

            <div id="firstAidEmergencySection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="firstAidEmergencySectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="firstAidEmergencyDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper mb-4">
                    <input type="text" id="emergencyTopicInput" class="input-field" aria-label="அவசர தலைப்பை உள்ளிடவும்" placeholder="எ.கா. சிறிய வெட்டு, மயக்கம்...">
                    <div id="emergencyTopicDropdown" class="dropdown-menu hidden mt-2 top-full left-0"></div>
                </div>
                <button id="getEmergencyInfoBtn" class="generate-button"></button>
                <div id="emergencyInfoOutput" class="tip-box" aria-live="polite"></div>
            </div>

        </div> <!-- Close featuresContainer -->
    </div> <!-- Close main container -->

    <script>
        // Language specific texts
        const translations = {
            'ta': {
                appName: "ஆரோக்கிய நண்பன்",
                tagline: "உங்கள் ஆரோக்கிய வழிகாட்டி",
                mainTitle: "ஆரோக்கிய நண்பன்",
                descriptionText: "உங்கள் ஆரோக்கிய இலக்குகளை அடைய உதவும் தனிப்பயனாக்கப்பட்ட குறிப்புகள் மற்றும் வழிகாட்டுதல்களைப் பெறுங்கள். உங்கள் இலக்கை கீழே உள்ளிட்டு அல்லது குரல் மூலம் கேட்கவும்.",
                tipSectionTitle: "உங்கள் ஆரோக்கிய இலக்கு",
                goalInputPlaceholder: "உங்கள் ஆரோக்கிய இலக்கை உள்ளிடவும் (எ.கா. எடை குறைப்பு, மன அழுத்த மேலாண்மை)",
                micButtonTitle: "உங்கள் இலக்கைப் பேசுங்கள்",
                generateButtonText: "ஆரோக்கிய குறிப்புகளை உருவாக்கு",
                loadingText: "உருவாக்கப்படுகிறது...",
                generatingTips: "உங்களுக்கு ஏற்ற ஆரோக்கிய குறிப்புகள் உருவாக்கப்படுகின்றன...",
                apiError: "குறிப்புகளைப் பெறுவதில் சிக்கல் ஏற்பட்டது. மீண்டும் முயற்சிக்கவும்.",
                tipOutputPlaceholder: "உங்கள் ஆரோக்கிய குறிப்புகள் இங்கே தோன்றும்...",
                featuresTitle: "மேலும் அம்சங்கள்",
                showFeaturesLabel: "அனைத்து அம்சங்களையும் காண்க",
                featuresPageTitle: "ஆரோக்கிய நண்பன் அம்சங்கள்",
                backToFeaturesListButtonText: "← அம்சங்களுக்கு பின்செல்", // New translation
                backToMainButtonText: "← பின்செல்", // For going back to initial view
                stepTrackerLabel: "படி டிராக்கர்",
                stepSectionTitle: "படி டிராக்கர்",
                currentStepsDisplayLabel: "தற்போதைய படிகள்:",
                addOneStepButtonText: "ஒரு படி சேர்",
                toggleTrackingButtonText: "டிராக்கிங்கை தொடங்கு/நிறுத்து",
                resetStepsButtonText: "படிகளை மீட்டமை",
                stepResultOutputPlaceholder: "உங்கள் படி டிராக்கர் நிலை இங்கே தோன்றும்...",
                heartRateTrackerLabel: "இதயத் துடிப்பு டிராக்கர்",
                heartRateSectionTitle: "இதயத் துடிப்பு டிராக்கர்",
                currentHeartRateDisplayLabel: "தற்போதைய இதயத் துடிப்பு:",
                simulateHeartRateButtonText: "இதயத் துடிப்பை உருவகப்படுத்து",
                resetHeartRateButtonText: "இதயத் துடிப்பை மீட்டமை",
                heartRateResultOutputPlaceholder: "உங்கள் இதயத் துடிப்பு நிலை இங்கே தோன்றும்...",
                waterTrackerLabel: "தண்ணீர் டிராக்கர்",
                waterSectionTitle: "தண்ணீர் டிராக்கர்",
                waterIntakeDisplayLabel: "தற்போதைய தண்ணீர் உட்கொள்ளல்:",
                addWaterButtonText: "200ml தண்ணீர் சேர்",
                resetWaterButtonText: "தண்ணீரை மீட்டமை",
                waterResultOutputPlaceholder: "உங்கள் தண்ணீர் உட்கொள்ளல் நிலை இங்கே தோன்றும்...",
                journalLabel: "மனநிலை & நன்றியுணர்வு ஜர்னல்",
                journalSectionTitle: "மனநிலை & நன்றியுணர்வு ஜர்னல்",
                journalDescription: "உங்கள் தினசரி மனநிலையையும், நீங்கள் நன்றியுள்ள விஷயங்களையும் பதிவு செய்யுங்கள். இது உங்கள் உணர்ச்சி ஆரோக்கியத்தைப் புரிந்துகொள்ள உதவும்.",
                moodSelectPlaceholder: "உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்",
                gratitudeInputPlaceholder: "நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்...",
                saveJournalEntryButtonText: "பதிவை சேமி",
                journalEntriesOutputPlaceholder: "உங்கள் ஜர்னல் பதிவுகள் இங்கே தோன்றும்...",
                localTipsLabel: "உள்ளூர் ஆரோக்கிய குறிப்புகள்",
                localTipsSectionTitle: "உள்ளூர் ஆரோக்கிய குறிப்புகள்",
                localTipsDescription: "தமிழ்நாடு மற்றும் இந்தியாவிற்கு குறிப்பிட்ட உள்ளூர் மூலிகைகள், பாரம்பரிய சிகிச்சைகள் மற்றும் ஆரோக்கிய நடைமுறைகள் பற்றி அறிக.",
                localTipCategoryPlaceholder: "எ.கா. மஞ்சள், முருங்கை, தியானம்...",
                getLocalTipButtonText: "உதவிக்குறிப்பைப் பெறு",
                localTipOutputPlaceholder: "உள்ளூர் ஆரோக்கிய குறிப்புகள் இங்கே தோன்றும்...",
                mealPlanLabel: "உணவுத் திட்டப் பரிந்துரைகள்",
                mealPlanSectionTitle: "உணவுத் திட்டப் பரிந்துரைகள்",
                mealPlanDescription: "உங்கள் இலக்குகள், உணவு விருப்பங்கள் மற்றும் ஒவ்வாமைகளின் அடிப்படையில் தனிப்பயனாக்கப்பட்ட உணவுத் திட்டங்களை உருவாக்குங்கள்.",
                dietGoalInputPlaceholder: "எ.கா. எடை குறைப்பு, தசை வளர்ச்சி...",
                dietPreferenceSelectPlaceholder: "உணவு விருப்பத்தைத் தேர்ந்தெடுக்கவும்",
                vegetarianOption: "சைவம்",
                nonVegetarianOption: "அசைவம்",
                veganOption: "முழு சைவம்",
                allergiesInputPlaceholder: "எ.கா. நிலக்கடலை, பால்...",
                generateMealPlanButtonText: "உணவுத் திட்டத்தை உருவாக்கு",
                mealPlanOutputPlaceholder: "உங்கள் உணவுத் திட்டம் இங்கே தோன்றும்...",
                moodAnalysisLabel: "உணர்வுப் பதிவேடு பகுப்பாய்வு",
                moodAnalysisSectionTitle: "உணர்வுப் பதிவேடு பகுப்பாய்வு",
                moodAnalysisDescription: "உங்கள் ஜர்னல் பதிவுகளிலிருந்து உங்கள் மனநிலை போக்குகள் மற்றும் வடிவங்களை பகுப்பாய்வு செய்யுங்கள்.",
                analyzeMoodJournalButtonText: "மனநிலை பகுப்பாய்வு செய்",
                moodAnalysisOutputPlaceholder: "உங்கள் மனநிலை பகுப்பாய்வு இங்கே தோன்றும்...",
                exerciseYogaLabel: "உடற்பயிற்சி & யோகா",
                exerciseYogaSectionTitle: "உடற்பயிற்சி & யோகா",
                exerciseYogaDescription: "உங்கள் உடற்பயிற்சி நிலை, கிடைக்கக்கூடிய நேரம் மற்றும் இலக்குகளின் அடிப்படையில் தனிப்பயனாக்கப்பட்ட உடற்பயிற்சி மற்றும் யோகா நடைமுறைகளைப் பெறுங்கள்.",
                fitnessLevelSelectPlaceholder: "உடற்பயிற்சி நிலையைத் தேர்ந்தெடுக்கவும்",
                beginnerOption: "ஆரம்பநிலை",
                intermediateOption: "நடுநிலை",
                advancedOption: "மேம்பட்டது",
                timeAvailableInputPlaceholder: "கிடைக்கக்கூடிய நேரம் (நிமிடங்கள்)...",
                exerciseGoalInputPlaceholder: "எ.கா. உடல் நெகிழ்வுத்தன்மை, தசைகளை உருவாக்குதல்...",
                generateExerciseRoutineButtonText: "உடற்பயிற்சி வழக்கத்தை உருவாக்கு",
                exerciseRoutineOutputPlaceholder: "உங்கள் உடற்பயிற்சி வழக்கம் இங்கே தோன்றும்...",
                diseasePreventionLabel: "நோய் தடுப்பு",
                diseasePreventionSectionTitle: "நோய் தடுப்பு",
                diseasePreventionDescription: "பொதுவான உடல்நலக் கவலைகள் மற்றும் நோய்களுக்கான தடுப்பு குறிப்புகள் மற்றும் வீட்டு வைத்தியங்களை அறிக.",
                healthConcernInputPlaceholder: "எ.கா. ஜலதோஷம், செரிமானப் பிரச்சனை...",
                getRemedyButtonText: "தீர்வைப் பெறு",
                remedyOutputPlaceholder: "தடுப்பு குறிப்புகள்/வீட்டு வைத்தியங்கள் இங்கே தோன்றும்...",
                wellnessChallengeLabel: "ஆரோக்கிய சவால்கள்",
                wellnessChallengeSectionTitle: "ஆரோக்கிய சவால்கள்",
                wellnessChallengeDescription: "உங்கள் ஆரோக்கியத்தை மேம்படுத்த சவால்களைத் தொடங்குங்கள் மற்றும் கண்காணிக்கவும். படிப்படியாக உங்கள் பழக்கங்களை மேம்படுத்துங்கள்.",
                currentHabitInputPlaceholder: "உங்கள் தற்போதைய பழக்கம் (எ.கா. 1000ml தண்ணீர்)...",
                challengeGoalInputPlaceholder: "உங்கள் சவால் இலக்கு (எ.கா. 2000ml தண்ணீர்)...",
                generateChallengeButtonText: "சவாலை உருவாக்கு",
                challengeOutputPlaceholder: "உங்கள் சவால் இங்கே தோன்றும்...",
                medicationReminderLabel: "மருந்து நினைவூட்டல்",
                medicationReminderSectionTitle: "மருந்து நினைவூட்டல்",
                medicationReminderDescription: "உங்கள் மருந்து நேரங்களை ஒருபோதும் தவறவிடாதீர்கள். நினைவூட்டல்களை அமைத்து உங்கள் மருந்துகளை சரியான நேரத்தில் எடுத்துக் கொள்ளுங்கள்.",
                medicationNameInputPlaceholder: "மருந்தின் பெயர்...",
                medicationTimeInputPlaceholder: "நேரம்",
                medicationFrequencySelectPlaceholder: "நினைவூட்டல் அதிர்வெண்ணைத் தேர்ந்தெடுக்கவும்",
                dailyOption: "தினமும்",
                weeklyOption: "வாராந்திர",
                onceOption: "ஒரு முறை",
                addMedicationReminderButtonText: "நினைவூட்டலை சேர்",
                activeRemindersTitle: "செயலில் உள்ள நினைவூட்டல்கள்:",
                noRemindersMessage: "தற்போது நினைவூட்டல்கள் இல்லை.",
                medicationRemindersOutputPlaceholder: "உங்கள் மருந்து நினைவூட்டல்கள் இங்கே தோன்றும்...",
                bodyPainMappingLabel: "உடல் வலி மேப்பிங்",
                bodyPainMappingSectionTitle: "உடல் வலி மேப்பிங்",
                bodyPainMappingDescription: "உடலின் வரைபடத்தில் நீங்கள் வலியை உணரும் இடங்களைக் குறிக்கவும். இது பொதுவான காரணங்கள் மற்றும் நிவாரண வழிகளைப் புரிந்துகொள்ள உதவும்.",
                getPainSuggestionsButtonText: "பரிந்துரைகளைப் பெறு",
                painSuggestionOutputPlaceholder: "வலி பகுப்பாய்வு மற்றும் பரிந்துரைகள் இங்கே தோன்றும்.",
                firstAidEmergencyLabel: "முதலுதவி & அவசர உதவி",
                firstAidEmergencySectionTitle: "முதலுதவி & அவசர உதவி",
                firstAidEmergencyDescription: "பொதுவான காயங்கள் மற்றும் அவசர சூழ்நிலைகளுக்கான உடனடி முதலுதவி தகவல்களைப் பெறுங்கள்.",
                emergencyTopicInputPlaceholder: "எ.கா. சிறிய வெட்டு, மயக்கம்...",
                getEmergencyInfoButtonText: "தகவலைப் பெறு",
                emergencyInfoOutputPlaceholder: "முதலுதவி/அவசர உதவி தகவல்கள் இங்கே தோன்றும்...",
                aiVoiceButtonText: "AI குரலில் கேட்க",
                aiVoiceButtonStopText: "குரலை நிறுத்து",
            },
            'en': {
                appName: "Arokya Nanban",
                tagline: "Your Health Guide",
                mainTitle: "Arokya Nanban",
                descriptionText: "Get personalized tips and guidance to achieve your health goals. Enter your goal below or speak it out.",
                tipSectionTitle: "Your Health Goal",
                goalInputPlaceholder: "Enter your health goal (e.g., weight loss, stress management)",
                micButtonTitle: "Speak your goal",
                generateButtonText: "Generate Health Tips",
                loadingText: "Generating...",
                generatingTips: "Generating personalized health tips for you...",
                apiError: "Failed to retrieve tips. Please try again.",
                tipOutputPlaceholder: "Your health tips will appear here...",
                featuresTitle: "More Features",
                showFeaturesLabel: "See All Features",
                featuresPageTitle: "Arokya Nanban Features",
                backToFeaturesListButtonText: "← Back to Features", // New translation
                backToMainButtonText: "← Back", // For going back to initial view
                stepTrackerLabel: "Step Tracker",
                stepSectionTitle: "Step Tracker",
                currentStepsDisplayLabel: "Current Steps:",
                addOneStepButtonText: "Add 1 Step",
                toggleTrackingButtonText: "Start/Stop Tracking",
                resetStepsButtonText: "Reset Steps",
                stepResultOutputPlaceholder: "Your step tracking status will appear here...",
                heartRateTrackerLabel: "Heart Rate Tracker",
                heartRateSectionTitle: "Heart Rate Tracker",
                currentHeartRateDisplayLabel: "Current Heart Rate:",
                simulateHeartRateButtonText: "Simulate Heart Rate",
                resetHeartRateButtonText: "Reset Heart Rate",
                heartRateResultOutputPlaceholder: "Your heart rate status will appear here...",
                waterTrackerLabel: "Water Tracker",
                waterSectionTitle: "Water Tracker",
                waterIntakeDisplayLabel: "Current Water Intake:",
                addWaterButtonText: "Add 200ml Water",
                resetWaterButtonText: "Reset Water",
                waterResultOutputPlaceholder: "Your water intake status will appear here...",
                journalLabel: "Mood & Gratitude Journal",
                journalSectionTitle: "Mood & Gratitude Journal",
                journalDescription: "Log your daily mood and things you're grateful for. This helps understand your emotional well-being.",
                moodSelectPlaceholder: "Select your mood",
                gratitudeInputPlaceholder: "Write something you're grateful for...",
                saveJournalEntryButtonText: "Save Entry",
                journalEntriesOutputPlaceholder: "Your journal entries will appear here...",
                localTipsLabel: "Local Health Tips",
                localTipsSectionTitle: "Local Health Tips",
                localTipsDescription: "Learn about local herbs, traditional remedies, and wellness practices specific to Tamil Nadu and India.",
                localTipCategoryPlaceholder: "e.g., Turmeric, Moringa, Meditation...",
                getLocalTipButtonText: "Get Tip",
                localTipOutputPlaceholder: "Local health tips will appear here...",
                mealPlanLabel: "Meal Plan Recommendations",
                mealPlanSectionTitle: "Meal Plan Recommendations",
                mealPlanDescription: "Generate personalized meal plans based on your goals, dietary preferences, and allergies.",
                dietGoalInputPlaceholder: "e.g., Weight loss, Muscle gain...",
                dietPreferenceSelectPlaceholder: "Select diet preference",
                vegetarianOption: "Vegetarian",
                nonVegetarianOption: "Non-Vegetarian",
                veganOption: "Vegan",
                allergiesInputPlaceholder: "e.g., Peanuts, Dairy...",
                generateMealPlanButtonText: "Generate Meal Plan",
                mealPlanOutputPlaceholder: "Your meal plan will appear here...",
                moodAnalysisLabel: "Mood Journal Analysis",
                moodAnalysisSectionTitle: "Mood Journal Analysis",
                moodAnalysisDescription: "Analyze your mood trends and patterns from your journal entries.",
                analyzeMoodJournalButtonText: "Analyze Mood",
                moodAnalysisOutputPlaceholder: "Your mood analysis will appear here...",
                exerciseYogaLabel: "Exercise & Yoga",
                exerciseYogaSectionTitle: "Exercise & Yoga",
                exerciseYogaDescription: "Get personalized exercise and yoga routines based on your fitness level, time available, and goals.",
                fitnessLevelSelectPlaceholder: "Select fitness level",
                beginnerOption: "Beginner",
                intermediateOption: "Intermediate",
                advancedOption: "Advanced",
                timeAvailableInputPlaceholder: "Time available (minutes)...",
                exerciseGoalInputPlaceholder: "e.g., Flexibility, Muscle building...",
                generateExerciseRoutineButtonText: "Generate Routine",
                exerciseRoutineOutputPlaceholder: "Your exercise routine will appear here...",
                diseasePreventionLabel: "Disease Prevention",
                diseasePreventionSectionTitle: "Disease Prevention",
                diseasePreventionDescription: "Learn about preventive tips and home remedies for common health concerns and diseases.",
                healthConcernInputPlaceholder: "e.g., Cold, Digestion issues...",
                getRemedyButtonText: "Get Remedy",
                remedyOutputPlaceholder: "Prevention tips/home remedies will appear here...",
                wellnessChallengeLabel: "Wellness Challenges",
                wellnessChallengeSectionTitle: "Wellness Challenges",
                wellnessChallengeDescription: "Start and track challenges to improve your well-being. Gradually improve your habits.",
                currentHabitInputPlaceholder: "Your current habit (e.g., 1000ml water)...",
                challengeGoalInputPlaceholder: "Your challenge goal (e.g., 2000ml water)...",
                generateChallengeButtonText: "Generate Challenge",
                challengeOutputPlaceholder: "Your challenge will appear here...",
                medicationReminderLabel: "Medication Reminder",
                medicationReminderSectionTitle: "Medication Reminder",
                medicationReminderDescription: "Never miss your medication times. Set reminders and take your medicines on time.",
                medicationNameInputPlaceholder: "Medication name...",
                medicationTimeInputPlaceholder: "Time",
                medicationFrequencySelectPlaceholder: "Select reminder frequency",
                dailyOption: "Daily",
                weeklyOption: "Weekly",
                onceOption: "Once",
                addMedicationReminderButtonText: "Add Reminder",
                activeRemindersTitle: "Active Reminders:",
                noRemindersMessage: "No reminders currently set.",
                medicationRemindersOutputPlaceholder: "Your medication reminders will appear here...",
                bodyPainMappingLabel: "Body Pain Mapping",
                bodyPainMappingSectionTitle: "Body Pain Mapping",
                bodyPainMappingDescription: "Mark areas on the body map where you feel pain. This can help understand common causes and relief methods.",
                getPainSuggestionsButtonText: "Get Suggestions",
                painSuggestionOutputPlaceholder: "Pain analysis and suggestions will appear here.",
                firstAidEmergencyLabel: "First Aid & Emergency",
                firstAidEmergencySectionTitle: "First Aid & Emergency",
                firstAidEmergencyDescription: "Get immediate first aid information for common injuries and emergency situations.",
                emergencyTopicInputPlaceholder: "e.g., Minor cut, Fainting...",
                getEmergencyInfoButtonText: "Get Info",
                emergencyInfoOutputPlaceholder: "First aid/emergency info will appear here...",
                aiVoiceButtonText: "Listen in AI Voice",
                aiVoiceButtonStopText: "Stop Voice",
            }
        };

        let currentLanguage = 'ta'; // Default language
        let speechRecognition;
        let isRecording = false;
        let audioPlayer = new Audio();
        let currentUtterance = null; // To keep track of the current speech synthesis utterance

        // Feature state management
        let currentView = 'initial'; // 'initial', 'featuresContainer', 'stepTrackerSection', etc.

        // Data for features
        let steps = 0;
        let isStepTracking = false;
        let waterIntake = 0;
        let journalEntries = [];
        let medicationReminders = [];
        let painPoints = []; // Stores {x, y, id} of pain dots

        // Mock data for local tips and emergencies (for demonstration)
        const localTipsData = {
            'ta': {
                'மஞ்சள்': 'மஞ்சள் ஒரு சக்திவாய்ந்த அழற்சி எதிர்ப்பு மற்றும் ஆன்டிஆக்ஸிடன்ட் ஆகும். இதை உங்கள் உணவில் சேர்த்துக்கொள்வது அல்லது மேற்பூச்சாக பயன்படுத்துவது வீக்கத்தைக் குறைக்க உதவும்.',
                'முருங்கை': 'முருங்கை இலைகள் வைட்டமின்கள், தாதுக்கள் மற்றும் ஆக்ஸிஜனேற்றங்களால் நிறைந்துள்ளன. நோய் எதிர்ப்பு சக்தியை அதிகரிக்கவும் ஒட்டுமொத்த ஆரோக்கியத்தை மேம்படுத்தவும் இதை சூப் அல்லது சமையலில் பயன்படுத்தலாம்.',
                'தியானம்': 'தியானம் மன அழுத்தத்தைக் குறைப்பதற்கும் மன அமைதியை மேம்படுத்துவதற்கும் ஒரு சிறந்த வழியாகும். தினமும் சில நிமிடங்கள் தியானம் செய்வது மன மற்றும் உடல் ஆரோக்கியத்திற்கு நன்மை பயக்கும்.',
                'நிலவேம்பு': 'நிலவேம்பு என்பது காய்ச்சல், சளி மற்றும் பிற நோய்த்தொற்றுகளுக்கு பாரம்பரியமாகப் பயன்படுத்தப்படும் ஒரு கசப்பான மூலிகையாகும். இது நோய் எதிர்ப்பு சக்தியை அதிகரிக்கும் பண்புகளைக் கொண்டுள்ளது.',
                'தூதுவளை': 'தூதுவளை என்பது சுவாச பிரச்சனைகள், இருமல் மற்றும் சளி போன்றவற்றுக்கு பாரம்பரிய மருத்துவத்தில் பயன்படுத்தப்படும் ஒரு பொதுவான மூலிகையாகும். இது சளி நீக்கும் பண்புகளைக் கொண்டுள்ளது.',
                'யோகா': 'யோகா உடல் ஆரோக்கியம், மன அமைதி மற்றும் ஆன்மீக வளர்ச்சிக்கு உதவுகிறது. இது உடல் நெகிழ்வுத்தன்மை, தசை வலிமை மற்றும் மன அழுத்த மேலாண்மைக்கு நன்மை பயக்கும்.'
            },
            'en': {
                'turmeric': 'Turmeric is a powerful anti-inflammatory and antioxidant. Incorporating it into your diet or applying it topically can help reduce inflammation.',
                'moringa': 'Moringa leaves are packed with vitamins, minerals, and antioxidants. Use them in soups or cooking to boost immunity and overall well-being.',
                'meditation': 'Meditation is an excellent way to reduce stress and improve mental clarity. Practicing a few minutes daily can benefit both mental and physical health.',
                'nilavembu': 'Nilavembu is a bitter herb traditionally used for fever, cold, and other infections. It is known for its immune-boosting properties.',
                'thuthuvalai': 'Thuthuvalai is a common herb used in traditional medicine for respiratory issues, cough, and cold. It has expectorant properties.',
                'yoga': 'Yoga helps in physical fitness, mental peace, and spiritual growth. It is beneficial for flexibility, muscle strength, and stress management.'
            }
        };

        const emergencyInfoData = {
            'ta': {
                'சிறிய வெட்டு': 'ஒரு சிறிய வெட்டிற்கு, வெட்டப்பட்ட பகுதியை சோப்பு மற்றும் தண்ணீரில் மெதுவாகக் கழுவவும். பிறகு, இரத்தப்போக்கு நிறுத்த அழுத்தம் கொடுக்கவும். ஒரு கிருமிநாசினி லோஷன் அல்லது களிம்பு தடவி, ஒரு பிளாஸ்டர் மூலம் மூடவும்.',
                'மயக்கம்': 'மயக்கம் வருவது போல் உணர்ந்தால், தரையில் படுத்து உங்கள் கால்களை உயர்த்தவும். இறுக்கமான ஆடைகளை தளர்த்தவும். சுவாசிக்க சுத்தமான காற்று கிடைக்கும்படி கூட்டத்தை அகற்றவும். ஒருமுறை மயக்கம் அடைந்தால், அவரை மெதுவாக ஒரு பக்கமாகத் திருப்பி, சுவாசம் உள்ளதா என உறுதி செய்யவும். விரைவில் மருத்துவ உதவியை நாடவும்.',
                'எலும்பு முறிவு': 'எலும்பு முறிவு ஏற்பட்டால், பாதிக்கப்பட்ட பகுதியை நகர்த்த வேண்டாம். முறிந்த பாகத்தை ஒரு கட்டு அல்லது துணியால் கட்டி உறுதுணையாகப் பிடிக்கவும். குளிர் ஒத்தடம் கொடுக்கலாம். உடனடியாக மருத்துவமனைக்கு செல்லவும்.',
                'தீக்காயம்': 'சாதாரண தீக்காயத்திற்கு, பாதிக்கப்பட்ட பகுதியை 10-15 நிமிடங்கள் குளிர்ந்த நீரில் (ஐஸ் நீர் அல்ல) வைக்கவும். தீக்காயத்தின் மீது வெண்ணெய் அல்லது எண்ணெய் போன்றவற்றை தடவ வேண்டாம். கொப்புளங்களை உடைக்க வேண்டாம். ஒரு சுத்தமான, வறண்ட துணியால் மூடி மருத்துவரை அணுகவும்.'
            },
            'en': {
                'minor cut': 'For a minor cut, gently wash the area with soap and water. Then, apply pressure to stop bleeding. Apply an antiseptic lotion or ointment and cover with a plaster.',
                'fainting': 'If you feel faint, lie down with your legs elevated. Loosen tight clothing. Clear crowds to allow fresh air. If someone has fainted, gently turn them on their side and ensure they are breathing. Seek medical help promptly.',
                'bone fracture': 'If a bone fracture is suspected, do not move the affected part. Immobilize the injured limb using a splint or bandage. Apply a cold compress. Seek immediate medical attention.',
                'burn': 'For a minor burn, hold the affected area under cool (not ice) running water for 10-15 minutes. Do not apply butter or oil to the burn. Do not break blisters. Cover with a clean, dry dressing and consult a doctor.'
            }
        };

        // UI Elements
        const splashScreen = document.getElementById('splashScreen');
        const mainContent = document.getElementById('mainContent');
        const languageSelect = document.getElementById('languageSelect');
        const mainTitle = document.getElementById('mainTitle');
        const descriptionText = document.getElementById('descriptionText');
        const tipSectionTitle = document.getElementById('tipSectionTitle');
        const goalInput = document.getElementById('goalInput');
        const micBtn = document.getElementById('micBtn');
        const generateBtn = document.getElementById('generateBtn');
        const loading = document.getElementById('loading');
        const loadingText = document.getElementById('loadingText');
        const tipOutput = document.getElementById('tipOutput');
        const aiVoiceBtn = document.getElementById('aiVoiceBtn');
        const ttsVoiceSelect = document.getElementById('ttsVoiceSelect');
        const featuresTitle = document.getElementById('featuresTitle');
        const toggleFeaturesBtn = document.getElementById('toggleFeaturesBtn');
        
        // New features container and its back button
        const featuresContainer = document.getElementById('featuresContainer');
        const backToMainFromFeaturesContainer = document.getElementById('backToMainFromFeaturesContainer');

        const featuresPageTitle = document.getElementById('featuresPageTitle');
        const allFeatureIconsContainer = document.getElementById('allFeatureIconsContainer');

        // Feature Sections
        const stepTrackerSection = document.getElementById('stepTrackerSection');
        const stepSectionTitle = document.getElementById('stepSectionTitle');
        const currentStepsDisplay = document.getElementById('currentStepsDisplay');
        const addOneStepBtn = document.getElementById('addOneStepBtn');
        const toggleTrackingBtn = document.getElementById('toggleTrackingBtn');
        const resetStepsBtn = document.getElementById('resetStepsBtn');
        const stepResultOutput = document.getElementById('stepResultOutput');

        const heartRateTrackerSection = document.getElementById('heartRateTrackerSection');
        const heartRateSectionTitle = document.getElementById('heartRateSectionTitle');
        const currentHeartRateDisplay = document.getElementById('currentHeartRateDisplay');
        const simulateHeartRateBtn = document.getElementById('simulateHeartRateBtn');
        const resetHeartRateBtn = document.getElementById('resetHeartRateBtn');
        const heartRateResultOutput = document.getElementById('heartRateResultOutput');

        const waterTrackerSection = document.getElementById('waterTrackerSection');
        const waterSectionTitle = document.getElementById('waterSectionTitle');
        const waterIntakeDisplay = document.getElementById('waterIntakeDisplay');
        const addWaterBtn = document.getElementById('addWaterBtn');
        const resetWaterBtn = document.getElementById('resetWaterBtn');
        const waterResultOutput = document.getElementById('waterResultOutput');

        const journalSection = document.getElementById('journalSection');
        const journalSectionTitle = document.getElementById('journalSectionTitle');
        const journalDescription = document.getElementById('journalDescription');
        const moodSelect = document.getElementById('moodSelect');
        const gratitudeInput = document.getElementById('gratitudeInput');
        const saveJournalEntryBtn = document.getElementById('saveJournalEntryBtn');
        const journalEntriesOutput = document.getElementById('journalEntriesOutput');

        const localTipsSection = document.getElementById('localTipsSection');
        const localTipsSectionTitle = document.getElementById('localTipsSectionTitle');
        const localTipsDescription = document.getElementById('localTipsDescription');
        const localTipCategory = document.getElementById('localTipCategory');
        const localTipCategoryDropdown = document.getElementById('localTipCategoryDropdown');
        const getLocalTipBtn = document.getElementById('getLocalTipBtn');
        const localTipOutput = document.getElementById('localTipOutput');

        const mealPlanSection = document.getElementById('mealPlanSection');
        const mealPlanSectionTitle = document.getElementById('mealPlanSectionTitle');
        const mealPlanDescription = document.getElementById('mealPlanDescription');
        const dietGoalInput = document.getElementById('dietGoalInput');
        const dietPreferenceSelect = document.getElementById('dietPreferenceSelect');
        const allergiesInput = document.getElementById('allergiesInput');
        const generateMealPlanBtn = document.getElementById('generateMealPlanBtn');
        const mealPlanOutput = document.getElementById('mealPlanOutput');

        const moodAnalysisSection = document.getElementById('moodAnalysisSection');
        const moodAnalysisSectionTitle = document.getElementById('moodAnalysisSectionTitle');
        const moodAnalysisDescription = document.getElementById('moodAnalysisDescription');
        const analyzeMoodJournalBtn = document.getElementById('analyzeMoodJournalBtn');
        const moodAnalysisOutput = document.getElementById('moodAnalysisOutput');

        const exerciseYogaSection = document.getElementById('exerciseYogaSection');
        const exerciseYogaSectionTitle = document.getElementById('exerciseYogaSectionTitle');
        const exerciseYogaDescription = document.getElementById('exerciseYogaDescription');
        const fitnessLevelSelect = document.getElementById('fitnessLevelSelect');
        const timeAvailableInput = document.getElementById('timeAvailableInput');
        const exerciseGoalInput = document.getElementById('exerciseGoalInput');
        const generateExerciseRoutineBtn = document.getElementById('generateExerciseRoutineBtn');
        const exerciseRoutineOutput = document.getElementById('exerciseRoutineOutput');

        const diseasePreventionSection = document.getElementById('diseasePreventionSection');
        const diseasePreventionSectionTitle = document.getElementById('diseasePreventionSectionTitle');
        const diseasePreventionDescription = document.getElementById('diseasePreventionDescription');
        const healthConcernInput = document.getElementById('healthConcernInput');
        const getRemedyBtn = document.getElementById('getRemedyBtn');
        const remedyOutput = document.getElementById('remedyOutput');

        const wellnessChallengeSection = document.getElementById('wellnessChallengeSection');
        const wellnessChallengeSectionTitle = document.getElementById('wellnessChallengeSectionTitle');
        const wellnessChallengeDescription = document.getElementById('wellnessChallengeDescription');
        const currentHabitInput = document.getElementById('currentHabitInput');
        const challengeGoalInput = document.getElementById('challengeGoalInput');
        const generateChallengeBtn = document.getElementById('generateChallengeBtn');
        const challengeOutput = document.getElementById('challengeOutput');

        const medicationReminderSection = document.getElementById('medicationReminderSection');
        const medicationReminderSectionTitle = document.getElementById('medicationReminderSectionTitle');
        const medicationReminderDescription = document.getElementById('medicationReminderDescription');
        const medicationNameInput = document.getElementById('medicationNameInput');
        const medicationTimeInput = document.getElementById('medicationTimeInput');
        const medicationFrequencySelect = document.getElementById('medicationFrequencySelect');
        const addMedicationReminderBtn = document.getElementById('addMedicationReminderBtn');
        const medicationRemindersOutput = document.getElementById('medicationRemindersOutput');
        const activeRemindersTitle = document.getElementById('activeRemindersTitle');
        const activeRemindersList = document.getElementById('activeRemindersList');
        const noRemindersMessage = document.getElementById('noRemindersMessage');

        const bodyPainMappingSection = document.getElementById('bodyPainMappingSection');
        const bodyPainMappingSectionTitle = document.getElementById('bodyPainMappingSectionTitle');
        const bodyPainMappingDescription = document.getElementById('bodyPainMappingDescription');
        const bodyMapImage = document.getElementById('bodyMapImage');
        const selectedPainAreas = document.getElementById('selectedPainAreas');
        const getPainSuggestionsBtn = document.getElementById('getPainSuggestionsBtn');
        const painSuggestionOutput = document.getElementById('painSuggestionOutput');

        const firstAidEmergencySection = document.getElementById('firstAidEmergencySection');
        const firstAidEmergencySectionTitle = document.getElementById('firstAidEmergencySectionTitle');
        const firstAidEmergencyDescription = document.getElementById('firstAidEmergencyDescription');
        const emergencyTopicInput = document.getElementById('emergencyTopicInput');
        const emergencyTopicDropdown = document.getElementById('emergencyTopicDropdown');
        const getEmergencyInfoBtn = document.getElementById('getEmergencyInfoBtn');
        const emergencyInfoOutput = document.getElementById('emergencyInfoOutput');


        // --- Utility Functions ---

        // Function to update all text content based on currentLanguage
        function updateContent() {
            const lang = translations[currentLanguage];
            document.title = lang.appName + " - " + lang.tagline;
            mainTitle.textContent = lang.mainTitle;
            descriptionText.textContent = lang.descriptionText;
            tipSectionTitle.textContent = lang.tipSectionTitle;
            goalInput.placeholder = lang.goalInputPlaceholder;
            micBtn.title = lang.micButtonTitle;
            micBtn.setAttribute('aria-label', lang.micButtonTitle);
            generateBtn.textContent = lang.generateButtonText;
            loadingText.textContent = lang.loadingText;
            tipOutput.innerHTML = `<p>${lang.tipOutputPlaceholder}</p>`;
            featuresTitle.textContent = lang.featuresTitle;
            toggleFeaturesBtn.querySelector('.label').textContent = lang.showFeaturesLabel;
            aiVoiceBtn.textContent = lang.aiVoiceButtonText;

            // Update features container title and back button
            featuresPageTitle.textContent = lang.featuresPageTitle;
            backToMainFromFeaturesContainer.textContent = lang.backToMainButtonText; // Default for this button

            document.getElementById('iconStepTracker').querySelector('.label').textContent = lang.stepTrackerLabel;
            document.getElementById('iconHeartRateTracker').querySelector('.label').textContent = lang.heartRateTrackerLabel;
            document.getElementById('iconWaterTracker').querySelector('.label').textContent = lang.waterTrackerLabel;
            document.getElementById('iconJournal').querySelector('.label').textContent = lang.journalLabel;
            document.getElementById('iconLocalTips').querySelector('.label').textContent = lang.localTipsLabel;
            document.getElementById('iconMealPlan').querySelector('.label').textContent = lang.mealPlanLabel;
            document.getElementById('iconMoodAnalysis').querySelector('.label').textContent = lang.moodAnalysisLabel;
            document.getElementById('iconExerciseYoga').querySelector('.label').textContent = lang.exerciseYogaLabel;
            document.getElementById('iconDiseasePrevention').querySelector('.label').textContent = lang.diseasePreventionLabel;
            document.getElementById('iconWellnessChallenge').querySelector('.label').textContent = lang.wellnessChallengeLabel;
            document.getElementById('iconMedicationReminder').querySelector('.label').textContent = lang.medicationReminderLabel;
            document.getElementById('iconBodyPainMapping').querySelector('.label').textContent = lang.bodyPainMappingLabel;
            document.getElementById('iconFirstAidEmergency').querySelector('.label').textContent = lang.firstAidEmergencyLabel;

            // Update individual feature sections
            // Step Tracker
            stepTrackerSection.querySelector('.back-button').textContent = lang.backToFeaturesListButtonText;
            stepSectionTitle.textContent = lang.stepSectionTitle;
            addOneStepBtn.textContent = lang.addOneStepButtonText;
            toggleTrackingBtn.textContent = lang.toggleTrackingButtonText;
            resetStepsBtn.textContent = lang.resetStepsButtonText;
            stepResultOutput.innerHTML = `<p>${lang.stepResultOutputPlaceholder}</p>`;
            currentStepsDisplay.setAttribute('aria-label', lang.currentStepsDisplayLabel);


            // Heart Rate Tracker
            heartRateTrackerSection.querySelector('.back-button').textContent = lang.backToFeaturesListButtonText;
            heartRateSectionTitle.textContent = lang.heartRateSectionTitle;
            simulateHeartRateBtn.textContent = lang.simulateHeartRateButtonText;
            resetHeartRateBtn.textContent = lang.resetHeartRateButtonText;
            heartRateResultOutput.innerHTML = `<p>${lang.heartRateResultOutputPlaceholder}</p>`;
            currentHeartRateDisplay.setAttribute('aria-label', lang.currentHeartRateDisplayLabel);

            // Water Tracker
            waterTrackerSection.querySelector('.back-button').textContent = lang.backToFeaturesListButtonText;
            waterSectionTitle.textContent = lang.waterSectionTitle;
            addWaterBtn.textContent = lang.addWaterButtonText;
            resetWaterBtn.textContent = lang.resetWaterButtonText;
            waterResultOutput.innerHTML = `<p>${lang.waterResultOutputPlaceholder}</p>`;
            waterIntakeDisplay.setAttribute('aria-label', lang.waterIntakeDisplayLabel);


            // Journal
            journalSection.querySelector('.back-button').textContent = lang.backToFeaturesListButtonText;
            journalSectionTitle.textContent = lang.journalSectionTitle;
            journalDescription.textContent = lang.journalDescription;
            moodSelect.querySelector('option[value=""]').textContent = lang.moodSelectPlaceholder;
            moodSelect.querySelector('option[value="happy"]').textContent = "மகிழ்ச்சி 😄" + (currentLanguage === 'en' ? " Happy 😄" : "");
            moodSelect.querySelector('option[value="neutral"]').textContent = "சாதாரணம் 😐" + (currentLanguage === 'en' ? " Neutral 😐" : "");
            moodSelect.querySelector('option[value="sad"]').textContent = "சோகம் 😔" + (currentLanguage === 'en' ? " Sad 😔" : "");
            moodSelect.querySelector('option[value="stressed"]').textContent = "மன அழுத்தம் 😩" + (currentLanguage === 'en' ? " Stressed 😩" : "");
            moodSelect.querySelector('option[value="energetic"]').textContent = "ஆற்றல் 💪" + (currentLanguage === 'en' ? " Energetic 💪" : "");

            gratitudeInput.placeholder = lang.gratitudeInputPlaceholder;
            saveJournalEntryBtn.textContent = lang.saveJournalEntryButtonText;
            journalEntriesOutput.innerHTML = `<p>${lang.journalEntriesOutputPlaceholder}</p>`;

            // Local Tips
            localTipsSection.querySelector('.back-button').textContent = lang.backToFeaturesListButtonText;
            localTipsSectionTitle.textContent = lang.localTipsSectionTitle;
            localTipsDescription.textContent = lang.localTipsDescription;
            localTipCategory.placeholder = lang.localTipCategoryPlaceholder;
            getLocalTipBtn.textContent = lang.getLocalTipButtonText;
            localTipOutput.innerHTML = `<p>${lang.localTipOutputPlaceholder}</p>`;

            // Meal Plan
            mealPlanSection.querySelector('.back-button').textContent = lang.backToFeaturesListButtonText;
            mealPlanSectionTitle.textContent = lang.mealPlanSectionTitle;
            mealPlanDescription.textContent = lang.mealPlanDescription;
            dietGoalInput.placeholder = lang.dietGoalInputPlaceholder;
            dietPreferenceSelect.querySelector('option[value=""]').textContent = lang.dietPreferenceSelectPlaceholder;
            dietPreferenceSelect.querySelector('option[value="vegetarian"]').textContent = lang.vegetarianOption;
            dietPreferenceSelect.querySelector('option[value="non-vegetarian"]').textContent = lang.nonVegetarianOption;
            dietPreferenceSelect.querySelector('option[value="vegan"]').textContent = lang.veganOption;
            allergiesInput.placeholder = lang.allergiesInputPlaceholder;
            generateMealPlanBtn.textContent = lang.generateMealPlanButtonText;
            mealPlanOutput.innerHTML = `<p>${lang.mealPlanOutputPlaceholder}</p>`;

            // Mood Analysis
            moodAnalysisSection.querySelector('.back-button').textContent = lang.backToFeaturesListButtonText;
            moodAnalysisSectionTitle.textContent = lang.moodAnalysisSectionTitle;
            moodAnalysisDescription.textContent = lang.moodAnalysisDescription;
            analyzeMoodJournalBtn.textContent = lang.analyzeMoodJournalButtonText;
            moodAnalysisOutput.innerHTML = `<p>${lang.moodAnalysisOutputPlaceholder}</p>`;

            // Exercise & Yoga
            exerciseYogaSection.querySelector('.back-button').textContent = lang.backToFeaturesListButtonText;
            exerciseYogaSectionTitle.textContent = lang.exerciseYogaSectionTitle;
            exerciseYogaDescription.textContent = lang.exerciseYogaDescription;
            fitnessLevelSelect.querySelector('option[value=""]').textContent = lang.fitnessLevelSelectPlaceholder;
            fitnessLevelSelect.querySelector('option[value="beginner"]').textContent = lang.beginnerOption;
            fitnessLevelSelect.querySelector('option[value="intermediate"]').textContent = lang.intermediateOption;
            fitnessLevelSelect.querySelector('option[value="advanced"]').textContent = lang.advancedOption;
            timeAvailableInput.placeholder = lang.timeAvailableInputPlaceholder;
            exerciseGoalInput.placeholder = lang.exerciseGoalInputPlaceholder;
            generateExerciseRoutineBtn.textContent = lang.generateExerciseRoutineButtonText;
            exerciseRoutineOutput.innerHTML = `<p>${lang.exerciseRoutineOutputPlaceholder}</p>`;

            // Disease Prevention
            diseasePreventionSection.querySelector('.back-button').textContent = lang.backToFeaturesListButtonText;
            diseasePreventionSectionTitle.textContent = lang.diseasePreventionSectionTitle;
            diseasePreventionDescription.textContent = lang.diseasePreventionDescription;
            healthConcernInput.placeholder = lang.healthConcernInputPlaceholder;
            getRemedyBtn.textContent = lang.getRemedyButtonText;
            remedyOutput.innerHTML = `<p>${lang.remedyOutputPlaceholder}</p>`;

            // Wellness Challenge
            wellnessChallengeSection.querySelector('.back-button').textContent = lang.backToFeaturesListButtonText;
            wellnessChallengeSectionTitle.textContent = lang.wellnessChallengeSectionTitle;
            wellnessChallengeDescription.textContent = lang.wellnessChallengeDescription;
            currentHabitInput.placeholder = lang.currentHabitInputPlaceholder;
            challengeGoalInput.placeholder = lang.challengeGoalInputPlaceholder;
            generateChallengeBtn.textContent = lang.generateChallengeButtonText;
            challengeOutput.innerHTML = `<p>${lang.challengeOutputPlaceholder}</p>`;

            // Medication Reminder
            medicationReminderSection.querySelector('.back-button').textContent = lang.backToFeaturesListButtonText;
            medicationReminderSectionTitle.textContent = lang.medicationReminderSectionTitle;
            medicationReminderDescription.textContent = lang.medicationReminderDescription;
            medicationNameInput.placeholder = lang.medicationNameInputPlaceholder;
            medicationTimeInput.setAttribute('aria-label', lang.medicationTimeInputPlaceholder);
            medicationFrequencySelect.querySelector('option[value=""]').textContent = lang.medicationFrequencySelectPlaceholder;
            medicationFrequencySelect.querySelector('option[value="daily"]').textContent = lang.dailyOption;
            medicationFrequencySelect.querySelector('option[value="weekly"]').textContent = lang.weeklyOption;
            medicationFrequencySelect.querySelector('option[value="once"]').textContent = lang.onceOption;
            addMedicationReminderBtn.textContent = lang.addMedicationReminderButtonText;
            activeRemindersTitle.textContent = lang.activeRemindersTitle;
            noRemindersMessage.textContent = lang.noRemindersMessage;
            medicationRemindersOutput.innerHTML = `<h3 class="text-xl font-semibold text-gray-700 mb-3" id="activeRemindersTitle">${lang.activeRemindersTitle}</h3><ul id="activeRemindersList" class="list-disc pl-5"></ul><p id="noRemindersMessage" class="text-gray-500 italic mt-2">${lang.noRemindersMessage}</p>`;
            renderMedicationReminders(); // Re-render reminders to update language

            // Body Pain Mapping
            bodyPainMappingSection.querySelector('.back-button').textContent = lang.backToFeaturesListButtonText;
            bodyPainMappingSectionTitle.textContent = lang.bodyPainMappingSectionTitle;
            bodyPainMappingDescription.textContent = lang.bodyPainMappingDescription;
            getPainSuggestionsBtn.textContent = lang.getPainSuggestionsButtonText;
            painSuggestionOutput.innerHTML = `<p>${lang.painSuggestionOutputPlaceholder}</p>`;
            updateSelectedPainAreasDisplay(); // Update display for pain points

            // First Aid & Emergency
            firstAidEmergencySection.querySelector('.back-button').textContent = lang.backToFeaturesListButtonText;
            firstAidEmergencySectionTitle.textContent = lang.firstAidEmergencySectionTitle;
            firstAidEmergencyDescription.textContent = lang.firstAidEmergencyDescription;
            emergencyTopicInput.placeholder = lang.emergencyTopicInputPlaceholder;
            getEmergencyInfoBtn.textContent = lang.getEmergencyInfoButtonText;
            emergencyInfoOutput.innerHTML = `<p>${lang.emergencyInfoOutputPlaceholder}</p>`;

            // Update voice button text based on whether speech is playing
            if (audioPlayer.paused) {
                aiVoiceBtn.textContent = lang.aiVoiceButtonText;
            } else {
                aiVoiceBtn.textContent = lang.aiVoiceButtonStopText;
            }
        }

        // Function to show a specific section and hide others
        function showSection(sectionId) {
            // Hide all main views first
            document.getElementById('initialView').style.display = 'none';
            featuresContainer.style.display = 'none';

            // Hide all feature sections within featuresContainer
            document.querySelectorAll('#featuresContainer .feature-section').forEach(section => {
                section.style.display = 'none';
            });
            // Hide the feature icons list
            allFeatureIconsContainer.style.display = 'none';
            // Hide the back button within featuresContainer by default
            backToMainFromFeaturesContainer.style.display = 'none';


            if (sectionId === 'initialView') {
                document.getElementById('initialView').style.display = 'block';
                currentView = 'initialView';
            } else if (sectionId === 'featuresContainer') {
                // Show the main features container
                featuresContainer.style.display = 'block';
                // Show the feature icons list by default when entering featuresContainer
                allFeatureIconsContainer.style.display = 'flex'; // Use flex for icon layout
                // The back button for featuresContainer should go back to initialView
                backToMainFromFeaturesContainer.style.display = 'block';
                backToMainFromFeaturesContainer.textContent = translations[currentLanguage].backToMainButtonText;
                backToMainFromFeaturesContainer.onclick = () => showSection('initialView'); // Set specific handler
                currentView = 'featuresContainer';
            } else {
                // This is a specific feature section (e.g., stepTrackerSection)
                featuresContainer.style.display = 'block'; // Ensure parent container is visible
                const targetSection = document.getElementById(sectionId);
                if (targetSection) {
                    targetSection.style.display = 'block';
                    // Show the back button within featuresContainer, and make it go back to feature icons
                    backToMainFromFeaturesContainer.style.display = 'block';
                    backToMainFromFeaturesContainer.textContent = translations[currentLanguage].backToFeaturesListButtonText;
                    backToMainFromFeaturesContainer.onclick = () => showSection('featuresContainer'); // Go back to icons list
                    currentView = sectionId;
                }
            }
        }


        // Function to show/hide loading indicator
        function showLoading(show, message = "") {
            if (show) {
                loadingText.textContent = message || translations[currentLanguage].loadingText;
                loading.style.display = 'flex';
            } else {
                loading.style.display = 'none';
            }
        }

        // Initialize Web Speech API for recognition
        function initializeSpeechRecognition() {
            if ('webkitSpeechRecognition' in window) {
                speechRecognition = new webkitSpeechRecognition();
                speechRecognition.continuous = false;
                speechRecognition.interimResults = false;
                speechRecognition.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US'; // Set language for recognition

                speechRecognition.onstart = () => {
                    isRecording = true;
                    micBtn.classList.add('recording');
                    goalInput.placeholder = translations[currentLanguage].micButtonTitle; // Indicate recording
                };

                speechRecognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    goalInput.value = transcript;
                    // Automatically generate tip after speech input
                    generateHealthTip();
                };

                speechRecognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    tipOutput.innerHTML = `<p class="text-red-600">${translations[currentLanguage].tipOutputPlaceholder}</p>`; // Show error placeholder
                    isRecording = false;
                    micBtn.classList.remove('recording');
                    goalInput.placeholder = translations[currentLanguage].goalInputPlaceholder; // Reset placeholder
                    if (event.error === 'not-allowed' || event.error === 'permission-denied') {
                        alert("Microphone access denied. Please enable it in your browser settings to use voice input.");
                    }
                };

                speechRecognition.onend = () => {
                    isRecording = false;
                    micBtn.classList.remove('recording');
                    goalInput.placeholder = translations[currentLanguage].goalInputPlaceholder; // Reset placeholder
                };
            } else {
                micBtn.style.display = 'none';
                console.warn('Web Speech API is not supported in this browser.');
                alert('குரல் உள்ளீடு உங்கள் உலாவியில் ஆதரிக்கப்படவில்லை. தயவுசெய்து Chrome போன்ற நவீன உலாவியைப் பயன்படுத்தவும்.');
            }
        }

        // Initialize Text-to-Speech API
        function initializeSpeechSynthesis() {
            if ('speechSynthesis' in window) {
                populateVoiceList();
                if (speechSynthesis.onvoiceschanged !== undefined) {
                    speechSynthesis.onvoiceschanged = populateVoiceList;
                }
            } else {
                aiVoiceBtn.style.display = 'none';
                ttsVoiceSelect.style.display = 'none';
                console.warn('Web Speech Synthesis API is not supported in this browser.');
            }
        }

        function populateVoiceList() {
            const voices = speechSynthesis.getVoices();
            ttsVoiceSelect.innerHTML = ''; // Clear existing options
            let defaultVoice = null;

            voices.forEach(voice => {
                // Prioritize Tamil or English voices based on current language
                if (currentLanguage === 'ta' && voice.lang.startsWith('ta-')) {
                    if (!defaultVoice) defaultVoice = voice;
                    const option = document.createElement('option');
                    option.textContent = voice.name + ' (' + voice.lang + ')';
                    option.value = voice.name;
                    option.setAttribute('data-lang', voice.lang);
                    ttsVoiceSelect.appendChild(option);
                } else if (currentLanguage === 'en' && voice.lang.startsWith('en-')) {
                    if (!defaultVoice) defaultVoice = voice;
                    const option = document.createElement('option');
                    option.textContent = voice.name + ' (' + voice.lang + ')';
                    option.value = voice.name;
                    option.setAttribute('data-lang', voice.lang);
                    ttsVoiceSelect.appendChild(option);
                }
            });

            // If no language-specific voice, add general English voices or system default
            if (ttsVoiceSelect.options.length === 0) {
                 voices.forEach(voice => {
                    if (voice.lang.startsWith('en-') || voice.default) {
                        if (!defaultVoice) defaultVoice = voice;
                        const option = document.createElement('option');
                        option.textContent = voice.name + ' (' + voice.lang + ')';
                        option.value = voice.name;
                        option.setAttribute('data-lang', voice.lang);
                        ttsVoiceSelect.appendChild(option);
                    }
                });
            }

            if (defaultVoice) {
                ttsVoiceSelect.value = defaultVoice.name;
            } else if (ttsVoiceSelect.options.length > 0) {
                ttsVoiceSelect.selectedIndex = 0; // Select the first available voice
            }
        }

        function speakText(text) {
            if ('speechSynthesis' in window) {
                if (speechSynthesis.speaking) {
                    speechSynthesis.cancel(); // Stop current speech if any
                    aiVoiceBtn.textContent = translations[currentLanguage].aiVoiceButtonText; // Reset button text
                    return; // Exit if stopping
                }

                currentUtterance = new SpeechSynthesisUtterance(text);
                const selectedVoiceName = ttsVoiceSelect.value;
                const voices = speechSynthesis.getVoices();
                const selectedVoice = voices.find(voice => voice.name === selectedVoiceName);

                if (selectedVoice) {
                    currentUtterance.voice = selectedVoice;
                    currentUtterance.lang = selectedVoice.lang;
                } else {
                    currentUtterance.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US'; // Fallback language
                }

                currentUtterance.onstart = () => {
                    aiVoiceBtn.textContent = translations[currentLanguage].aiVoiceButtonStopText;
                };

                currentUtterance.onend = () => {
                    aiVoiceBtn.textContent = translations[currentLanguage].aiVoiceButtonText;
                };

                currentUtterance.onerror = (event) => {
                    console.error('SpeechSynthesisUtterance.onerror', event);
                    aiVoiceBtn.textContent = translations[currentLanguage].aiVoiceButtonText; // Reset button on error
                    alert("குரல் இயக்க முடியவில்லை. சில குரல்கள் அனைத்து உரைக்கும் ஆதரிக்கப்படாமல் இருக்கலாம்.");
                };

                speechSynthesis.speak(currentUtterance);
            }
        }

        // --- Core Functions ---

        async function generateHealthTip() {
            const goal = goalInput.value.trim();
            if (!goal) {
                tipOutput.innerHTML = `<p class="text-red-600">${translations[currentLanguage].goalInputPlaceholder}</p>`;
                return;
            }

            showLoading(true, translations[currentLanguage].generatingTips);
            tipOutput.innerHTML = ""; // Clear previous output
            aiVoiceBtn.style.display = 'none'; // Hide voice button initially
            ttsVoiceSelect.style.display = 'none';

            try {
                let chatHistory = [];
                const prompt = `Generate a personalized health tip for the user's goal: "${goal}". Provide a detailed and actionable tip. The response should be in ${currentLanguage === 'ta' ? 'Tamil' : 'English'}.`;
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; // Canvas will provide this at runtime
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('API Error:', errorData);
                    throw new Error(errorData.error ? errorData.error.message : 'Unknown API error');
                }

                const result = await response.json();
                let generatedText = translations[currentLanguage].apiError; // Default to error message

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    generatedText = result.candidates[0].content.parts[0].text;
                } else {
                    console.warn('Unexpected API response structure:', result);
                }

                tipOutput.innerHTML = `<p>${generatedText}</p>`;
                aiVoiceBtn.style.display = 'inline-flex'; // Show voice button after content is generated
                ttsVoiceSelect.style.display = 'inline-block';

            } catch (error) {
                console.error('Error generating health tip:', error);
                tipOutput.innerHTML = `<p class="text-red-600">${translations[currentLanguage].apiError}</p>`;
            } finally {
                showLoading(false);
            }
        }

        // --- Feature Specific Functions ---

        // Step Tracker
        function updateStepsDisplay() {
            currentStepsDisplay.value = `${steps} ${translations[currentLanguage].stepTrackerLabel.split(' ')[0]}`; // "படிகள்" or "Steps"
            if (steps >= 5000) { // Example goal
                stepResultOutput.innerHTML = `<p><strong>${translations[currentLanguage].stepTrackerLabel.split(' ')[0]} இலக்கு எட்டப்பட்டது!</strong> வாழ்த்துக்கள்! இன்றைய ஆரோக்கியமான நடைப்பயிற்சியை முடித்துவிட்டீர்கள்.</p>`;
            } else {
                stepResultOutput.innerHTML = `<p>${translations[currentLanguage].stepResultOutputPlaceholder.replace('...', `உங்கள் தற்போதைய படிகள்: ${steps}. மேலும் <strong>${5000 - steps}</strong> படிகள் செல்ல வேண்டும்.`)}</p>`;
            }
        }

        function addOneStep() {
            steps += 1; // Increment by 1 for demonstration
            updateStepsDisplay();
        }

        function toggleStepTracking() {
            isStepTracking = !isStepTracking;
            if (isStepTracking) {
                toggleTrackingBtn.textContent = translations[currentLanguage].toggleTrackingButtonText.replace('தொடங்கு', 'நிறுத்து').replace('Start', 'Stop');
                stepResultOutput.innerHTML = `<p><strong>${translations[currentLanguage].stepTrackerLabel.split(' ')[0]} டிராக்கிங் தொடங்கப்பட்டது.</strong> நீங்கள் நடக்கத் தொடங்குங்கள்!</p>`;
                // In a real app, you'd start listening to device step sensors here
            } else {
                toggleTrackingBtn.textContent = translations[currentLanguage].toggleTrackingButtonText.replace('நிறுத்து', 'தொடங்கு').replace('Stop', 'Start');
                stepResultOutput.innerHTML = `<p><strong>${translations[currentLanguage].stepTrackerLabel.split(' ')[0]} டிராக்கிங் நிறுத்தப்பட்டது.</strong></p>`;
                // In a real app, you'd stop listening to device step sensors here
            }
        }

        function resetSteps() {
            steps = 0;
            updateStepsDisplay();
            isStepTracking = false;
            toggleTrackingBtn.textContent = translations[currentLanguage].toggleTrackingButtonText; // Reset button text
            stepResultOutput.innerHTML = `<p>${translations[currentLanguage].stepResultOutputPlaceholder}</p>`;
        }

        // Heart Rate Tracker
        function simulateHeartRate() {
            const min = 60;
            const max = 100;
            const simulatedRate = Math.floor(Math.random() * (max - min + 1)) + min;
            currentHeartRateDisplay.value = `${simulatedRate} bpm`;

            let message = "";
            if (currentLanguage === 'ta') {
                if (simulatedRate < 60) message = "உங்கள் இதயத் துடிப்பு சற்று குறைவாக உள்ளது. இது சிலருக்கு இயல்பானது, ஆனால் நிலையானதாக இருந்தால் மருத்துவரை அணுகவும்.";
                else if (simulatedRate > 100) message = "உங்கள் இதயத் துடிப்பு சற்று அதிகமாக உள்ளது. ஓய்வெடுத்து, தேவைப்பட்டால் மருத்துவரை அணுகவும்.";
                else message = "உங்கள் இதயத் துடிப்பு சாதாரண வரம்பில் உள்ளது. ஆரோக்கியமாக இருங்கள்!";
            } else { // English
                if (simulatedRate < 60) message = "Your heart rate is a bit low. While normal for some, if persistent, consult a doctor.";
                else if (simulatedRate > 100) message = "Your heart rate is a bit high. Rest and consult a doctor if needed.";
                else message = "Your heart rate is within the normal range. Keep up the good health!";
            }
            heartRateResultOutput.innerHTML = `<p><strong>இதயத் துடிப்பு: ${simulatedRate} bpm.</strong> ${message}</p>`;
        }

        function resetHeartRate() {
            currentHeartRateDisplay.value = `0 bpm`;
            heartRateResultOutput.innerHTML = `<p>${translations[currentLanguage].heartRateResultOutputPlaceholder}</p>`;
        }

        // Water Tracker
        function updateWaterIntakeDisplay() {
            waterIntakeDisplay.value = `${waterIntake} ml`;
            let message = "";
            if (currentLanguage === 'ta') {
                if (waterIntake < 2000) {
                    message = `இன்னும் <strong>${2000 - waterIntake} ml</strong> தண்ணீர் குடிக்க வேண்டும். தொடர்ந்து குடிக்கவும்!`;
                } else {
                    message = "அருமை! நீங்கள் போதுமான தண்ணீர் குடித்துவிட்டீர்கள். உடலில் நீரேற்றம் செய்யுங்கள்!";
                }
            } else { // English
                if (waterIntake < 2000) {
                    message = `You need to drink <strong>${2000 - waterIntake} ml</strong> more water. Keep hydrating!`;
                } else {
                    message = "Great! You've drunk enough water for today. Stay hydrated!";
                }
            }
            waterResultOutput.innerHTML = `<p>${message}</p>`;
        }

        function addWater() {
            waterIntake += 200; // Add 200ml
            updateWaterIntakeDisplay();
        }

        function resetWater() {
            waterIntake = 0;
            updateWaterIntakeDisplay();
        }

        // Journal
        function saveJournalEntry() {
            const mood = moodSelect.value;
            const gratitude = gratitudeInput.value.trim();
            if (!mood || !gratitude) {
                journalEntriesOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'மனநிலையையும் நன்றியுணர்வு பதிவையும் உள்ளிடவும்.' : 'Please enter both mood and gratitude entry.'}</p>`;
                return;
            }

            const now = new Date();
            const entry = {
                mood: mood,
                gratitude: gratitude,
                timestamp: now.toLocaleString(currentLanguage === 'ta' ? 'ta-IN' : 'en-US')
            };
            journalEntries.push(entry);
            renderJournalEntries();
            moodSelect.value = "";
            gratitudeInput.value = "";
        }

        function renderJournalEntries() {
            const list = document.createElement('ul');
            list.classList.add('list-disc', 'pl-5');
            if (journalEntries.length === 0) {
                journalEntriesOutput.innerHTML = `<p>${translations[currentLanguage].journalEntriesOutputPlaceholder}</p>`;
                return;
            }
            journalEntries.forEach(entry => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `<strong>[${entry.timestamp}]</strong> - ${currentLanguage === 'ta' ? 'மனநிலை' : 'Mood'}: ${entry.mood} (${getMoodEmoji(entry.mood)}), ${currentLanguage === 'ta' ? 'நன்றியுணர்வு' : 'Gratitude'}: ${entry.gratitude}`;
                list.appendChild(listItem);
            });
            journalEntriesOutput.innerHTML = '';
            journalEntriesOutput.appendChild(list);
        }

        function getMoodEmoji(mood) {
            switch (mood) {
                case 'happy': return '😄';
                case 'neutral': return '😐';
                case 'sad': return '😔';
                case 'stressed': return '😩';
                case 'energetic': return '💪';
                default: return '';
            }
        }

        // Local Tips
        function populateLocalTipDropdown(query) {
            localTipCategoryDropdown.innerHTML = '';
            localTipCategoryDropdown.classList.add('hidden');
            const relevantTips = Object.keys(localTipsData[currentLanguage]).filter(tip =>
                tip.toLowerCase().includes(query.toLowerCase())
            );

            if (relevantTips.length > 0 && query.length > 0) {
                relevantTips.forEach(tip => {
                    const div = document.createElement('div');
                    div.textContent = tip;
                    div.onclick = () => {
                        localTipCategory.value = tip;
                        localTipCategoryDropdown.classList.add('hidden');
                    };
                    localTipCategoryDropdown.appendChild(div);
                });
                localTipCategoryDropdown.classList.remove('hidden');
            }
        }

        function getLocalTip() {
            const category = localTipCategory.value.trim().toLowerCase();
            const tip = localTipsData[currentLanguage][category];
            if (tip) {
                localTipOutput.innerHTML = `<p><strong>${category.charAt(0).toUpperCase() + category.slice(1)}:</strong> ${tip}</p>`;
            } else {
                localTipOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'இந்த வகைக்கான உதவிக்குறிப்பு இல்லை.' : 'No tip found for this category.'}</p>`;
            }
        }

        // Meal Plan
        async function generateMealPlan() {
            const goal = dietGoalInput.value.trim();
            const preference = dietPreferenceSelect.value;
            const allergies = allergiesInput.value.trim();

            if (!goal || !preference) {
                mealPlanOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'உணவு இலக்கு மற்றும் உணவு விருப்பத்தைத் தேர்ந்தெடுக்கவும்.' : 'Please enter diet goal and select preference.'}</p>`;
                return;
            }

            showLoading(true, translations[currentLanguage].loadingText);
            mealPlanOutput.innerHTML = "";
            await new Promise(resolve => setTimeout(resolve, 2000)); // Simulate delay

            let plan = "";
            if (currentLanguage === 'ta') {
                plan += `உங்கள் ${preference === 'vegetarian' ? 'சைவ' : (preference === 'non-vegetarian' ? 'அசைவ' : 'முழு சைவ')} உணவுத் திட்டம் (${goal} க்காக):\n\n`;
                plan += "காலை உணவு: ஓட்ஸ், பழங்கள், நட்ஸ்\n";
                plan += "மதிய உணவு: சப்பாத்தி, பருப்பு, காய்கறி கூட்டு\n";
                plan += "மாலை சிற்றுண்டி: தயிர், சுண்டல்\n";
                plan += "இரவு உணவு: சாதம், மீன் கறி (அசைவம் என்றால்), அல்லது பனீர் கறி (சைவம் என்றால்)\n\n";
                if (allergies) {
                    plan += `குறிப்பு: நீங்கள் "${allergies}" க்கு ஒவ்வாமை உள்ளீர்கள் என்பதை நினைவில் கொள்க. திட்டத்தில் அவற்றைத் தவிர்க்கவும்.`;
                }
                plan += "\n\nஇது ஒரு பொதுவான பரிந்துரை. நிபுணரை அணுகவும்.";
            } else { // English
                plan += `Your ${preference} meal plan for ${goal}:\n\n`;
                plan += "Breakfast: Oats with fruits and nuts\n";
                plan += "Lunch: Chapati, Dal, Vegetable Curry\n";
                plan += "Evening Snack: Yogurt, Chickpea Salad\n";
                plan += "Dinner: Rice, Fish Curry (if non-vegetarian) or Paneer Curry (if vegetarian)\n\n";
                if (allergies) {
                    plan += `Note: You have allergies to "${allergies}". Please avoid them in the plan.`;
                }
                plan += "\n\nThis is a general recommendation. Consult a professional.";
            }
            showLoading(false);
            mealPlanOutput.innerHTML = `<pre>${plan}</pre>`; // Use <pre> for pre-formatted text
        }

        // Mood Analysis
        async function analyzeMoodJournal() {
            if (journalEntries.length === 0) {
                moodAnalysisOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'பகுப்பாய்வு செய்ய ஜர்னல் பதிவுகள் இல்லை.' : 'No journal entries to analyze.'}</p>`;
                return;
            }

            showLoading(true, translations[currentLanguage].loadingText);
            moodAnalysisOutput.innerHTML = "";
            await new Promise(resolve => setTimeout(resolve, 2000)); // Simulate delay

            const moodCounts = {};
            journalEntries.forEach(entry => {
                moodCounts[entry.mood] = (moodCounts[entry.mood] || 0) + 1;
            });

            let analysis = "";
            if (currentLanguage === 'ta') {
                analysis += "<h3>உங்கள் மனநிலை பகுப்பாய்வு:</h3><ul>";
                for (const mood in moodCounts) {
                    analysis += `<li>${getMoodEmoji(mood)} <strong>${mood}:</strong> ${moodCounts[mood]} முறை</li>`;
                }
                analysis += "</ul><p>உங்கள் பதிவுகளின் அடிப்படையில், உங்கள் மனநிலை போக்குகள் இவைதான். தொடர்ந்து கண்காணித்து, தேவைப்பட்டால் உங்கள் உணர்ச்சி ஆரோக்கியத்திற்கு முன்னுரிமை அளியுங்கள்.</p>";
            } else { // English
                analysis += "<h3>Your Mood Analysis:</h3><ul>";
                for (const mood in moodCounts) {
                    analysis += `<li>${getMoodEmoji(mood)} <strong>${mood}:</strong> ${moodCounts[mood]} times</li>`;
                }
                analysis += "</ul><p>Based on your entries, these are your mood trends. Continue to monitor and prioritize your emotional well-being if needed.</p>";
            }
            showLoading(false);
            moodAnalysisOutput.innerHTML = analysis;
        }

        // Exercise & Yoga
        async function generateExerciseRoutine() {
            const fitnessLevel = fitnessLevelSelect.value;
            const timeAvailable = parseInt(timeAvailableInput.value);
            const exerciseGoal = exerciseGoalInput.value.trim();

            if (!fitnessLevel || !timeAvailable || !exerciseGoal) {
                exerciseRoutineOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'அனைத்து புலங்களையும் நிரப்பவும்.' : 'Please fill all fields.'}</p>`;
                return;
            }

            showLoading(true, translations[currentLanguage].loadingText);
            exerciseRoutineOutput.innerHTML = "";
            await new Promise(resolve => setTimeout(resolve, 2000)); // Simulate delay

            let routine = "";
            if (currentLanguage === 'ta') {
                routine += `<h3>உங்கள் ${fitnessLevel === 'beginner' ? 'ஆரம்பநிலை' : (fitnessLevel === 'intermediate' ? 'நடுநிலை' : 'மேம்பட்ட')} உடற்பயிற்சி/யோகா வழக்கம் (${timeAvailable} நிமிடங்கள், ${exerciseGoal} க்காக):</h3><ul>`;
                if (fitnessLevel === 'beginner') {
                    routine += `<li>5 நிமிடங்கள்: மெதுவான வார்ம்-அப் (நடைபயிற்சி, கைகளை சுழற்றுதல்)</li>`;
                    routine += `<li>10 நிமிடங்கள்: எளிதான யோகா ஆசனங்கள் (தாடாசனம், பத்ராசனம்) அல்லது குறைந்த தாக்கமுள்ள உடற்பயிற்சிகள் (இடத்திலே ஜாகிங்)</li>`;
                    routine += `<li>5 நிமிடங்கள்: கூல்-டவுன் (ஸ்ட்ரெச்சிங்)</li>`;
                } else if (fitnessLevel === 'intermediate') {
                    routine += `<li>5 நிமிடங்கள்: வார்ம்-அப் (டைனமிக் ஸ்ட்ரெச்சிங்)</li>`;
                    routine += `<li>${timeAvailable - 10} நிமிடங்கள்: சூர்ய நமஸ்காரம் (5-10 சுற்றுகள்) அல்லது இடைநிலை உடற்பயிற்சிகள் (ஸ்க்வாட்ஸ், லஞ்சஸ்)</li>`;
                    routine += `<li>5 நிமிடங்கள்: கூல்-டவுன் (கவனமான ஸ்ட்ரெச்சிங்)</li>`;
                } else { // Advanced
                    routine += `<li>10 நிமிடங்கள்: தீவிர வார்ம்-அப்</li>`;
                    routine += `<li>${timeAvailable - 20} நிமிடங்கள்: சவாலான யோகா ஆசனங்கள் (சிரசாசனம், சர்வங்காசனம்) அல்லது HIIT (High-Intensity Interval Training)</li>`;
                    routine += `<li>10 நிமிடங்கள்: கூல்-டவுன் மற்றும் தியானம்</li>`;
                }
                routine += `</ul><p>இது ஒரு மாதிரி திட்டம். உங்கள் உடல்நிலைக்கு ஏற்ப மாற்றவும் அல்லது நிபுணரை அணுகவும்.</p>`;
            } else { // English
                routine += `<h3>Your ${fitnessLevel} Exercise/Yoga Routine (${timeAvailable} minutes, for ${exerciseGoal}):</h3><ul>`;
                if (fitnessLevel === 'beginner') {
                    routine += `<li>5 minutes: Gentle Warm-up (walking in place, arm circles)</li>`;
                    routine += `<li>10 minutes: Easy Yoga Poses (Mountain Pose, Butterfly Pose) or Low-Impact Exercises (light jogging in place)</li>`;
                    routine += `<li>5 minutes: Cool-down (basic stretches)</li>`;
                } else if (fitnessLevel === 'intermediate') {
                    routine += `<li>5 minutes: Warm-up (dynamic stretching)</li>`;
                    routine += `<li>${timeAvailable - 10} minutes: Sun Salutations (5-10 rounds) or Intermediate Exercises (Squats, Lunges, Push-ups)</li>`;
                    routine += `<li>5 minutes: Cool-down (mindful stretching)</li>`;
                } else { // Advanced
                    routine += `<li>10 minutes: Intense Warm-up</li>`;
                    routine += `<li>${timeAvailable - 20} minutes: Challenging Yoga Asanas (Headstand, Shoulder Stand) or HIIT (High-Intensity Interval Training)</li>`;
                    routine += `<li>10 minutes: Cool-down and Meditation</li>`;
                }
                routine += `</ul><p>This is a sample plan. Adjust according to your body's needs or consult a professional.</p>`;
            }
            showLoading(false);
            exerciseRoutineOutput.innerHTML = routine;
        }

        // Disease Prevention
        async function getRemedy() {
            const concern = healthConcernInput.value.trim().toLowerCase();
            const remedy = translations[currentLanguage === 'ta' ? 'localTipsData' : 'emergencyInfoData'][currentLanguage][concern]; // Using existing data for simplicity

            if (remedy) {
                remedyOutput.innerHTML = `<p><strong>${concern.charAt(0).toUpperCase() + concern.slice(1)}:</strong> ${remedy}</p>`;
            } else {
                remedyOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'இந்த உடல்நலக் கவலைக்கான தடுப்பு குறிப்புகள்/தீர்வு இல்லை.' : 'No prevention tips/remedy found for this health concern.'}</p>`;
            }
        }

        // Wellness Challenge
        async function generateChallenge() {
            const currentHabit = currentHabitInput.value.trim();
            const challengeGoal = challengeGoalInput.value.trim();

            if (!currentHabit || !challengeGoal) {
                challengeOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'தற்போதைய பழக்கம் மற்றும் சவால் இலக்கை உள்ளிடவும்.' : 'Please enter current habit and challenge goal.'}</p>`;
                return;
            }

            showLoading(true, translations[currentLanguage].loadingText);
            challengeOutput.innerHTML = "";
            await new Promise(resolve => setTimeout(resolve, 2000)); // Simulate delay

            let challengeText = "";
            if (currentLanguage === 'ta') {
                challengeText += `<h3>உங்கள் ஆரோக்கிய சவால்:</h3><p>உங்கள் தற்போதைய பழக்கம்: <strong>${currentHabit}</strong></p><p>உங்கள் சவால் இலக்கு: <strong>${challengeGoal}</strong></p><p>இந்த இலக்கை அடைய, ஒவ்வொரு நாளும் ஒரு சிறிய படி எடுத்து வைக்கவும். உதாரணமாக, உங்கள் நீர் உட்கொள்ளலை தினமும் 200ml அதிகரிக்கவும் அல்லது உங்கள் உடற்பயிற்சி நேரத்தை 5 நிமிடங்கள் அதிகரிக்கவும். இந்த சவாலை அடுத்த 7 நாட்களுக்கு தொடர்ந்து கண்காணிக்கவும்.</p><p>வாழ்த்துக்கள்! 💪</p>`;
            } else { // English
                challengeText += `<h3>Your Wellness Challenge:</h3><p>Your Current Habit: <strong>${currentHabit}</strong></p><p>Your Challenge Goal: <strong>${challengeGoal}</strong></p><p>To achieve this goal, take a small step each day. For example, increase your water intake by 200ml daily or increase your exercise time by 5 minutes. Track this challenge consistently for the next 7 days.</p><p>Good luck! 💪</p>`;
            }
            showLoading(false);
            challengeOutput.innerHTML = challengeText;
        }

        // Medication Reminder
        function addMedicationReminder() {
            const name = medicationNameInput.value.trim();
            const time = medicationTimeInput.value;
            const frequency = medicationFrequencySelect.value;

            if (!name || !time || !frequency) {
                medicationRemindersOutput.querySelector('p').textContent = translations[currentLanguage].noRemindersMessage;
                medicationRemindersOutput.querySelector('ul').innerHTML = `<li class="text-red-600">${currentLanguage === 'ta' ? 'அனைத்து புலங்களையும் நிரப்பவும்.' : 'Please fill all fields.'}</li>`;
                return;
            }

            const reminder = {
                id: Date.now(),
                name,
                time,
                frequency
            };
            medicationReminders.push(reminder);
            localStorage.setItem('medicationReminders', JSON.stringify(medicationReminders)); // Persist reminders
            renderMedicationReminders();
            medicationNameInput.value = '';
            medicationTimeInput.value = '';
            medicationFrequencySelect.value = '';
        }

        function renderMedicationReminders() {
            const list = medicationRemindersOutput.querySelector('ul');
            list.innerHTML = '';
            if (medicationReminders.length === 0) {
                noRemindersMessage.style.display = 'block';
                list.style.display = 'none';
            } else {
                noRemindersMessage.style.display = 'none';
                list.style.display = 'block';
                medicationReminders.forEach(r => {
                    const listItem = document.createElement('li');
                    listItem.classList.add('flex', 'justify-between', 'items-center', 'py-1');
                    const freqText = translations[currentLanguage][r.frequency + 'Option'] || r.frequency;
                    listItem.innerHTML = `<span><strong>${r.name}</strong> at ${r.time} (${freqText})</span>
                                          <button class="text-red-500 hover:text-red-700 ml-4" onclick="removeMedicationReminder(${r.id})">❌</button>`;
                    list.appendChild(listItem);
                });
            }
        }

        function removeMedicationReminder(id) {
            medicationReminders = medicationReminders.filter(r => r.id !== id);
            localStorage.setItem('medicationReminders', JSON.stringify(medicationReminders));
            renderMedicationReminders();
        }

        function loadMedicationReminders() {
            const storedReminders = localStorage.getItem('medicationReminders');
            if (storedReminders) {
                medicationReminders = JSON.parse(storedReminders);
            }
            renderMedicationReminders();
        }

        // Body Pain Mapping
        function handleBodyMapClick(event) {
            const rect = bodyMapImage.getBoundingClientRect();
            const x = event.clientX - rect.left; // X position relative to the image
            const y = event.clientY - rect.top;  // Y position relative to the image

            // Convert to percentage for responsiveness
            const xPercent = (x / rect.width) * 100;
            const yPercent = (y / rect.height) * 100;

            const newPainPoint = {
                id: Date.now(),
                x: xPercent,
                y: yPercent
            };

            // Check if a dot is already very close to prevent duplicates
            const isDuplicate = painPoints.some(p =>
                Math.abs(p.x - xPercent) < 2 && Math.abs(p.y - yPercent) < 2
            );

            if (!isDuplicate) {
                painPoints.push(newPainPoint);
                renderPainPoints();
                updateSelectedPainAreasDisplay();
            }
        }

        function renderPainPoints() {
            // Remove existing dots
            document.querySelectorAll('.pain-dot').forEach(dot => dot.remove());

            painPoints.forEach(point => {
                const dot = document.createElement('div');
                dot.classList.add('pain-dot');
                dot.style.left = `${point.x}%`;
                dot.style.top = `${point.y}%`;
                dot.onclick = (e) => {
                    e.stopPropagation(); // Prevent re-triggering parent click
                    removePainPoint(point.id);
                };
                bodyMapImage.parentElement.appendChild(dot);
            });
        }

        function removePainPoint(id) {
            painPoints = painPoints.filter(p => p.id !== id);
            renderPainPoints();
            updateSelectedPainAreasDisplay();
        }

        function updateSelectedPainAreasDisplay() {
            if (painPoints.length === 0) {
                selectedPainAreas.textContent = currentLanguage === 'ta' ? 'வலியை உணர இடத்தைக் கிளிக் செய்யவும்.' : 'Click on the map to mark pain areas.';
            } else {
                selectedPainAreas.textContent = `${currentLanguage === 'ta' ? 'குறிக்கப்பட்ட வலி புள்ளிகள்:' : 'Marked Pain Points:'} ${painPoints.length}`;
            }
        }

        async function getPainSuggestions() {
            if (painPoints.length === 0) {
                painSuggestionOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'பரிந்துரைகளைப் பெற சில வலி புள்ளிகளைக் குறிக்கவும்.' : 'Please mark some pain points to get suggestions.'}</p>`;
                return;
            }

            showLoading(true, translations[currentLanguage].loadingText);
            painSuggestionOutput.innerHTML = "";
            await new Promise(resolve => setTimeout(resolve, 2500)); // Simulate delay

            let suggestion = "";
            if (currentLanguage === 'ta') {
                suggestion += "<h3>உங்கள் வலி புள்ளிகளுக்கான பரிந்துரைகள்:</h3><ul>";
                painPoints.forEach((p, index) => {
                    // This is a very basic mock based on general areas. A real app would use more sophisticated mapping.
                    let area = "உடல் பகுதி";
                    if (p.y < 30) area = "தலை/கழுத்து"; // Top of the map
                    else if (p.y >= 30 && p.y < 60) area = "மார்பு/வயிறு"; // Middle
                    else area = "கால்கள்/கைகள்"; // Lower
                    suggestion += `<li>புள்ளி ${index + 1} (${area}): ஓய்வு எடுக்கவும், மென்மையான மசாஜ் செய்யவும். வலி தொடர்ந்தால் மருத்துவரை அணுகவும்.</li>`;
                });
                suggestion += `</ul><p>இந்த பரிந்துரைகள் பொதுவான தகவல்களுக்காக மட்டுமே. துல்லியமான நோயறிதல் மற்றும் சிகிச்சைக்கு மருத்துவரை அணுகுவது அவசியம்.</p>`;
            } else { // English
                suggestion += "<h3>Suggestions for your Pain Points:</h3><ul>";
                painPoints.forEach((p, index) => {
                    let area = "body area";
                    if (p.y < 30) area = "head/neck";
                    else if (p.y >= 30 && p.y < 60) area = "chest/abdomen";
                    else area = "legs/arms";
                    suggestion += `<li>Point ${index + 1} (${area}): Consider rest, gentle massage. Consult a doctor if pain persists.</li>`;
                });
                suggestion += `</ul><p>These suggestions are for general information only. It is crucial to consult a doctor for accurate diagnosis and treatment.</p>`;
            }
            showLoading(false);
            painSuggestionOutput.innerHTML = suggestion;
        }

        // First Aid & Emergency
        function populateEmergencyDropdown(query) {
            emergencyTopicDropdown.innerHTML = '';
            emergencyTopicDropdown.classList.add('hidden');
            const relevantTopics = Object.keys(emergencyInfoData[currentLanguage]).filter(topic =>
                topic.toLowerCase().includes(query.toLowerCase())
            );

            if (relevantTopics.length > 0 && query.length > 0) {
                relevantTopics.forEach(topic => {
                    const div = document.createElement('div');
                    div.textContent = topic;
                    div.onclick = () => {
                        emergencyTopicInput.value = topic;
                        emergencyTopicDropdown.classList.add('hidden');
                    };
                    emergencyTopicDropdown.appendChild(div);
                });
                emergencyTopicDropdown.classList.remove('hidden');
            }
        }

        function getEmergencyInfo() {
            const topic = emergencyTopicInput.value.trim().toLowerCase();
            const info = emergencyInfoData[currentLanguage][topic];
            if (info) {
                emergencyInfoOutput.innerHTML = `<p><strong>${topic.charAt(0).toUpperCase() + topic.slice(1)}:</strong> ${info}</p>`;
            } else {
                emergencyInfoOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'இந்த அவசர தலைப்புக்கான தகவல் இல்லை.' : 'No information found for this emergency topic.'}</p>`;
            }
        }

        // --- Event Listeners ---

        // Splash screen fade out
        window.addEventListener('load', () => {
            setTimeout(() => {
                splashScreen.classList.add('fade-out');
                // Ensure main content is hidden initially before fade out completes
                mainContent.style.display = 'none';
            }, 1500); // Display splash for 1.5 seconds

            setTimeout(() => {
                splashScreen.style.display = 'none';
                mainContent.style.display = 'block'; // Show main content after splash
                updateContent(); // Initial content load
                loadMedicationReminders(); // Load saved reminders
                initializeSpeechRecognition(); // Initialize speech recognition
                initializeSpeechSynthesis(); // Initialize speech synthesis
            }, 2500); // 1 second for fade-out after 1.5 seconds display
        });

        languageSelect.addEventListener('change', (event) => {
            currentLanguage = event.target.value;
            updateContent();
            // Re-initialize speech recognition and synthesis for new language
            if (speechRecognition) speechRecognition.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US';
            populateVoiceList();
        });

        generateBtn.addEventListener('click', generateHealthTip);
        micBtn.addEventListener('click', () => {
            if (speechRecognition) {
                if (isRecording) {
                    speechRecognition.stop();
                } else {
                    speechRecognition.start();
                }
            }
        });

        aiVoiceBtn.addEventListener('click', () => {
            const textToSpeak = tipOutput.textContent;
            if (textToSpeak && textToSpeak !== translations[currentLanguage].tipOutputPlaceholder) {
                speakText(textToSpeak);
            } else {
                alert(currentLanguage === 'ta' ? 'குரல் உள்ளீட்டிற்கு எந்த உரையும் இல்லை.' : 'No text to speak for AI voice.');
            }
        });

        // Toggle features view (from initial view to features container showing icons)
        toggleFeaturesBtn.addEventListener('click', () => {
            showSection('featuresContainer');
        });

        // Back button from features container to initial view
        backToMainFromFeaturesContainer.addEventListener('click', () => {
            showSection('initialView');
        });

        // Feature icons click handlers (from features icons list to specific feature section)
        document.querySelectorAll('.feature-icon').forEach(icon => {
            icon.addEventListener('click', (event) => {
                const sectionId = icon.dataset.section;
                showSection(sectionId);
            });
        });

        // Back buttons inside individual feature sections (from specific feature section back to features icons list)
        document.querySelectorAll('.feature-section .back-button').forEach(button => {
            button.addEventListener('click', (event) => {
                const target = event.target.dataset.target; // This will be 'allFeatureIconsContainer'
                showSection(target);
            });
        });

        // Step Tracker Events
        addOneStepBtn.addEventListener('click', addOneStep);
        toggleTrackingBtn.addEventListener('click', toggleStepTracking);
        resetStepsBtn.addEventListener('click', resetSteps);

        // Heart Rate Tracker Events
        simulateHeartRateBtn.addEventListener('click', simulateHeartRate);
        resetHeartRateBtn.addEventListener('click', resetHeartRate);

        // Water Tracker Events
        addWaterBtn.addEventListener('click', addWater);
        resetWaterBtn.addEventListener('click', resetWater);

        // Journal Events
        saveJournalEntryBtn.addEventListener('click', saveJournalEntry);
        // Initial render for journal entries
        renderJournalEntries();

        // Local Tips Events
        localTipCategory.addEventListener('input', (event) => {
            populateLocalTipDropdown(event.target.value);
        });
        localTipCategory.addEventListener('focus', (event) => {
            populateLocalTipDropdown(event.target.value);
        });
        localTipCategory.addEventListener('blur', () => {
            setTimeout(() => { // Delay hiding to allow click on dropdown items
                localTipCategoryDropdown.classList.add('hidden');
            }, 100);
        });
        getLocalTipBtn.addEventListener('click', getLocalTip);

        // Meal Plan Events
        generateMealPlanBtn.addEventListener('click', generateMealPlan);

        // Mood Analysis Events
        analyzeMoodJournalBtn.addEventListener('click', analyzeMoodJournal);

        // Exercise & Yoga Events
        generateExerciseRoutineBtn.addEventListener('click', generateExerciseRoutine);

        // Disease Prevention Events
        getRemedyBtn.addEventListener('click', getRemedy);

        // Wellness Challenge Events
        generateChallengeBtn.addEventListener('click', generateChallenge);

        // Medication Reminder Events
        addMedicationReminderBtn.addEventListener('click', addMedicationReminder);

        // Body Pain Mapping Events
        bodyMapImage.parentElement.addEventListener('click', handleBodyMapClick); // Click on container, not just image
        getPainSuggestionsBtn.addEventListener('click', getPainSuggestions);
        updateSelectedPainAreasDisplay(); // Initial display

        // First Aid & Emergency Events
        emergencyTopicInput.addEventListener('input', (event) => {
            populateEmergencyDropdown(event.target.value);
        });
        emergencyTopicInput.addEventListener('focus', (event) => {
            populateEmergencyDropdown(event.target.value);
        });
        emergencyTopicInput.addEventListener('blur', () => {
            setTimeout(() => { // Delay hiding to allow click on dropdown items
                emergencyTopicDropdown.classList.add('hidden');
            }, 100);
        });
        getEmergencyInfoBtn.addEventListener('click', getEmergencyInfo);

    </script>
</body>
</html>
